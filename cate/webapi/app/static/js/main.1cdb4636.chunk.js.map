{"version":3,"sources":["renderer/remoteStorageAPI.ts","renderer/webapi/apis/callHttpApi.ts","renderer/webapi/apis/FilesApi.ts","renderer/selectors.ts","common/objutil.ts","renderer/containers/ChooseWorkspaceDialog.tsx","renderer/electron.ts","renderer/webapi/HttpError.ts","common/types.ts","renderer/containers/FileUploadDialog.tsx","renderer/webapi/apis/ServiceInfoAPI.ts","renderer/containers/globe-view-layers.ts","common/memoize.ts","../node_modules/cesium/Source/Core sync","renderer/state-util.ts","common/assert.ts","renderer/webapi/WebAPIClient.ts","renderer/webapi/apis/DatasetAPI.ts","renderer/webapi/apis/OperationAPI.ts","renderer/webapi/apis/WorkspaceAPI.ts","renderer/webapi/apis/BackendConfigAPI.ts","renderer/webapi/apis/ColorMapsAPI.ts","renderer/webapi/apis/FileSystemAPI.ts","renderer/resources/cate-icon-128.png","renderer/containers/editor/DictValueEditor.tsx","renderer/containers/editor/LiteralValueEditor.tsx","renderer/components/ModalDialog.tsx","renderer/containers/AnimationView.tsx","common/cate-types.ts","renderer/components/ListBox.tsx","renderer/components/desktop/fs/FileNode.ts","renderer/components/field/TextField.tsx","renderer/components/field/Field.tsx","renderer/components/cesium/cesium-util.ts","common/geojson-simple-style.ts","common/paths.ts","renderer/state.ts","renderer/toast.ts","renderer/components/ViewState.ts","renderer/containers/operation-step-dialog-ids.ts","renderer/cookies.ts","renderer/initial-state.ts","renderer/reducers.ts","renderer/containers/GdprBanner.tsx","renderer/containers/WorkspacesMenu.tsx","renderer/containers/FilesMenu.tsx","renderer/containers/HelpMenu.tsx","renderer/containers/AppBar.tsx","renderer/messages.tsx","renderer/components/ExternalObjectComponent.tsx","common/shallow-equal.ts","common/array-diff.ts","renderer/components/cesium/SplitSlider.tsx","renderer/components/cesium/geometry-tool.ts","renderer/components/cesium/CesiumGlobe.tsx","common/geometry-util.ts","renderer/containers/GlobeView.tsx","renderer/components/matplotlib/MplFigure.ts","renderer/components/matplotlib/MplFigureContainer.tsx","renderer/components/ToolButton.tsx","renderer/components/matplotlib/MplFigurePanel.tsx","renderer/containers/FigureView.tsx","renderer/containers/ServiceAutoCloseDialog.tsx","renderer/containers/TableView.tsx","renderer/components/Splitter.tsx","renderer/components/SplitPane.tsx","renderer/components/ContentWithDetailsPanel.tsx","renderer/components/DataSourceLinks.tsx","renderer/components/Markdown.tsx","renderer/components/ScrollableContent.tsx","renderer/components/DataSourceDetails.tsx","renderer/components/DataSourceItem.tsx","renderer/components/DataSourcesList.tsx","renderer/components/DataSourceOpenHint.tsx","renderer/containers/AddDatasetDialog.tsx","common/format.ts","renderer/components/field/DateField.tsx","renderer/components/field/DateRangeField.tsx","renderer/components/LongIdLabel.tsx","renderer/components/field/NumericField.tsx","renderer/components/Region.tsx","renderer/components/LabelWithType.tsx","renderer/containers/VariablesDialog.tsx","renderer/containers/editor/VarNameValueEditor.tsx","renderer/containers/DataAccessComponent.tsx","renderer/containers/editor/InputEditor.tsx","renderer/containers/editor/BooleanValueEditor.tsx","renderer/containers/editor/ValueSetValueEditor.tsx","renderer/containers/editor/IntegerValueEditor.tsx","renderer/containers/editor/FloatValueEditor.tsx","renderer/containers/editor/TextValueEditor.tsx","renderer/containers/editor/FileValueEditor.tsx","renderer/components/GeometryDialog.tsx","renderer/components/field/GeometryField.tsx","renderer/containers/editor/GeometryValueEditor.tsx","renderer/containers/editor/TimeRangeValueEditor.tsx","renderer/containers/DimensionsDialog.tsx","renderer/containers/editor/DimNameValueEditor.tsx","renderer/containers/editor/TimeValueEditor.tsx","renderer/components/ScriptDialog.tsx","renderer/components/field/ScriptField.tsx","renderer/containers/editor/ScriptValueEditor.tsx","renderer/containers/editor/ValueEditor.tsx","renderer/containers/OperationStepDialog.tsx","renderer/containers/OpenDatasetDialog.tsx","renderer/containers/RemoveDatasetDialog.tsx","renderer/containers/DataSourcesPanel.tsx","renderer/containers/OperationsPanel.tsx","renderer/containers/WebAPIStatusBox.tsx","renderer/containers/WorkflowStepPropertiesDialog.tsx","renderer/containers/WorkspacePanel.tsx","renderer/containers/VariablesPanel.tsx","renderer/containers/LayerSourcesDialog.tsx","renderer/containers/PlacemarksPanel.tsx","renderer/containers/ViewPanel.tsx","renderer/containers/TaskComponent.tsx","renderer/containers/TasksPanel.tsx","renderer/components/TermsAndConditions.tsx","renderer/containers/VersionTags.tsx","version.ts","renderer/containers/StatusBar.tsx","renderer/components/SubPanelHeader.tsx","renderer/containers/LayersPanel.tsx","renderer/components/field/NumericRangeField.tsx","renderer/containers/StylesPanel.tsx","renderer/containers/SelectWorkspaceDialog.tsx","renderer/containers/NewWorkspaceDialog.tsx","renderer/containers/SaveWorkspaceAsDialog.tsx","renderer/containers/PreferencesDialog.tsx","renderer/components/desktop/fs/FileList.tsx","renderer/components/desktop/fs/RootNodeLoading.tsx","renderer/components/desktop/fs/FileTree.tsx","renderer/components/desktop/fs/FileDialog.tsx","renderer/components/desktop/fs/OpenDialog.tsx","renderer/containers/DirectorySelectDialog.tsx","renderer/containers/FileOpenDialog.tsx","renderer/components/desktop/fs/SaveDialog.tsx","renderer/containers/FileSaveDialog.tsx","renderer/containers/FileBrowseDialog.tsx","renderer/components/desktop/MessageBox.tsx","renderer/containers/MessageBox.tsx","renderer/components/PanelContainer.tsx","renderer/components/Panel.tsx","renderer/components/ViewManager.tsx","renderer/components/MessageDetails.tsx","renderer/containers/JobFailureDialog.tsx","renderer/containers/FileDownloadDialog.tsx","renderer/containers/AppMainPage.tsx","renderer/containers/AppMainPageWrapper.tsx","index.tsx","renderer/main.tsx","renderer/containers/editor/value-editor-assign.ts","renderer/actions.ts","renderer/components/desktop/electron.ts","renderer/components/desktop/actions.tsx","renderer/webapi/Job.ts"],"names":["RemoteStorageAPI","webAPIClient","this","call","session","callApi","endpointUrl","queryComponents","init","url","length","map","kv","encodeURIComponent","join","makeUrl","console","debug","fetch","then","response","ok","log","HttpError","status","statusText","catch","error","callBlobApi","fileName","blob","uuidv4","objectUrl","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","callJsonApi","json","FilesAPI","processId","onProgress","serviceUrl","undefined","mode","method","JSON","stringify","dir","file","formData","FormData","append","name","filePaths","target_files","electron","requireElectron","EMPTY_OBJECT","EMPTY_ARRAY","offlineModeSelector","state","offlineMode","webAPIServiceInfoSelector","communication","webAPIServiceInfo","webAPIClientSelector","webAPIServiceURLSelector","webAPIServiceURL","isLocalFSAccessAllowedSelector","ipcRenderer","userRootMode","webAPIRestUrlSelector","createSelector","makeURL","getRestUrl","apiWebSocketsUrlSelector","getAPIWebSocketsUrl","mplWebSocketUrlSelector","getMPLWebSocketsUrl","ws","path","_url","protocol","pathname","newUrl","host","startsWith","endsWith","backendConfigAPISelector","BackendConfigAPI","datasetAPISelector","DatasetAPI","operationAPISelector","OperationAPI","workspaceAPISelector","WorkspaceAPI","remoteStorageAPISelector","colorMapsAPISelector","ColorMapsAPI","fileSystemAPISelector","FileSystemAPI","activeRequestLocksSelector","activeRequestLocks","Set","jobId","tasks","task","JobStatusEnum","NEW","SUBMITTED","IN_PROGRESS","add","requestLock","DIALOG_STATE_SELECTORS","dialogStatesSelector","control","dialogs","dialogStateSelector","dialogId","dialogStates","isDialogOpenSelector","Object","getOwnPropertyNames","some","isOpen","panelContainerUndockedModeSelector","panelContainerUndockedMode","leftPanelContainerLayoutSelector","leftPanelContainerLayout","rightPanelContainerLayoutSelector","rightPanelContainerLayout","selectedLeftTopPanelIdSelector","selectedLeftTopPanelId","selectedLeftBottomPanelIdSelector","selectedLeftBottomPanelId","selectedRightTopPanelIdSelector","selectedRightTopPanelId","selectedRightBottomPanelIdSelector","selectedRightBottomPanelId","newPlacemarkToolTypeSelector","newPlacemarkToolType","placemarkCollectionSelector","placemarkCollection","selectedPlacemarkIdSelector","selectedPlacemarkId","showPlacemarkDetailsSelector","showPlacemarkDetails","defaultPlacemarkStyleSelector","defaultPlacemarkStyle","selectedPlacemarkSelector","features","placemarks","canFind","find","placemark","id","globeMousePositionSelector","location","globeMousePosition","globeViewPositionSelector","globeViewPosition","operationsSelector","data","operations","operationFilterTagsSelector","operationFilterTags","operationFilterExprSelector","operationFilterExpr","selectedOperationNameSelector","selectedOperationName","selectedOperationSelector","op","selectedCtxOperationSelector","selectedCtxOperationName","filteredOperationsSelector","hasOperations","hasFilterExpr","hasFilterTags","nameMatches","hasTag","parts","toLowerCase","split","every","part","includes","tag","tags","has","filter","operationsTagCountsSelector","tagCounts","Map","forEach","set","get","dataStoresSelector","dataStores","selectedDataStoreIdSelector","selectedDataStoreId","selectedDataSourceIdSelector","selectedDataSourceId","dataSourceFilterExprSelector","dataSourceFilterExpr","dataSourceListHeightSelector","dataSourceListHeight","showDataSourceDetailsSelector","showDataSourceDetails","showAllDataSourcesSelector","showAllDataSources","showDataSourceIDsSelector","showDataSourceIDs","showDataStoreDescriptionSelector","showDataStoreDescription","showDataStoreNoticesSelector","showDataStoreNotices","selectedDataStoreSelector","dataStore","selectedDataSourcesSelector","selectedDataStore","dataSources","filteredDataSourcesSelector","selectedDataSources","ds","searchWords","canOpenDataSource","word","title","metaInfo","matchesIdOrTitle","selectedDataSourceSelector","dataSource","selectedDataSourceTemporalCoverageSelector","selectedDataSource","time_range","canCacheDataSourceSelector","canCacheDataSource","canConstrainDataSourceTimeSelector","canMapDataSource","canConstrainDataSourceTime","canConstrainDataSourceRegionSelector","canConstrainDataSourceRegion","canConstrainDataSourceVariablesSelector","canConstrainDataSourceVariables","workspaceSelector","workspace","isScratchWorkspaceSelector","isScratch","workspaceBaseDirSelector","baseDir","resourcesSelector","resources","workflowStepsSelector","workflow","steps","resourceListHeightSelector","resourceListHeight","showResourceDetailsSelector","showResourceDetails","selectedResourceNameSelector","selectedWorkspaceResourceName","workflowStepListHeightSelector","workflowStepListHeight","showWorkflowStepDetailsSelector","showWorkflowStepDetails","selectedWorkflowStepIdSelector","selectedWorkflowStepId","selectedVariableNameSelector","selectedVariableName","workspaceNameSelector","index","Math","max","lastIndexOf","substring","getFileName","workspaceDirSelector","getParentDir","lastWorkspaceDirSelector","lastWorkspacePath","resourceNamesSelector","r","resourceMapSelector","resourceMap","resource","selectedResourceSelector","selectedResourceName","selectedResourceAttributesSelector","selectedResource","attributes","array","attrName","hasOwnProperty","push","selectedWorkflowStepResourceSelector","selectedWorkflowStepSelector","workflowSteps","selectedResourceWorkflowStepSelector","selectedWorkflowStepOpSelector","selectedWorkflowStep","findOperation","figureResourcesSelector","isFigureResource","animationResourcesSelector","isAnimationResource","variablesSelector","variables","selectedVariableSelector","selectedVariables","v","selectedVariableAttributesTableDataSelector","selectedVariable","tableData","dataType","units","validMin","validMax","dimNames","shape","chunkSizes","viewLayoutSelector","viewLayout","viewsSelector","views","activeViewIdSelector","activeViewId","activeViewSelector","view","type","activeViewTypeSelector","selectedEntityIdSelector","selectedEntityId","selectedEntitySelector","unusedEntityId","getWorldViewSelectedEntity","selectedWorldViewViewerSelector","getWorldViewViewer","selectedGeometryWKTGetterSelector","getWorldViewSelectedGeometryWKTGetter","externalObjectStoreSelector","EXTERNAL_OBJECT_STORE","savedLayersSelector","savedLayers","selectedLayerIdSelector","selectedLayerId","baseMapsSelector","baseMaps","baseMapIdSelector","baseMapId","DEFAULT_BASE_MAP_ID","baseMapSelector","bm","DEFAULT_BASE_MAP","baseMapOptionsSelector","baseMap","options","layersSelector","layers","selectedLayerSelector","l","selectedLayerIndexSelector","findIndex","selectedImageLayerSelector","selectedLayer","selectedVariableImageLayerSelector","selectedVariableImageLayerDisplayMinMaxSelector","displayMin","isNumber","displayMax","selectedVectorLayerSelector","styleContextSelector","styleContext","vectorStyleSelector","entityUpdateCount","selectedVectorLayer","selectedPlacemark","selectedEntity","style","selectedLayerStyle","STYLE_CONTEXT_LAYER","STYLE_CONTEXT_ENTITY","placemarkStyle","simpleStyleFromFeatureProperties","properties","entityStyle","entityToSimpleStyle","entityVectorLayer","getWorldViewVectorLayerForEntity","entityVectorLayerStyle","savedEntityStyle","entityStyles","SIMPLE_STYLE_DEFAULTS","selectedResourceVectorLayerSelector","selectedLayerVariablesSelector","layerVariables","variable","isSpatialImageVariable","isSpatialVectorVariable","isComputingVariableStatistics","selectedVariableImageLayer","imageLayer","getLockForGetWorkspaceVariableStatistics","varIndex","colorMapCategoriesSelector","colorMaps","selectedColorMapSelector","colorMapCategories","selectedImageLayer","selectedColorMapName","colorMapName","selectedColorMap","cm","fileAPISelector","updateObject","target","sources","assign","updatePropertyObject","propertyName","newValue","oldValue","OPEN_WORKSPACE_DIALOG_ID","DELETE_WORKSPACE_DIALOG_ID","ChooseWorkspaceDialog","props","renderItem","workspaceDir","currentWorkspaceName","selectedWorkspaceName","deleteEntireWorkspace","onCancel","bind","onConfirm","canConfirm","renderBody","onWorkspaceNameChange","onWorkspaceDirChange","nextProps","setState","dispatch","actions","resetSelectedWorkspaceName","test","workspaceName","composeWorkspacePath","event","checked","ev","value","confirmTitle","checkbox","workspaceNames","marginTop","content","label","onChange","handleCheckboxChange","items","selectionMode","ListBoxSelectionMode","SINGLE","getItemKey","item","itemIndex","onSelection","newSelection","setSelectedWorkspace","selection","React","connect","ownProps","dialogState","selectors","isLocalFSAllowed","indexOf","splice","isElectron","Boolean","window","_status","message","Error","isDefined","isUndefined","isDefinedAndNotNull","isUndefinedOrNull","isString","isBoolean","DIV_STYLE","width","marginBottom","display","flexGrow","TEXT_FIELD_STYLE","BUTTON_STYLE","flex","baseStyle","flexDirection","alignItems","padding","border","borderRadius","background","color","transition","FileUploadDialog","handleOnDrop","files","handleOpenDirectoryOnClose","handleOpenDirectoryOpen","showDirectorySelectDialog","DIALOG_ID","icon","confirmIconName","confirmTooltip","key","size","fill","nullable","intent","Intent","PRIMARY","onClick","onDrop","getRootProps","getInputProps","className","FILE_UPLOAD_DIALOG_ID","ServiceInfoAPI","serviceURL","toString","fromResponse","version","timestamp","user_root_mode","hostOS","host_os","dependencies","convertLayersToLayerDescriptors","baseUrl","imageLayerDescriptors","vectorLayerDescriptors","layer","imageLayerDescriptor","vectorLayerDescriptor","convertVariableImageLayerToDescriptor","convertResourceVectorLayerToDescriptor","convertVectorLayerToDescriptor","AUTO_LAYER_ID","warn","findVariable","varName","resId","imageLayout","getTileUrl","rectangle","Cesium","MAX_VALUE","extent","fromDegrees","west","south","east","north","imageryProvider","createImageryProvider","imageryProviderOptions","minimumLevel","maximumLevel","numLevels","tileWidth","tileHeight","tilingScheme","numberOfLevelZeroTilesX","numLevelZeroTilesX","numberOfLevelZeroTilesY","numLevelZeroTilesY","findResource","createResourceGeoJSONDataSource","dataSourceOptions","getFeatureCollectionUrl","COUNTRIES_LAYER_ID","getGeoJSONCountriesUrl","MY_PLACES_LAYER_ID","createGeoJsonDataSource","viewer","errorEvent","addEventListener","simpleStyleToCesium","load","createResourceGeoJSONDataSourceImpl","func","maxSize","memo","memoized","args","memoize","customDataSource","cStyle","worker","Worker","process","postMessage","onmessage","pointColor","fromAlpha","pointOutlineColor","featureCollection","geoJsonDataSource","featureMap","f","scaleByDistance","translucencyByDistance","entities","suspendEvents","values","entity","feature","_simp","_resId","_idx","point","billboard","ratio","area","pixelSize","position","description","outlineColor","outlineWidth","e","removeAll","resumeEvents","changedEvent","raiseEvent","entityGeometryPropertyNames","reloadEntityWithOriginalGeometry","oldEntity","featureUrl","fromEntity","toEntity","newGeomPropertyName","oldGeomPropertyName","transferEntityGeometry","webpackEmptyContext","req","code","keys","resolve","module","exports","AUTO_LAYER","visible","COUNTRIES_LAYER","stroke","fillOpacity","strokeWidth","MY_PLACES_LAYER","markerSize","markerColor","markerSymbol","strokeOpacity","PLACEMARK_ID_PREFIX","isLocalDataStore","isLocal","isRemoteDataStore","getDataSourceUrls","catalogUrl","infoUrl","catalog_url","catalogue_url","uuid","info_url","computeDataSourceCapabilities","dsd","canConstrainTime","isCoord1DInDataset","canConstrainRegion","data_type","coords","c","dims","d","isCoord1D","_checkDataSourceCapability","data_vars","capabilities","Array","isArray","availableCapabilities","requiredCapabilities","requiredCapability","alphaBlending","ref","getFeatureUrl","getCsvUrl","varPart","getHtmlUrl","getMPLWebSocketUrl","figureId","getMPLDownloadUrl","numDims","isFeatureAttribute","genSimpleId","prefix","floor","random","Date","now","genLayerId","isDataFrameResource","getLayerDisplayName","resName","getLayerTypeIconName","isVectorLayer","findResourceById","findResourceByName","qualifiedName","findDataSource","dataStoreId","dataSourceId","findVariableIndexCoordinates","coordVariables","coordDataMap","cv","i","coordIndex","dimName","coord","coordData","getNonSpatialIndexers","dimIndexers","newCfSBaseMap","toUpperCase","BASE_MAPS","credit","newInitialWorldViewData","viewMode","projectionCode","layerSplitPosition","newInitialTableViewData","dataRows","WORLD_VIEW_COUNTER","newWorldView","viewNumber","newFigureView","getFigureViewTitle","resourceId","fixedSize","resourceName","newAnimationView","newTableView","getWorldViewExternalObject","externalObject","object","assert","dataSourceMap","dataSourceCollection","contains","layerId","entityToGeometryWkt","isImageLayer","STROKE_COLORS","FILL_COLORS","newVariableLayer","spatialImageVariable","spatialVectorVariable","restoredLayer","layerDisplayProperties","updateVariableLayerVarIndex","restoredStyle","getResourceVectorStyle","updateAutoLayer","getLockForLoadDataSources","getVariableLock","slice","defaultDisplayMin","defaultDisplayMax","opacity","brightness","contrast","hue","saturation","gamma","splitMode","SPLIT_MODE_OFF","newVariableLayerDisplayProperties","newVarIndex","_hasWebGL","hasWebGL","canvas","extensions","getContext","getSupportedExtensions","getPlacemarkTitleAndIndex","t","geometry","titles","condition","ERROR_CODE_INVALID_REQUEST","ERROR_CODE_METHOD_NOT_FOUND","ERROR_CODE_INVALID_PARAMS","ERROR_CODE_OS_ERROR","ERROR_CODE_OUT_OF_MEMORY","ERROR_CODE_METHOD_ERROR","ERROR_CODE_INVALID_RESPONSE","ERROR_CODE_CANCELLED","CANCEL_METHOD","DEBUG","newWebAPIClient","firstMessageId","socket","WebAPIClientImpl","onOpen","onClose","onError","onWarning","currentMessageId","activeJobs","WebSocket","onopen","onclose","onerror","processMessage","params","transformer","request","newId","job","JobImpl","invoke","cancel","close","jsonrpc","messageText","send","eval","err","warnInvalidJsonRcpMessage","notifyDone","progress","notifyInProgress","notifyFailed","detailsMessage","jsonRcpMessage","readyState","OPEN","onResolve","onReject","CANCELLED","promise","Promise","setHandlers","sendMessage","setStatus","getJob","getJobId","DONE","failure","FAILED","getRequest","getJobFailureIntentName","WARNING","getJobFailureIconName","exception","getJobFailureTitle","NON_DEVELOPER_ERRORS","isDeveloperError","USER_ERRORS","isUserError","responseToDataSources","responseToMetaInfo","filePathPattern","removeFiles","source","indexers","metaInfoStatus","responseToOperations","operationsResponse","responseOperationToOperation","qualified_name","header","hasMonitor","has_monitor","inputs","responseInputToOperationInput","outputs","responseOutputToOperationOutput","input","password","defaultValue","default_value","valueSet","value_set","valueSetSource","value_set_source","valueRange","value_range","scriptLang","script_lang","fileOpenMode","file_open_mode","fileFilters","file_filters","fileProps","file_props","noUI","no_ui","step_id","output","webAPI","responseToWorkspace","workspaceResponse","base_dir","is_scratch","isModified","is_modified","isSaved","is_saved","resourcesResponse","variablesResponse","validRange","rangeOk","validMinMin","responseToWorkspaceAndResName","workspaceAndResNameResponse","toDir","opName","opArgs","overwrite","persistent","newResName","fromPythonConfig","configResponse","dataStoresPath","data_stores_path","useWorkspaceImageryCache","use_workspace_imagery_cache","resourceNamePattern","default_res_pattern","proxyUrl","http_proxy","config","backendConfig","responseToColorMaps","colorMapsResponse","v1","v2","imageData","DictValueEditor","textValue","toTextValue","validator","validateDictText","placeholder","trim","None","True","False","LiteralValueEditor","validatePythonLiteralText","ModalDialog","autoFocus","canEscapeKeyClose","canOutsideClickClose","enforceFocus","renderDialogContent","renderDialogFooter","Classes","DIALOG_BODY","children","DIALOG_FOOTER","DIALOG_FOOTER_ACTIONS","renderActions","cancelButton","noCancelButton","extraActions","confirmButton","disabled","renderExtraActions","mapStateToProps","animationResources","mplWebSocketUrl","AnimationView","divElement","onRef","innerHTML","loading","elements","getElementsByTagName","script","getAnimationResource","animationViewData","dangerouslySetInnerHTML","__html","height","overflowX","overflowY","BOOL_TYPE","INT_TYPE","FLOAT_TYPE","STR_TYPE","ND_ARRAY_TYPE","DATASET_TYPE","DATA_ARRAY_TYPE","DATA_FRAME_TYPE","SERIES_TYPE","DATASET_LIKE_TYPE","DATA_FRAME_LIKE_TYPE","POINT_LIKE_TYPE","POLYGON_LIKE_TYPE","GEOMETRY_LIKE_TYPE","TIME_LIKE_TYPE","TIME_RANGE_LIKE_TYPE","VAR_NAME_LIKE_TYPE","VAR_NAMES_LIKE_TYPE","DIM_NAME_LIKE_TYPE","DIM_NAMES_LIKE_TYPE","DICT_LIKE_TYPE","FILE_LIKE_TYPE","LITERAL_TYPE","isAssignableFrom","targetDataType","sourceDataType","ListBox","detail","oldSelection","toSelectionArray","k","MULTIPLE","onItemClick","onItemDoubleClick","renderedItems","renderedItem","handleClick","onDoubleClick","handleDoubleClick","itemStyle","obj","constructor","ALL_FILES_FILTER","updateFileNode","rootNode","updatedFileNode","childNodes","newRootNode","currentNode","depth","childIndex","n","localeCompare","newChildNode","childNode","_updateFileNode","getFileNodePath","pathNames","fileNodePath","_getValidSubFileNodePath","rootNodes","node","getFileNode","getFileNodeIcon","isDir","compareFileNames","b","addExpandedDirPath","expandedPaths","parentDir","getParentPath","cleanedPaths","p","removeExpandedDirPath","isPathValidAtIndex","applyFileFilter","nodes","fileFilter","extSet","ext","getBasenameExtension","fromPathInputValue","inputValue","currentDirPath","multiSelection","paths","isWindows","escChar","token","char","abs","isAbsolutePath","replace","normalizePath","toAbsolutePath","denormalizePath","isWindowsRootPath","toPathInputValue","selectedPaths","escapePath","getBasename","TextField","Field","isFieldValue","_fieldValue","toFieldValue","uncontrolled","handleKeyPress","handleBlur","handleInputChange","setFieldValue","newFieldValueFromValue","newFieldValueFromValueAndTextValue","newFieldValueFromTextValue","charCode","setTextValue","parseValue","validateValue","formatValue","fieldValue","getError","errorClassName","ERROR_CLASS","nominalClassName","NOMINAL_CLASS","getTextValue","onBlur","onKeyPress","INTENT_DANGER","MARKER_SIZES","small","medium","large","defaults","getString","fromCssColorString","getNumber","pinBuilder","markerCanvas","fromColor","fromText","fromMakiIconId","pixelSizeValue","getValue","colorValue","rgbToCssColor","red","green","blue","pointGraphicsToSimpleStyle","image","scale","imageValue","scaleValue","billboardGraphicsToSimpleStyle","text","fillColor","labelGraphicsToSimpleStyle","polyline","material","alpha","polylineGraphicsToSimpleStyle","polygon","isFilled","isOutlined","outline","polygonGraphicsToSimpleStyle","applyStyleToEntityCollection","applyStyleToEntity","colorToHexString","g","entityToGeoJson","fromCartesian","_entityToGeoJson","coordinates","toDegrees","longitude","latitude","positions","hierarchy","holes","ring","cartesian3ArrayToWktArray","cartesian3ArrayToWkt","exterior","linearRings","interior","x1","toDeg","y1","x2","y2","cartesian3ToWkt","TypeError","canvasToCartographic","canvasPos","degrees","cartographic","ellipsoid","scene","globe","cartesian","camera","pickEllipsoid","cartesianToCartographic","round","clientToCanvas","clientPos","rect","getBoundingClientRect","x","y","left","right","top","bottom","pickEntity","pickedObject","pick","setViewerBaseMap","baseMapOptions","bgMapImageryProvider","z","imageryLayers","oldLayer","remove","getEntityByEntityId","entityId","getById","PI","_getValue","predicate","objects","o","styleProperties","simpleStyle","featurePropertiesFromSimpleStyle","isLinuxRootPath","isWindowsNetworkDevicePath","isWindowsDrivePath","makeAbsolutePath","path1","path2","comps1","splitPath","comps2","joinPathComponents","normPathComponents","concat","makeRelativePath","relPathComps","n1","n2","iFirstDiff","min","components","newComponents","insPos","component","substr","basename","SPLIT_MODE_LEFT","SPLIT_MODE_RIGHT","MessageToaster","showToast","timeout","action","Toaster","create","Position","BOTTOM","NONE","SUCCESS","DANGER","show","isViewSplitState","isViewPanelState","getViewPanel","viewPath","_getViewPanel","pathIndex","viewSplit","layoutIndex","layouts","findViewPanel","viewPanel","findMoveTargetViewIds","sourceViewId","result","before","after","_collectMoveTargetViewIds","viewIds","lastViewId","viewId","nextViewId","layout","moveView","placement","targetViewId","_moveView","oldLayout1","oldLayout2","newLayout1","newLayout2","selectedViewId","sourceViewIndex","selectedViewIndex","targetViewIndex","addViewToPanel","placeAfterViewId","_addViewToPanel","oldViewIds","placeAfterIndex","insertionIndex","addViewToLayout","_addViewToLayout","oldLayout","splitViewPanel","pos","_splitViewPanel","charCodeAt","newLayout","viewIds1","viewIds2","changeViewSplitPos","delta","_changeViewSplitPos","selectViewInLayout","_selectViewInLayout","removeViewFromLayout","_removeViewFromLayout","removeViewFromViewArray","w","selectView","viewIndex","C_OPTIONS","expires","storeCookieConsent","trackingConsentObtained","Cookies","INITIAL_DATA_STATE","fsRootNode","lastModified","INITIAL_WORLD_VIEW","INITIAL_CONTROL_STATE","directorySelectDialog","fileOpenDialog","fileSaveDialog","fileBrowseDialog","messageBox","INITIAL_SESSION_STATE","reopenLastWorkspace","autoUpdateSoftware","autoShowNewFigures","showSelectedVariableLayer","operationListHeight","showOperationDetails","variableListHeight","showVariableDetails","layerListHeight","showLayerDetails","lastBaseMapId","horPos","verPos","placemarkListHeight","workspacePanelMode","showLayerTextOverlay","debugWorldView","cookieConsentObtained","INITIAL_COMMUNICATION_STATE","webAPIStatus","INITIAL_LOCATION_STATE","positionData","updateDataStores","createDataSources","payload","dataStoreIndex","oldDataStore","newDataStore","newDataStores","addView","newViewLayout","newViews","addViewToViewArray","oldViewLayout","viewsReducer","oldView","newView","viewReducer","isActiveView","layersReducer","selectLayer","layerIndex","temp","newLayers","newLayer","layerReducer","oldStyle","newStyle","deepEqual","updatePlacemarkProperties","placemarkId","featureIndex","oldFeature","oldProperties","newProperties","newFeature","updatePlacemarkGeometry","oldGeometry","newGeometry","stateReducer","combineReducers","UPDATE_FS_ROOT_NODE","newDataSources","dataSourceIndex","oldDataSource","newDataSource","figureView","animationView","tableView","containsActiveId","activeViewPanel","inputAssignments","removedFeatureIndex","OBTAIN_COOKIE_CONSENT","autoStopInfo","webAPIAutoStopInfo","hubStatus","taskState","customizeMode","setCustomizeMode","trackingAllowed","setTrackingAllowed","isCloseButtonShown","DRAWER_BODY","obtainCookieConsent","rightIcon","currentTarget","WorkspacesMenu","newWorkspaceInteractive","openWorkspaceInteractive","closeWorkspaceInteractive","saveWorkspaceInteractive","saveWorkspaceAsInteractive","deleteWorkspaceInteractive","FilesMenu","fileUploadInteractive","fileDownloadInteractive","showItemInFolder","HelpMenu","openUrl","open","TITLE_STYLE","marginLeft","AppBar","src","cateIcon","alt","align","PopoverPosition","CONFIG_ERROR_MESSAGE","NO_WORKSPACE","NO_WORKSPACE_RESOURCES","NO_WORKFLOW_STEPS","NO_DATA_STORES_FOUND","NO_LOCAL_DATA_SOURCES","DATA_SOURCES_LOADING","NO_DATA_SOURCES_FOUND","NO_OPERATIONS_FOUND","NO_VARIABLES","NO_ACTIVE_VIEW","NO_WEB_GL","NO_PLACES","NO_PLACE_SELECTED","NO_LAYERS_NO_VIEW","NO_LAYERS_EMPTY_VIEW","NO_LAYER_SELECTED","NO_LAYER_FOR_STYLE","NO_ENTITY_FOR_STYLE","NO_TABLE_DATA","ExternalObjectComponent","parentContainer","checkProps","externalObjectStore","prevState","container","updateExternalComponentAndSaveProps","remountExternalObject","renderChildren","externalObjectRef","unmountExternalObject","mountExistingExternalObject","mountNewExternalObject","newContainer","newExternalObject","externalObjectMounted","externalObjectUnmounted","nextState","propsToExternalObjectState","shouldExternalObjectUpdate","updateExternalObject","t1","names1","names2","shallowEqual","DEFAULT_EXTERNAL_OBJECT_STORE","arrayDiff","oldArray","newArray","computeChange","currentArray","newIds","oldIndex","oldElement","newIndex","newElement","currentElement","currentIndex","numSteps","change","SplitSlider","sliderElement","dragStartX","handleRef","mouseDown","mouseUp","sliderMove","clientX","offsetLeft","removeEventListener","splitPosition","parentElement","offsetWidth","splitPos","backgroundColor","zIndex","cursor","CHARTREUSE","withAlpha","polylineColor","YELLOW","polygonColor","AQUA","CesiumToolContext","onNewEntity","_viewer","_ellipsoid","_toolDataSource","_handler","_onNewEntity","handler","setInputAction","leftClick","tool","isActive","onLeftClick","requestRender","LEFT_CLICK","doubleClick","onLeftDoubleClick","LEFT_DOUBLE_CLICK","movement","onMouseMove","MOUSE_MOVE","cartographicToCartesian","destroy","_tool","NO_TOOL","handleLeftClick","handleLeftDoubleClick","handleMouseMove","deactivate","context","activate","ToolBase","_context","PointTool","newEntity","PolyTool","genPolygon","polylinePositions","polygonPositions","polylineEntity","polygonEntity","hasRubberband","reset","addPoint","moveLastPoint","endPosition","endInteraction","screenPosition","cartesianWithHeightDelta","updatePositions","addToolEntity","BLACK","polylinePoint","newPointAdded","numPoints","equals","polygonPoint","removeAllToolEntities","PolylineTool","PolygonTool","BoxTool","position1","position2","setPosition","doAdd","getPositions","carto1","carto2","lon1","lat1","lon2","lat2","defaultAccessToken","CENTRAL_EUROPE_BOX","DEFAULT_VIEW_RECTANGLE","DEFAULT_VIEW_FACTOR","CesiumGlobe","cesiumEventHandler","selectedEntityChangeHandler","toolContext","handleRemoteBaseLayerError","isContextMenuOpen","splitLayerPosition","onLayerSplitPosChange","div","setAttribute","baseLayerImageryProvider","getStaticNaturalEarthImageryProvider","cesiumViewerOptions","animation","baseLayerPicker","selectionIndicator","fullscreenButton","geocoder","homeButton","infoBox","sceneModePicker","timeline","navigationHelpButton","navigationInstructionsInitiallyVisible","automaticallyTrackDataSourceClocks","requestRenderMode","maximumRenderTimeChange","Infinity","oncontextmenu","handleContextMenu","debugShowFramesPerSecond","viewModel","originalUpdate","update","vm","apply","styleValue","_screenPositionY","_screenPositionX","_selectionIndicatorElement","timesRetried","getExternalObjectRef","imageryLayer","staticNaturalEarthImageryProvider","addImageryProvider","renderContextMenu","screenPos","clientY","contextMenu","preventDefault","ContextMenu","overlayHtml","geometryToolType","prevBaseMapOptions","prevSelectedPlacemarkId","prevImageLayerDescriptors","prevVectorLayerDescriptors","prevOverlayHtml","prevSplitLayerPosition","prevGeometryToolType","nextBaseMapOptions","nextSelectedPlacemarkId","nextImageLayerDescriptors","nextVectorLayerDescriptors","nextOverlayHtml","nextSplitLayerPosition","nextGeometryToolType","shouldRequestRender","updateImageLayers","updateVectorLayers","updatePlacemarkSelection","updateOverlayHtml","imagerySplitPosition","activateGeometryTool","handleInputAction","canvasPosition","shouldPickEntity","callback","onLeftUp","LEFT_UP","onRightClick","RIGHT_CLICK","onSelectedEntityChanged","selectedEntityChanged","onNewEntityAdded","onViewerMounted","onViewerUnmounted","selectedEntityInViewer","currentPlacemarks","nextPlacemarks","promises","dataSourcePromise","moveEntities","removeById","oldPlacemark","newPlacemark","all","currentLayers","nextLayers","cesiumIndex","addLayer","setLayerProps","removeLayer","minificationFilter","NEAREST","magnificationFilter","lower","raise","addDataSource","removeDataSource","updateDataSource","getDataSource","resolvedDataSource","setDataSourceProps","oldData","newData","updatePlacemarks","styleDelta","diff","oldEntityStyles","newEntityStyles","entityStylesDelta","entityStyleDelta","layerDescriptor","getImageryProvider","dataSourceDescriptor","replaceChild","splitDirection","LEFT","RIGHT","from","to","WKT_GEOMETRY_TYPES","WKT_GEOMETRIES_TEXT","s","isAlpha","parseFloatWithError","errorText","parseFloat","isNaN","validateGeometryValue","geometryType","isWKT","geometryName","geometryTypeUC","validateWKTGeometryType","expectedMinCommaCount","expectedMinDepthCount","expectedMaxDepthCount","commaCount","depthCount","maxDepthCount","validateWKTBody","i1","i2","coordParts","validateGeoCoordinate","lon","lat","isBox","x0","y0","x3","y3","x4","y4","geometryGeoJsonToGeometryWkt","a1","a2","GlobeView","intervalHandle","lastPosition","positionChanged","handleSelectedEntityChanged","handleNewEntityAdded","handleSplitLayerPosChange","handlePosDataUpdate","setInterval","POS_UPDATE_PERIOD","clearInterval","newPosition","newPlacemarkProperties","geoPos","wkt","menuItems","expectedInputType","dividerAdded","operation","geometryInput","isValueUsed","constantValue","descriptors","layerDescriptors","hasSplitLayer","indexCoords","varText","textDivElement","innerText","getOverlayHtml","CESIUM_GLOBE_STYLE","isDialogOpen","overflow","MplFigureCommandSourceImpl","listenersMap","dispatchCommand","listener","listeners","delete","commandData","MplFigure","webSocketUrl","commandSource","onMessage","webSocket","figureImageCanvas","rubberBandCanvas","imageObj","imageMode","waiting","lastKey","resizeTimer","lastSize","Image","handleCommand","initCanvas","onload","canvasContext","clearRect","drawImage","onunload","addCommandListener","supportsBinary","binaryType","sendRefresh","sendResize","clientWidth","clientHeight","validSize","sizeChange","removeCommandListener","handleKeyboardEvent","onkeydown","wrapEvent","onkeyup","onwheel","step","deltaY","handleMouseEvent","onmousedown","onmouseup","onmousemove","onmouseenter","onmouseleave","strokeStyle","jsonText","figure_id","evt","Blob","blobData","sendCanvasUpdated","msg","parse","msgType","stack","resizeCanvas","xMin","yMin","rubberBandCanvasContext","strokeRect","0","1","2","3","sendDrawMessage","extraData","canvas_pos","targ","srcElement","nodeType","parentNode","bodyRect","elemRect","offsetX","offsetY","pageX","pageY","findpos","focus","button","guiEvent","simpleKeys","which","ctrlKey","altKey","shiftKey","original","reduce","MplFigureContainer","figureUpdateCount","figureDiv","figureHeight","figure","ToolButton","active","tooltipContent","tooltipPosition","AUTO","FIGURE_COMMAND_SOURCE","MplFigurePanel","handleFigureMessage","CONTAINER_DIV_STYLE","onCommand","onDownload","removeCommandListeners","MplFigureToolbar","commands","tooltip","command","messageTag","buttons","tooltipText","FigureView","imageBaseUrl","figureResource","getFigureResource","compId","updateCount","figureName","figureViewData","figureResources","availableTime","remainingTime","inactivityTime","remainingTimeMax","handleClose","getServiceInfo","formatSeconds","hours","remainder","minutes","seconds","TableView","viewData","isLoading","TABLE_CONTAINER_STYLE","renderDataTable","LOADING_CONTAINER_STYLE","firstRow","columnNames","getData","row","col","cellRenderer","numRows","enableRowHeader","getCellClipboardData","justifyContent","resNames","Splitter","bodyEventListeners","onBodyMouseMove","onBodyMouseUp","onBodyMouseEnter","onBodyMouseLeave","isButton1Pressed","getCurrentPosition","removeBodyMouseListeners","addBodyMouseListeners","currentPosition","positionDelta","endDragging","screenX","screenY","pair","onMouseDown","SplitPane","handleSplitDelta","initialSize","oldSize","newSize","containerClass","childContainer1Style","childContainer2Style","width1","height1","ContentWithDetailsPanel","handleSwitchChange","handleContentHeightChange","onShowDetailsChange","onContentHeightChange","detailsControlPanel","contentChild","detailsChild","detailsSwitch","showDetails","alignSelf","detailsContentPanel","actionComponent","detailsPanel","isSplitPanel","contentHeight","DataSourceLinks","float","margin","CODE_STYLE","fontFamily","Colors","LIGHT_GRAY1","MARKDOWN_COMPONENTS","em","li","span","pre","Markdown","remarkPlugins","remarkGFM","linkTarget","STYLE","ScrollablePanelContent","COVERAGE_PANEL_STYLE","flexWrap","DataSourceDetails","metaInfoKeys","details","renderAbstract","renderVariablesTable","renderMetaInfoTable","renderMetaInfoLicences","renderActiveTabPanelOnly","panel","element","spatialCoverage","temporalCoverage","summary","bbox","x_min","y_min","x_max","y_max","start","end","abstract","rowIndex","long_name","licences","ECV_META","ITEM_STYLE","ID_STYLE","BLUE5","fontSize","WARN_ICON_STYLE","marginRight","DATA_TYPE_STYLE","GREEN4","TEXT_ICON_STYLE","textAlign","DataSourceItem","warnIcon","typeSpec","ecvId","idParts","actualEcvId","mappings","ecvMetaItem","ecvs","colors","dataSourceToTextIconProps","dataSourceToTitle","iconSize","DataSourcesList","setSelectedDataSourceId","doubleClickAction","DataSourceOpenHint","manualInterventionNotice","isSandboxedMode","AddDatasetDialog","dataSourceName","onDataSourceNameChange","onFilePathPatternChange","showSelectDirectoryDialog","openDialogOptions","buttonLabel","defaultPath","dirPath","formatDateAsISODateString","date","getTime","getTimezoneOffset","toISOString","formatDataTypeName","fullyQualified","indexColon","indexDot","DEFAULT_DATE_RANGE","DateField","parseDate","formatDate","validateDate","millis","valueOf","defaultProps","DateRangeField","dateStrings","date1","date2","parseDateRange","formatDateRange","validateDateRange","LONG_ID_STYLE","wordWrap","LongIdLabel","longId","NumericField","handleNumericInputChange","validateNumber","isInt","setValueAndTextValue","onValueChange","minorStepSize","selectAllOnFocus","GLOBAL","Region","onEastChange","onSouthChange","onWestChange","onNorthChange","renderField","NUMBER_FIELD_STYLE","TOOLTIP_STYLE","LabelWithType","labelText","dataTypeText","unitsText","VariablesDialog","multiSelect","getVariableItemKey","renderVariableItem","VarNameValueEditor","validate","isDetailsEditorOpen","multi","varNames","validNames","validateVarNamesText","hasSelectableVariables","justifySelf","WARNINGS_PANEL_STYLE","WARNING_ICON","IconNames","WARNING_SIGN","ERROR_ICON","ERROR","ISSUE_ICON","ISSUE","TIME_RANGE_STYLE","DataAccessComponent","onHasTimeConstraintChange","onDateRangeChange","onHasRegionConstraintChange","onRegionChange","onHasVariablesConstraintChange","onVariableNamesChange","onMakeLocalSelectedChange","onMakeLocalDataSourceIdChange","onOpenDatasetResourceNameChange","dateRange","region","hasTimeConstraint","hasRegionConstraint","hasVariablesConstraint","unused","variableNames","isCacheDataSourceSelected","cachedDataSourceId","openDatasetResourceName","minDate","maxDate","cacheConfigPanel","temporalCoverageText","timeConstraintsPanel","SUB_PANEL_STYLE","OPTION_DIV_STYLE","regionConstraintsPanel","res","dataSourceToResource","variablesConstraintPanel","canConstrainVariables","VAR_NAMES_INPUT","canCache","isLocalDataSource","isMakeLocalSelected","messagesPanel","messages","dsVar","types","dataSourceVarToVariable","validTimeConstraint","validRegion","validNorth","validSouth","validVariableNames","validDataSourceId","makeLocalDataSourceId","inputErrors","t0","var_names","force_local","local_ds_id","OPTION_CHECK_STYLE","InputEditor","editor","isValueEditorShown","valueEditor","renderResourceNameEditor","editorSwitch","renderEditorSwitch","LABEL_STYLE","firstResourceOption","otherResourceOptions","isDataTypeCompatible","resourceOptions","RESOURCE_NAME_STYLE","handleChange","interactionKind","PopoverInteractionKind","HOVER","hoverOpenDelay","hoverCloseDelay","TOP","cateTypes","renderTypeInstanceHintText","valueEditorShown","valueEditorDisabled","isValueEditorDisabled","resourceSelectorDisabled","hasCompatibleResources","switchDisabled","alignIndicator","Alignment","EDITOR_SWITCH_STYLE","BooleanValueEditor","indeterminate","ValueSetValueEditor","NULL_VALUE","VALUE_SELECTOR_STYLE","IntegerValueEditor","isValueSetGiven","FloatValueEditor","TextValueEditor","FileValueEditor","showFileDialogCallback","toRelativePath","saveDialogOptions","filters","filePath","canceled","propsSet","WKT_LINK","rel","GeometryDialog","toState","hasError","htmlFor","rows","getHelpText","helpText","GeometryField","validateGeometryText","isEditorOpen","setGeometryWKT","geometryWKTGetter","GeometryValueEditor","TimeRangeValueEditor","valueMinMax","getValueMinMax","DimensionsDialog","dimensions","getDimItemKey","renderDimItem","dimension","DimNameValueEditor","valueDims","validateDimNamesText","hasSelectableDims","TimeValueEditor","LIBS","ScriptDialog","DIALOG_STYLE","theme","showGutter","highlightActiveLine","libText","ScriptField","validateScript","ScriptValueEditor","renderValueEditor","factory","getValueEditorFactory","VALUE_EDITOR_FACTORIES","renderFileValueEditor","renderScriptValueEditor","renderTextValueEditor","findDims","inputAssignment","OperationStepDialog","onConstantValueChange","onResourceNameChange","onValidate","onDefaults","hideValidationDialog","mapPropsToState","inputAssignmentsMap","isEditMode","isNewMode","getInputArguments","getInputErrors","isValidationDialogOpen","inputArguments","inputArgument","hasInputErrors","getInitialInputAssignments","setInputAssignment","dialogTitle","bodyHeaderText","bodyFooterText","parameterPanel","renderParameterPanel","inputEditors","PARAMETER_PANEL_STYLE","NO_STATE","gridTemplateColumns","justifyItems","rowGap","columnGap","operationStep","inputPort","getInputAssignmentsFromOperationStep","lastInputAssignments","forceDefaults","defaultInputAssignment","lastInputAssignment","ValidationDialog","count","inputName","renderInputErrors","countResourceProblems","resourceProblems","introText","problems","footerText","OpenDatasetDialog","onOptionsChange","validateOptions","dsDefault","makeLocalDataSourceTitle","optionsToOperationArguments","cacheSelected","optionsToErrors","defaultOptions","ensureDateRangeIsValidated","RemoveDatasetDialog","onRemoveFilesChange","INTENTS","mapDispatchToProps","setSelectedDataStoreId","setDataSourceFilterExpr","setSessionState","setControlState","updateSessionState","showDialog","hideDialog","DataSourcesPanel","handleAddDatasetDialog","handleRemoveDatasetDialog","handleShowOpenDatasetDialog","handleListHeightChanged","handleShowDetailsChanged","handleDataStoreSelected","handleShowDataStoreDescriptionChanged","handleShowDataStoreNoticesChanged","handleShowAllDataSourcesChanged","handleShowDataSourceIDsChanged","renderNoDataStoreMessage","hasDataSources","isLocalStore","canAdd","canRemove","isNotVerified","canOpen","hasWorkspace","popoverClassName","POPOVER_CONTENT_SIZING","renderDataStoreSelector","FLEX_ROW_STYLE","SPACER_STYLE","renderDataSourceFilterExprInput","filteredDataSources","renderNoDataSourcesMessage","resultsTag","MINIMAL","onRemove","paddingBottom","leftIcon","rightElement","dataStoreOptions","dataStoreDescriptionElement","hasDataStoreDescription","hasDataStoreNotices","notices","callouts","notice","LABEL_TEXT_STYLE","SELECT_STYLE","minWidth","whiteSpace","OP_CARD_STYLE","OperationsPanel","handleOperationSelection","handleOperationFilterExprCleared","handleOperationFilterExprChange","handleAddOperationStepButtonClicked","operationTagFilterPanel","renderOperationTagFilterPanel","operationsList","renderOperationsList","operationDetailsCard","renderOperationDetailsCard","filteredOperations","operationFilterExprInput","canAddStepOperation","selectedOperation","renderNoOperationsMessage","selectedOperationTags","operationsTagCounts","tagStyle","paddingTop","selectedTagItems","tagName","minimal","removeTagName","tagMenuItems","tagCount","addTagName","addTagButton","tagMenu","CLICK","outputElems","getOutputDescriptionText","getMultiplicityText","inputElems","getInputDescriptionText","elevation","formatPortDescriptionText","singularText","pluralText","WebAPIStatusBox","reload","isWaiting","onRetry","DIALOG_P_STYLE","DIALOG_ICON_STYLE","StatusBox","footer","retryButton","ErrorBox","WorkflowStepPropertiesDialog","oldStepId","newStepId","stepId","oldStepPersistent","newStepPersistent","stepPersistent","newStepIdIsValid","WorkspacePanel","handleResourceListHeightChanged","handleShowResourceDetailsChanged","handleResourceNameSelected","handleStepListHeightChanged","handleShowWorkflowStepDetailsChanged","handleWorkflowStepIdSelected","handleShowFigureButtonClicked","handleWorkflowStepPropertiesButtonClicked","handleOpenWorkspaceDirectoryClicked","handleEditOperationStepButtonClicked","renderStepItem","renderResourceAttrName","renderResourceAttrValue","renderOperationStepInputName","renderOperationStepInputValue","renderOperationStepOutputName","renderOperationStepOutputValue","handleWorkspacePanelModeChanged","handleRemoveOperationStepButtonClicked","handleCleanWorkflowButtonClicked","handleShowResourceTableView","handleCopyWorkflowAsPythonScript","handleCopyWorkflowAsShellScript","handleCopyWorkflowAsJSON","getEffectiveResource","convertSteps","getEffectiveResourceName","selectedResourceWorkflowStep","selectedWorkflowStepResource","workflowStep","getEffectiveWorkflowStep","getWorkflowStepLabel","pop","workspaceLabel","AUTO_START","workspaceState","STATE_TAG_STYLE","openItemButton","copyItemButton","selectedTabId","renderWorkflowStepsPanel","renderResourcesPanel","canShowFigure","isOperationStepSelected","hasSteps","canShowTableView","renderWorkspaceActions","renderResourcesList","renderResourceDetails","getResourceItemKey","renderResourceItem","selectedResourceAttributes","renderWorkflowStepsList","renderWorkflowStepDetails","getStepItemKey","selectedWorkflowStepOp","stepInputPanel","renderWorkflowStepPorts","showPopover","TruncatedPopoverMode","WHEN_TRUNCATED","detectTruncation","inputProps","renderWorkflowPortName","renderWorkflowPortValue","outputProps","outputPort","resourcesMap","ports","itemsTitle","noItemsTitle","renderName","renderValue","portProps","port","ALWAYS","cellValue","lines","VariablesPanel","handleSelectedVariableNameChanged","handleShowSelectedVariableLayer","handleAddVariableLayer","handleAddVariableTimeSeriesPlot","handleAddVariableHistogramPlot","handleShowVariableTableView","placemarkName","placemarkPosition","renderVariableActionRow","onSelectedVariableNameChanged","selectedVariableAttributesTableData","isSpatialVariable","hasWorldView","activeViewType","canAddLayer","canAddTimeSeriesPlot","canAddHistogramPlot","VALUE_STYLE","VariablesListPanel","getItemValue","property","handleVariableNameSelection","VariableDetailsPanel","renderAttributeName","renderAttributeValue","LayerSourcesDialog","handleChangedVariableSelection","selectedIndices","layerVariable","DIALOG_TITLE","PlacemarksPanel","handleCopyGeometryAsCsv","sep","geometryGeoJsonToCsv","handleCopyGeometryAsWkt","handleCopyGeometryAsGeoJson","geoJson","handleNewPointToolButtonClicked","handleNewPolygonToolButtonClicked","handleNewPolylineToolButtonClicked","handleNewBoxToolButtonClicked","handleRemovePlacemarkButtonClicked","handleLocatePlacemarkButtonClicked","handleChangedPlacemarkVisibility","handleChangedPlacemarkSelection","handleChangedPlacemarkName","handleChangedPointLongitude","handleChangedPointLatitude","handleCopySelectedPlacemarkAsCsv","handleCopySelectedPlacemarkAsWkt","handleCopySelectedPlacemarkAsGeoJSON","handlePlacemarkDoubleClick","renderPlacemarkItem","nameField","renderActionButtonRow","renderPlacemarksList","renderPlacemarkDetails","isPointToolActive","isPolylineToolActive","isPolygonToolActive","isBoxToolActive","getPlacemarkItemKey","onVisibilityChange","onCopyPlacemarkCsv","onCopyPlacemarkWkt","onCopyPlacemarkGeoJSON","renderPlacemarkTitle","renderPlacemarkGeometry","activeView","PlacemarkItem","placemarkItemRef","createRef","handleVisibilityChanged","handleCopyPlacemarkCsv","handleCopyPlacemarkWkt","handleCopyPlacemarksGeoJSON","rightClickMe","current","menu","Menu","MenuItem","info","toFixed","CHECK_STYLE","ICON_STYLE","NAME_STYLE","INFO_STYLE","ViewPanel","onViewModeChange","onAddWorldView","onShowLayerTextOverlayChange","ACTION_ITEM_STYLE","renderActiveViewPanel","titleField","PROPERTY_ITEM_STYLE","PROPERTY_ITEM_CONTROL_GROUP_STYLE","PROPERTY_ITEM_CONTROL_GROUP_MEMBER_STYLE","marginBlock","TaskComponent","handleShowDetails","isRunning","isMakingProgress","progressValue","total","worked","progressBar","onCancelJob","cancelableProgress","PROGRESS_STYLE","progressMag","detailsButton","renderIcon","onRemoveJob","jobFailure","paddingRight","flexFlow","cancelJob","removeJob","TasksPanel","taskComponents","TermsAndConditions","serviceInfo","uiVersion","apiVersion","VersionTag","StatusBar","globePosition","DIV_MESSAGE_STYLE","DIV_TASKS_STYLE","renderTasks","DIV_CURSOR_STYLE","DIV_TAC_STYLE","DIV_STATUS_STYLE","renderBackendStatus","numRunningTasks","numFailedTasks","render","spinner","tasksInPopover","paddingLeft","LEFT_TOP","DIV_MARGIN","SubPanelHeader","divStyle","titleStyle","SPAN_STYLE","fontWeight","LayersPanel","handleAddLayerButtonClicked","handleRemoveLayerButtonClicked","handleMoveLayerUpButtonClicked","handleMoveLayerDownButtonClicked","handleChangedLayerSelection","handleChangedLayerVisibility","handleChangedLayerSplitMode","handleChangedBaseMap","renderLayerItem","renderBackgroundMapSelector","renderLayersList","renderLayerDetails","LAYER_DIV_STYLE","LAYER_CHECKBOX_STYLE","stopPropagation","LAYER_LABEL_ELEMENT_STYLE","layerCount","selectedLayerIndex","canRemoveLayer","canMoveLayerUp","canMoveLayerDown","BG_MAP_CONTAINER_STYLE","BG_MAP_LABEL_STYLE","BG_MAP_VALUE_STYLE","bgMap","getLayerItemKey","renderDataSelectionSection","renderSplitModeSection","dimensionRows","LABEL_SPAN_STYLE_100","capitalizeFirstLetter","SLIDER_DIV_STYLE_10","stepSize","labelStepSize","handleChangedLayerVarIndex","inline","selectedValue","string","charAt","flexBasis","NumericRangeField","parseNumericPair","DISPLAY_RANGE_STYLE","StylesPanel","handleUpdateDisplayStatistics","handleChangedDisplayMinMax","handleChangedDisplayRange","handleChangedDisplayAlphaBlend","handleChangedColorMapName","handleChangedStyleContext","handleChangedFillColor","handleChangedFillColorFromPicker","handleChangedFillOpacity","handleChangedStrokeWidth","handleChangedStrokeColor","handleChangedStrokeColorFromPicker","handleChangedStrokeOpacity","handleChangedMarkerColor","handleChangedMarkerColorFromPicker","handleChangedMarkerSize","handleChangedMarkerSymbol","renderVectorLayerDetails","renderImageLayerDetails","renderStyleContext","renderFormAlphaBlending","renderFormDisplayMinMax","renderFormDisplayColorBar","renderFormImageEnhancement","selectedResourceVectorLayer","displayMinMax","SLIDER_DIV_STYLE_15","renderDisplayRangeSlider","colorBarButton","popoverContent","renderColorBarBox","renderColorBarButton","labelRenderer","handleChangedImageEnhancement","renderFillColor","renderFillOpacity","renderStrokeWidth","renderStrokeColor","renderStrokeOpacity","renderMarkerColor","renderMarkerSize","renderMarkerSymbol","entityDisplayName","layerDisplayName","LABEL_BOTTOM_MARGIN","lineHeight","vectorStyle","disableAlpha","SLIDER_DIV_STYLE_05","statistics","ORANGE3","fractionDigits","log10","getDisplayFractionDigits","toExponential","formatNumber","buttonContent","renderColorMapImage","cat","colorMap","displayRange","handleChangedVectorStyle","hex","SelectWorkspaceDialog","localWebAPI","isNewDialog","directoryChooser","NewWorkspaceDialog","SaveWorkspaceAsDialog","SYSTEM_LABEL_STYLE","SYSTEM_CONTROL_GROUP_STYLE","SYSTEM_DIV_STYLE","SYSTEM_ITEM_STYLE","PreferencesDialog","preferences","autoUpdateSoftwareChangeDetected","backendChangesDetected","showMessageBox","renderGeneralPanel","renderDataManagementPanel","renderProxyConfigurationPanel","renderSystemPanel","renderReopenLastWorkspace","renderAutoShowNewFigures","renderDataStoresPath","renderCacheWorkspaceImagery","renderResourceNamePrefix","renderProxyUrlInput","showProperties","getStateValue","onShowPropertiesChange","getChangeHandler","condensed","bordered","packageName","packageVersion","renderBooleanValue","renderDirectoryPath","renderStringValue","initialValue","isBackend","showOpenDirectoryDialog","setBackendConfig","backendConfigDelta","NAME_CELL_STYLE","NAME_ICON_STYLE","SIZE_CELL_STYLE","ROW_DEFAULT_STYLE","ROW_SELECTED_STYLE","BLUE3","borderColor","DARK_GRAY2","borderStyle","borderWidth","TABLE_STYLE","FileList","multiSelections","openDirectory","onCurrentDirPathChange","onSelectedPathsChange","currentFileNodes","currentFileNodesPath","sort","getCurrentFileNodes","selectedPathSet","getRowFileNode","getRowPath","isRowSelected","fileNode","newSelectedPathSet","clear","handleRowClick","handleRowDoubleClick","renderFileNodeName","renderFileNodeLastModified","renderFileNodeSize","RootNodeLoading","TREE_CONTAINER_STYLE","FileTree","selectedPath","onSelectedPathChange","onExpandedPathsChange","showFiles","treeNodes","includeFiles","_getTreeNodes","fileNodes","idGen","_selectedPath","isSelected","_expandedPaths","isExpanded","childTreeNodes","hasCaret","secondaryLabel","treeNode","nodeData","getTreeNodes","contents","onNodeClick","nodePath","onNodeExpand","onNodeCollapse","FILE_DIALOG_STYLE","FILE_CONTAINER_STYLE","FILE_MGT_ROW_STYLE","FILE_LIST_ROW_STYLE","FILE_INPUT_ROW_STYLE","FILE_INPUT_STYLE","INVALID_FILE_INPUT_STYLE","FILE_NAV_ROW_STYLE","FILE_NAV_BC_STYLE","DARK_GRAY5","FileFilterSelect","Select","ofType","FileDialog","createFileNode","renameFileNode","deleteFileNodes","saveFile","openFile","showHiddenFiles","initSelectedPaths","initExpandedPaths","initSelectedDirPath","initCurrentDirPath","stateUpdate","selectedDirPath","pathState","dispatchPathState","isValid","inputState","dispatchInputState","fileTreeWidth","setFileTreeWidth","selectedFileFilter","setSelectedFileFilter","updateCallback","canNavigateUp","canCreateDirectory","canRename","canDelete","handleSelectedDirChangeInTree","getDefaultFileActionText","pathComponents","dirName","getBreadcrumbs","INPUT","isInputValid","expandedPath","popoverProps","filterable","itemRenderer","fileFilterItemRenderer","onItemSelect","getFileFilterText","itemProps","modifiers","OpenDialog","SaveDialog","propSet","icons","none","INFO_SIGN","question","CONFIRM","warning","MessageBox","checkboxLabel","checkboxChecked","defaultId","cancelId","_checkboxChecked","setCheckboxChecked","hasCheckbox","handleCancel","buttonText","buttonIndex","handleButtonClick","PanelContainer","onTopPanelSelected","onBottomPanelSelected","onTopPanelClose","onBottomPanelClose","onVerSplitterPosChange","onHorSplitterPosChange","panelId","isCurrent","selectedTopPanelId","onSelectedTopPanelChange","selectedBottomPanelId","onSelectedBottomPanelChange","setLayout","onLayoutChange","findPanel","selectedPanel","child","topPanelPane","bottomPanelPane","panelPane","resizablePanelPane","panelBar","PanelBar","panels","toArray","selectedTopPanel","getSelectedTopPanel","selectedBottomPanel","getSelectedBottomPanel","panelPaneWidth","panelPaneHeight","topPanelPaneStyle","renderPanelPane","bottomPanelPaneStyle","renderTwoPanelsPane","renderResizablePanelPane","panelContainerStyle","maxHeight","PanelPane","verSplitter","undockedModeStyle","undockedMode","PANEL_BAR_SIZE","PANEL_UNDOCKED_BACKGROUND_COLOR","resizablePanelPaneStyle","PANEL_PANE_PADDING","horSplitter","PanelHeader","panelIcon","panelTitle","panelCloseIcon","PANEL_ICON_SIZE","PANEL_ICON_PADDING","PANEL_BAR_PADDING","PANEL_BODY_PADDING","PANEL_BAR_ITEM_BASE_STYLE","PANEL_BAR_ITEM_NORMAL_STYLE","GRAY4","PANEL_BAR_ITEM_SELECTED_STYLE","WHITE","TOP_PANEL_BAR_STYLE","listStyleType","BOTTOM_PANEL_BAR_STYLE","CONTAINER_STYLE","PANEL_BUTTON_STYLE","verticalAlign","PANEL_BODY_CONTAINER_STYLE","tooltipPos","renderPanelButton","selectedPanelId","panelPosition","topPanelButtons","bottomPanelButtons","panelBody","panelParentStyle","Panel","ViewManager","viewMap","createViewMap","renderViewSplit","renderViewPanel","renderNoViews","NO_VIEW_CONTAINER_STYLE","noViewsDescription","noViewsAction","noViewsVisual","renderedLayout1","renderedLayout2","layout1","layout2","containerStyle","HOR_SPLIT_CONTAINER_STYLE","VER_SPLIT_CONTAINER_STYLE","onChangeViewSplitPos","viewRenderMap","onSelectView","onCloseView","onCloseAllViews","onMoveView","onSplitViewPanel","boxSizing","contentElement","onSplitHor","onSplitVer","onContentDivRef","renderedViewContent","selectedView","tabItems","viewTitle","viewIconName","tabStyle","closeIconStyle","viewRenderer","TAB_STYLE_SELECTED","TITLE_STYLE_ACTIVE","TITLE_STYLE_SELECTED","CLOSE_ICON_STYLE_SELECTED","TAB_STYLE_NORMAL","TITLE_STYLE_NORMAL","CLOSE_ICON_STYLE_NORMAL","onSelect","iconSpan","splitHorEntry","splitVerEntry","moreMenuEntry","tabs","TABS_STYLE","spacer","menuIconStyle","MENU_ICON_STYLE","moveBeforeMenuItem","moveAfterMenuItem","moveBeforeMenuItems","moveAfterMenuItems","moreMenu","MENU_STYLE","VIEW_HEADER_STYLE","VIEW_BODY_STYLE","SELECTED_BG_COLOR","DARK_GRAY1","TITLE_STYLE_BASE","GRAY5","borderBottomStyle","borderBottomWidth","borderBottomColor","DETAILS_STYLE","MessageDetails","onCopyDetails","setShowDetails","ERROR_MESSAGE_STYLE","wordBreak","JobFailureDialog","handleConfirm","handleCopyReport","copyReport","jobTitle","report","traceback","reporting","messageDiv","iconIntent","FileDownloadDialog","handleOpenFilesOnClose","handleOpenFilesOpen","showFileOpenDialog","VIEW_TYPE_RENDERERS","world","table","ROOT_DIV_STYLE","MAIN_DIV_STYLE","AppMainPage","forceAppBar","fileSystemAPI","appServiceMode","appServiceURL","appServiceHostOS","appServiceVersion","appBar","trackPageView","useMatomo","customDimensions","LeftPanel","CenterPanel","RightPanel","desktopActions","isNativeUI","_LeftPanel","onLeftPanelContainerLayoutChange","onRightPanelContainerLayoutChange","onSelectedLeftTopPanelChange","onSelectedLeftBottomPanelChange","_RightPanel","onSelectedRightTopPanelChange","onSelectedRightBottomPanelChange","_CenterPanel","matomoInstance","setMatomoInstance","instance","createInstance","urlBase","siteId","heartBeat","linkTracking","configurations","disableCookies","setSecureCookie","setRequestMethod","MatomoProvider","CESIUM_BASE_URL","middlewares","thunkMiddleware","middleware","applyMiddleware","store","createStore","search","URLSearchParams","connectWebAPIService","ReactDOM","getElementById","main","isInputAssigned","assignConstantValueInput","assignResourceNameInput","UPDATE_INITIAL_STATE","SET_WEBAPI_STATUS","SET_WEBAPI_AUTO_STOP_INFO","SET_WEBAPI_CLIENT","SET_WEBAPI_SERVICE_URL","SET_WEBAPI_SERVICE_INFO","UPDATE_HUB_STATUS","UPDATE_DIALOG_STATE","UPDATE_TASK_STATE","REMOVE_TASK_STATE","UPDATE_CONTROL_STATE","UPDATE_SESSION_STATE","INVOKE_CTX_OPERATION","setWebAPIStatus","setWebAPIClient","setWebAPIServiceURL","getState","handleFetchError","formatMessage","keepAlive","available_time","inactivity_time","remaining_time","keepAliveTimer","callAPI","getBackendConfig","updateBackendConfig","loadColorMaps","loadPreferences","loadDataStores","openWorkspace","newWorkspace","planB","requireDoneNotification","getOperations","UPDATE_OPERATIONS","updateOperations","keepAliveSeconds","closeDetails","reason","wasClean","updateDialogState","updateTaskState","removeTaskState","setControlProperty","updateControlState","invokeCtxOperation","invokeCtxOperationImpl","controlState","savePreferences","postAction","updatePreferences","setSessionProperty","sessionState","storeBackendConfig","showJobFailureDetails","startToastTimeoutHandler","disableNotifications","startToastDelay","jobPromise","jobProgress","startToastShown","setTimeout","jobSubmitted","jobResult","clearTimeout","notificationDisabled","jobFailed","SET_GLOBE_MOUSE_POSITION","SET_GLOBE_VIEW_POSITION","setGlobeMousePosition","setGlobeViewPositionImpl","setGlobeViewPosition","extractPixelValues","updateFsRootNode","force","subPathsToBeUpdated","subPath","subNode","updateSubPathFileNode","subPaths","api","ACTIVATE_NEW_PLACEMARK_TOOL","ADD_PLACEMARK","REMOVE_PLACEMARK","UPDATE_PLACEMARK_GEOMETRY","UPDATE_PLACEMARK_PROPERTIES","UPDATE_PLACEMARK_STYLE","activateNewPlacemarkTool","addPlacemark","addPointPlacemark","removePlacemark","updatePlacemarkStyle","locatePlacemark","headingPitchRange","zoomTo","setSelectedPlacemarkId","UPDATE_DATA_STORES","UPDATE_DATA_SOURCES","UPDATE_DATA_SOURCE_META_INFO","getDataStores","loadDataSources","setSelection","getDataSources","updateDataSources","setSelectedDataStoreIdImpl","updateDataSourceMetaInfo","getDataSourceMetaInfo","loadDataSourceMetaInfo","openDataset","updateLocalDataSources","ds_id","data_store_id","wrappedOpArgs","setWorkspaceResource","addLocalDataset","addLocalDataSource","removeLocalDataset","removeLocalDataSource","setSelectedOperationName","setOperationFilterTags","setOperationFilterExpr","showOperationStepDialog","hideOperationStepDialog","SET_CURRENT_WORKSPACE","UPDATE_WORKSPACE_NAMES","RENAME_RESOURCE","SHOW_FIGURE_VIEW","SHOW_ANIMATION_VIEW","SHOW_TABLE_VIEW","updateWorkspaceNames","workspacePath","setCurrentWorkspace","saveWorkspace","setSelectedWorkspaceResourceName","saveWorkspaceAs","deleteWorkspace","openLocalWorkspace","showSingleFileOpenDialog","maybeSaveCurrentWorkspace","listWorkspaces","openRemoteWorkspace","deleteRemoteWorkspace","closeWorkspace","cleanWorkspaceInteractive","answer","cleanWorkspace","deleteResourceInteractive","deleteWorkspaceResource","deleteResource","setCurrentWorkspaceImpl","setSelectedWorkspaceResourceNameImpl","isDefault","setSelectedVariable","setSelectedWorkflowStepId","setSelectedWorkflowStepIdImpl","isFigure","isAnimation","showFigureView","showAnimationView","setWorkspaceResourcePersistence","renameWorkspaceResource","renameWorkspaceResourceImpl","getWorkspaceVariableStatistics","showTableView","saveFigureImageAs","imageUrl","shell","openExternal","SET_SHOW_SELECTED_VARIABLE_LAYER","SET_SELECTED_VARIABLE","setShowSelectedVariableLayer","addVariableLayer","ADD_LAYER","setLeftPanelContainerLayout","setRightPanelContainerLayout","setSelectedLeftTopPanelId","setSelectedLeftBottomPanelId","setSelectedRightTopPanelId","setSelectedRightBottomPanelId","ADD_WORLD_VIEW","ADD_TABLE_VIEW","SELECT_VIEW","CLOSE_VIEW","SPLIT_VIEW_PANEL","CHANGE_VIEW_SPLIT_POS","MOVE_VIEW","addWorldView","closeView","closeAllViews","SET_VIEW_MODE","SET_PROJECTION_CODE","SET_LAYER_SPLIT_MODE","SET_LAYER_SPLIT_POSITION","SET_SELECTED_ENTITY_ID","INC_ENTITY_UPDATE_COUNT","UPDATE_ENTITY_STYLE","UPDATE_MOUSE_IDLE_STATE","setViewMode","setLayerSplitMode","setLayerSplitPosition","notifySelectedEntityChange","setSelectedEntityId","updateEntityStyle","updateEntityStyleImpl","UPDATE_TABLE_VIEW_DATA","updateTableViewData","loadTableViewData","restUrl","csvUrl","d3","UPDATE_ANIMATION_VIEW_DATA","loadAnimationViewData","htmlUrl","xmlHttp","XMLHttpRequest","onreadystatechange","setAnimationResult","responseText","SET_SELECTED_LAYER_ID","REMOVE_LAYER","UPDATE_LAYER","UPDATE_LAYER_STYLE","MOVE_LAYER_UP","MOVE_LAYER_DOWN","SAVE_LAYER","SET_BASE_MAP_ID","setSelectedLayerId","moveLayerUp","moveLayerDown","updateLayer","layerProperties","updateLayerImpl","saveLayer","updateLayerStyle","setStyleContext","setBaseMap","UPDATE_COLOR_MAPS","getColorMaps","updateColorMaps","showPreferencesDialog","hidePreferencesDialog","OPEN_DIRECTORY_SELECT_DIALOG","CLOSE_DIRECTORY_SELECT_DIALOG","closeDirectorySelectDialog","openDirectorySelectDialog","OPEN_FILE_OPEN_DIALOG","CLOSE_FILE_OPEN_DIALOG","closeFileOpenDialog","openFileOpenDialog","OPEN_FILE_SAVE_DIALOG","CLOSE_FILE_SAVE_DIALOG","showFileSaveDialog","closeFileSaveDialog","openFileSaveDialog","OPEN_MESSAGE_BOX","CLOSE_MESSAGE_BOX","messageBoxOptions","closeMessageBox","openMessageBox","OPEN_FILE_BROWSE_DIALOG","CLOSE_FILE_BROWSE_DIALOG","fullPath","copyTextToClipboard","hasElectron","clipboard","writeText","copyToClipboard","uploadFiles","downloadFiles","functionName","suffix","_handlersInstalled","installGlobalHandlers","on","initialState","updateInitialState","dataTransfer","readDroppedFile","dropWorkspaceResource","newDesktopActions","once","actionName","openItem","onCopy"],"mappings":"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","file":"static/js/main.1cdb4636.chunk.js","sourcesContent":["import { SessionState } from \"./state\";\r\nimport { JobPromise, WebAPIClient } from \"./webapi\";\r\n\r\n\r\n/**\r\n * This interface provides access to a particular domain's session or local storage.\r\n * It allows, for example, the addition, modification, or deletion of stored data items.\r\n */\r\nexport class RemoteStorageAPI {\r\n    private readonly webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPIClient: WebAPIClient) {\r\n        this.webAPIClient = webAPIClient;\r\n    }\r\n\r\n    loadPreferences(): JobPromise<Partial<SessionState>> {\r\n        return this.webAPIClient.call('get_preferences', []);\r\n    }\r\n\r\n    updatePreferences(session: Partial<SessionState>): JobPromise<Partial<SessionState>> {\r\n        return this.webAPIClient.call('set_preferences', [session]);\r\n    }\r\n}\r\n","import { v4 as uuidv4 } from 'uuid'\r\nimport { HttpError } from '../HttpError';\r\n\r\nexport type QueryComponent = [string, string];\r\n\r\nexport function makeUrl(url: string, queryComponents?: QueryComponent[]) {\r\n    if (queryComponents && queryComponents.length > 0) {\r\n        const queryString = queryComponents.map(kv => kv.map(encodeURIComponent).join('=')).join('&');\r\n        url += '?' + queryString;\r\n    }\r\n    return url;\r\n}\r\n\r\nexport function callApi(endpointUrl: string, queryComponents?: QueryComponent[], init?: RequestInit): Promise<Response> {\r\n    const url = makeUrl(endpointUrl, queryComponents);\r\n\r\n    console.debug('Calling API: ', url);\r\n\r\n    return fetch(url, init)\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                console.log(response);\r\n                throw new HttpError(response.status, response.statusText);\r\n            }\r\n            return response;\r\n        })\r\n        .catch(error => {\r\n            throw error;\r\n        });\r\n}\r\n\r\n\r\nfunction download(blob: Blob, fileName?: string) {\r\n    if (!fileName) {\r\n        const suffix = uuidv4();\r\n        fileName = 'cate_' + suffix + '.zip';\r\n    }\r\n    const objectUrl: string = URL.createObjectURL(blob);\r\n    const a: HTMLAnchorElement = document.createElement('a') as HTMLAnchorElement;\r\n\r\n    a.href = objectUrl;\r\n    a.download = fileName;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(objectUrl);\r\n}\r\n\r\n\r\nexport function callBlobApi(endpointUrl: string, queryComponents?: QueryComponent[], init?: RequestInit, fileName?: string)\r\n    : Promise<Blob> {\r\n    return callApi(endpointUrl, queryComponents, init).then(response => response.blob())\r\n        .then((blob: Blob) => {\r\n            download(blob, fileName);\r\n\r\n            return blob;\r\n        });\r\n}\r\n\r\n\r\nexport function callJsonApi<T>(endpointUrl: string, queryComponents?: QueryComponent[], init?: RequestInit): Promise<T> {\r\n    return callApi(endpointUrl, queryComponents, init).then(response => response.json());\r\n}","import { callBlobApi, callJsonApi } from \"./callHttpApi\";\r\nimport { WebAPIClient } from \"../WebAPIClient\";\r\nimport { JobProgress, JobPromise } from \"../Job\";\r\n\r\n\r\ninterface ResponseStatus {\r\n    status: 'info' | 'success' | 'notification' | 'warning' | 'error';\r\n    message?: string;\r\n}\r\n\r\n\r\nexport interface ProcessState {\r\n    process_id: string;\r\n}\r\n\r\nexport class FilesAPI {\r\n    private readonly webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPIClient: WebAPIClient) {\r\n        this.webAPIClient = webAPIClient;\r\n    }\r\n\r\n    monitorProcess(processId: string,\r\n                   onProgress: (progress: JobProgress) => void): JobPromise<void> {\r\n        return this.webAPIClient.call('monitor_download_files',\r\n                                      [processId],\r\n                                      onProgress,\r\n                                      () => {\r\n                                      });\r\n    }\r\n\r\n    registerProcess(serviceUrl: string) {\r\n        return callJsonApi<ProcessState>(\r\n            serviceUrl + '/files/download',\r\n            undefined,\r\n            {\r\n                mode: 'cors',\r\n                method: 'PUT',\r\n                body: JSON.stringify({}),\r\n            });\r\n    }\r\n\r\n    uploadFiles(dir: string, file: File, serviceUrl: string) {\r\n        let formData = new FormData();\r\n\r\n        formData.append('dir', dir);\r\n        formData.append('files', file, file.name);\r\n\r\n        return callJsonApi<ResponseStatus>(serviceUrl + '/files/upload',\r\n                                           undefined,\r\n                                           {\r\n                                               mode: 'cors',\r\n                                               method: 'POST',\r\n                                               body: formData,\r\n                                           });\r\n    }\r\n\r\n    downloadFiles(filePaths: string[], processId: string, serviceUrl: string) {\r\n        const target_files = {'target_files': filePaths, 'process_id': processId};\r\n\r\n        return callBlobApi(serviceUrl + '/files/download',\r\n                           undefined,\r\n                           {\r\n                               mode: 'cors',\r\n                               method: 'POST',\r\n                               body: JSON.stringify(target_files)\r\n                           }\r\n        );\r\n    }\r\n}\r\n","import { createSelector, Selector } from 'reselect';\r\nimport * as Cesium from 'cesium';\r\n\r\nimport { requireElectron } from './electron';\r\nimport {\r\n    canOpenDataSource,\r\n    canCacheDataSource,\r\n    canMapDataSource,\r\n    canConstrainDataSourceRegion,\r\n    canConstrainDataSourceTime,\r\n    canConstrainDataSourceVariables,\r\n    DEFAULT_BASE_MAP,\r\n    DEFAULT_BASE_MAP_ID,\r\n} from './state-util';\r\nimport {\r\n    BaseMapState,\r\n    ColorMapCategoryState,\r\n    ColorMapState,\r\n    DataSourceState,\r\n    DataStoreState,\r\n    DialogState,\r\n    FigureViewDataState,\r\n    GeographicPosition,\r\n    ImageLayerState,\r\n    LayerState,\r\n    LayerVariableState,\r\n    OperationState,\r\n    Placemark,\r\n    PlacemarkCollection,\r\n    ResourceState,\r\n    ResourceVectorLayerState,\r\n    SavedLayers,\r\n    State,\r\n    STYLE_CONTEXT_ENTITY,\r\n    STYLE_CONTEXT_LAYER,\r\n    VariableImageLayerState,\r\n    VariableLayerBase,\r\n    VariableState,\r\n    VectorLayerState, \r\n    WebAPIServiceInfo, \r\n    WebAPIStatus,\r\n    WorkflowStepState,\r\n    WorkspaceState,\r\n    WorldViewDataState\r\n} from './state';\r\nimport { JobStatusEnum, WebAPIClient } from './webapi';\r\nimport { BackendConfigAPI, ColorMapsAPI, DatasetAPI, OperationAPI, WorkspaceAPI, FileSystemAPI } from './webapi';\r\nimport { PanelContainerLayout } from './components/PanelContainer';\r\nimport {\r\n    EXTERNAL_OBJECT_STORE,\r\n    findOperation,\r\n    getLockForGetWorkspaceVariableStatistics,\r\n    getWorldViewSelectedEntity,\r\n    getWorldViewSelectedGeometryWKTGetter,\r\n    getWorldViewVectorLayerForEntity,\r\n    getWorldViewViewer,\r\n    isAnimationResource,\r\n    isFigureResource,\r\n    isSpatialImageVariable,\r\n    isSpatialVectorVariable,\r\n} from './state-util';\r\nimport { ViewLayoutState, ViewState } from './components/ViewState';\r\nimport { isNumber } from '../common/types';\r\nimport { GeometryWKTGetter } from './containers/editor/ValueEditor';\r\nimport { BaseMapOptions, entityToSimpleStyle } from './components/cesium/cesium-util';\r\nimport { SIMPLE_STYLE_DEFAULTS, SimpleStyle, simpleStyleFromFeatureProperties } from '../common/geojson-simple-style';\r\nimport { GeometryToolType } from './components/cesium/geometry-tool';\r\nimport { RemoteStorageAPI } from \"./remoteStorageAPI\";\r\nimport { FilesAPI } from \"./webapi/apis/FilesApi\";\r\n\r\n\r\nconst electron = requireElectron();\r\n\r\nexport const EMPTY_OBJECT = {};\r\nexport const EMPTY_ARRAY = [];\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Application selectors\r\n\r\nexport const offlineModeSelector = (state: State): boolean => state.session.offlineMode;\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Remote API selectors\r\n\r\nexport const webAPIServiceInfoSelector = (state: State): WebAPIServiceInfo | null => state.communication.webAPIServiceInfo;\r\nexport const webAPIStatusSelector = (state: State): WebAPIStatus | null => state.communication.webAPIStatus;\r\nexport const webAPIClientSelector = (state: State): WebAPIClient | null => state.communication.webAPIClient;\r\nexport const webAPIServiceURLSelector = (state: State): string => state.communication.webAPIServiceURL;\r\n\r\nexport const isLocalFSAccessAllowedSelector = (state: State): boolean => {\r\n    // Note that once we have ChooseWorkspaceDialog and SelectWorkspaceDialog with directory choosers,\r\n    // we can get rid of the electron requirement here.\r\n    return !!electron\r\n           && !!electron.ipcRenderer\r\n           && !!state.communication.webAPIServiceInfo\r\n           && !state.communication.webAPIServiceInfo.userRootMode;\r\n};\r\n\r\nexport const webAPIRestUrlSelector = createSelector(\r\n    webAPIServiceURLSelector,\r\n    (webAPIServiceURL: string) => {\r\n        return getRestUrl(webAPIServiceURL);\r\n    }\r\n);\r\n\r\nexport const apiWebSocketsUrlSelector = createSelector(\r\n    webAPIServiceURLSelector,\r\n    (webAPIServiceURL: string) => {\r\n        return getAPIWebSocketsUrl(webAPIServiceURL);\r\n    }\r\n);\r\n\r\nexport const mplWebSocketUrlSelector = createSelector(\r\n    webAPIServiceURLSelector,\r\n    (webAPIServiceURL: string) => {\r\n        return getMPLWebSocketsUrl(webAPIServiceURL);\r\n    }\r\n);\r\n\r\nfunction getRestUrl(webAPIServiceURL: string): string {\r\n    return makeURL(webAPIServiceURL, false, '/');\r\n}\r\n\r\nfunction getAPIWebSocketsUrl(webAPIServiceURL: string): string {\r\n    return makeURL(webAPIServiceURL, true, 'api');\r\n}\r\n\r\nfunction getMPLWebSocketsUrl(webAPIServiceURL: string): string {\r\n    return makeURL(webAPIServiceURL, true, 'mpl/figures/');\r\n}\r\n\r\nfunction makeURL(url: string, ws: boolean, path: string): string {\r\n    // console.log(`>> makeUrl: [${url}] [${ws}] [${path}]`);\r\n    const _url = new URL(url);\r\n    const protocol = ws ? (_url.protocol === 'https:' ? 'wss:' : 'ws:') : _url.protocol;\r\n    const pathname = _url.pathname;\r\n    let newUrl = `${protocol}//${_url.host}`;\r\n    if (pathname && pathname !== '/') {\r\n        newUrl += pathname\r\n    }\r\n    if (path) {\r\n        if (!(path.startsWith('/') || newUrl.endsWith('/'))) {\r\n            newUrl += '/';\r\n        }\r\n        newUrl += path\r\n    }\r\n    // console.log(`<< makeUrl: [${newUrl}]`);\r\n    return newUrl;\r\n}\r\n\r\nexport const backendConfigAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new BackendConfigAPI(webAPIClient);\r\n    }\r\n);\r\n\r\n\r\nexport const datasetAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new DatasetAPI(webAPIClient);\r\n    }\r\n);\r\n\r\nexport const operationAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new OperationAPI(webAPIClient);\r\n    }\r\n);\r\n\r\n\r\nexport const workspaceAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new WorkspaceAPI(webAPIClient);\r\n    }\r\n);\r\n\r\n\r\nexport const remoteStorageAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new RemoteStorageAPI(webAPIClient);\r\n    }\r\n);\r\n\r\n\r\nexport const colorMapsAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new ColorMapsAPI(webAPIClient);\r\n    }\r\n);\r\n\r\nexport const fileSystemAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return webAPIClient !== null ? new FileSystemAPI(webAPIClient) : null;\r\n    }\r\n);\r\n\r\nexport const activeRequestLocksSelector = (state: State): Set<string> => {\r\n    const activeRequestLocks = new Set<string>();\r\n    for (let jobId in state.communication.tasks) {\r\n        const task = state.communication.tasks[jobId];\r\n        if (task.status === JobStatusEnum.NEW ||\r\n            task.status === JobStatusEnum.SUBMITTED ||\r\n            task.status === JobStatusEnum.IN_PROGRESS) {\r\n            activeRequestLocks.add(task.requestLock);\r\n        }\r\n    }\r\n    return activeRequestLocks;\r\n};\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Dialog state selectors\r\n\r\nconst DIALOG_STATE_SELECTORS: { [dialogId: string]: Selector<State, DialogState> } = {};\r\n\r\nexport const dialogStatesSelector = (state: State): { [dialogId: string]: DialogState } => state.control.dialogs;\r\n\r\nexport const dialogStateSelector = (dialogId: string) => {\r\n    if (!DIALOG_STATE_SELECTORS[dialogId]) {\r\n        DIALOG_STATE_SELECTORS[dialogId] = createSelector<State, DialogState, { [dialogId: string]: DialogState }>(\r\n            dialogStatesSelector,\r\n            (dialogStates: { [dialogId: string]: DialogState }) => dialogStates[dialogId] || EMPTY_OBJECT\r\n        );\r\n    }\r\n    return DIALOG_STATE_SELECTORS[dialogId];\r\n};\r\n\r\nexport const isDialogOpenSelector = createSelector(\r\n    dialogStatesSelector,\r\n    (dialogStates: { [dialogId: string]: DialogState }) => {\r\n        return Object.getOwnPropertyNames(dialogStates).some(dialogId => dialogStates[dialogId].isOpen);\r\n    }\r\n);\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// AppMainPage layout selectors\r\n\r\nexport const panelContainerUndockedModeSelector = (state: State): boolean => state.session.panelContainerUndockedMode;\r\n\r\nexport const leftPanelContainerLayoutSelector = (state: State): PanelContainerLayout => state.session.leftPanelContainerLayout;\r\nexport const rightPanelContainerLayoutSelector = (state: State): PanelContainerLayout => state.session.rightPanelContainerLayout;\r\n\r\nexport const selectedLeftTopPanelIdSelector = (state: State): string | null => state.session.selectedLeftTopPanelId;\r\nexport const selectedLeftBottomPanelIdSelector = (state: State): string\r\n    | null => state.session.selectedLeftBottomPanelId;\r\nexport const selectedRightTopPanelIdSelector = (state: State): string | null => state.session.selectedRightTopPanelId;\r\nexport const selectedRightBottomPanelIdSelector = (state: State): string\r\n    | null => state.session.selectedRightBottomPanelId;\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Placemark selectors\r\n\r\nexport const newPlacemarkToolTypeSelector = (state: State): GeometryToolType => state.control.newPlacemarkToolType;\r\nexport const placemarkCollectionSelector = (state: State): PlacemarkCollection => state.session.placemarkCollection;\r\nexport const placemarksSelector = (state: State): Placemark[] => state.session.placemarkCollection.features;\r\nexport const selectedPlacemarkIdSelector = (state: State): string | null => state.session.selectedPlacemarkId;\r\nexport const showPlacemarkDetailsSelector = (state: State): boolean => state.session.showPlacemarkDetails;\r\nexport const defaultPlacemarkStyleSelector = (state: State): SimpleStyle => state.session.defaultPlacemarkStyle;\r\n\r\nexport const selectedPlacemarkSelector = createSelector<State,\r\n    Placemark | null,\r\n    Placemark[],\r\n    string | null>(\r\n    placemarksSelector,\r\n    selectedPlacemarkIdSelector,\r\n    (placemarks: Placemark[], selectedPlacemarkId: string | null) => {\r\n        if (canFind(placemarks, selectedPlacemarkId)) {\r\n            return placemarks.find(placemark => placemark.id === selectedPlacemarkId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Location selectors\r\n\r\nexport const globeMousePositionSelector = (state: State): GeographicPosition | null => state.location.globeMousePosition;\r\nexport const globeViewPositionSelector = (state: State): GeographicPosition | null => state.location.globeViewPosition;\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Operation selectors\r\n\r\nexport const operationsSelector = (state: State): OperationState[] | null => state.data.operations;\r\nexport const operationFilterTagsSelector = (state: State): string[] | null => state.session.operationFilterTags;\r\nexport const operationFilterExprSelector = (state: State): string | null => state.session.operationFilterExpr;\r\nexport const selectedOperationNameSelector = (state: State): string | null => state.session.selectedOperationName;\r\nexport const selectedCtxOperationNameSelector = (state: State): string | null => state.control.selectedCtxOperationName;\r\n\r\nexport const selectedOperationSelector = createSelector<State, OperationState | null, OperationState[] | null,\r\n    string | null>(\r\n    operationsSelector,\r\n    selectedOperationNameSelector,\r\n    (operations, selectedOperationName) => {\r\n        if (operations && operations.length && selectedOperationName) {\r\n            return operations.find(op => op.name === selectedOperationName);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedCtxOperationSelector = createSelector<State, OperationState | null, OperationState[] | null,\r\n    string | null>(\r\n    operationsSelector,\r\n    selectedCtxOperationNameSelector,\r\n    (operations, selectedOperationName) => {\r\n        if (operations && operations.length && selectedOperationName) {\r\n            return operations.find(op => op.name === selectedOperationName);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const filteredOperationsSelector = createSelector<State, OperationState[], OperationState[] | null,\r\n    string[]\r\n    | null, string | null>(\r\n    operationsSelector,\r\n    operationFilterTagsSelector,\r\n    operationFilterExprSelector,\r\n    (operations, operationFilterTags, operationFilterExpr) => {\r\n        const hasOperations = operations && operations.length;\r\n        const hasFilterExpr = operationFilterExpr && operationFilterExpr !== '';\r\n        const hasFilterTags = operationFilterTags && operationFilterTags.length;\r\n        if (hasOperations && (hasFilterExpr || hasFilterTags)) {\r\n            let nameMatches;\r\n            if (hasFilterExpr) {\r\n                const filterExprLC = operationFilterExpr.toLowerCase();\r\n                const parts = filterExprLC.split(' ');\r\n                nameMatches = op => {\r\n                    return parts.every(part => op.name.toLowerCase().includes(part));\r\n                };\r\n            } else {\r\n                // noinspection JSUnusedLocalSymbols\r\n                nameMatches = op => true;\r\n            }\r\n            let hasTag;\r\n            if (hasFilterTags) {\r\n                hasTag = op => !operationFilterTags.length || operationFilterTags.every(tag => new Set(op.tags).has(tag));\r\n            } else {\r\n                // noinspection JSUnusedLocalSymbols\r\n                hasTag = op => true;\r\n            }\r\n            return operations.filter(op => nameMatches(op) && hasTag(op));\r\n        }\r\n        return operations || EMPTY_ARRAY;\r\n    }\r\n);\r\n\r\nexport const operationsTagCountsSelector = createSelector<State, Map<string, number>, OperationState[] | null>(\r\n    operationsSelector,\r\n    (operations) => {\r\n        let tagCounts = new Map<string, number>();\r\n        (operations || EMPTY_ARRAY).forEach((op: OperationState) => (op.tags || EMPTY_ARRAY).forEach((tag: string) => {\r\n            tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);\r\n        }));\r\n        return tagCounts;\r\n    }\r\n);\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Data store and data source selectors\r\n\r\nexport const dataStoresSelector = (state: State) => state.data.dataStores;\r\nexport const selectedDataStoreIdSelector = (state: State) => state.session.selectedDataStoreId;\r\nexport const selectedDataSourceIdSelector = (state: State) => state.session.selectedDataSourceId;\r\nexport const dataSourceFilterExprSelector = (state: State) => state.session.dataSourceFilterExpr;\r\nexport const dataSourceListHeightSelector = (state: State) => state.session.dataSourceListHeight;\r\nexport const showDataSourceDetailsSelector = (state: State) => state.session.showDataSourceDetails;\r\nexport const showAllDataSourcesSelector = (state: State): boolean => state.session.showAllDataSources;\r\nexport const showDataSourceIDsSelector = (state: State): boolean => state.session.showDataSourceIDs;\r\nexport const showDataStoreDescriptionSelector = (state: State): boolean => state.session.showDataStoreDescription;\r\nexport const showDataStoreNoticesSelector = (state: State): boolean => state.session.showDataStoreNotices;\r\n\r\nexport const selectedDataStoreSelector = createSelector<State, DataStoreState | null,\r\n    DataStoreState[] | null,\r\n    string | null>(\r\n    dataStoresSelector,\r\n    selectedDataStoreIdSelector,\r\n    (dataStores, selectedDataStoreId) => {\r\n        if (canFind(dataStores, selectedDataStoreId)) {\r\n            return dataStores.find(dataStore => dataStore.id === selectedDataStoreId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedDataSourcesSelector = createSelector<State, DataSourceState[] | null,\r\n    DataStoreState | null>(\r\n    selectedDataStoreSelector,\r\n    (selectedDataStore) => {\r\n        return (selectedDataStore && selectedDataStore.dataSources) || null;\r\n    }\r\n);\r\n\r\nexport const filteredDataSourcesSelector = createSelector<State, DataSourceState[] | null,\r\n    DataSourceState[] | null,\r\n    string | null,\r\n    boolean>(\r\n    selectedDataSourcesSelector,\r\n    dataSourceFilterExprSelector,\r\n    showAllDataSourcesSelector,\r\n    (selectedDataSources, dataSourceFilterExpr, showAllDataSources) => {\r\n        const hasDataSources = selectedDataSources && selectedDataSources.length;\r\n        const hasFilterExpr = dataSourceFilterExpr && dataSourceFilterExpr !== '';\r\n        if (hasDataSources && (hasFilterExpr || !showAllDataSources)) {\r\n            const dataSourceFilterExprLC = dataSourceFilterExpr.toLowerCase();\r\n            const parts = dataSourceFilterExprLC.split(' ');\r\n            return selectedDataSources.filter(ds => matchesIdOrTitle(ds, showAllDataSources, parts));\r\n        }\r\n        return selectedDataSources;\r\n    }\r\n);\r\n\r\nfunction matchesIdOrTitle(ds: DataSourceState, showAllDataSources: boolean, searchWords: string[]) {\r\n    let isCandidate = showAllDataSources || canOpenDataSource(ds);\r\n    if (!isCandidate) {\r\n        return false;\r\n    }\r\n    const id = ds.id.toLowerCase();\r\n    if (searchWords.every(word => id.includes(word))) {\r\n        return true;\r\n    }\r\n    let title = ds.title || (ds.metaInfo ? ds.metaInfo.title : null);\r\n    if (!title || title === '') {\r\n        return false;\r\n    }\r\n    title = title.toLowerCase();\r\n    return searchWords.every(word => title.includes(word));\r\n}\r\n\r\nexport const selectedDataSourceSelector = createSelector<State, DataSourceState | null, DataSourceState[] | null,\r\n    string\r\n    | null>(\r\n    selectedDataSourcesSelector,\r\n    selectedDataSourceIdSelector,\r\n    (selectedDataSources, selectedDataSourceId) => {\r\n        if (canFind(selectedDataSources, selectedDataSourceId)) {\r\n            return selectedDataSources.find(dataSource => dataSource.id === selectedDataSourceId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedDataSourceTemporalCoverageSelector = createSelector<State,\r\n    [string | null, string | null] | null,\r\n    DataSourceState\r\n    | null>(\r\n    selectedDataSourceSelector,\r\n    (selectedDataSource: DataSourceState): [string | null, string | null] | null => {\r\n        return (selectedDataSource\r\n                && selectedDataSource.metaInfo\r\n                && selectedDataSource.metaInfo.time_range) || null;\r\n    }\r\n);\r\n\r\nexport const canCacheDataSourceSelector = createSelector<State, boolean, string | null, DataSourceState | null>(\r\n    selectedDataStoreIdSelector,\r\n    selectedDataSourceSelector,\r\n    (selectedDataStoreId, selectedDataSource): boolean => {\r\n        if (selectedDataStoreId === null\r\n            || selectedDataStoreId === 'local'\r\n            || selectedDataStoreId === 'cci-zarr-store') {\r\n            return false;\r\n        }\r\n        return selectedDataSource ? canCacheDataSource(selectedDataSource) : false;\r\n    }\r\n);\r\n\r\nexport const canMapDataSourceSelector = createSelector<State, boolean, DataSourceState | null>(\r\n    selectedDataSourceSelector,\r\n    (selectedDataSource: DataSourceState | null): boolean => {\r\n        return selectedDataSource ? canMapDataSource(selectedDataSource) : false;\r\n    }\r\n);\r\n\r\nexport const canConstrainDataSourceTimeSelector = createSelector<State, boolean, DataSourceState | null>(\r\n    selectedDataSourceSelector,\r\n    (selectedDataSource: DataSourceState | null): boolean => {\r\n        return selectedDataSource && canConstrainDataSourceTime(selectedDataSource);\r\n    }\r\n);\r\n\r\nexport const canConstrainDataSourceRegionSelector = createSelector<State, boolean, DataSourceState | null>(\r\n    selectedDataSourceSelector,\r\n    (selectedDataSource: DataSourceState | null): boolean => {\r\n        return selectedDataSource && canConstrainDataSourceRegion(selectedDataSource);\r\n    }\r\n);\r\n\r\nexport const canConstrainDataSourceVariablesSelector = createSelector<State, boolean, DataSourceState | null>(\r\n    selectedDataSourceSelector,\r\n    (selectedDataSource: DataSourceState | null): boolean => {\r\n        return selectedDataSource && canConstrainDataSourceVariables(selectedDataSource);\r\n    }\r\n);\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Workspace, resource, step, and variable selectors\r\n\r\nexport const workspaceSelector = (state: State): WorkspaceState | null => {\r\n    return state.data.workspace;\r\n};\r\nexport const isScratchWorkspaceSelector = (state: State): boolean => {\r\n    return state.data.workspace && state.data.workspace.isScratch;\r\n};\r\nexport const workspaceBaseDirSelector = (state: State): string | null => {\r\n    return state.data.workspace && state.data.workspace.baseDir;\r\n};\r\nexport const resourcesSelector = (state: State): ResourceState[] => {\r\n    return state.data.workspace ? state.data.workspace.resources : EMPTY_ARRAY;\r\n};\r\nexport const workflowStepsSelector = (state: State): WorkflowStepState[] => {\r\n    return state.data.workspace ? state.data.workspace.workflow.steps : EMPTY_ARRAY;\r\n};\r\nexport const lastWorkspacePathSelector = (state: State): string | null => {\r\n    return state.session.lastWorkspacePath;\r\n};\r\nexport const resourceListHeightSelector = (state: State): number => {\r\n    return state.session.resourceListHeight;\r\n};\r\nexport const showResourceDetailsSelector = (state: State): boolean => {\r\n    return state.session.showResourceDetails;\r\n};\r\nexport const selectedResourceNameSelector = (state: State): string | null => {\r\n    return state.control.selectedWorkspaceResourceName;\r\n};\r\nexport const workflowStepListHeightSelector = (state: State): number => {\r\n    return state.session.workflowStepListHeight;\r\n};\r\nexport const showWorkflowStepDetailsSelector = (state: State): boolean => {\r\n    return state.session.showWorkflowStepDetails;\r\n};\r\nexport const selectedWorkflowStepIdSelector = (state: State): string | null => {\r\n    return state.control.selectedWorkflowStepId || selectedResourceNameSelector(state);\r\n};\r\nexport const selectedVariableNameSelector = (state: State): string | null => {\r\n    return state.control.selectedVariableName;\r\n};\r\n\r\nexport const workspaceNameSelector = createSelector<State, string | null, string | null>(\r\n    workspaceBaseDirSelector,\r\n    (baseDir: string | null) => {\r\n        return getFileName(baseDir);\r\n    }\r\n);\r\n\r\nexport const workspaceDirSelector = createSelector<State, string | null, string | null>(\r\n    workspaceBaseDirSelector,\r\n    (baseDir: string | null) => {\r\n        return getParentDir(baseDir);\r\n    }\r\n);\r\n\r\nexport const lastWorkspaceDirSelector = createSelector<State, string | null, string | null>(\r\n    lastWorkspacePathSelector,\r\n    (baseDir: string | null) => {\r\n        return getParentDir(baseDir);\r\n    }\r\n);\r\n\r\nfunction getFileName(path: string | null): string | null {\r\n    if (!path) {\r\n        return null;\r\n    }\r\n    let index = Math.max(path.lastIndexOf('/'), path.lastIndexOf('\\\\'));\r\n    return index >= 0 ? path.substring(index + 1) : path;\r\n}\r\n\r\nfunction getParentDir(path: string | null): string | null {\r\n    if (!path) {\r\n        return null;\r\n    }\r\n    let index = Math.max(path.lastIndexOf('/'), path.lastIndexOf('\\\\'));\r\n    return index >= 0 ? path.substring(0, index) : '';\r\n}\r\n\r\nexport const resourceNamesSelector = createSelector<State, string[], ResourceState[]>(\r\n    resourcesSelector,\r\n    (resources: ResourceState[]) => {\r\n        return resources.map(r => r.name)\r\n    }\r\n);\r\n\r\nexport const resourceMapSelector = createSelector<State, { [name: string]: ResourceState }, ResourceState[]>(\r\n    resourcesSelector,\r\n    (resources: ResourceState[]) => {\r\n        const resourceMap = {};\r\n        resources.forEach((resource => {\r\n            resourceMap[resource.name] = resource;\r\n        }));\r\n        return resourceMap;\r\n    }\r\n);\r\n\r\nexport const selectedResourceSelector = createSelector<State, ResourceState | null, ResourceState[], string>(\r\n    resourcesSelector,\r\n    selectedResourceNameSelector,\r\n    (resources: ResourceState[], selectedResourceName: string) => {\r\n        if (canFind(resources, selectedResourceName)) {\r\n            return resources.find(r => r.name === selectedResourceName);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedResourceAttributesSelector = createSelector<State, string[][], ResourceState | null>(\r\n    selectedResourceSelector,\r\n    (selectedResource: ResourceState | null) => {\r\n        if (!selectedResource || !selectedResource.attributes) {\r\n            return EMPTY_ARRAY;\r\n        }\r\n        const array = [];\r\n        const attributes = selectedResource.attributes;\r\n        for (let attrName in attributes) {\r\n            if (attributes.hasOwnProperty(attrName)) {\r\n                array.push([attrName, attributes[attrName]])\r\n            }\r\n        }\r\n        return array;\r\n    }\r\n);\r\n\r\nexport const selectedWorkflowStepResourceSelector = createSelector<State, ResourceState | null, ResourceState[], string>(\r\n    resourcesSelector,\r\n    selectedWorkflowStepIdSelector,\r\n    (resources: ResourceState[], selectedWorkflowStepId: string) => {\r\n        if (canFind(resources, selectedWorkflowStepId)) {\r\n            return resources.find(r => r.name === selectedWorkflowStepId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedWorkflowStepSelector = createSelector<State,\r\n    WorkflowStepState | null,\r\n    WorkflowStepState[],\r\n    string>(\r\n    workflowStepsSelector,\r\n    selectedWorkflowStepIdSelector,\r\n    (workflowSteps: WorkflowStepState[], selectedWorkflowStepId: string) => {\r\n        if (canFind(workflowSteps, selectedWorkflowStepId)) {\r\n            return workflowSteps.find(r => r.id === selectedWorkflowStepId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedResourceWorkflowStepSelector = createSelector<State,\r\n    WorkflowStepState | null,\r\n    WorkflowStepState[],\r\n    string>(\r\n    workflowStepsSelector,\r\n    selectedResourceNameSelector,\r\n    (workflowSteps: WorkflowStepState[], selectedResourceName: string) => {\r\n        if (canFind(workflowSteps, selectedResourceName)) {\r\n            return workflowSteps.find(r => r.id === selectedResourceName);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedWorkflowStepOpSelector = createSelector<State, OperationState | null, OperationState[] | null,\r\n    WorkflowStepState\r\n    | null>(\r\n    operationsSelector,\r\n    selectedWorkflowStepSelector,\r\n    (operations: OperationState[] | null, selectedWorkflowStep: WorkflowStepState | null) => {\r\n        if (operations && selectedWorkflowStep && selectedWorkflowStep.op) {\r\n            return findOperation(operations, selectedWorkflowStep.op);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const figureResourcesSelector = createSelector<State, ResourceState[], ResourceState[]>(\r\n    resourcesSelector,\r\n    (resources: ResourceState[]) => {\r\n        return resources.filter(r => isFigureResource(r))\r\n    }\r\n);\r\n\r\nexport const selectedFigureResourceSelector = createSelector<State, ResourceState | null, ResourceState | null>(\r\n    selectedResourceSelector,\r\n    (resource: ResourceState | null) => {\r\n        return resource && isFigureResource(resource) ? resource : null;\r\n    }\r\n);\r\n\r\nexport const animationResourcesSelector = createSelector<State, ResourceState[], ResourceState[]>(\r\n    resourcesSelector,\r\n    (resources: ResourceState[]) => {\r\n        return resources.filter(r => isAnimationResource(r))\r\n    }\r\n);\r\n\r\nexport const variablesSelector = createSelector<State, VariableState[] | null, ResourceState | null>(\r\n    selectedResourceSelector,\r\n    (selectedResource: ResourceState | null) => {\r\n        return selectedResource ? (selectedResource.variables || null) : null;\r\n    }\r\n);\r\n\r\n\r\nexport const selectedVariableSelector = createSelector<State, VariableState | null, VariableState[] | null,\r\n    string\r\n    | null>(\r\n    variablesSelector,\r\n    selectedVariableNameSelector,\r\n    (selectedVariables: VariableState[] | null, selectedVariableName: string | null) => {\r\n        if (canFind(selectedVariables, selectedVariableName)) {\r\n            return (selectedVariables || EMPTY_ARRAY).find(v => v.name === selectedVariableName);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedVariableAttributesTableDataSelector = createSelector<State, [string, any][] | null, VariableState | null>(\r\n    selectedVariableSelector,\r\n    (selectedVariable: VariableState | null) => {\r\n        if (!selectedVariable) {\r\n            return null;\r\n        }\r\n        const tableData: [string, any][] = [\r\n            ['Data type', selectedVariable.dataType],\r\n            ['Units', selectedVariable.units || ''],\r\n            ['Valid minimum', selectedVariable.validMin],\r\n            ['Valid maximum', selectedVariable.validMax],\r\n            ['Dimension names', selectedVariable.dimNames && selectedVariable.dimNames.join(', ')],\r\n            ['Array shape', selectedVariable.shape && selectedVariable.shape.join(', ')],\r\n            ['Chunk sizes', selectedVariable.chunkSizes && selectedVariable.chunkSizes.join(', ')],\r\n            [' ', ''],\r\n        ];\r\n        let attributes = selectedVariable.attributes;\r\n        if (attributes) {\r\n            Object.getOwnPropertyNames(attributes).forEach(name => {\r\n                tableData.push([name, attributes[name]]);\r\n            });\r\n        }\r\n        return tableData;\r\n    }\r\n);\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// View selectors\r\n\r\nexport const viewLayoutSelector = (state: State): ViewLayoutState => state.control.viewLayout;\r\nexport const viewsSelector = (state: State): ViewState<any>[] => state.control.views;\r\nexport const activeViewIdSelector = (state: State): string | null => state.control.activeViewId;\r\n\r\nexport const figureViewsSelector = createSelector<State, ViewState<FigureViewDataState>[], ViewState<any>[]>(\r\n    viewsSelector,\r\n    (views: ViewState<any>[]) => {\r\n        return (views ? views.filter(view => view.type === 'figure') : EMPTY_ARRAY) as ViewState<FigureViewDataState>[];\r\n    }\r\n);\r\n\r\nexport const activeViewSelector = createSelector<State, ViewState<any> | null, ViewState<any>[], string | null>(\r\n    viewsSelector,\r\n    activeViewIdSelector,\r\n    (views: ViewState<any>[], activeViewId) => {\r\n        if (canFind(views, activeViewId)) {\r\n            return views.find(view => view.id === activeViewId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const activeViewTypeSelector = createSelector<State, string | null, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    (view: ViewState<any>) => {\r\n        return view ? view.type : null\r\n    }\r\n);\r\n\r\nexport const selectedEntityIdSelector = createSelector<State, string | null, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    (view: ViewState<any>) => {\r\n        if (view && view.type === 'world') {\r\n            const data = view.data as WorldViewDataState;\r\n            return data.selectedEntityId;\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nexport const selectedEntitySelector = createSelector<State, Cesium.Entity | null, ViewState<any> | null, any>(\r\n    activeViewSelector,\r\n    selectedEntityIdSelector, // we need this to invalidate selector on selection changes in Cesium\r\n    (view: ViewState<any>, unusedEntityId: any) => {\r\n        return getWorldViewSelectedEntity(view);\r\n    }\r\n);\r\n\r\nexport const selectedWorldViewViewerSelector = createSelector<State, Cesium.Viewer | null, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    (view: ViewState<any>) => {\r\n        return view ? getWorldViewViewer(view) : null;\r\n    }\r\n);\r\n\r\nexport const selectedGeometryWKTGetterSelector = createSelector<State, GeometryWKTGetter, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    getWorldViewSelectedGeometryWKTGetter\r\n);\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nexport const externalObjectStoreSelector = (state: State) => EXTERNAL_OBJECT_STORE;\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Layer selectors\r\n\r\nexport const savedLayersSelector = (state: State): SavedLayers => state.session.savedLayers;\r\n\r\nexport const selectedLayerIdSelector = createSelector<State, string | null, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    (view: ViewState<any> | null) => {\r\n        return (view && view.data.selectedLayerId) || null;\r\n    }\r\n);\r\n\r\nexport const baseMapsSelector = (state: State) => state.data.baseMaps;\r\n\r\nexport const baseMapIdSelector = createSelector<State, string, BaseMapState[], ViewState<any> | null>(\r\n    baseMapsSelector,\r\n    activeViewSelector,\r\n    (baseMaps: BaseMapState[], view: ViewState<any> | null) => {\r\n        return (view\r\n                && view.data.baseMapId) || DEFAULT_BASE_MAP_ID;\r\n    }\r\n);\r\n\r\nexport const baseMapSelector = createSelector<State, BaseMapState, BaseMapState[], ViewState<any> | null>(\r\n    baseMapsSelector,\r\n    activeViewSelector,\r\n    (baseMaps: BaseMapState[], view: ViewState<any> | null) => {\r\n        return (view\r\n                && view.data.baseMapId\r\n                && baseMaps.find(bm => bm.id === view.data.baseMapId)) || DEFAULT_BASE_MAP;\r\n    }\r\n);\r\n\r\nexport const baseMapOptionsSelector = createSelector<State, BaseMapOptions | null, BaseMapState>(\r\n    baseMapSelector,\r\n    (baseMap: BaseMapState) => {\r\n        return baseMap.options;\r\n    }\r\n);\r\n\r\nexport const layersSelector = createSelector<State, LayerState[] | null, ViewState<any> | null>(\r\n    activeViewSelector,\r\n    (view: ViewState<any> | null) => {\r\n        return (view && view.data.layers) || null;\r\n    }\r\n);\r\n\r\nexport const selectedLayerSelector = createSelector<State, LayerState | null, LayerState[], string | null>(\r\n    layersSelector,\r\n    selectedLayerIdSelector,\r\n    (layers: LayerState[] | null, selectedLayerId: string | null): LayerState | null => {\r\n        if (canFind(layers, selectedLayerId)) {\r\n            return layers.find(l => l.id === selectedLayerId);\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedLayerIndexSelector = createSelector<State, number, LayerState[], string>(\r\n    layersSelector,\r\n    selectedLayerIdSelector,\r\n    (layers: LayerState[] | null, selectedLayerId: string | null): number => {\r\n        if (canFind(layers, selectedLayerId)) {\r\n            return layers.findIndex(l => l.id === selectedLayerId);\r\n        }\r\n        return -1;\r\n    }\r\n);\r\n\r\nexport const selectedImageLayerSelector = createSelector<State, ImageLayerState | null, LayerState | null>(\r\n    selectedLayerSelector,\r\n    (selectedLayer: LayerState | null) => {\r\n        if (selectedLayer && (selectedLayer.type === 'Image' || selectedLayer.type === 'VariableImage')) {\r\n            return selectedLayer as ImageLayerState;\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedVariableImageLayerSelector = createSelector<State, VariableImageLayerState | null,\r\n    LayerState | null>(\r\n    selectedLayerSelector,\r\n    (selectedLayer: LayerState | null) => {\r\n        if (selectedLayer && selectedLayer.type === 'VariableImage') {\r\n            return selectedLayer as VariableImageLayerState;\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedVariableImageLayerDisplayMinMaxSelector = createSelector<State,\r\n    [number, number] | null, VariableImageLayerState | null>(\r\n    selectedVariableImageLayerSelector,\r\n    (selectedLayer: VariableImageLayerState | null) => {\r\n        if (selectedLayer) {\r\n            const displayMin = isNumber(selectedLayer.displayMin) ? selectedLayer.displayMin : 0;\r\n            const displayMax = isNumber(selectedLayer.displayMax) ? selectedLayer.displayMax : displayMin + 1;\r\n            return [displayMin, displayMax];\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedVectorLayerSelector = createSelector<State, VectorLayerState | null,\r\n    LayerState | null>(\r\n    selectedLayerSelector,\r\n    (selectedLayer: LayerState | null) => {\r\n        if (selectedLayer && (selectedLayer.type === 'Vector' || selectedLayer.type === 'ResourceVector')) {\r\n            return selectedLayer as VectorLayerState;\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const entityUpdateCountSelector = (state: State) => state.control.entityUpdateCount;\r\n\r\nexport const styleContextSelector = (state: State) => state.session.styleContext;\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nexport const vectorStyleSelector = createSelector<State, SimpleStyle, ViewState<any>, string, VectorLayerState | null, Placemark | null, Cesium.Entity | null, number>(\r\n    activeViewSelector,\r\n    styleContextSelector,\r\n    selectedVectorLayerSelector,\r\n    selectedPlacemarkSelector,\r\n    selectedEntitySelector,\r\n    entityUpdateCountSelector,\r\n    (view: ViewState<any>, styleContext, selectedVectorLayer, selectedPlacemark, selectedEntity, entityUpdateCount) => {\r\n        const selectedLayerStyle = selectedVectorLayer && selectedVectorLayer.style;\r\n        let style;\r\n        if (styleContext === STYLE_CONTEXT_LAYER) {\r\n            style = selectedLayerStyle;\r\n        } else if (styleContext === STYLE_CONTEXT_ENTITY) {\r\n            if (selectedPlacemark) {\r\n                const placemarkStyle = simpleStyleFromFeatureProperties(selectedPlacemark.properties);\r\n                style = {...selectedLayerStyle, ...placemarkStyle};\r\n            } else if (selectedEntity) {\r\n                const entityStyle = entityToSimpleStyle(selectedEntity);\r\n                const entityVectorLayer = getWorldViewVectorLayerForEntity(view, selectedEntity);\r\n                const entityVectorLayerStyle = entityVectorLayer && entityVectorLayer.style;\r\n                const savedEntityStyle = entityVectorLayer\r\n                                         && entityVectorLayer.entityStyles\r\n                                         && entityVectorLayer.entityStyles[selectedEntity.id];\r\n                style = {...selectedLayerStyle, ...entityVectorLayerStyle, ...entityStyle, ...savedEntityStyle};\r\n            }\r\n        }\r\n        return {...SIMPLE_STYLE_DEFAULTS, ...style};\r\n    }\r\n);\r\n\r\nexport const selectedResourceVectorLayerSelector = createSelector<State, ResourceVectorLayerState | null,\r\n    LayerState | null>(\r\n    selectedLayerSelector,\r\n    (selectedLayer: LayerState | null) => {\r\n        if (selectedLayer && selectedLayer.type === 'ResourceVector') {\r\n            return selectedLayer as ResourceVectorLayerState;\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const selectedLayerVariablesSelector = createSelector<State, LayerVariableState[] | null, ResourceState[]>(\r\n    resourcesSelector,\r\n    (resources: ResourceState[]) => {\r\n        const layerVariables = [];\r\n        for (let resource of resources) {\r\n            if (resource.variables) {\r\n                for (let variable of resource.variables) {\r\n                    if (isSpatialImageVariable(variable) || isSpatialVectorVariable(variable)) {\r\n                        layerVariables.push({resource, variable});\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return layerVariables;\r\n    }\r\n);\r\n\r\nexport const isComputingVariableStatistics = createSelector<State, boolean,\r\n    ResourceState | null, VariableState | null, VariableLayerBase | null, Set<string>>(\r\n    selectedResourceSelector,\r\n    selectedVariableSelector,\r\n    selectedVariableImageLayerSelector,\r\n    activeRequestLocksSelector,\r\n    (selectedResource: ResourceState | null,\r\n     selectedVariable: VariableState | null,\r\n     selectedVariableImageLayer: VariableLayerBase | null,\r\n     activeRequestLocks: Set<string>) => {\r\n        const imageLayer = selectedVariableImageLayer;\r\n        if (!selectedResource || !selectedVariable || !imageLayer) {\r\n            return false;\r\n        }\r\n        const requestLock = getLockForGetWorkspaceVariableStatistics(selectedResource.name,\r\n                                                                     selectedVariable.name,\r\n                                                                     imageLayer.varIndex);\r\n        return activeRequestLocks.has(requestLock);\r\n    }\r\n);\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Color map selectors\r\n\r\nexport const colorMapCategoriesSelector = (state: State): Array<ColorMapCategoryState> => state.data.colorMaps;\r\n\r\nexport const selectedColorMapSelector = createSelector<State, ColorMapState, ColorMapCategoryState[] | null,\r\n    VariableImageLayerState\r\n    | null>(\r\n    colorMapCategoriesSelector,\r\n    selectedVariableImageLayerSelector,\r\n    (colorMapCategories: ColorMapCategoryState[] | null, selectedImageLayer: VariableImageLayerState | null) => {\r\n        const selectedColorMapName = selectedImageLayer ? selectedImageLayer.colorMapName : null;\r\n        if (canFind(colorMapCategories, selectedColorMapName)) {\r\n            for (let cat of colorMapCategories) {\r\n                const selectedColorMap = cat.colorMaps.find(cm => cm.name === selectedColorMapName);\r\n                if (selectedColorMap) {\r\n                    return selectedColorMap;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n);\r\n\r\nexport const fileAPISelector = createSelector(\r\n    webAPIClientSelector,\r\n    (webAPIClient) => {\r\n        return new FilesAPI(webAPIClient);\r\n    }\r\n);\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Utilities\r\n\r\nfunction canFind(array: any[], id: string): boolean {\r\n    return array && array.length && !!id;\r\n}\r\n\r\n\r\n","/**\r\n * Object functions used to improve readability of Redux reducer code.\r\n *\r\n * @author Norman Fomferra\r\n */\r\n\r\nimport { isDefined, isUndefined } from './types';\r\n\r\n/**\r\n * Encapsulate the idea of passing a new object as the first parameter\r\n * to <code>Object.assign</code> to ensure we correctly copy data instead of mutating.\r\n *\r\n * @param target The target object\r\n * @param sources The source objects\r\n * @returns a new {Object}\r\n */\r\nexport function updateObject(target, ...sources) {\r\n    return Object.assign({}, target, ...sources);\r\n}\r\n\r\n/**\r\n * Similar to <code>updateObject()</code> but updates just the given property in *target*.\r\n *\r\n * @param target The target object\r\n * @param propertyName The property's name.\r\n * @param newValue The property's new value.\r\n * @returns a new {Object}\r\n */\r\nexport function updatePropertyObject(target, propertyName: string, newValue) {\r\n    const oldValue = target[propertyName];\r\n    return updateObject(target, {[propertyName]: updateObject(oldValue, newValue)});\r\n}\r\n\r\n/**\r\n * Similar to <code>updateObject()</code> but will only assign a property if\r\n * a given *source* property is undefined in *target*.\r\n *\r\n * @param target The target object\r\n * @param sources The source objects\r\n * @returns a new {Object}\r\n */\r\nexport function updateConditionally(target, ...sources) {\r\n    target = {...target};\r\n    for (let source of sources) {\r\n        if (isDefined(source)) {\r\n            for (let name of Object.keys(source)) {\r\n                if (isUndefined(target[name])) {\r\n                    target[name] = source[name];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return target;\r\n}\r\n\r\n// TODO (nf): test & find better name\r\nexport function updateConditionally2(target, ...sources) {\r\n    target = {...target};\r\n    for (let source of sources) {\r\n        if (isDefined(source)) {\r\n            for (let name of Object.keys(source)) {\r\n                if (isDefined(source[name])) {\r\n                    target[name] = source[name];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return target;\r\n}\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { Checkbox, Tooltip } from '@blueprintjs/core';\r\n\r\nimport { DialogState, State } from '../state';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\n\r\n\r\ninterface IChooseWorkspaceDialogState extends DialogState {\r\n    workspaceDir: string | null;\r\n    currentWorkspaceName: string;\r\n    selectedWorkspaceName: string;\r\n    deleteEntireWorkspace: boolean;\r\n}\r\n\r\ninterface IChooseWorkspaceDialogOwnProps {\r\n    dialogId: string;\r\n}\r\n\r\ninterface IChooseWorkspaceDialogProps extends IChooseWorkspaceDialogState, IChooseWorkspaceDialogOwnProps {\r\n    isOpen: boolean;\r\n    isLocalFSAllowed: boolean;\r\n    workspaceNames: string[];\r\n}\r\n\r\nexport const OPEN_WORKSPACE_DIALOG_ID = 'openWorkspaceDialog';\r\nexport const DELETE_WORKSPACE_DIALOG_ID = 'deleteWorkspaceDialog';\r\n\r\nfunction mapStateToProps(state: State, ownProps: IChooseWorkspaceDialogOwnProps): IChooseWorkspaceDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(ownProps.dialogId)(state) as any;\r\n    const isOpen = dialogState.isOpen;\r\n    const dialogId = ownProps.dialogId;\r\n    const isLocalFSAllowed = selectors.isLocalFSAccessAllowedSelector(state);\r\n    let workspaceDir = dialogState.workspaceDir;\r\n    let currentWorkspaceName = dialogState.workspaceName;\r\n    let selectedWorkspaceName = '';\r\n    // TODO (forman): Fix code duplication with SelectWorkspaceDialog\r\n    if (isOpen) {\r\n        if (!selectors.isScratchWorkspaceSelector(state)) {\r\n            workspaceDir = workspaceDir || selectors.workspaceDirSelector(state);\r\n            currentWorkspaceName = currentWorkspaceName || selectors.workspaceNameSelector(state);\r\n        }\r\n        workspaceDir = workspaceDir || selectors.lastWorkspaceDirSelector(state);\r\n    }\r\n    workspaceDir = isLocalFSAllowed ? workspaceDir || '' : null;\r\n    currentWorkspaceName = currentWorkspaceName || '';\r\n    let workspaceNames: string[];\r\n    if (state.data.workspace && state.data.workspaceNames) {\r\n        workspaceNames = [...state.data.workspaceNames];\r\n        let indexOf = workspaceNames.indexOf(currentWorkspaceName);\r\n        if (indexOf > -1) {\r\n            workspaceNames.splice(indexOf, 1);\r\n        }\r\n    }\r\n    return {\r\n        workspaceDir,\r\n        currentWorkspaceName,\r\n        selectedWorkspaceName,\r\n        dialogId,\r\n        isOpen,\r\n        isLocalFSAllowed: isLocalFSAllowed,\r\n        workspaceNames: workspaceNames,\r\n        deleteEntireWorkspace: this.deleteEntireWorkspace\r\n    };\r\n}\r\n\r\nclass ChooseWorkspaceDialog extends React.Component<IChooseWorkspaceDialogProps & IChooseWorkspaceDialogOwnProps & DispatchProp<State>, IChooseWorkspaceDialogState> {\r\n\r\n    constructor(props: IChooseWorkspaceDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {\r\n            workspaceDir: '',\r\n            currentWorkspaceName: '',\r\n            selectedWorkspaceName: '',\r\n            deleteEntireWorkspace: true\r\n        };\r\n        // TODO (forman): Fix code duplication with SelectWorkspaceDialog\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onWorkspaceNameChange = this.onWorkspaceNameChange.bind(this);\r\n        this.onWorkspaceDirChange = this.onWorkspaceDirChange.bind(this);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IChooseWorkspaceDialogProps) {\r\n        this.setState({workspaceDir: nextProps.workspaceDir, currentWorkspaceName: nextProps.currentWorkspaceName});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(this.props.dialogId));\r\n        this.resetSelectedWorkspaceName();\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        if (this.state.selectedWorkspaceName === 'undefined' || !this.state.selectedWorkspaceName) {\r\n            return false;\r\n        }\r\n        return /^([A-Za-z_\\-\\s0-9.]+)$/.test(this.state.selectedWorkspaceName);\r\n    }\r\n\r\n    private composeWorkspacePath(): string {\r\n        let workspaceDir = this.state.workspaceDir;\r\n        let workspaceName = this.state.selectedWorkspaceName;\r\n        if (workspaceDir === null) {\r\n            return workspaceName;\r\n        }\r\n        return workspaceDir + '/' + workspaceName;\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(this.props.dialogId, this.state));\r\n        if (this.props.dialogId === DELETE_WORKSPACE_DIALOG_ID) {\r\n            this.props.dispatch(actions.deleteWorkspace(this.composeWorkspacePath(), this.state.deleteEntireWorkspace) as any);\r\n        } else {\r\n            this.props.dispatch(actions.openWorkspace(this.composeWorkspacePath()) as any);\r\n        }\r\n        this.resetSelectedWorkspaceName();\r\n    }\r\n\r\n    private resetSelectedWorkspaceName() {\r\n        this.setState({selectedWorkspaceName: ''});\r\n    }\r\n\r\n    private setSelectedWorkspace(workspaceName: string) {\r\n        this.setState({selectedWorkspaceName: workspaceName});\r\n    }\r\n\r\n    private handleCheckboxChange(event) {\r\n        this.setState({deleteEntireWorkspace: event.target.checked});\r\n    }\r\n\r\n    private onWorkspaceDirChange(ev: any) {\r\n        this.setState({workspaceDir: ev.target.value} as IChooseWorkspaceDialogState);\r\n    }\r\n\r\n    private onWorkspaceNameChange(ev: any) {\r\n        this.setState({currentWorkspaceName: ev.target.value} as IChooseWorkspaceDialogState);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        let title: string;\r\n        let confirmTitle: string;\r\n        if (this.props.dialogId === DELETE_WORKSPACE_DIALOG_ID) {\r\n            title = 'Delete Workspace';\r\n            confirmTitle = 'Delete';\r\n        } else {\r\n            title = 'Open Workspace';\r\n            confirmTitle = 'Open';\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title={title}\r\n                confirmTitle={confirmTitle}\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    renderItem = (path: string) => {\r\n        return (<span>{path}</span>);\r\n    };\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        if (this.props.workspaceNames.length === 0) {\r\n            return (\r\n                <div>\r\n                    <p style={{marginTop: '1em'}}>No saved workspaces found.</p>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        let checkbox;\r\n        if (this.props.dialogId === DELETE_WORKSPACE_DIALOG_ID) {\r\n            checkbox =\r\n                <Tooltip content={\"Also delete other files in the workspace folder\"}>\r\n                    <Checkbox\r\n                        style={{marginTop: '1em'}}\r\n                        label={'Delete entire workspace'}\r\n                        checked={this.state.deleteEntireWorkspace}\r\n                        onChange={this.handleCheckboxChange.bind(this)}\r\n                    />\r\n                </Tooltip>\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <p style={{marginTop: '1em'}}>Saved workspaces:</p>\r\n                <ListBox items={this.props.workspaceNames}\r\n                         selectionMode={ListBoxSelectionMode.SINGLE}\r\n                         getItemKey={(item: any, itemIndex: number) => item}\r\n                         renderItem={this.renderItem}\r\n                         onSelection={newSelection => this.setSelectedWorkspace('' + newSelection[0])}\r\n                         selection={this.state.selectedWorkspaceName}\r\n                />\r\n                {checkbox}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(ChooseWorkspaceDialog);\r\n","declare global {\r\n    // noinspection JSUnusedGlobalSymbols\r\n    interface Window {\r\n        electron?: any;\r\n    }\r\n}\r\n\r\nexport function isElectron() {\r\n    return Boolean(window.electron);\r\n}\r\n\r\nexport function requireElectron(): any | null {\r\n    return window.electron || null;\r\n}\r\n\r\nif (isElectron()) {\r\n    console.debug('We are running on Electron :)');\r\n}\r\n","export class HttpError extends Error {\r\n    constructor(status: number, statusText: string) {\r\n        super(statusText);\r\n        this._status = status;\r\n    }\r\n\r\n    private _status: number;\r\n\r\n    get status(): number {\r\n        return this._status;\r\n    }\r\n\r\n    get statusText(): string {\r\n        return this.message;\r\n    }\r\n\r\n    static fromResponse(response: Response): HttpError {\r\n        return new HttpError(response.status, response.statusText);\r\n    }\r\n}\r\n","/**\r\n * Created by Norman on 22.03.2017.\r\n */\r\n\r\n\r\nexport function isDefined(value: any): boolean {\r\n    return typeof (value) !== 'undefined';\r\n}\r\n\r\nexport function isUndefined(value: any): boolean {\r\n    return typeof (value) === 'undefined';\r\n}\r\n\r\nexport function isDefinedAndNotNull(value: any): boolean {\r\n    return value !== null && typeof (value) !== 'undefined';\r\n}\r\n\r\nexport function isUndefinedOrNull(value: any): boolean {\r\n    return value === null || typeof (value) === 'undefined';\r\n}\r\n\r\nexport function isNumber(value: any): boolean {\r\n    return typeof (value) === 'number';\r\n}\r\n\r\nexport function isString(value: any): boolean {\r\n    return typeof (value) === 'string';\r\n}\r\n\r\nexport function isBoolean(value: any): boolean {\r\n    return typeof (value) === 'boolean';\r\n}\r\n","import * as React from 'react';\r\nimport { CSSProperties } from \"react\";\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { AnchorButton, ControlGroup, Intent } from \"@blueprintjs/core\";\r\nimport Dropzone from 'react-dropzone';\r\n\r\nimport { DialogState, State } from '../state';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { showDirectorySelectDialog } from \"../actions\";\r\nimport { TextField } from \"../components/field/TextField\";\r\n\r\n\r\nconst DIV_STYLE = {width: '100%', marginBottom: '2em', display: 'flex', flexGrow: 1};\r\nconst TEXT_FIELD_STYLE = {flexGrow: 1};\r\nconst BUTTON_STYLE = {flex: 'none'};\r\n\r\n\r\nconst baseStyle: CSSProperties = {\r\n    flex: 1,\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    padding: '20px',\r\n    border: '2px dashed #137cbd',\r\n    borderRadius: '5px',\r\n    background: 'rgba(16, 22, 26, 0.3)',\r\n    color: '#f5f8fa',\r\n    transition: 'border .24s ease-in-out'\r\n};\r\n\r\ninterface IFileUploadDialogProps {\r\n    dialogId: string;\r\n    isOpen: boolean;\r\n}\r\n\r\ninterface IFileUploadDialogState extends DialogState {\r\n    files: File[];\r\n    dir: string;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IFileUploadDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(FileUploadDialog.DIALOG_ID)(state);\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n        dialogId: FileUploadDialog.DIALOG_ID\r\n    };\r\n}\r\n\r\nclass FileUploadDialog extends React.Component<IFileUploadDialogProps & DispatchProp<State>, IFileUploadDialogState> {\r\n    static readonly DIALOG_ID = 'fileUploadDialog';\r\n\r\n    constructor(props: IFileUploadDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {files: [], dir: './'};\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IFileUploadDialogProps) {\r\n        this.setState({files: [], dir: './'});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(FileUploadDialog.DIALOG_ID));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        return this.state.files.length > 0;\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(FileUploadDialog.DIALOG_ID, this.state));\r\n        for (let file of this.state.files) {\r\n            this.props.dispatch(actions.uploadFiles(this.state.dir, file) as any);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title=\"Upload files\"\r\n                icon=\"upload\"\r\n                confirmTitle=\"Upload\"\r\n                confirmIconName=\"upload\"\r\n                confirmTooltip=\"Upload files.\"\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    handleOnDrop = (files: File[]) => {\r\n        this.setState({...this.state, files: files});\r\n    };\r\n\r\n    handleOpenDirectoryOnClose = (dir: string) => {\r\n        this.setState({...this.state, dir: dir});\r\n        console.log(dir);\r\n    };\r\n\r\n    handleOpenDirectoryOpen = () => {\r\n        this.props.dispatch(\r\n            showDirectorySelectDialog({title: 'Select Target Directory'}, this.handleOpenDirectoryOnClose) as any);\r\n    };\r\n\r\n    private renderBody() {\r\n        const files = this.state.files.map(file => (\r\n            <li key={file.name}>\r\n                {file.name} - {file.size} bytes\r\n            </li>\r\n        ));\r\n\r\n        if (!this.state.files) {\r\n            return null;\r\n        }\r\n        return (\r\n            <div>\r\n                <div>\r\n                    Remote target directory:\r\n                    <ControlGroup style={DIV_STYLE} fill={true}>\r\n                        <TextField style={TEXT_FIELD_STYLE}\r\n                                   value={this.state.dir}\r\n                                   onChange={value => {\r\n                                       console.log(value);\r\n                                   }}\r\n                                   nullable={false}\r\n                        />\r\n                        <AnchorButton intent={Intent.PRIMARY} style={BUTTON_STYLE}\r\n                                      onClick={this.handleOpenDirectoryOpen}>...</AnchorButton>\r\n\r\n                    </ControlGroup>\r\n                </div>\r\n\r\n                <div>Files to upload:\r\n                    <ControlGroup style={DIV_STYLE} fill={true}>\r\n                        <Dropzone onDrop={this.handleOnDrop}>\r\n                            {({getRootProps, getInputProps}) => (\r\n                                <section className=\"container\">\r\n                                    <div {...getRootProps({style: baseStyle})}>\r\n                                        <input {...getInputProps()} />\r\n                                        <p>Drag 'n' drop files here, or click to select files</p>\r\n                                    </div>\r\n                                    <aside>\r\n                                        {files.length > 0 ? (<h4>Files</h4>) : ''}\r\n                                        <ul>{files}</ul>\r\n                                    </aside>\r\n                                </section>\r\n                            )}\r\n                        </Dropzone>\r\n                    </ControlGroup>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport const FILE_UPLOAD_DIALOG_ID = FileUploadDialog.DIALOG_ID;\r\n\r\nexport default connect(mapStateToProps)(FileUploadDialog);\r\n","import { WebAPIServiceInfo } from '../../state';\r\nimport { HttpError } from '../HttpError';\r\n\r\n\r\nexport class ServiceInfoAPI {\r\n\r\n    getServiceInfo(serviceURL: string): Promise<WebAPIServiceInfo> {\r\n        const url = new URL(serviceURL + \"/\");\r\n        // console.log('GET: ', url);\r\n        return fetch(url.toString())\r\n            .then((response: Response) => {\r\n                if (!response.ok) {\r\n                    throw HttpError.fromResponse(response);\r\n                }\r\n                return response.json() as Promise<any>;\r\n            })\r\n            .then((response: any) => {\r\n                const webAPIServiceInfo = response.content;\r\n                return {\r\n                    name: webAPIServiceInfo.name,\r\n                    version: webAPIServiceInfo.version,\r\n                    timestamp: webAPIServiceInfo.timestamp,\r\n                    userRootMode: webAPIServiceInfo.user_root_mode,\r\n                    hostOS: webAPIServiceInfo.host_os,\r\n                    dependencies: webAPIServiceInfo.dependencies\r\n                };\r\n            });\r\n    }\r\n}\r\n","import {\r\n    LayerState,\r\n    PlacemarkCollection,\r\n    ResourceState,\r\n    ResourceVectorLayerState,\r\n    VariableImageLayerState,\r\n    VectorLayerState\r\n} from '../state';\r\nimport { ImageLayerDescriptor, LayerDescriptors, VectorLayerDescriptor, } from '../components/cesium/CesiumGlobe';\r\nimport {\r\n    AUTO_LAYER_ID,\r\n    COUNTRIES_LAYER_ID,\r\n    findResource,\r\n    findVariable,\r\n    getFeatureCollectionUrl,\r\n    getGeoJSONCountriesUrl,\r\n    getTileUrl,\r\n    MY_PLACES_LAYER_ID,\r\n} from '../state-util';\r\nimport { memoize } from '../../common/memoize';\r\nimport { EMPTY_OBJECT } from '../selectors';\r\nimport * as Cesium from 'cesium';\r\nimport { isNumber } from '../../common/types';\r\nimport { SimpleStyle } from '../../common/geojson-simple-style';\r\nimport { simpleStyleToCesium } from '../components/cesium/cesium-util';\r\n\r\n\r\nexport function convertLayersToLayerDescriptors(layers: LayerState[],\r\n                                                resources: ResourceState[],\r\n                                                placemarkCollection: PlacemarkCollection,\r\n                                                baseUrl: string,\r\n                                                baseDir: string): LayerDescriptors {\r\n    if (!layers || !layers.length) {\r\n        return EMPTY_OBJECT;\r\n    }\r\n    let imageLayerDescriptors: ImageLayerDescriptor[];\r\n    let vectorLayerDescriptors: VectorLayerDescriptor[];\r\n    for (let layer of layers) {\r\n        let imageLayerDescriptor: ImageLayerDescriptor;\r\n        let vectorLayerDescriptor: VectorLayerDescriptor;\r\n        switch (layer.type) {\r\n            case 'VariableImage': {\r\n                imageLayerDescriptor = convertVariableImageLayerToDescriptor(layer as VariableImageLayerState,\r\n                                                                             baseUrl, baseDir, resources);\r\n                break;\r\n            }\r\n            case 'ResourceVector': {\r\n                vectorLayerDescriptor = convertResourceVectorLayerToDescriptor(layer as ResourceVectorLayerState,\r\n                                                                               baseUrl, baseDir, resources);\r\n                break;\r\n            }\r\n            case 'Vector': {\r\n                vectorLayerDescriptor = convertVectorLayerToDescriptor(layer as VectorLayerState,\r\n                                                                       baseUrl, placemarkCollection);\r\n                break;\r\n            }\r\n        }\r\n        if (imageLayerDescriptor) {\r\n            if (!imageLayerDescriptors) {\r\n                imageLayerDescriptors = [imageLayerDescriptor];\r\n            } else {\r\n                // noinspection JSUnusedAssignment\r\n                imageLayerDescriptors.push(imageLayerDescriptor);\r\n            }\r\n        } else if (vectorLayerDescriptor) {\r\n            if (!vectorLayerDescriptors) {\r\n                vectorLayerDescriptors = [vectorLayerDescriptor];\r\n            } else {\r\n                // noinspection JSUnusedAssignment\r\n                vectorLayerDescriptors.push(vectorLayerDescriptor);\r\n            }\r\n        } else if (layer.id !== AUTO_LAYER_ID) {\r\n            console.warn(`GlobeView: layer with ID \"${layer.id}\" will not be rendered`);\r\n        }\r\n    }\r\n\r\n    return {imageLayerDescriptors, vectorLayerDescriptors};\r\n}\r\n\r\n\r\nfunction convertVariableImageLayerToDescriptor(layer: VariableImageLayerState,\r\n                                               baseUrl: string,\r\n                                               baseDir: string,\r\n                                               resources: ResourceState[]): ImageLayerDescriptor | null {\r\n    const variable = findVariable(resources, layer);\r\n    if (!variable) {\r\n        console.warn(`GlobeView: variable \"${layer.varName}\" not found in resource \"${layer.resId}\"`);\r\n        return null;\r\n    }\r\n    const imageLayout = variable.imageLayout;\r\n    if (!variable.imageLayout) {\r\n        console.warn(`GlobeView: variable \"${layer.varName}\" of resource \"${layer.resId}\" has no imageLayout`);\r\n        return null;\r\n    }\r\n    const url = getTileUrl(baseUrl, baseDir, layer);\r\n    let rectangle = Cesium.Rectangle.MAX_VALUE;\r\n    if (imageLayout.extent) {\r\n        const extent = imageLayout.extent;\r\n        rectangle = Cesium.Rectangle.fromDegrees(extent.west, extent.south, extent.east, extent.north);\r\n    }\r\n    return Object.assign({}, layer, {\r\n        imageryProvider: createImageryProvider,\r\n        imageryProviderOptions: {\r\n            url,\r\n            rectangle,\r\n            minimumLevel: 0,\r\n            maximumLevel: imageLayout.numLevels - 1,\r\n            tileWidth: imageLayout.tileWidth,\r\n            tileHeight: imageLayout.tileHeight,\r\n            tilingScheme: new Cesium.GeographicTilingScheme({\r\n                                                                rectangle,\r\n                                                                numberOfLevelZeroTilesX: imageLayout.numLevelZeroTilesX,\r\n                                                                numberOfLevelZeroTilesY: imageLayout.numLevelZeroTilesY\r\n                                                            }),\r\n        },\r\n    });\r\n}\r\n\r\nfunction convertResourceVectorLayerToDescriptor(layer: ResourceVectorLayerState,\r\n                                                baseUrl: string,\r\n                                                baseDir: string,\r\n                                                resources: ResourceState[]): VectorLayerDescriptor | null {\r\n    const resource = findResource(resources, layer);\r\n    if (!resource) {\r\n        console.warn(`globe-view-layers: resource \"${layer.resId}\" not found\"`);\r\n        return null;\r\n    }\r\n    return {\r\n        ...layer,\r\n        dataSource: createResourceGeoJSONDataSource,\r\n        dataSourceOptions: {\r\n            data: getFeatureCollectionUrl(baseUrl, baseDir, layer),\r\n            resId: resource.id,\r\n            style: layer.style,\r\n        },\r\n    } as VectorLayerDescriptor;\r\n}\r\n\r\nfunction convertVectorLayerToDescriptor(layer: VectorLayerState,\r\n                                        baseUrl: string,\r\n                                        placemarkCollection: PlacemarkCollection): VectorLayerDescriptor {\r\n    let data = layer.data;\r\n    let style = layer.style;\r\n    if (layer.id === COUNTRIES_LAYER_ID) {\r\n        data = getGeoJSONCountriesUrl(baseUrl);\r\n    } else if (layer.id === MY_PLACES_LAYER_ID) {\r\n        data = placemarkCollection;\r\n    }\r\n    return {\r\n        ...layer,\r\n        dataSource: createGeoJsonDataSource,\r\n        dataSourceOptions: {data, style},\r\n    } as VectorLayerDescriptor;\r\n}\r\n\r\n/**\r\n * Creates a Cesium.UrlTemplateImageryProvider instance.\r\n *\r\n * @param viewer the Cesium viewer\r\n * @param imageryProviderOptions see https://cesiumjs.org/Cesium/Build/Documentation/UrlTemplateImageryProvider.html\r\n */\r\nfunction createImageryProvider(viewer: Cesium.Viewer, imageryProviderOptions): Cesium.ImageryProvider {\r\n    const imageryProvider = new Cesium.UrlTemplateImageryProvider(imageryProviderOptions);\r\n    imageryProvider.errorEvent.addEventListener((event) => {\r\n        console.error('GlobeView:', event);\r\n    });\r\n    return imageryProvider;\r\n}\r\n\r\n/**\r\n * Creates a Cesium.GeoJsonDataSource instance.\r\n *\r\n * @param viewer the Cesium viewer\r\n * @param dataSourceOptions see https://cesiumjs.org/Cesium/Build/Documentation/GeoJsonDataSource.html\r\n */\r\nfunction createGeoJsonDataSource(viewer: Cesium.Viewer, dataSourceOptions): Promise<Cesium.DataSource> {\r\n    const style = simpleStyleToCesium(dataSourceOptions.style || EMPTY_OBJECT);\r\n    return Cesium.GeoJsonDataSource.load(dataSourceOptions.data, style);\r\n}\r\n\r\n/**\r\n * Creates a Cesium.GeoJsonDataSource instance that loads GeoJSON features from Cate WebAPI REST call.\r\n *\r\n * @param viewer the Cesium viewer\r\n * @param dataSourceOptions see https://cesiumjs.org/Cesium/Build/Documentation/GeoJsonDataSource.html\r\n */\r\nfunction createResourceGeoJSONDataSource(viewer: Cesium.Viewer, dataSourceOptions): Cesium.DataSource {\r\n    return createResourceGeoJSONDataSourceImpl(dataSourceOptions.data, dataSourceOptions.resId, dataSourceOptions.style);\r\n}\r\n\r\ntype ResourceGeoJSONDataSourceFactory = (url: string, resId: number, style: SimpleStyle) => Cesium.DataSource;\r\n\r\nconst createResourceGeoJSONDataSourceImpl: ResourceGeoJSONDataSourceFactory =\r\n    memoize((url: string, resId: number, style: SimpleStyle) => {\r\n        const customDataSource: Cesium.DataSource = new Cesium.CustomDataSource('Cate Resource #' + resId);\r\n        const cStyle = simpleStyleToCesium(style);\r\n        // let numFeatures = 0;\r\n        // const worker = new Worker();\r\n        const worker = new Worker(`${process.env.PUBLIC_URL}/stream-geojson.js`);\r\n        worker.postMessage(url);\r\n        worker.onmessage = function (event: MessageEvent) {\r\n\r\n            const features = event.data;\r\n            if (!features) {\r\n                // console.log(`Received ${numFeatures} feature(s) in total from ${url}`);\r\n                return;\r\n            }\r\n\r\n            // numFeatures += features.length;\r\n            // console.log(`Received another ${features.length} feature(s) from ${url}`);\r\n\r\n            // Style for points symbolizing a more complex geometry\r\n            const pixelSizeMin = 10;\r\n            const pixelSizeMax = 100;\r\n            const areaMin = 20.;\r\n            const areaMax = 500.;\r\n            const defaultRatio = 0.2;\r\n            const pointColor = Cesium.Color.fromAlpha(cStyle.fill, 0.9);\r\n            const pointOutlineColor = Cesium.Color.fromAlpha(cStyle.fill, 0.5);\r\n            const featureCollection = {\r\n                type: 'FeatureCollection',\r\n                features: features\r\n            };\r\n            Cesium.GeoJsonDataSource.load(featureCollection, cStyle)\r\n                  .then((geoJsonDataSource: Cesium.GeoJsonDataSource) => {\r\n\r\n                      const featureMap = new Map();\r\n                      features.forEach(f => featureMap.set(f.id, f));\r\n\r\n                      // Style for points symbolizing a more complex geometry\r\n                      const scaleByDistance = new Cesium.NearFarScalar(2e2, 1.0, 1e7, 0.1);\r\n                      const translucencyByDistance = new Cesium.NearFarScalar(2e2, 1.0, 1e7, 0.5);\r\n\r\n                      customDataSource.entities.suspendEvents();\r\n\r\n                      for (let entity of geoJsonDataSource.entities.values) {\r\n                          // console.log(\"entity: \", entity);\r\n                          // TODO #477 (nf): Use of the following featureMap is probably wrong\r\n                          //   as there is no unconditional 1:1 mapping between GeoJSON features and generated entities.\r\n                          const feature = featureMap.get(entity.id);\r\n                          // console.log(\"feature: \", feature);\r\n                          if (feature\r\n                              && isNumber(feature._simp)\r\n                              && isNumber(feature._resId)\r\n                              && isNumber(feature._idx)\r\n                              && !!(entity.point || entity.billboard || entity.label)) {\r\n\r\n                              // TODO #477 (nf): Generalize this code. This is for Glaciers CCI.\r\n                              //   See #491: use a special style for feature geometries that are expandable/collapsible.\r\n                              let ratio = defaultRatio;\r\n\r\n                              if (feature.properties) {\r\n                                  let area = feature.properties['area_npl43'];\r\n                                  if (area) {\r\n                                      ratio = (area - areaMin) / (areaMax - areaMin);\r\n                                      if (ratio < 0.) {\r\n                                          ratio = 0.;\r\n                                      }\r\n                                      if (ratio > 1.) {\r\n                                          ratio = 1.;\r\n                                      }\r\n                                  }\r\n                              }\r\n\r\n                              const pixelSize = pixelSizeMin + ratio * (pixelSizeMax - pixelSizeMin);\r\n\r\n                              entity = new Cesium.Entity({\r\n                                                             id: entity.id,\r\n                                                             position: entity.position,\r\n                                                             description: entity.description,\r\n                                                             properties: entity.properties,\r\n                                                             point: {\r\n                                                                 // Style for points symbolizing a more complex geometry\r\n                                                                 color: pointColor,\r\n                                                                 outlineColor: pointOutlineColor,\r\n                                                                 outlineWidth: 10,\r\n                                                                 // pixelSize will multiply by the scale factor, so in this\r\n                                                                 // example the size will range from pixelSize (near) to 0.1*pixelSize (far).\r\n                                                                 pixelSize,\r\n                                                                 scaleByDistance,\r\n                                                                 translucencyByDistance,\r\n                                                             }\r\n                                                         });\r\n\r\n                              entity['_simp'] = feature._simp;\r\n                              entity['_resId'] = feature._resId;\r\n                              entity['_idx'] = feature._idx;\r\n                          }\r\n\r\n                          try {\r\n                              customDataSource.entities.add(entity);\r\n                              // console.log(\"added entity: \", entity);\r\n                          } catch (e) {\r\n                              console.error('failed to add entity: ', entity, e);\r\n                          }\r\n                      }\r\n\r\n                      geoJsonDataSource.entities.removeAll();\r\n                      customDataSource.entities.resumeEvents();\r\n                      customDataSource.changedEvent.raiseEvent();\r\n                      // console.log(`Added another ${features.length} feature(s) to Cesium custom data source`);\r\n                  });\r\n        };\r\n        return customDataSource;\r\n    });\r\n\r\nconst entityGeometryPropertyNames = ['billboard', 'label', 'point', 'corridor', 'polyline', 'polygon'];\r\n\r\nexport function reloadEntityWithOriginalGeometry(oldEntity: Cesium.Entity, featureUrl: string, style: SimpleStyle) {\r\n    // TODO #477 (nf): We don't correctly handle multi-geometries here.\r\n    const cStyle = simpleStyleToCesium(style);\r\n    Cesium.GeoJsonDataSource.load(featureUrl, cStyle)\r\n          .then((geoJsonDataSource: Cesium.GeoJsonDataSource) => {\r\n              const entities = geoJsonDataSource.entities.values;\r\n              if (entities && entities.length) {\r\n                  const entity = entities[0];\r\n                  transferEntityGeometry(entity, oldEntity);\r\n              }\r\n          });\r\n}\r\n\r\nexport function transferEntityGeometry(fromEntity: Cesium.Entity, toEntity: Cesium.Entity): void {\r\n    const newGeomPropertyName = entityGeometryPropertyNames.find(name => Cesium.defined(fromEntity[name]));\r\n    const oldGeomPropertyName = entityGeometryPropertyNames.find(name => Cesium.defined(toEntity[name]));\r\n    if (oldGeomPropertyName && newGeomPropertyName && oldGeomPropertyName !== newGeomPropertyName) {\r\n        toEntity[oldGeomPropertyName] = undefined;\r\n    }\r\n    if (newGeomPropertyName) {\r\n        toEntity[newGeomPropertyName] = fromEntity[newGeomPropertyName];\r\n        if (isNumber(toEntity['_simp'])) {\r\n            // clear geometry simplification flag\r\n            toEntity['_simp'] &= ~0x01;\r\n        }\r\n    }\r\n}\r\n","import { isUndefinedOrNull } from './types';\r\n\r\nexport interface MemoizedFunction {\r\n    (...args): any;\r\n\r\n    getMaxSize();\r\n\r\n    getSize();\r\n\r\n    clearCache();\r\n}\r\n\r\n/**\r\n * Wrap a function with a memoizing function that saves up to the maxSize most recent calls.\r\n *\r\n * @param func The function to wrap.\r\n * @param maxSize Number of most recent calls to be memoized.\r\n * @returns A memoized version of func.\r\n */\r\nexport function memoize(func: Function, maxSize?: number): MemoizedFunction {\r\n\r\n    let memo = {};\r\n    let size = 0;\r\n\r\n    const memoized = (...args) => {\r\n        //console.log('memoized: totalSize =', size)\r\n        const key = args.map(a => `(${a}:${typeof a})`).join();\r\n        if (key in memo) {\r\n            return memo[key];\r\n        } else {\r\n            const value = func(...args);\r\n            if (isUndefinedOrNull(maxSize) || (maxSize > 0 && size < maxSize)) {\r\n                memo[key] = value;\r\n                size++;\r\n            }\r\n            return value;\r\n        }\r\n    };\r\n\r\n    memoized['getMaxSize'] = () => maxSize;\r\n    memoized['getSize'] = () => size;\r\n    memoized['clearCache'] = () => {\r\n        memo = {};\r\n        size = 0;\r\n    };\r\n\r\n    return memoized as MemoizedFunction;\r\n}\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 221;","import * as Cesium from 'cesium';\r\nimport { IconName } from '@blueprintjs/core';\r\n\r\nimport {\r\n    AnimationViewDataState,\r\n    BaseMapState,\r\n    DatasetDescriptor,\r\n    DataSourceState,\r\n    DataSourceCapability,\r\n    DataStoreState,\r\n    DimSizes,\r\n    FigureViewDataState,\r\n    LayerState,\r\n    OperationState,\r\n    Placemark,\r\n    PlacemarkCollection,\r\n    ResourceRefState,\r\n    ResourceState,\r\n    ResourceVectorLayerState,\r\n    SavedLayers,\r\n    SPLIT_MODE_OFF,\r\n    TableViewDataState,\r\n    VariableDataRefState, VariableDescriptor,\r\n    VariableImageLayerState,\r\n    VariableRefState,\r\n    VariableState,\r\n    VectorLayerBase,\r\n    WorldViewDataState\r\n} from './state';\r\nimport { ViewState } from './components/ViewState';\r\nimport * as assert from '../common/assert';\r\nimport { isNumber, isString } from '../common/types';\r\nimport { EMPTY_ARRAY, EMPTY_OBJECT } from './selectors';\r\nimport { GeometryWKTGetter } from './containers/editor/ValueEditor';\r\nimport { entityToGeometryWkt } from './components/cesium/cesium-util';\r\nimport { SIMPLE_STYLE_DEFAULTS, SimpleStyle } from '../common/geojson-simple-style';\r\n\r\n\r\nexport const AUTO_LAYER_ID = 'auto';\r\nexport const COUNTRIES_LAYER_ID = 'countries';\r\nexport const MY_PLACES_LAYER_ID = 'myPlaces';\r\n\r\nexport const AUTO_LAYER = {\r\n    id: AUTO_LAYER_ID,\r\n    type: 'Unknown',\r\n    visible: true,\r\n};\r\n\r\nexport const COUNTRIES_LAYER = {\r\n    id: COUNTRIES_LAYER_ID,\r\n    name: 'Countries',\r\n    type: 'Vector',\r\n    visible: false,\r\n    style: {\r\n        ...SIMPLE_STYLE_DEFAULTS,\r\n        stroke: '#ffff00',\r\n        fill: '#FFFFFF',\r\n        fillOpacity: 0.2,\r\n        strokeWidth: 1.5,\r\n    },\r\n};\r\n\r\nexport const MY_PLACES_LAYER = {\r\n    id: MY_PLACES_LAYER_ID,\r\n    name: 'My Places',\r\n    type: 'Vector',\r\n    visible: true,\r\n    style: {\r\n        markerSize: 'small',\r\n        markerColor: '#ff0000',\r\n        markerSymbol: '',\r\n        fill: '#0000ff',\r\n        fillOpacity: 0.5,\r\n        stroke: '#ffff00',\r\n        strokeOpacity: 0.5,\r\n        strokeWidth: 1,\r\n    },\r\n};\r\n\r\nexport const PLACEMARK_ID_PREFIX = 'placemark-';\r\n\r\nexport function isLocalDataStore(dataStore: DataStoreState | null) {\r\n    return dataStore && (dataStore.id === 'local' || dataStore.isLocal);\r\n}\r\n\r\nexport function isRemoteDataStore(dataStore: DataStoreState | null) {\r\n    return dataStore && dataStore.id !== 'local' && !dataStore.isLocal;\r\n}\r\n\r\nexport interface DataSourceUrls {\r\n    catalogUrl?: string;\r\n    infoUrl?: string;\r\n}\r\n\r\nexport function getDataSourceUrls(dataSource: DataSourceState): DataSourceUrls {\r\n    const metaInfo = dataSource.metaInfo;\r\n    let catalogUrl;\r\n    let infoUrl;\r\n    if (metaInfo) {\r\n        catalogUrl = metaInfo.catalog_url || metaInfo.catalogue_url;\r\n        if (!catalogUrl && dataSource.id.includes(\"esacci\") && metaInfo.uuid) {\r\n            catalogUrl = `https://catalogue.ceda.ac.uk/uuid/${metaInfo.uuid}`;\r\n        }\r\n        infoUrl = metaInfo.info_url;\r\n    }\r\n    return {catalogUrl, infoUrl};\r\n}\r\n\r\n/**\r\n * Compute capabilities for data source.\r\n * This function is actually invoked for any data source NOT originating from CCI ODP data store.\r\n * @param dataSource a data source\r\n */\r\nexport function computeDataSourceCapabilities(dataSource: DataSourceState): DataSourceCapability[] | undefined {\r\n    const dsd = dataSource.metaInfo;\r\n    if (dsd) {\r\n        const canConstrainTime = isCoord1DInDataset(dsd, 'time');\r\n        const canConstrainRegion = isCoord1DInDataset(dsd, 'lon')\r\n                                   && isCoord1DInDataset(dsd, 'lat');\r\n        if (canConstrainTime && canConstrainRegion) {\r\n            return [\"open\", \"constrain_time\", \"constrain_region\"];\r\n        } else if (canConstrainTime) {\r\n            return [\"open\", \"constrain_time\"];\r\n        } else if (canConstrainRegion) {\r\n            return [\"open\", \"constrain_region\"];\r\n        }\r\n        if (isString(dsd.data_type)) {\r\n            if (dsd.data_type === \"dataset\") {\r\n                return [\"open\"];\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction isCoord1DInDataset(dsd: DatasetDescriptor, name: string): boolean {\r\n    return !!(dsd.coords && dsd.coords.find(c => isCoord1D(c, name)));\r\n}\r\n\r\nfunction isCoord1D(c: VariableDescriptor, name: string): boolean {\r\n    return c.name === name\r\n           && !!c.dims\r\n           && c.dims.length === 1\r\n           && !!c.dims.find(d => d === name);\r\n}\r\n\r\nexport function canOpenDataSource(dataSource: DataSourceState) {\r\n    return _checkDataSourceCapability(dataSource,\r\n                                      'open', 'constrain_region', 'constrain_time', 'write_zarr');\r\n}\r\n\r\nexport function canCacheDataSource(dataSource: DataSourceState) {\r\n    return _checkDataSourceCapability(dataSource,\r\n                                      'write_zarr');\r\n}\r\n\r\nexport function canConstrainDataSourceTime(dataSource: DataSourceState) {\r\n    return _checkDataSourceCapability(dataSource,\r\n                                      'constrain_time');\r\n}\r\n\r\nexport function canConstrainDataSourceRegion(dataSource: DataSourceState) {\r\n    return _checkDataSourceCapability(dataSource,\r\n                                      'constrain_region');\r\n}\r\n\r\nexport function canMapDataSource(dataSource: DataSourceState) {\r\n    return _checkDataSourceCapability(dataSource,\r\n                                      'constrain_region');\r\n}\r\n\r\nexport function canConstrainDataSourceVariables(dataSource: DataSourceState) {\r\n    return dataSource.metaInfo\r\n           && dataSource.metaInfo.data_vars\r\n           && dataSource.metaInfo.data_vars.length > 1;\r\n}\r\n\r\nfunction _checkDataSourceCapability(dataSource: DataSourceState,\r\n                                    ...requiredCapabilities: DataSourceCapability[]): boolean | undefined {\r\n    let capabilities = dataSource.capabilities;\r\n    if (!capabilities) {\r\n        if ((dataSource.dataType && dataSource.dataType === 'dataset')\r\n            || dataSource.id.endsWith('.zarr')) {\r\n            // dataSource.capabilities have been introduced for ESA CCI datasets only\r\n            capabilities = [\"open\"];\r\n        }\r\n    }\r\n    if (Array.isArray(capabilities)) {\r\n        const availableCapabilities = new Set<string>(capabilities);\r\n        for (let requiredCapability of requiredCapabilities) {\r\n            if (availableCapabilities.has(requiredCapability)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\nexport function getTileUrl(baseUrl: string, baseDir: string, layer: VariableImageLayerState): string {\r\n    return baseUrl + `ws/res/tile/${encodeURIComponent(baseDir)}/${layer.resId}/{z}/{y}/{x}.png?`\r\n           + `&var=${encodeURIComponent(layer.varName)}`\r\n           + `&index=${encodeURIComponent((layer.varIndex || []).join())}`\r\n           + `&cmap=${encodeURIComponent(layer.colorMapName) + (layer.alphaBlending ? '_alpha' : '')}`\r\n           + `&min=${encodeURIComponent(layer.displayMin + '')}`\r\n           + `&max=${encodeURIComponent(layer.displayMax + '')}`;\r\n}\r\n\r\nexport function getFeatureCollectionUrl(baseUrl: string, baseDir: string, ref: ResourceRefState): string {\r\n    return baseUrl + `ws/res/geojson/${encodeURIComponent(baseDir)}/${ref.resId}`;\r\n}\r\n\r\nexport function getFeatureUrl(baseUrl: string, baseDir: string, ref: ResourceRefState, index: number): string {\r\n    return baseUrl + `ws/res/geojson/${encodeURIComponent(baseDir)}/${ref.resId}/${index}`;\r\n}\r\n\r\nexport function getCsvUrl(baseUrl: string, baseDir: string, ref: ResourceRefState, varName?: string | null): string {\r\n    let varPart = '';\r\n    if (varName) {\r\n        varPart = `?var=${encodeURIComponent(varName)}`;\r\n    }\r\n    return baseUrl + `ws/res/csv/${encodeURIComponent(baseDir)}/${ref.resId}${varPart}`;\r\n}\r\n\r\nexport function getHtmlUrl(baseUrl: string, baseDir: string, resId: number): string {\r\n    return baseUrl + `ws/res/html/${encodeURIComponent(baseDir)}/${resId}`;\r\n}\r\n\r\nexport function getGeoJSONCountriesUrl(baseUrl: string): string {\r\n    return baseUrl + 'ws/countries';\r\n}\r\n\r\nexport function getMPLWebSocketUrl(baseUrl: string, baseDir: string, figureId: number): string {\r\n    return `${baseUrl}${encodeURIComponent(baseDir)}/${encodeURIComponent('' + figureId)}`;\r\n}\r\n\r\nexport function getMPLDownloadUrl(baseUrl: string, baseDir: string, figureId: number): string {\r\n    return `${baseUrl}mpl/download/${encodeURIComponent(baseDir)}/${encodeURIComponent('' + figureId)}`;\r\n}\r\n\r\nexport function isSpatialImageVariable(variable: VariableState): boolean {\r\n    return variable.numDims && variable.numDims >= 2 && !!variable.imageLayout;\r\n}\r\n\r\nexport function isSpatialVectorVariable(variable: VariableState): boolean {\r\n    return variable.isFeatureAttribute;\r\n}\r\n\r\nexport function genSimpleId(prefix: string): string {\r\n    return prefix + Math.floor((1 + Math.random()) * 0x100000000).toString(16) + '-' + Math.floor(Date.now()).toString(16);\r\n}\r\n\r\nexport function genLayerId() {\r\n    return genSimpleId('layer-');\r\n}\r\n\r\nexport function isFigureResource(resource: ResourceState | null): boolean {\r\n    return resource && isNumber(resource.id) && resource.dataType.endsWith('.Figure');\r\n}\r\n\r\nexport function isAnimationResource(resource: ResourceState | null): boolean {\r\n    return resource && isNumber(resource.id) && resource.dataType.endsWith('.HTML');\r\n}\r\n\r\nexport function isDataFrameResource(resource: ResourceState | null): boolean {\r\n    return resource && (resource.dataType.endsWith('.DataFrame') || resource.dataType.endsWith('.GeoDataFrame'));\r\n}\r\n\r\nexport function getLayerDisplayName(layer: LayerState): string {\r\n    if (layer.name) {\r\n        return layer.name;\r\n    }\r\n    const varName = (layer as any).varName;\r\n    const resName = (layer as any).resName;\r\n    if (layer.id === AUTO_LAYER_ID) {\r\n        if (resName && varName) {\r\n            return `Selected Variable (${resName} / ${varName})`;\r\n        }\r\n        return `Selected Variable (none)`;\r\n    } else {\r\n        if (resName && varName) {\r\n            return `${resName} / ${varName}`;\r\n        }\r\n    }\r\n    return layer.id;\r\n}\r\n\r\nexport function getLayerTypeIconName(layer: LayerState): IconName {\r\n    if (isVectorLayer(layer)) {\r\n        return 'map-marker';\r\n    } else if (layer.type === 'Image' || layer.type === 'VariableImage') {\r\n        return 'layout-grid';\r\n    }\r\n    return 'layer';\r\n}\r\n\r\nexport function findResource(resources: ResourceState[], ref: ResourceRefState): ResourceState | null {\r\n    return findResourceById(resources, ref.resId);\r\n}\r\n\r\nexport function findResourceByName(resources: ResourceState[], name: string): ResourceState | null {\r\n    return resources.find(r => r.name === name);\r\n}\r\n\r\nexport function findResourceById(resources: ResourceState[], id: number): ResourceState | null {\r\n    return resources.find(r => r.id === id);\r\n}\r\n\r\nexport function findVariable(resources: ResourceState[], ref: VariableRefState): VariableState | null {\r\n    const resource = findResource(resources, ref);\r\n    return resource && resource.variables && resource.variables.find(v => v.name === ref.varName);\r\n}\r\n\r\nexport function findOperation(operations: OperationState[], name: string): OperationState | null {\r\n    return operations && operations.find(op => op.qualifiedName === name || op.name === name);\r\n}\r\n\r\nexport function findDataSource(dataStores: DataStoreState[],\r\n                               dataStoreId: string,\r\n                               dataSourceId: string): DataSourceState | null {\r\n    const dataStore = dataStores && dataStores.find(dataStore => dataStore.id === dataStoreId);\r\n    if (dataStore) {\r\n        const dataSource = dataStore.dataSources\r\n                           && dataStore.dataSources.find(dataSource => dataSource.id === dataSourceId);\r\n        if (dataSource) {\r\n            return dataSource;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function findVariableIndexCoordinates(resources: ResourceState[], ref: VariableDataRefState): any[] {\r\n    const resource = findResourceById(resources, ref.resId);\r\n    if (!resource) {\r\n        return EMPTY_ARRAY;\r\n    }\r\n    const coordVariables = resource.coordVariables;\r\n    if (!coordVariables) {\r\n        return EMPTY_ARRAY;\r\n    }\r\n    const variable = resource && resource.variables.find(v => v.name === ref.varName);\r\n    if (!variable) {\r\n        return EMPTY_ARRAY;\r\n    }\r\n    const varIndex = ref.varIndex;\r\n    if (!varIndex || !varIndex.length) {\r\n        return EMPTY_ARRAY;\r\n    }\r\n    const dimNames = variable.dimNames;\r\n    if (!dimNames || !dimNames.length) {\r\n        return EMPTY_ARRAY;\r\n    }\r\n\r\n    const coordDataMap = {};\r\n    coordVariables.forEach(cv => {\r\n        coordDataMap[cv.name] = cv.data;\r\n    });\r\n\r\n    let coords = [];\r\n    for (let i = 0; i < varIndex.length; i++) {\r\n        const coordIndex = varIndex[i];\r\n        const dimName = i < dimNames.length ? dimNames[i] : null;\r\n        let coord;\r\n        if (dimName) {\r\n            const coordData = coordDataMap[dimName];\r\n            if (coordData && coordData.length && coordIndex < coordData.length) {\r\n                coord = coordData[coordIndex];\r\n            } else {\r\n                coord = '-';\r\n            }\r\n        } else {\r\n            coord = '?';\r\n        }\r\n        coords.push([dimName, coord]);\r\n    }\r\n    return coords;\r\n}\r\n\r\nexport function getNonSpatialIndexers(resource: ResourceState, ref: VariableDataRefState): DimSizes {\r\n    const coordVariables = resource.coordVariables;\r\n    if (!coordVariables) {\r\n        return EMPTY_OBJECT;\r\n    }\r\n    const variable = resource && resource.variables.find(v => v.name === ref.varName);\r\n    if (!variable) {\r\n        return EMPTY_OBJECT;\r\n    }\r\n    const varIndex = ref.varIndex;\r\n    if (!varIndex || !varIndex.length) {\r\n        return EMPTY_OBJECT;\r\n    }\r\n    const dimNames = variable.dimNames;\r\n    if (!dimNames || !dimNames.length) {\r\n        return EMPTY_OBJECT;\r\n    }\r\n\r\n    const coordDataMap = {};\r\n    coordVariables.forEach(cv => {\r\n        coordDataMap[cv.name] = cv.data;\r\n    });\r\n\r\n    let dimIndexers = {};\r\n    for (let i = 0; i < varIndex.length; i++) {\r\n        const coordIndex = varIndex[i];\r\n        const dimName = i < dimNames.length ? dimNames[i] : null;\r\n        if (dimName) {\r\n            const coordData = coordDataMap[dimName];\r\n            if (coordData && coordData.length && coordIndex < coordData.length) {\r\n                dimIndexers[dimName] = coordData[coordIndex];\r\n            }\r\n        }\r\n    }\r\n    return dimIndexers;\r\n}\r\n\r\nconst newCfSBaseMap = (id: string): BaseMapState => {\r\n    return {\r\n        id,\r\n        title: id[0].toUpperCase() + id.substring(1),\r\n        options: {\r\n            url: `https://storage.googleapis.com/esa-cfs-tiles/0.7.0/basemaps/${id}/{z}/{x}/{reverseY}.png`,\r\n            tilingScheme: 'Geographic',\r\n            maximumLevel: 4,\r\n        }\r\n    };\r\n};\r\n\r\nexport const BASE_MAPS: BaseMapState[] = [\r\n    // Note, the first entry will be used as default: \"natural\" in this case.\r\n    {\r\n        id: 'natural',\r\n        title: 'Natural',\r\n        options: null,\r\n    },\r\n    {\r\n        id: 'natural_offline',\r\n        title: 'Natural (offline)',\r\n        options: {\r\n            url: './Cesium/Assets/Textures/NaturalEarthII/{z}/{x}/{reverseY}.jpg',\r\n            credit: '© Analytical Graphics, Inc.',\r\n            tilingScheme: 'Geographic',\r\n            maximumLevel: 2\r\n        }\r\n    },\r\n    newCfSBaseMap('atmosphere'),\r\n    newCfSBaseMap('blue'),\r\n    newCfSBaseMap('dark'),\r\n    newCfSBaseMap('land'),\r\n    newCfSBaseMap('ocean'),\r\n];\r\n\r\nexport const DEFAULT_BASE_MAP_ID = 'atmosphere';\r\nexport const DEFAULT_BASE_MAP = BASE_MAPS.find(bm => bm.id === 'atmosphere');\r\n\r\nfunction newInitialWorldViewData(baseMapId?: string): WorldViewDataState {\r\n    return {\r\n        viewMode: '3D',\r\n        projectionCode: 'EPSG:4326',\r\n        baseMapId: baseMapId || DEFAULT_BASE_MAP_ID,\r\n        layers: [\r\n            {...AUTO_LAYER} as LayerState,\r\n            {...COUNTRIES_LAYER} as LayerState,\r\n            {...MY_PLACES_LAYER} as LayerState,\r\n        ],\r\n        selectedLayerId: AUTO_LAYER_ID,\r\n        selectedEntityId: null,\r\n        layerSplitPosition: 0.5,\r\n    };\r\n}\r\n\r\nfunction newInitialFigureViewData(resourceId: number): FigureViewDataState {\r\n    return {\r\n        resourceId: resourceId,\r\n        fixedSize: false,\r\n    };\r\n}\r\n\r\nfunction newInitialAnimationViewData(resourceId: number): AnimationViewDataState {\r\n    return {\r\n        resourceId: resourceId,\r\n        fixedSize: false,\r\n    };\r\n}\r\n\r\nfunction newInitialTableViewData(resName: string, varName: string): TableViewDataState {\r\n    return {resName, varName, dataRows: null};\r\n}\r\n\r\nlet WORLD_VIEW_COUNTER = 0;\r\n\r\nexport function newWorldView(baseMapId?: string): ViewState<WorldViewDataState> {\r\n    const viewNumber = ++WORLD_VIEW_COUNTER;\r\n    return {\r\n        title: `World (${viewNumber})`,\r\n        id: genSimpleId('world-'),\r\n        type: 'world',\r\n        icon: 'globe',\r\n        data: newInitialWorldViewData(baseMapId),\r\n    };\r\n}\r\n\r\nexport function newFigureView(resource: ResourceState): ViewState<FigureViewDataState> {\r\n    return {\r\n        title: getFigureViewTitle(resource.name),\r\n        id: `fig-${resource.id}`,\r\n        type: 'figure',\r\n        icon: 'timeline-area-chart',\r\n        data: newInitialFigureViewData(resource.id),\r\n    };\r\n}\r\n\r\nexport function getFigureViewTitle(resourceName: string): string {\r\n    return `Figure - ${resourceName}`;\r\n}\r\n\r\nexport function newAnimationView(resource: ResourceState): ViewState<AnimationViewDataState> {\r\n    return {\r\n        title: getAnimationViewTitle(resource.name),\r\n        id: `anim-${resource.id}`,\r\n        type: 'animation',\r\n        icon: 'play',\r\n        data: newInitialAnimationViewData(resource.id),\r\n    };\r\n}\r\n\r\nexport function getAnimationViewTitle(resourceName: string): string {\r\n    return `Animation - ${resourceName}`;\r\n}\r\n\r\nexport function newTableView(resName: string, varName: string): ViewState<TableViewDataState> {\r\n    return {\r\n        title: varName ? `${resName}.${varName}` : resName,\r\n        id: genSimpleId('table-'),\r\n        type: 'table',\r\n        icon: 'th',\r\n        data: newInitialTableViewData(resName, varName),\r\n    };\r\n}\r\n\r\n/**\r\n * An object that is used by CesiumGlobe to store the Cesium.Viewer instances.\r\n * It can't be a part of our global state object.\r\n */\r\nexport const EXTERNAL_OBJECT_STORE = {id: 'global_external_object_store'};\r\n\r\nfunction getWorldViewExternalObject(view: ViewState<any>): any {\r\n    if (view && view.type === 'world') {\r\n        return EXTERNAL_OBJECT_STORE['CesiumGlobe-' + view.id];\r\n    }\r\n}\r\n\r\nexport function getWorldViewViewer(view: ViewState<any>): Cesium.Viewer | null {\r\n    const externalObject = getWorldViewExternalObject(view);\r\n    if (externalObject) {\r\n        return externalObject.object as Cesium.Viewer;\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function getWorldViewSelectedEntity(view: ViewState<any>): Cesium.Entity | null {\r\n    const viewer = getWorldViewViewer(view);\r\n    if (viewer && viewer.selectedEntity) {\r\n        return viewer.selectedEntity;\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function getWorldViewVectorLayerForEntity(view: ViewState<any>, entity: Cesium.Entity | null): VectorLayerBase | null {\r\n    const externalObject = getWorldViewExternalObject(view);\r\n    if (!entity || !externalObject) {\r\n        return null;\r\n    }\r\n\r\n    const viewer = externalObject.object as Cesium.Viewer;\r\n    assert.ok(viewer);\r\n\r\n    const dataSourceMap = externalObject.state.dataSourceMap;\r\n    assert.ok(dataSourceMap);\r\n\r\n    const dataSourceCollection = viewer.dataSources;\r\n    // Find entity in viewer's dataSourceCollection\r\n    for (let index = 0; index < dataSourceCollection.length; index++) {\r\n        const dataSource: Cesium.DataSource = dataSourceCollection.get(index);\r\n        if (dataSource.entities.contains(entity)) {\r\n            // Find dataSource in dataSourceMap of CesiumGlobe --> layerId\r\n            for (let layerId of Object.getOwnPropertyNames(dataSourceMap)) {\r\n                if (dataSource === dataSourceMap[layerId]) {\r\n                    // Find layer for layerId in views's layer list\r\n                    for (let layer of view.data.layers) {\r\n                        if (layer.id === layerId) {\r\n                            assert.ok(isVectorLayer(layer));\r\n                            return layer;\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport function getWorldViewSelectedGeometryWKTGetter(view: ViewState<any>): GeometryWKTGetter {\r\n    const selectedEntity = getWorldViewSelectedEntity(view);\r\n    if (selectedEntity) {\r\n        return () => entityToGeometryWkt(selectedEntity);\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function isVectorLayer(layer: LayerState) {\r\n    return layer.type === 'Vector' || layer.type === 'ResourceVector';\r\n}\r\n\r\nexport function isImageLayer(layer: LayerState) {\r\n    return layer.type === 'Image' || layer.type === 'VariableImage';\r\n}\r\n\r\n\r\nconst STROKE_COLORS = [\r\n    '#550000',\r\n    '#005500',\r\n    '#000055',\r\n    '#555555',\r\n];\r\n\r\nconst FILL_COLORS = [\r\n    '#FF0000',\r\n    '#FFA500',\r\n    '#FFFF00',\r\n    '#00FF00',\r\n    '#0000FF',\r\n    '#FF00FF',\r\n    '#00FFFF',\r\n];\r\n\r\nexport function newVariableLayer(resource: ResourceState,\r\n                                 variable: VariableState,\r\n                                 savedLayers?: { [name: string]: LayerState }): LayerState {\r\n    assert.ok(resource);\r\n    assert.ok(variable);\r\n    const spatialImageVariable = variable && isSpatialImageVariable(variable);\r\n    const spatialVectorVariable = variable && isSpatialVectorVariable(variable);\r\n    assert.ok(spatialImageVariable || spatialVectorVariable, 'geo-spatial variable expected');\r\n    if (spatialImageVariable) {\r\n        const restoredLayer = (savedLayers && savedLayers[variable.name]) as VariableImageLayerState;\r\n        const layerDisplayProperties = updateVariableLayerVarIndex(variable, restoredLayer);\r\n        return {\r\n            ...restoredLayer,\r\n            id: genLayerId(),\r\n            type: 'VariableImage',\r\n            name: `${resource.name}.${variable.name}`,\r\n            visible: true,\r\n            resId: resource.id,\r\n            resName: resource.name,\r\n            varName: variable.name,\r\n            ...layerDisplayProperties\r\n        } as VariableImageLayerState;\r\n    } else {\r\n        const restoredLayer = (savedLayers && savedLayers[variable.name]) as ResourceVectorLayerState;\r\n        const restoredStyle = restoredLayer && restoredLayer.style;\r\n        return {\r\n            ...restoredLayer,\r\n            id: genLayerId(),\r\n            type: 'ResourceVector',\r\n            name: `${resource.name}`,\r\n            visible: true,\r\n            resId: resource.id,\r\n            resName: resource.name,\r\n            style: getResourceVectorStyle(resource.id, restoredStyle)\r\n        } as ResourceVectorLayerState;\r\n    }\r\n}\r\n\r\nexport function updateAutoLayer(layer: LayerState,\r\n                                resource: ResourceState,\r\n                                variable: VariableState,\r\n                                savedLayers?: SavedLayers): LayerState {\r\n    assert.ok(layer);\r\n    assert.ok(layer.id === AUTO_LAYER_ID);\r\n    const spatialImageVariable = variable && isSpatialImageVariable(variable);\r\n    const spatialVectorVariable = variable && isSpatialVectorVariable(variable);\r\n    if (spatialImageVariable) {\r\n        const restoredLayer = (savedLayers && savedLayers[variable.name]) as VariableImageLayerState;\r\n        const layerDisplayProperties = updateVariableLayerVarIndex(variable, restoredLayer);\r\n        return {\r\n            ...layer,\r\n            ...restoredLayer,\r\n            type: 'VariableImage',\r\n            name: `Auto ${resource.name}.${variable.name}`,\r\n            resId: resource.id,\r\n            resName: resource.name,\r\n            varName: variable.name,\r\n            ...layerDisplayProperties,\r\n            id: AUTO_LAYER_ID,\r\n        };\r\n    } else if (spatialVectorVariable) {\r\n        const restoredLayer = (savedLayers && savedLayers[resource.name]) as ResourceVectorLayerState;\r\n        const restoredStyle = restoredLayer && restoredLayer.style;\r\n        return {\r\n            ...layer,\r\n            ...restoredLayer,\r\n            type: 'ResourceVector',\r\n            name: `Auto ${resource.name}`,\r\n            resId: resource.id,\r\n            resName: resource.name,\r\n            style: getResourceVectorStyle(resource.id, restoredStyle),\r\n            id: AUTO_LAYER_ID,\r\n        } as ResourceVectorLayerState;\r\n    } else {\r\n        return {\r\n            type: 'Unknown' as any,\r\n            name: variable ? `Auto ${variable.name} (geo-ref not found or recognized)` : 'Auto (no selection)',\r\n            visible: layer.visible,\r\n            id: AUTO_LAYER_ID,\r\n        } as any;\r\n    }\r\n}\r\n\r\nfunction getResourceVectorStyle(resourceId: number, restoredStyle: SimpleStyle) {\r\n    return {\r\n        ...SIMPLE_STYLE_DEFAULTS,\r\n        stroke: STROKE_COLORS[resourceId % STROKE_COLORS.length],\r\n        fill: FILL_COLORS[resourceId % FILL_COLORS.length],\r\n        ...restoredStyle,\r\n    };\r\n}\r\n\r\nexport function getLockForLoadDataSources(dataStoreId: string) {\r\n    return `loadDataSources(\"${dataStoreId}\")`;\r\n}\r\n\r\nexport function getLockForGetWorkspaceVariableStatistics(resName: string, varName: string, varIndex?: number[]) {\r\n    return getVariableLock('getWorkspaceVariableStatistics', resName, varName, varIndex);\r\n}\r\n\r\nfunction getVariableLock(op: string, resName: string, varName: string, varIndex: number[]) {\r\n    if (varIndex && varIndex.length) {\r\n        return `${op}(\"${resName}\", \"${varName}\", [${varIndex}])`;\r\n    } else {\r\n        return `${op}(\"${resName}\", \"${varName}\")`;\r\n    }\r\n}\r\n\r\n/**\r\n * If there is a restoredLayer try reusing its varIndex, otherwise generate new variable display properties with\r\n * new varIndex.\r\n *\r\n * @param variable\r\n * @param restoredLayer\r\n * @returns {{varIndex: any}}\r\n */\r\nfunction updateVariableLayerVarIndex(variable: VariableState | null,\r\n                                     restoredLayer: VariableImageLayerState | null) {\r\n    let layerDisplayProperties;\r\n    let varIndex;\r\n    if (restoredLayer) {\r\n        varIndex = restoredLayer.varIndex && restoredLayer.varIndex.slice();\r\n    } else if (variable) {\r\n        layerDisplayProperties = newVariableLayerDisplayProperties(variable);\r\n    }\r\n    if (variable) {\r\n        varIndex = newVarIndex(variable, varIndex);\r\n    }\r\n    return {...layerDisplayProperties, varIndex};\r\n}\r\n\r\nfunction newVarIndex(variable: VariableState, varIndex) {\r\n    const numSpatialDims = 2;\r\n    if (variable.numDims\r\n        && variable.numDims >= numSpatialDims\r\n        && (!varIndex || varIndex.length !== variable.numDims - numSpatialDims)) {\r\n        return Array(variable.numDims - numSpatialDims).fill(0);\r\n    }\r\n    return varIndex;\r\n}\r\n\r\n\r\nfunction newVariableLayerDisplayProperties(variable: VariableState) {\r\n    const defaultColorMapName = 'inferno';\r\n    const defaultDisplayMin = isNumber(variable.validMin) ? variable.validMin : 0.;\r\n    const defaultDisplayMax = isNumber(variable.validMax) ? variable.validMax : defaultDisplayMin + 1.;\r\n    return {\r\n        colorMapName: isString(variable.colorMapName) ? variable.colorMapName : defaultColorMapName,\r\n        displayMin: isNumber(variable.displayMin) ? variable.displayMin : defaultDisplayMin,\r\n        displayMax: isNumber(variable.displayMax) ? variable.displayMax : defaultDisplayMax,\r\n        alphaBlending: false,\r\n        opacity: 1.0,\r\n        brightness: 1.0,\r\n        contrast: 1.0,\r\n        hue: 0.0,\r\n        saturation: 1.0,\r\n        gamma: 1.0,\r\n        splitMode: SPLIT_MODE_OFF,\r\n    };\r\n}\r\n\r\nlet _hasWebGL = null;\r\n\r\n// from https://stackoverflow.com/questions/11871077/proper-way-to-detect-webgl-support\r\nexport function hasWebGL(): boolean {\r\n    let canvas;\r\n    let context;\r\n    let extensions;\r\n\r\n    if (_hasWebGL === null) {\r\n        try {\r\n            canvas = document.createElement('canvas');\r\n            _hasWebGL = true;\r\n            context = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n            extensions = context.getSupportedExtensions();\r\n            console.debug('WebGL supported extensions:', extensions);\r\n        } catch (e) {\r\n            _hasWebGL = false;\r\n            console.warn('WebGL not supported but required by world view');\r\n            return false;\r\n        }\r\n    }\r\n\r\n    canvas = null;\r\n    context = null;\r\n    return _hasWebGL;\r\n}\r\n\r\n\r\nexport function getPlacemarkTitleAndIndex(placemark: Placemark, placemarks: PlacemarkCollection): { title: string | undefined, index: number | undefined } {\r\n    const type = placemark.geometry.type;\r\n    const features = placemarks.features;\r\n    const titles = new Set<string>();\r\n    for (let f of features) {\r\n        const props = f.properties;\r\n        if (props && props.title && props.title.startsWith(type)) {\r\n            titles.add(props.title);\r\n        }\r\n    }\r\n    let title, index, t;\r\n    for (index = 1; index <= features.length + 1; index++) {\r\n        t = `${type} ${index}`;\r\n        if (!titles.has(t)) {\r\n            title = t;\r\n            break;\r\n        }\r\n    }\r\n    return {title, index};\r\n}\r\n","export function ok(condition: any, message?: string) {\r\n    if (!condition) {\r\n        throw new Error('assertion failed' + (message ? `: ${message}` : ''));\r\n    }\r\n}\r\n","/**\r\n * A web API client and related type definitions.\r\n *\r\n * The implementation is based on WebSockets with a JSON-RPC-based protocol.\r\n * For JSON-RPC details see http://www.jsonrpc.org/specification.\r\n *\r\n * A WebAPI server must implement a general method \"__cancel__(id: number): void\"\r\n * which cancels the method for the given *id*. The method call must either succeed with any \"response\" value\r\n * or fail by returning an \"error\" object.\r\n *\r\n * If the WebAPI server has successfully cancelled a running job, an \"error\" object with code 999\r\n * must be returned.\r\n *\r\n * To report progress, the WebAPI server can send \"progress\" objects:\r\n *\r\n *   {\r\n *      work?: number,\r\n *      total?: number,\r\n *      message?: string\r\n *   }\r\n *\r\n * This is non JSON-RCP, which only allows for either the \"response\" or an \"error\" object.\r\n *\r\n * @author Norman Fomferra\r\n */\r\n\r\nimport { IconName, Intent } from '@blueprintjs/core';\r\nimport {\r\n    Job,\r\n    JobFailure,\r\n    JobFailureHandler,\r\n    JobProgress,\r\n    JobProgressHandler,\r\n    JobPromise,\r\n    JobRequest,\r\n    JobResponseHandler,\r\n    JobStatus,\r\n    JobStatusEnum\r\n} from './Job'\r\nimport { WebSocketMin } from './WebSocketMock'\r\n\r\n// IMPORTANT NOTE: The following error codes MUST BE COPIED from cate/util/web/jsonrpchandler.py\r\n//\r\n// See http://www.jsonrpc.org/specification#error_object\r\n// The error codes from and including -32768 to -32000 are reserved for pre-defined errors.\r\nexport const ERROR_CODE_INVALID_REQUEST = -32600;\r\nexport const ERROR_CODE_METHOD_NOT_FOUND = -32601;\r\nexport const ERROR_CODE_INVALID_PARAMS = -32602;\r\n// The error codes from and including -32000 to -32099 are reserved for implementation-defined server-errors.\r\nexport const ERROR_CODE_OS_ERROR = -32001;\r\nexport const ERROR_CODE_OUT_OF_MEMORY = -32002;\r\nexport const ERROR_CODE_METHOD_ERROR = -32003;\r\nexport const ERROR_CODE_INVALID_RESPONSE = -32004;\r\n// The remainder of the space is available for application defined errors.\r\nexport const ERROR_CODE_CANCELLED = 999;\r\n\r\nconst CANCEL_METHOD = '__cancel__';\r\nconst DEBUG = false;\r\n\r\n\r\nexport type JobResponseTransformer<JobResponse> = (any) => JobResponse;\r\n\r\n/**\r\n * The web API's call interface.\r\n *\r\n * The WebAPIClient class is used to perform remote calls to server-side methods and to observe\r\n * their progress, success, failure, or cancellation in an asynchronous fashion.\r\n *\r\n * A WebAPI server must implement a general method \"__cancel__(id: number): void\"\r\n * which cancels the method for the given *id*. The method call must either succeed with any \"response\" value\r\n * or fail by returning an \"error\" object.\r\n *\r\n * If the WebAPIClient server has successfully cancelled a running job, an \"error\" object with the code\r\n * given by the CANCELLED_CODE constant (999) must be returned.\r\n *\r\n * To report progress, the WebAPIClient server can send \"progress\" objects:\r\n *\r\n *   {\r\n *      id: number;\r\n *      label?: string;\r\n *      message?: string;\r\n *      worked?: number;\r\n *      total?: number;\r\n *   }\r\n *\r\n * This is non JSON-RCP, which only allows for either the \"response\" or an \"error\" object.\r\n */\r\nexport interface WebAPIClient {\r\n    /**\r\n     * Test if the connection is open and active.\r\n     */\r\n    readonly isOpen: boolean;\r\n    readonly url: string;\r\n\r\n    onOpen: (event) => void;\r\n    onClose: (event) => void;\r\n    onError: (event) => void;\r\n    onWarning: (event) => void;\r\n\r\n    /**\r\n     * Perform a JSON-RPC call.\r\n     *\r\n     * @param method The method name.\r\n     * @param params The method parameters, either a list with positional arguments or an object\r\n     *               providing keyword arguments.\r\n     * @param onProgress An optional handler that is notified while the Job progresses.\r\n     *        Note that not all server-side methods provide progress notifications.\r\n     * @param transformer Optional transformer for the returned responses\r\n     */\r\n    call<JobResponse>(method: string,\r\n                      params: Array<any> | Object,\r\n                      onProgress?: (progress: JobProgress) => void,\r\n                      transformer?: JobResponseTransformer<JobResponse>): JobPromise<JobResponse>;\r\n\r\n    /**\r\n     * Cancels the job with the given ID.\r\n     *\r\n     * @param jobId the job ID\r\n     */\r\n    cancel(jobId: number);\r\n\r\n    /**\r\n     * Closes this client and the underlying connection, if any.\r\n     */\r\n    close(): void;\r\n}\r\n\r\n/**\r\n * Creates a new WebAPIClient.\r\n *\r\n * The implementation uses WebSockets with a JSON-RPC-based protocol.\r\n * For JSON-RPC details see http://www.jsonrpc.org/specification.\r\n *\r\n * @param url The WebSocket URL. WebSocket URL must start with \"ws://\".\r\n * @param firstMessageId The ID of the first JSON-RPC method call.\r\n * @param socket Alternative WebSocket instance for testing.\r\n * @returns {WebAPIClient} instance.\r\n */\r\nexport function newWebAPIClient(url: string, firstMessageId = 0, socket?: WebSocketMin): WebAPIClient {\r\n    return new WebAPIClientImpl(url, firstMessageId, socket);\r\n}\r\n\r\nclass WebAPIClientImpl implements WebAPIClient {\r\n\r\n    readonly url: string;\r\n    onOpen: (event: Event) => void;\r\n    onClose: (event: CloseEvent) => void;\r\n    onError: (event: ErrorEvent) => void;\r\n    onWarning: (event) => void;\r\n\r\n    private readonly socket: WebSocketMin;\r\n    private currentMessageId = 0;\r\n    private readonly activeJobs: JobImpl<any>[];\r\n\r\n    constructor(url: string, firstMessageId = 0, socket?: WebSocketMin) {\r\n        this.url = url;\r\n        this.currentMessageId = firstMessageId;\r\n        this.activeJobs = [];\r\n        this.socket = socket ? socket : new WebSocket(url);\r\n        this.socket.onopen = (event: Event) => {\r\n            if (DEBUG && process.env.NODE_ENV === 'development') {\r\n                console.debug(\"WebSocket.onopen:\", event);\r\n            }\r\n            if (this.onOpen) {\r\n                this.onOpen(event);\r\n            }\r\n        };\r\n        this.socket.onclose = (event: CloseEvent) => {\r\n            if (DEBUG && process.env.NODE_ENV === 'development') {\r\n                console.debug(\"WebSocket.onclose:\", event);\r\n            }\r\n            if (this.onClose) {\r\n                this.onClose(event);\r\n            }\r\n        };\r\n        this.socket.onerror = (event: ErrorEvent) => {\r\n            if (DEBUG && process.env.NODE_ENV === 'development') {\r\n                console.debug(\"WebSocket.onerror:\", event);\r\n            }\r\n            if (this.onError) {\r\n                this.onError(event);\r\n            }\r\n        };\r\n        this.socket.onmessage = (event: MessageEvent) => {\r\n            if (DEBUG && process.env.NODE_ENV === 'development') {\r\n                console.debug(\"WebSocket.onmessage:\", event);\r\n            }\r\n            this.processMessage(event.data);\r\n        }\r\n    }\r\n\r\n    get isOpen(): boolean {\r\n        return this.socket.readyState === WebSocket.OPEN;\r\n    }\r\n\r\n    call<JobResponse>(method: string,\r\n                      params: Array<any> | Object,\r\n                      onProgress?: (progress: JobProgress) => void,\r\n                      transformer?: JobResponseTransformer<JobResponse>): JobPromise<JobResponse> {\r\n        const request = {\r\n            'id': this.newId(),\r\n            'method': method,\r\n            'params': params,\r\n        };\r\n        const job = new JobImpl(this, request, transformer);\r\n        this.activeJobs[request.id] = job;\r\n        return job.invoke(onProgress);\r\n    }\r\n\r\n    cancel(jobId: number): void {\r\n        const job = this.activeJobs[jobId];\r\n        if (!job) {\r\n            this.warn(`Job with \"id\"=${jobId} does not exist`);\r\n            return;\r\n        } else {\r\n            job.cancel();\r\n        }\r\n    }\r\n\r\n    close(): void {\r\n        this.socket.close();\r\n    }\r\n\r\n    sendMessage(request: JobRequest) {\r\n        // console.log('WebAPIClient.sendMessage: request=', request)\r\n        const message = Object.assign({}, {jsonrpc: '2.0'}, request);\r\n        const messageText = JSON.stringify(message);\r\n        this.socket.send(messageText);\r\n    }\r\n\r\n    private processMessage(messageText: string): void {\r\n        let message;\r\n        try {\r\n            // JSON does not recognise NaN\r\n            // See https://stackoverflow.com/questions/15228651/how-to-parse-json-string-containing-nan-in-node-js\r\n            // message = JSON.parse(messageText);\r\n            // So we use evil eval() because JSON is valid JavaScript:\r\n            // eslint-disable-next-line\r\n            message = eval(`(${messageText})`);\r\n            // We cannot use the following naive approach, because \"NaN\" appears as word in operation doc strings\r\n            // const TEMP_NAN_STR = '[[<<~~***NaN***~~>>]]';\r\n            // const TEMP_NAN_JSON_STR = `\"${TEMP_NAN_STR}\"`;\r\n            // message = JSON.parse(messageText.replace(/\\bNaN\\b/g, TEMP_NAN_JSON_STR),\r\n            //                      (key, value) => value === TEMP_NAN_STR ? NaN : value);\r\n        } catch (err) {\r\n            this.warnInvalidJsonRcpMessage('Message is no valid JSON', messageText);\r\n            return;\r\n        }\r\n        if (message.jsonrpc !== '2.0' || typeof message.id !== 'number') {\r\n            this.warnInvalidJsonRcpMessage('Message is not JSON-RCP 2.0 compliant', messageText);\r\n            return;\r\n        }\r\n\r\n        const job = this.activeJobs[message.id];\r\n        if (!job) {\r\n            this.warnInvalidJsonRcpMessage(`Method with \"id\"=${message.id} has no associated job`, messageText);\r\n            return;\r\n        }\r\n\r\n        if (message.response || message.response === null) {\r\n            job.notifyDone(message.response);\r\n            delete this.activeJobs[message.id];\r\n        } else if (message.progress) {\r\n            message.progress.id = message.id;\r\n            job.notifyInProgress(message.progress)\r\n        } else if (message.error) {\r\n            job.notifyFailed(message.error);\r\n            delete this.activeJobs[message.id];\r\n        } else {\r\n            this.warnInvalidJsonRcpMessage(`Method is neither a \"response\", \"progress\", nor \"error\"`, messageText);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private warnInvalidJsonRcpMessage(detailsMessage: string, jsonRcpMessage: string) {\r\n        if (this.onWarning) {\r\n            const message = `Received invalid JSON-RCP message from Cate service. ${detailsMessage}. Ignoring it.\\n--------------------\\n${jsonRcpMessage}\\n--------------------`;\r\n            this.onWarning({type: 'warning', message});\r\n        }\r\n    }\r\n\r\n    private warn(message: string) {\r\n        if (this.onWarning) {\r\n            this.onWarning({type: 'warning', message});\r\n        }\r\n    }\r\n\r\n    private newId(): number {\r\n        return this.currentMessageId++;\r\n    }\r\n}\r\n\r\n/**\r\n * Default implementation of the Job interface which uses the default WebAPI implementation.\r\n */\r\nclass JobImpl<JobResponse> implements Job {\r\n\r\n    private webAPIClient: WebAPIClientImpl;\r\n    private request: JobRequest;\r\n    private status: JobStatus;\r\n    private onProgress: JobProgressHandler;\r\n    private onResolve: JobResponseHandler<JobResponse>;\r\n    private onReject: JobFailureHandler;\r\n    private transformer: JobResponseTransformer<JobResponse>;\r\n\r\n    constructor(webAPIClient: WebAPIClientImpl, request: JobRequest, transformer: JobResponseTransformer<JobResponse>) {\r\n        this.webAPIClient = webAPIClient;\r\n        this.request = request;\r\n        this.status = JobStatusEnum.NEW;\r\n        this.transformer = transformer;\r\n    }\r\n\r\n    getRequest() {\r\n        return this.request;\r\n    }\r\n\r\n    getStatus(): JobStatus {\r\n        return this.status;\r\n    }\r\n\r\n    isCancelled(): boolean {\r\n        return this.status === JobStatusEnum.CANCELLED;\r\n    }\r\n\r\n    cancel(onResolve?: JobResponseHandler<void>,\r\n           onReject?: JobFailureHandler): void {\r\n        this.webAPIClient.call<void>(CANCEL_METHOD, {id: this.request.id})\r\n            .then(onResolve || (() => {\r\n            }), onReject || (() => {\r\n            }));\r\n    }\r\n\r\n    ////////////////////////////////////////////////////////////\r\n    // Implementation details\r\n\r\n    invoke(onProgress?: JobProgressHandler): JobPromise<JobResponse> {\r\n\r\n        const executor = (onResolve: JobResponseHandler<JobResponse>, onReject: JobFailureHandler) => {\r\n            this.setHandlers(onProgress, onResolve, onReject);\r\n            this.sendMessage();\r\n            this.setStatus(JobStatusEnum.SUBMITTED);\r\n        };\r\n\r\n        const promise = new Promise<JobResponse>(executor.bind(this));\r\n        // Convert the plain promise into a JobPromise\r\n        promise['getJob'] = this.getJob.bind(this);\r\n        promise['getJobId'] = this.getJobId.bind(this);\r\n        return promise as JobPromise<JobResponse>;\r\n    }\r\n\r\n    notifyInProgress(progress: JobProgress) {\r\n        this.setStatus(JobStatusEnum.IN_PROGRESS);\r\n        if (this.onProgress) {\r\n            this.onProgress(progress);\r\n        }\r\n    }\r\n\r\n    notifyDone(response: JobResponse) {\r\n        this.setStatus(JobStatusEnum.DONE);\r\n        if (this.onResolve) {\r\n            this.onResolve(this.transformer ? this.transformer(response) : response);\r\n        }\r\n    }\r\n\r\n    notifyFailed(failure: JobFailure) {\r\n        this.setStatus(failure.code === ERROR_CODE_CANCELLED ? JobStatusEnum.CANCELLED : JobStatusEnum.FAILED);\r\n        if (this.onReject) {\r\n            this.onReject(failure);\r\n        }\r\n    }\r\n\r\n    private getJob(): Job {\r\n        return this;\r\n    }\r\n\r\n    private getJobId(): number {\r\n        return this.getRequest().id;\r\n    }\r\n\r\n    private setHandlers(onProgress, onResolve, onReject) {\r\n        this.onProgress = onProgress;\r\n        this.onResolve = onResolve;\r\n        this.onReject = onReject;\r\n    }\r\n\r\n    private sendMessage() {\r\n        this.webAPIClient.sendMessage(this.request);\r\n    }\r\n\r\n    private setStatus(status: JobStatus) {\r\n        this.status = status;\r\n    }\r\n}\r\n\r\nexport function getJobFailureIntentName(failure: JobFailure): Intent {\r\n    if (failure) {\r\n        switch (failure.code) {\r\n            case ERROR_CODE_INVALID_PARAMS:\r\n            case ERROR_CODE_CANCELLED:\r\n                return Intent.PRIMARY;\r\n            case ERROR_CODE_OS_ERROR:\r\n                return Intent.WARNING;\r\n            default:\r\n                return Intent.WARNING;\r\n        }\r\n    }\r\n    return Intent.WARNING;\r\n}\r\n\r\nexport function getJobFailureIconName(failure: JobFailure): IconName {\r\n    if (failure) {\r\n        if (failure.data) {\r\n            if (failure.data.exception === 'cate.core.ds.NetworkError') {\r\n                return 'offline';\r\n            }\r\n            if (failure.data.exception === 'cate.core.ds.DataAccessError') {\r\n                return 'database';\r\n            }\r\n        }\r\n        switch (failure.code) {\r\n            case ERROR_CODE_INVALID_PARAMS:\r\n                return 'manually-entered-data';\r\n            case ERROR_CODE_CANCELLED:\r\n                return 'hand';\r\n            default:\r\n                return 'error';\r\n        }\r\n    }\r\n    return 'warning-sign';\r\n}\r\n\r\nexport function getJobFailureTitle(failure: JobFailure): string {\r\n\r\n    if (failure) {\r\n        console.log(failure);\r\n        if (failure.data) {\r\n            if (failure.data.exception === 'cate.core.ds.NetworkError') {\r\n                return 'Network Problem';\r\n            }\r\n            if (failure.data.exception === 'cate.core.ds.DataAccessError') {\r\n                return 'Data Access Error';\r\n            }\r\n        }\r\n        switch (failure.code) {\r\n            case ERROR_CODE_INVALID_PARAMS:\r\n                return 'Invalid Input';\r\n            case ERROR_CODE_OUT_OF_MEMORY:\r\n                return 'Out-Of-Memory Error';\r\n            case ERROR_CODE_OS_ERROR:\r\n                return 'External Problem';\r\n            case ERROR_CODE_CANCELLED:\r\n                return 'Task Cancelled';\r\n            case ERROR_CODE_METHOD_NOT_FOUND:\r\n                return 'Internal Error (Method Not Found)';\r\n            case ERROR_CODE_INVALID_REQUEST:\r\n                return 'Internal Error (Invalid Request)';\r\n            case ERROR_CODE_INVALID_RESPONSE:\r\n                return 'Internal Error (Invalid Response)';\r\n            case ERROR_CODE_METHOD_ERROR:\r\n                return 'Operation Error';\r\n        }\r\n    }\r\n\r\n    return 'Unknown Error';\r\n}\r\n\r\nconst NON_DEVELOPER_ERRORS = [\r\n    ERROR_CODE_INVALID_PARAMS,\r\n    ERROR_CODE_CANCELLED,\r\n    ERROR_CODE_OS_ERROR,\r\n    ERROR_CODE_OUT_OF_MEMORY,\r\n];\r\n\r\nexport function isDeveloperError(failure: JobFailure): boolean {\r\n    return NON_DEVELOPER_ERRORS.indexOf(failure.code) < 0;\r\n}\r\n\r\n\r\nconst USER_ERRORS = [\r\n    ERROR_CODE_INVALID_PARAMS,\r\n    ERROR_CODE_CANCELLED,\r\n];\r\n\r\nexport function isUserError(failure: JobFailure): boolean {\r\n    return USER_ERRORS.indexOf(failure.code) >= 0;\r\n}\r\n","import { DatasetDescriptor, DataSourceState, DataStoreState, DimSizes } from '../../state';\r\nimport { JobProgress, JobPromise } from '../Job';\r\nimport { WebAPIClient } from '../WebAPIClient';\r\n\r\n\r\nexport class DatasetAPI {\r\n    private readonly webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPIClient: WebAPIClient) {\r\n        this.webAPIClient = webAPIClient;\r\n    }\r\n\r\n    getDataStores(): JobPromise<DataStoreState[]> {\r\n        return this.webAPIClient.call('get_data_stores', []);\r\n    }\r\n\r\n    getDataSources(dataStoreId: string,\r\n                   onProgress: (progress: JobProgress) => void): JobPromise<DataSourceState[]> {\r\n        return this.webAPIClient.call('get_data_sources',\r\n                                      [dataStoreId],\r\n                                      onProgress,\r\n                                      DatasetAPI.responseToDataSources);\r\n    }\r\n\r\n    getDataSourceMetaInfo(dataStoreId: string, dataSourceId: string,\r\n                          onProgress: (progress: JobProgress) => void): JobPromise<DatasetDescriptor> {\r\n        return this.webAPIClient.call('get_data_source_meta_info',\r\n                                      [dataStoreId, dataSourceId],\r\n                                      onProgress,\r\n                                      DatasetAPI.responseToMetaInfo);\r\n    }\r\n\r\n    addLocalDataSource(dataSourceId: string, filePathPattern: string,\r\n                       onProgress: (progress: JobProgress) => void): JobPromise<DataSourceState[]> {\r\n        return this.webAPIClient.call('add_local_data_source',\r\n                                      [dataSourceId, filePathPattern],\r\n                                      onProgress);\r\n    }\r\n\r\n    removeLocalDataSource(dataSourceId: string, removeFiles: boolean,\r\n                          onProgress: (progress: JobProgress) => void): JobPromise<DataSourceState[]> {\r\n        return this.webAPIClient.call('remove_local_data_source',\r\n                                      [dataSourceId, removeFiles],\r\n                                      onProgress);\r\n    }\r\n\r\n    extractPixelValues(baseDir: string,\r\n                       source: string,\r\n                       point: [number, number],\r\n                       indexers: DimSizes): JobPromise<{ [varName: string]: number } | null> {\r\n        return this.webAPIClient.call('extract_pixel_values', [baseDir, source, point, indexers]);\r\n    }\r\n\r\n    static responseToDataSources(dataSources: any[]): DataSourceState[] {\r\n        // noinspection JSUnusedLocalSymbols\r\n        return dataSources.map((dataSource, i): DataSourceState => {\r\n            console.debug(`dataSources[${i}]:`, dataSource);\r\n            return {\r\n                id: dataSource['id'],\r\n                title: dataSource['title'],\r\n                dataType: dataSource['data_type'] || 'dataset',\r\n                capabilities: dataSource['verification_flags'],\r\n                metaInfoStatus: 'init',\r\n            };\r\n        });\r\n    }\r\n\r\n    static responseToMetaInfo(response: any): DatasetDescriptor {\r\n        return response as DatasetDescriptor;\r\n    }\r\n}\r\n\r\n","import { OperationInputState, OperationOutputState, OperationState } from '../../state';\r\nimport { JobPromise } from '../Job';\r\nimport { WebAPIClient } from '../WebAPIClient';\r\n\r\nfunction responseToOperations(operationsResponse: any): OperationState[] {\r\n    return operationsResponse ? operationsResponse.map(responseOperationToOperation) : null;\r\n}\r\n\r\nfunction responseOperationToOperation(op: any): OperationState {\r\n    return {\r\n        qualifiedName: op.qualified_name,\r\n        name: op.name || op.qualified_name,\r\n        description: (op.header && op.header.description) || null,\r\n        tags: (op.header && op.header.tags) || [],\r\n        hasMonitor: (op.has_monitor || false),\r\n        inputs: op.inputs.map(responseInputToOperationInput),\r\n        outputs: op.outputs.map(responseOutputToOperationOutput),\r\n    }\r\n}\r\n\r\nfunction responseInputToOperationInput(input: any): OperationInputState {\r\n    return {\r\n        name: input.name,\r\n        dataType: input.data_type,\r\n        description: (input.description || null),\r\n        units: input.units,\r\n        password: input.password,\r\n        /* optional properties used mainly for validation */\r\n        defaultValue: input.default_value,\r\n        nullable: (input.nullable || input.default_value === null),\r\n        valueSet: input.value_set,\r\n        valueSetSource: input.value_set_source,\r\n        valueRange: input.value_range,\r\n        scriptLang: input.script_lang,\r\n        fileOpenMode: input.file_open_mode,\r\n        fileFilters: input.file_filters,\r\n        fileProps: input.file_props,\r\n        noUI: input.no_ui || input.step_id,\r\n    };\r\n}\r\n\r\nfunction responseOutputToOperationOutput(output: any): OperationOutputState {\r\n    return {\r\n        name: output.name,\r\n        dataType: output.data_type,\r\n        description: (output.description || null),\r\n    };\r\n}\r\n\r\nexport class OperationAPI {\r\n    private webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPI: WebAPIClient) {\r\n        this.webAPIClient = webAPI;\r\n    }\r\n\r\n    getOperations(): JobPromise<OperationState[]> {\r\n        return this.webAPIClient.call('get_operations', [], null, responseToOperations);\r\n    }\r\n\r\n    /*\r\n    callOperation(opName: string, opParams: any, onProgress: (progress: JobProgress) => void): JobPromise<any> {\r\n        return this.webAPIClient.call('call_operation', [opName, opParams], onProgress);\r\n    }\r\n    */\r\n}\r\n","import { isDefined, isNumber } from '../../../common/types';\r\nimport { EMPTY_ARRAY, EMPTY_OBJECT } from '../../selectors';\r\nimport { ImageStatisticsState, OperationKWArgs, ResourceState, VariableState, WorkspaceState } from '../../state';\r\nimport { JobProgress, JobPromise } from '../Job';\r\nimport { WebAPIClient } from '../WebAPIClient';\r\n\r\nfunction responseToVariables(variablesResponse: any): VariableState[] {\r\n    return (variablesResponse || EMPTY_ARRAY).map(v => {\r\n        const attributes = v.attributes || EMPTY_OBJECT;\r\n        let validMin = attributes['valid_min'];\r\n        let validMax = attributes['valid_max'];\r\n        const validRange = attributes['valid_range'];\r\n        const rangeOk = isDefined(validRange) && validRange.length === 2;\r\n        validMin = (!isNumber(validMin) && rangeOk && isNumber(validRange[0])) ? validRange[0] : validMin;\r\n        validMax = (!isNumber(validMax) && rangeOk && isNumber(validRange[1])) ? validRange[1] : validMax;\r\n        const units = attributes['units'];\r\n        if (units === 'kelvin' || units === 'Kelvin') {\r\n            const validMinMin = 270;\r\n            const validMaxMax = validMinMin + 40;\r\n            if (!isNumber(validMin) || validMin < validMinMin) {\r\n                validMin = validMinMin;\r\n            }\r\n            if (!isNumber(validMax) || validMax > validMaxMax) {\r\n                validMax = validMaxMax;\r\n            }\r\n        }\r\n        return {\r\n            ...v,\r\n            units,\r\n            validMin,\r\n            validMax,\r\n        };\r\n    });\r\n}\r\n\r\nfunction responseToResources(resourcesResponse: any): ResourceState[] {\r\n    return (resourcesResponse || EMPTY_ARRAY).map(r => {\r\n        if (r.variables) {\r\n            return {...r, variables: responseToVariables(r.variables)};\r\n        }\r\n        return r;\r\n    });\r\n}\r\n\r\nfunction responseToWorkspace(workspaceResponse: any): WorkspaceState {\r\n    if (!workspaceResponse) {\r\n        return null;\r\n    }\r\n    return {\r\n        baseDir: workspaceResponse.base_dir,\r\n        description: workspaceResponse.description,\r\n        isScratch: workspaceResponse.is_scratch,\r\n        isModified: workspaceResponse.is_modified,\r\n        isSaved: workspaceResponse.is_saved,\r\n        workflow: workspaceResponse.workflow,\r\n        resources: responseToResources(workspaceResponse.resources),\r\n    };\r\n}\r\n\r\nfunction responseToWorkspaceAndResName(workspaceAndResNameResponse: any): [WorkspaceState, string] {\r\n    return [responseToWorkspace(workspaceAndResNameResponse[0]), workspaceAndResNameResponse[1]];\r\n}\r\n\r\nexport class WorkspaceAPI {\r\n    private webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPI: WebAPIClient) {\r\n        this.webAPIClient = webAPI;\r\n    }\r\n\r\n    listWorkspaces(): JobPromise<string[]> {\r\n        return this.webAPIClient.call('list_workspace_names', []);\r\n    }\r\n\r\n    newWorkspace(baseDir: string | null): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('new_workspace',\r\n                                      [baseDir],\r\n                                      null,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    openWorkspace(baseDir: string,\r\n                  onProgress: (progress: JobProgress) => void): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('open_workspace',\r\n                                      [baseDir],\r\n                                      onProgress,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    closeWorkspace(baseDir: string): JobPromise<null> {\r\n        return this.webAPIClient.call('close_workspace',\r\n                                      [baseDir]);\r\n    }\r\n\r\n    saveWorkspace(baseDir: string,\r\n                  onProgress: (progress: JobProgress) => void): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('save_workspace',\r\n                                      [baseDir],\r\n                                      onProgress,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    saveWorkspaceAs(baseDir: string, toDir: string,\r\n                    onProgress: (progress: JobProgress) => void): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('save_workspace_as',\r\n                                      [baseDir, toDir],\r\n                                      onProgress,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    cleanWorkspace(baseDir: string): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('clean_workspace',\r\n                                      [baseDir],\r\n                                      null, responseToWorkspace);\r\n    }\r\n\r\n    setWorkspaceResource(baseDir: string,\r\n                         opName: string,\r\n                         opArgs: OperationKWArgs,\r\n                         resName: string | null,\r\n                         overwrite: boolean,\r\n                         onProgress: (progress: JobProgress) => void): JobPromise<[WorkspaceState, string]> {\r\n        return this.webAPIClient.call('set_workspace_resource',\r\n                                      [baseDir, opName, opArgs, resName, overwrite],\r\n                                      onProgress,\r\n                                      responseToWorkspaceAndResName);\r\n    }\r\n\r\n    setWorkspaceResourcePersistence(baseDir: string, resName: string, persistent: boolean): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('set_workspace_resource_persistence',\r\n                                      [baseDir, resName, persistent],\r\n                                      null,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    runOpInWorkspace(baseDir: string,\r\n                     opName: string,\r\n                     opArgs: OperationKWArgs,\r\n                     onProgress: (progress: JobProgress) => void): JobPromise<any> {\r\n        return this.webAPIClient.call('run_op_in_workspace',\r\n                                      [baseDir, opName, opArgs], onProgress);\r\n    }\r\n\r\n    renameWorkspaceResource(baseDir: string, resName: string, newResName: string): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('rename_workspace_resource',\r\n                                      [baseDir, resName, newResName],\r\n                                      null,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    deleteWorkspace(baseDir: string, deleteEntireWorkspace = true): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('delete_workspace',\r\n                                      [baseDir, deleteEntireWorkspace],\r\n                                      null,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    deleteWorkspaceResource(baseDir: string, resName: string): JobPromise<WorkspaceState> {\r\n        return this.webAPIClient.call('delete_workspace_resource',\r\n                                      [baseDir, resName],\r\n                                      null,\r\n                                      responseToWorkspace);\r\n    }\r\n\r\n    getWorkspaceVariableStatistics(baseDir: string, resName: string, varName: string, varIndex: Array<number> | null,\r\n                                   onProgress: (progress: JobProgress) => void): JobPromise<ImageStatisticsState> {\r\n        return this.webAPIClient.call('get_workspace_variable_statistics',\r\n                                      [baseDir, resName, varName, varIndex],\r\n                                      onProgress);\r\n    }\r\n}\r\n","import { BackendConfigState } from '../../state';\r\nimport { JobPromise } from '../Job';\r\nimport { WebAPIClient } from '../WebAPIClient';\r\n\r\n\r\nfunction fromPythonConfig(configResponse: any): BackendConfigState | null {\r\n    if (!configResponse) {\r\n        return null;\r\n    }\r\n    return {\r\n        dataStoresPath: configResponse.data_stores_path,\r\n        useWorkspaceImageryCache: configResponse.use_workspace_imagery_cache,\r\n        resourceNamePattern: configResponse.default_res_pattern,\r\n        proxyUrl: configResponse.http_proxy\r\n    };\r\n}\r\n\r\nfunction toPythonConfig(backendConfig: BackendConfigState): any {\r\n    if (!backendConfig) {\r\n        return {};\r\n    }\r\n    return {\r\n        data_stores_path: backendConfig.dataStoresPath,\r\n        use_workspace_imagery_cache: backendConfig.useWorkspaceImageryCache,\r\n        default_res_pattern: backendConfig.resourceNamePattern,\r\n        http_proxy: backendConfig.proxyUrl\r\n    };\r\n}\r\n\r\nexport class BackendConfigAPI {\r\n    private webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPI: WebAPIClient) {\r\n        this.webAPIClient = webAPI;\r\n    }\r\n\r\n    getBackendConfig(): JobPromise<BackendConfigState> {\r\n        return this.webAPIClient.call('get_config', [], null, fromPythonConfig);\r\n    }\r\n\r\n    setBackendConfig(config: BackendConfigState): JobPromise<null> {\r\n        return this.webAPIClient.call('set_config', [toPythonConfig(config)]);\r\n    }\r\n}\r\n","import { ColorMapCategoryState } from '../../state';\r\nimport { JobPromise } from '../Job';\r\nimport { WebAPIClient } from '../WebAPIClient';\r\n\r\n\r\nfunction responseToColorMaps(colorMapsResponse: any[][]): ColorMapCategoryState[] {\r\n    if (!colorMapsResponse) {\r\n        return null;\r\n    }\r\n    return colorMapsResponse.map((v1: any[]) => {\r\n        return {\r\n            name: v1[0],\r\n            description: v1[1],\r\n            colorMaps: v1[2].map((v2) => {\r\n                return {\r\n                    name: v2[0],\r\n                    imageData: v2[1]\r\n                };\r\n            })\r\n        };\r\n    });\r\n}\r\n\r\nexport class ColorMapsAPI {\r\n    private readonly webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPIClient: WebAPIClient) {\r\n        this.webAPIClient = webAPIClient;\r\n    }\r\n\r\n    getColorMaps(): JobPromise<ColorMapCategoryState[]> {\r\n        return this.webAPIClient.call('get_color_maps', [], null, responseToColorMaps);\r\n    }\r\n}\r\n","import { WebAPIClient } from '../WebAPIClient';\r\nimport { JobPromise } from '../Job';\r\nimport { FileNode } from '../../components/desktop/fs/FileNode';\r\n\r\n\r\nexport class FileSystemAPI {\r\n    private webAPIClient: WebAPIClient;\r\n\r\n    constructor(webAPI: WebAPIClient) {\r\n        this.webAPIClient = webAPI;\r\n    }\r\n\r\n    updateFileNode(path: string): JobPromise<FileNode> {\r\n        return this.webAPIClient.call<FileNode>('update_file_node', [path]);\r\n    }\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/cate-icon-128.4edcc198.png\";","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue, toTextValue } from '../../components/field/Field';\r\nimport { TextField } from '../../components/field/TextField';\r\n\r\n// Note: DictValueEditor and ArbitraryValueEditor are almost the same - use the React HLC pattern\r\n\r\ninterface IDictValueEditorProps extends IValueEditorProps<string> {\r\n}\r\n\r\nexport class DictValueEditor extends React.Component<IDictValueEditorProps, null> {\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n\r\n    constructor(props: IDictValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    render() {\r\n        const textValue = toTextValue(this.props.value);\r\n        return (\r\n            <TextField\r\n                value={textValue}\r\n                validator={validateDictText}\r\n                size={36}\r\n                placeholder='Enter key-value pairs (Python), separated by comma'\r\n                onChange={this.onChange}\r\n                style={DictValueEditor.TEXT_FIELD_STYLE}\r\n                nullable={this.props.input.nullable}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport function validateDictText(value: string | null) {\r\n    if (!value || value.trim() === '') {\r\n        return;\r\n    }\r\n    // Define Python eval context:\r\n    //\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const None = null;\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const True = true;\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const False = false;\r\n    //\r\n    // To validate, e.g. \"layers=3, time=19\", try eval(\"var layers=3, time=19;\")\r\n    // which should succeed if value is fine\r\n    // eslint-disable-next-line\r\n    eval(`var ${value};`);\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue, toTextValue } from '../../components/field/Field';\r\nimport { TextField } from '../../components/field/TextField';\r\n\r\n// Note: DictValueEditor and LiteralValueEditor are almost the same - use the React HLC pattern\r\n\r\ninterface ILiteralValueEditorProps extends IValueEditorProps<string> {\r\n    placeholder?: string;\r\n    validator?: (value: any) => void;\r\n}\r\n\r\nexport class LiteralValueEditor extends React.Component<ILiteralValueEditorProps, null> {\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n\r\n    constructor(props: ILiteralValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    render() {\r\n        const textValue = toTextValue(this.props.value);\r\n        return (\r\n            <TextField\r\n                value={textValue}\r\n                validator={this.props.validator || validatePythonLiteralText}\r\n                size={36}\r\n                placeholder={this.props.placeholder || 'Enter constant (Python) literal'}\r\n                onChange={this.onChange}\r\n                style={LiteralValueEditor.TEXT_FIELD_STYLE}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport function validatePythonLiteralText(value: string | null) {\r\n    if (!value || value.trim() === '') {\r\n        return;\r\n    }\r\n    // Define Python eval context:\r\n    //\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const None = null;\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const True = true;\r\n    //noinspection JSUnusedLocalSymbols\r\n    // eslint-disable-next-line\r\n    const False = false;\r\n    //\r\n    // Use JavaScript's eval() to validate Python literals.\r\n    // This is not exact, but works for most literals.\r\n    // eslint-disable-next-line\r\n    eval(value);\r\n}\r\n","import * as React from 'react';\r\nimport { AnchorButton, Classes, Dialog, IconName, Intent, Tooltip } from '@blueprintjs/core';\r\n\r\ninterface IModalDialogProps {\r\n    isOpen: boolean;\r\n    title?: string;\r\n    confirmIconName?: IconName;\r\n    confirmTitle?: string;\r\n    confirmTooltip?: JSX.Element | string;\r\n    icon?: IconName;\r\n    renderBody?: () => JSX.Element | JSX.Element[];\r\n    renderActions?: () => JSX.Element[];\r\n    renderExtraActions?: () => JSX.Element[];\r\n    onConfirm?: () => void;\r\n    onCancel?: () => void;\r\n    canConfirm?: () => boolean;\r\n    noCancelButton?: boolean;\r\n    style?: React.CSSProperties;\r\n}\r\n\r\ntype IModalDialogState = any;\r\n\r\nexport class ModalDialog extends React.Component<IModalDialogProps, IModalDialogState> {\r\n\r\n    render() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        return (\r\n            <Dialog\r\n                isOpen={this.props.isOpen}\r\n                title={this.props.title}\r\n                icon={this.props.icon}\r\n                onClose={this.props.onCancel}\r\n                autoFocus={true}\r\n                canEscapeKeyClose={true}\r\n                canOutsideClickClose={false}\r\n                enforceFocus={true}\r\n                style={this.props.style}\r\n            >\r\n                {this.renderDialogContent()}\r\n                {this.renderDialogFooter()}\r\n            </Dialog>\r\n        );\r\n    }\r\n\r\n    private renderDialogContent() {\r\n        return (\r\n            <div className={Classes.DIALOG_BODY}>\r\n                {this.props.renderBody ? this.props.renderBody() : this.props.children}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderDialogFooter() {\r\n        return (\r\n            <div className={Classes.DIALOG_FOOTER}>\r\n                <div className={Classes.DIALOG_FOOTER_ACTIONS}>\r\n                    {this.props.renderActions ? this.props.renderActions() : this.renderActions()}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderActions() {\r\n        const canConfirm = this.props.canConfirm ? this.props.canConfirm() : true;\r\n\r\n        let cancelButton;\r\n        if (!this.props.noCancelButton) {\r\n            cancelButton = (<AnchorButton key=\"cancel\"\r\n                                          onClick={this.props.onCancel}>Cancel</AnchorButton>);\r\n        }\r\n\r\n        let confirmButton = (<AnchorButton key=\"confirm\"\r\n                                           onClick={this.props.onConfirm}\r\n                                           intent={Intent.PRIMARY}\r\n                                           disabled={!canConfirm}\r\n                                           icon={this.props.confirmIconName}>{this.props.confirmTitle || 'OK'}</AnchorButton>);\r\n\r\n        if (this.props.confirmTooltip) {\r\n            confirmButton = (\r\n                <Tooltip key=\"confirmTooltip\" content={this.props.confirmTooltip}>{confirmButton}</Tooltip>);\r\n        }\r\n\r\n        let extraActions;\r\n        if (this.props.renderExtraActions) {\r\n            extraActions = this.props.renderExtraActions();\r\n        }\r\n\r\n        return extraActions ? [cancelButton, ...extraActions, confirmButton] : [cancelButton, confirmButton];\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { AnimationViewDataState, ResourceState, State } from '../state';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { ViewState } from '../components/ViewState';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { Card } from '@blueprintjs/core';\r\nimport { isNumber } from '../../common/types';\r\n\r\n\r\ninterface IAnimationViewOwnProps {\r\n    view: ViewState<AnimationViewDataState>;\r\n}\r\n\r\ninterface IAnimationViewProps extends IAnimationViewOwnProps {\r\n    baseUrl: string;\r\n    baseDir: string | null;\r\n    animationResources: ResourceState[];\r\n    mplWebSocketUrl: string;\r\n}\r\n\r\ninterface IAnimationViewState {\r\n    loading?: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IAnimationViewOwnProps): IAnimationViewProps {\r\n    return {\r\n        view: ownProps.view,\r\n        baseUrl: selectors.webAPIRestUrlSelector(state),\r\n        baseDir: selectors.workspaceBaseDirSelector(state),\r\n        animationResources: selectors.animationResourcesSelector(state),\r\n        mplWebSocketUrl: selectors.mplWebSocketUrlSelector(state),\r\n    };\r\n}\r\n\r\n/**\r\n * This component displays a 2D map with a number of layers.\r\n */\r\nclass AnimationView extends React.Component<IAnimationViewProps & DispatchProp<State>, IAnimationViewState> {\r\n    static readonly DIV_STYLE: React.CSSProperties = {\r\n        width: '100%',\r\n        height: '100%',\r\n        //height: 400,\r\n        overflowX: 'hidden',\r\n        overflowY: 'auto'\r\n    };\r\n\r\n    constructor(props: IAnimationViewProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {};\r\n        this.divElement = null;\r\n        this.onRef = this.onRef.bind(this)\r\n    }\r\n\r\n    private divElement;\r\n\r\n    componentWillMount(): void {\r\n        if (!this.props.view.data.innerHTML && !this.state.loading) {\r\n            this.setState({loading: true}, () => {\r\n                this.props.dispatch(actions.loadAnimationViewData(this.props.view.id, this.props.view.data.resourceId) as any);\r\n            });\r\n        }\r\n    }\r\n\r\n    private onRef(divElement: HTMLDivElement) {\r\n        this.divElement = divElement;\r\n\r\n        if (divElement && this.props.view.data.innerHTML) {\r\n            const elements = divElement.getElementsByTagName('script');\r\n            for (let i = 0; i < elements.length; i++) {\r\n                const script = elements[i].innerHTML;\r\n                try {\r\n                    // indirect eval call evaluates in global scope\r\n                    // eslint-disable-next-line\r\n                    eval('eval')(script);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const animationResource = this.getAnimationResource();\r\n        if (!animationResource) {\r\n            return (<Card>Animation not found.</Card>);\r\n        }\r\n\r\n        const animationViewData = this.props.view.data;\r\n        let innerHTML = animationViewData.innerHTML;\r\n        let status = animationViewData.status;\r\n        if (innerHTML) {\r\n            //console.log(\"AnimationView: \", innerHTML);\r\n            return (\r\n                <div style={AnimationView.DIV_STYLE}\r\n                     dangerouslySetInnerHTML={{__html: innerHTML}}\r\n                     ref={this.onRef}\r\n                />\r\n            );\r\n        } else if (isNumber(status) && (status < 200 || status >= 300)) {\r\n            return (<Card>`Error loading animation (status ${animationViewData.status}`)</Card>);\r\n        } else if (this.state.loading) {\r\n            return (<Card>Loading animation...</Card>);\r\n        } else {\r\n            return (<Card>???</Card>);\r\n        }\r\n    }\r\n\r\n    getAnimationResource(): ResourceState | null {\r\n        const animationViewData = this.props.view.data;\r\n        return this.props.animationResources.find(r => r.id === animationViewData.resourceId);\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(AnimationView);\r\n\r\n\r\n","export const OBJECT_TYPE = 'object';\r\nexport const BOOL_TYPE = 'bool';\r\nexport const INT_TYPE = 'int';\r\nexport const FLOAT_TYPE = 'float';\r\nexport const STR_TYPE = 'str';\r\nexport const PASSWD_TYPE = 'cate.core.types.Password';\r\n\r\nexport const ND_ARRAY_TYPE = 'numpy.ndarray';\r\n\r\nexport const DATASET_TYPE = 'xarray.core.dataset.Dataset';\r\nexport const DATA_ARRAY_TYPE = 'xarray.core.dataarray.DataArray';\r\nexport const DATA_FRAME_TYPE = 'pandas.core.frame.DataFrame';\r\nexport const GEO_DATA_FRAME_TYPE = 'geopandas.geodataframe.GeoDataFrame';\r\nexport const GEO_SERIES_TYPE = 'geopandas.geoseries.GeoSeries';\r\nexport const SERIES_TYPE = 'pandas.core.series.Series';\r\n\r\nexport const DATASET_LIKE_TYPE = 'cate.core.types.DatasetLike';\r\nexport const DATA_FRAME_LIKE_TYPE = 'cate.core.types.DataFrameLike';\r\nexport const POINT_LIKE_TYPE = 'cate.core.types.PointLike';\r\nexport const POLYGON_LIKE_TYPE = 'cate.core.types.PolygonLike';\r\nexport const GEOMETRY_LIKE_TYPE = 'cate.core.types.GeometryLike';\r\nexport const GEO_DATA_FRAME_PROXY_TYPE = 'cate.core.types.GeoDataFrame';\r\nexport const TIME_LIKE_TYPE = 'cate.core.types.TimeLike';\r\nexport const TIME_RANGE_LIKE_TYPE = 'cate.core.types.TimeRangeLike';\r\nexport const VAR_NAME_LIKE_TYPE = 'cate.core.types.VarName';\r\nexport const VAR_NAMES_LIKE_TYPE = 'cate.core.types.VarNamesLike';\r\nexport const DIM_NAME_LIKE_TYPE = 'cate.core.types.DimName';\r\nexport const DIM_NAMES_LIKE_TYPE = 'cate.core.types.DimNamesLike';\r\nexport const DICT_LIKE_TYPE = 'cate.core.types.DictLike';\r\nexport const FILE_LIKE_TYPE = 'cate.core.types.FileLike';\r\nexport const ARBITRARY_TYPE = 'cate.core.types.Arbitrary';\r\nexport const LITERAL_TYPE = 'cate.core.types.Literal';\r\n\r\nexport const GEOMETRY_TYPE = 'shapely.geometry.base.BaseGeometry';\r\nexport const POINT_TYPE = 'shapely.geometry.point.Point';\r\nexport const MULTI_POINT_TYPE = 'shapely.geometry.multipoint.MultiPoint';\r\nexport const LINE_STRING_TYPE = 'shapely.geometry.linestring.LineString';\r\nexport const MULTI_LINE_STRING_TYPE = 'shapely.geometry.multilinestring.MultiLineString';\r\nexport const POLYGON_TYPE = 'shapely.geometry.polygon.Polygon';\r\nexport const MULTI_POLYGON_TYPE = 'shapely.geometry.multipolygon.multiPolygon';\r\nexport const GEOMETRY_COLLECTION_TYPE = 'shapely.geometry.collection.GeometryCollection';\r\n\r\n\r\n/**\r\n * Naive test if a targetDataType is assignable from a given sourceDataType.\r\n *\r\n * @param targetDataType The name of the target data type used in Cate's Python API\r\n * @param sourceDataType The name of the source data type used in Cate's Python API\r\n * @returns {boolean} true, if so.\r\n */\r\nexport function isAssignableFrom(targetDataType: string, sourceDataType: string) {\r\n    if (!targetDataType || !sourceDataType) {\r\n        return false;\r\n    }\r\n    if (targetDataType === sourceDataType) {\r\n        return true;\r\n    }\r\n    switch (targetDataType) {\r\n        case OBJECT_TYPE:\r\n        case ARBITRARY_TYPE:\r\n            return true;\r\n        case LITERAL_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case BOOL_TYPE:\r\n            return sourceDataType === INT_TYPE || sourceDataType === FLOAT_TYPE;\r\n        case INT_TYPE:\r\n            return sourceDataType === BOOL_TYPE;\r\n        case FLOAT_TYPE:\r\n            return sourceDataType === BOOL_TYPE || sourceDataType === INT_TYPE;\r\n        case ND_ARRAY_TYPE:\r\n            return sourceDataType === DATA_ARRAY_TYPE;\r\n        case DATA_FRAME_TYPE:\r\n            return sourceDataType === DATA_FRAME_LIKE_TYPE || sourceDataType === GEO_DATA_FRAME_TYPE\r\n                   || sourceDataType === GEO_DATA_FRAME_PROXY_TYPE;\r\n        case DATA_FRAME_LIKE_TYPE:\r\n            return sourceDataType === DATA_FRAME_TYPE\r\n                   || sourceDataType === GEO_DATA_FRAME_TYPE || sourceDataType === GEO_DATA_FRAME_PROXY_TYPE\r\n                   || sourceDataType === DATASET_TYPE || sourceDataType === DATASET_LIKE_TYPE;\r\n        case GEO_DATA_FRAME_TYPE:\r\n            return sourceDataType === GEO_DATA_FRAME_PROXY_TYPE;\r\n        case DATASET_TYPE:\r\n            return sourceDataType === DATASET_LIKE_TYPE;\r\n        case DATASET_LIKE_TYPE:\r\n            return sourceDataType === DATASET_TYPE || sourceDataType === DATA_FRAME_TYPE;\r\n        case SERIES_TYPE:\r\n            return sourceDataType === GEO_SERIES_TYPE;\r\n        case VAR_NAME_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case VAR_NAMES_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case DIM_NAME_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case DIM_NAMES_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case DICT_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case FILE_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case TIME_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case TIME_RANGE_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE;\r\n        case POINT_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE || sourceDataType === POINT_TYPE;\r\n        case POLYGON_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE || sourceDataType === POLYGON_TYPE;\r\n        case GEOMETRY_LIKE_TYPE:\r\n            return sourceDataType === STR_TYPE\r\n                   || sourceDataType === POINT_LIKE_TYPE\r\n                   || sourceDataType === POLYGON_LIKE_TYPE\r\n                   || sourceDataType === GEOMETRY_TYPE\r\n                   || sourceDataType === POINT_TYPE\r\n                   || sourceDataType === MULTI_POINT_TYPE\r\n                   || sourceDataType === LINE_STRING_TYPE\r\n                   || sourceDataType === MULTI_LINE_STRING_TYPE\r\n                   || sourceDataType === POLYGON_TYPE\r\n                   || sourceDataType === MULTI_POLYGON_TYPE\r\n                   || sourceDataType === GEOMETRY_COLLECTION_TYPE;\r\n    }\r\n    return false;\r\n}\r\n","import * as React from 'react'\r\n\r\n//import './ListBox.css'\r\n\r\nexport enum ListBoxSelectionMode {\r\n    SINGLE,\r\n    MULTIPLE\r\n}\r\n\r\n\r\nexport interface IListBoxProps {\r\n    items: any[];\r\n    renderItem: (item: any, itemIndex: number) => JSX.Element;\r\n    getItemKey?: (item: any, itemIndex: number) => React.Key;\r\n    onItemClick?: (item: any, itemIndex: number) => void;\r\n    onItemDoubleClick?: (item: any, itemIndex: number) => void;\r\n    onSelection?: (newSelection: React.Key[], oldSelection: React.Key[]) => void;\r\n    selectionMode?: ListBoxSelectionMode;\r\n    selection?: React.Key[] | React.Key | null;\r\n    style?: Object;\r\n    itemStyle?: Object;\r\n}\r\n\r\n/**\r\n * A  ListBox is used similar to Blueprint's `Table` component.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class ListBox extends React.PureComponent<IListBoxProps, any> {\r\n\r\n    handleClick(event: MouseEvent, itemIndex, key: string | number) {\r\n        // console.log('handleClick', event.button, event.buttons,event.bubbles, event.detail);\r\n        if (event.detail === 2) {\r\n            return;\r\n        }\r\n        if (this.props.onSelection) {\r\n            const oldSelection = toSelectionArray(this.props.selection);\r\n            let newSelection;\r\n            if (this.props.selection) {\r\n                const selectionMode = this.props.selectionMode || ListBoxSelectionMode.SINGLE;\r\n                const itemIndex = oldSelection.findIndex(k => k === key);\r\n                if (itemIndex >= 0) {\r\n                    newSelection = oldSelection.slice();\r\n                    newSelection.splice(itemIndex, 1);\r\n                } else {\r\n                    if (selectionMode === ListBoxSelectionMode.SINGLE) {\r\n                        newSelection = [key];\r\n                    } else if (selectionMode === ListBoxSelectionMode.MULTIPLE) {\r\n                        newSelection = oldSelection.slice();\r\n                        newSelection.push(key);\r\n                    }\r\n                }\r\n            } else {\r\n                newSelection = [key];\r\n            }\r\n            this.props.onSelection(newSelection, oldSelection);\r\n        }\r\n        if (this.props.onItemClick) {\r\n            this.props.onItemClick(this.props.items[itemIndex], itemIndex);\r\n        }\r\n    }\r\n\r\n    handleDoubleClick(event, itemIndex) {\r\n        // console.log('handleDoubleClick', event.button, event.buttons,event.bubbles, event.detail);\r\n        if (this.props.onItemDoubleClick) {\r\n            this.props.onItemDoubleClick(this.props.items[itemIndex], itemIndex);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const items = this.props.items;\r\n        if (!items) {\r\n            return null;\r\n        }\r\n\r\n        const selection = new Set<any>(toSelectionArray(this.props.selection));\r\n        const getItemKey = this.props.getItemKey || ((item: any, itemIndex: number) => itemIndex);\r\n        const renderItem = this.props.renderItem;\r\n        //noinspection JSMismatchedCollectionQueryUpdate\r\n        let renderedItems: Array<JSX.Element> = [];\r\n        for (let itemIndex = 0; itemIndex < items.length; itemIndex++) {\r\n            const item = items[itemIndex];\r\n            const key = getItemKey(item, itemIndex);\r\n            const renderedItem = renderItem(item, itemIndex);\r\n            const selected = selection.has(key);\r\n            const className = selected ? 'cate-selected' : null;\r\n            renderedItems.push(\r\n                <li key={key}\r\n                    onClick={(event) => this.handleClick(event as any, itemIndex, key)}\r\n                    onDoubleClick={(event) => this.handleDoubleClick(event as any, itemIndex)}\r\n                    className={className}\r\n                    style={this.props.itemStyle}>\r\n                    {renderedItem}\r\n                </li>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <ul className=\"cate-list-box\" style={this.props.style}>\r\n                {renderedItems}\r\n            </ul>\r\n        );\r\n    }\r\n}\r\n\r\nconst EMPTY_ARRAY = [];\r\n\r\nfunction toSelectionArray(obj): any[] {\r\n    if (obj === null || typeof obj === 'undefined') {\r\n        return EMPTY_ARRAY;\r\n    }\r\n    if (obj.constructor === Array) {\r\n        return obj;\r\n    }\r\n    return [obj];\r\n}\r\n","import { IconName } from '@blueprintjs/core';\r\n\r\nimport {\r\n    getBasename,\r\n    getBasenameExtension,\r\n    getParentPath,\r\n    HostOS,\r\n    isAbsolutePath,\r\n    isWindowsRootPath\r\n} from '../../../../common/paths';\r\nimport { isNumber, isString } from '../../../../common/types';\r\nimport { FileFilter } from '../types';\r\n\r\n\r\n/**\r\n * Represents the current update status of a file node.\r\n */\r\nexport type FileNodeStatus = 'updating' | 'ready' | 'error';\r\n\r\n/**\r\n * A file node represent a file or directory in a file system.\r\n * When we create path strings from file node paths (hence FileNode[]),\r\n * we concatenate always by forward slashes (\"/\"), even if the server file system\r\n * is Windows OS. Therefore path strings ever start with a \"/\", even absolute paths.\r\n */\r\nexport interface FileNode {\r\n    /**\r\n     * Name of the file or directory. The root node's name is the empty string.\r\n     */\r\n    name: string;\r\n    /**\r\n     * Date-time of last modification.\r\n     */\r\n    lastModified?: string;\r\n    /**\r\n     * Size in bytes\r\n     */\r\n    size?: number;\r\n    /**\r\n     * True, if this node represents a directory\r\n     */\r\n    isDir: boolean;\r\n    /**\r\n     * Child nodes of the directory\r\n     */\r\n    childNodes?: FileNode[];\r\n    /**\r\n     * The node's update status.\r\n     * If status === undefined means, we have not updated this node yet (i.e. children not fetched)\r\n     */\r\n    status?: FileNodeStatus;\r\n    /**\r\n     * Detail message if status === \"error\"\r\n     */\r\n    message?: string;\r\n}\r\n\r\nexport const ALL_FILES_FILTER = {name: \"All files\", extensions: [\"*\"]};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// FileNode operations\r\n\r\n/**\r\n * Returns a new `rootNode` where `updatedFileNode` is inserted at position given by `path`.\r\n * @param rootNode the root node\r\n * @param path normalized path\r\n * @param updatedFileNode the file node update that will replace the old one\r\n */\r\nexport function updateFileNode(rootNode: FileNode, path: string, updatedFileNode: FileNode): FileNode {\r\n    if (path === '') {\r\n        return {...rootNode, ...updatedFileNode, status: 'ready'};\r\n    }\r\n    return _updateFileNode(rootNode, path.split('/'), updatedFileNode);\r\n}\r\n\r\nfunction _updateFileNode(rootNode: FileNode, path: string[], updatedFileNode: FileNode): FileNode {\r\n    if (!rootNode.childNodes) {\r\n        // can't work without child nodes\r\n        console.error('_updateFileNode: root node without child nodes');\r\n        return rootNode;\r\n    }\r\n    updatedFileNode = !updatedFileNode.status ? {...updatedFileNode, status: 'ready'} : updatedFileNode;\r\n    const newRootNode: FileNode = {...rootNode, childNodes: [...rootNode.childNodes]};\r\n    let currentNode: FileNode = newRootNode;\r\n    for (let depth = 0; depth < path.length; depth++) {\r\n        if (!currentNode.childNodes) {\r\n            console.error(`_updateFileNode: no child nodes at index ${depth} in \"${path.join('/')}\"`);\r\n            return rootNode;\r\n        }\r\n        const name = path[depth];\r\n        const childIndex = currentNode.childNodes.findIndex(n => name.localeCompare(n.name) === 0);\r\n        if (childIndex < 0) {\r\n            console.error(`_updateFileNode: invalid path component \"${name}\" at index ${depth} in \"${path.join('/')}\"`);\r\n            return rootNode;\r\n        }\r\n        if (depth === path.length - 1) {\r\n            currentNode.childNodes[childIndex] = updatedFileNode;\r\n        } else {\r\n            const childNode = currentNode.childNodes[childIndex];\r\n            let newChildNode;\r\n            if (childNode.childNodes) {\r\n                newChildNode = {...childNode, childNodes: [...childNode.childNodes]};\r\n            } else {\r\n                newChildNode = {...childNode};\r\n            }\r\n            currentNode.childNodes[childIndex] = newChildNode;\r\n            currentNode = newChildNode;\r\n        }\r\n    }\r\n    return newRootNode;\r\n}\r\n\r\n/**\r\n * Get file node path excluding the `rootNode`.\r\n * @param rootNode the root node\r\n * @param path normalized path\r\n */\r\nexport function getFileNodePath(rootNode: FileNode, path: string): FileNode[] | null {\r\n    if (path === '') {\r\n        return [];\r\n    }\r\n    const pathNames = path.split('/');\r\n    const fileNodePath = _getValidSubFileNodePath(rootNode.childNodes, pathNames);\r\n    return pathNames.length === fileNodePath.length ? fileNodePath : null;\r\n}\r\n\r\n/**\r\n * Get valid sub file node path excluding the `rootNode`.\r\n * @param rootNode the root node\r\n * @param path normalized path\r\n */\r\nexport function getValidSubFileNodePath(rootNode: FileNode, path: string): FileNode[] {\r\n    return _getValidSubFileNodePath(rootNode.childNodes, path.split('/'));\r\n}\r\n\r\nfunction _getValidSubFileNodePath(rootNodes: FileNode[] | undefined, pathNames: string[]): FileNode[] {\r\n    let childNodes = rootNodes;\r\n    let fileNodePath: FileNode[] = [];\r\n    for (let depth = 0; depth < pathNames.length; depth++) {\r\n        if (!childNodes) {\r\n            return fileNodePath;\r\n        }\r\n        const name = pathNames[depth];\r\n        const node = childNodes.find(n => n.name.localeCompare(name) === 0);\r\n        if (!node) {\r\n            return fileNodePath;\r\n        }\r\n        fileNodePath.push(node);\r\n        childNodes = node.childNodes;\r\n    }\r\n    return fileNodePath;\r\n}\r\n\r\n/**\r\n * Get the file node in `rootNode` for given `path`.\r\n * @param rootNode the root node\r\n * @param path normalized path\r\n */\r\nexport function getFileNode(rootNode: FileNode, path: string): FileNode | null {\r\n    if (path === \"\") {\r\n        return rootNode;\r\n    }\r\n    const fileNodePath = getFileNodePath(rootNode, path);\r\n    if (fileNodePath) {\r\n        if (fileNodePath.length === 0) {\r\n            return rootNode;\r\n        } else {\r\n            return fileNodePath[fileNodePath.length - 1];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Get an icon name for given file node.\r\n * @param node the file node\r\n */\r\nexport function getFileNodeIcon(node: FileNode): IconName {\r\n    return node.isDir ? \"folder-close\" : \"document\";\r\n}\r\n\r\nexport function compareFileNames(a: FileNode, b: FileNode) {\r\n    if (a.isDir) {\r\n        if (!b.isDir) {\r\n            return -1;\r\n        }\r\n    } else if (b.isDir) {\r\n        return 1;\r\n    }\r\n    return a.name.localeCompare(b.name);\r\n}\r\n\r\nexport function compareFileLastModified(a: FileNode, b: FileNode) {\r\n    if (a.isDir) {\r\n        if (!b.isDir) {\r\n            return -1;\r\n        }\r\n    } else if (b.isDir) {\r\n        return 1;\r\n    }\r\n    if (isString(a.lastModified)) {\r\n        if (isString(b.lastModified)) {\r\n            const compValue = a.lastModified.localeCompare(b.lastModified);\r\n            if (compValue !== 0) {\r\n                return compValue;\r\n            }\r\n        }\r\n    } else if (isString(b.lastModified)) {\r\n        return -1;\r\n    }\r\n    return a.name.localeCompare(b.name);\r\n}\r\n\r\nexport function compareFileSize(a: FileNode, b: FileNode) {\r\n    if (a.isDir) {\r\n        if (!b.isDir) {\r\n            return -1;\r\n        }\r\n    } else if (b.isDir) {\r\n        return 1;\r\n    }\r\n    if (isNumber(a.size)) {\r\n        if (isNumber(b.size)) {\r\n            const compValue = a.size - b.size;\r\n            if (compValue !== 0) {\r\n                return compValue;\r\n            }\r\n        }\r\n    } else if (isNumber(b.size)) {\r\n        return -1;\r\n    }\r\n    return a.name.localeCompare(b.name);\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// FileDialog-internal path operations\r\n\r\n/**\r\n * Add `path` to the expanded paths `expandedPaths`. Return a new, updated array of expanded paths.\r\n * @param expandedPaths array of expanded paths\r\n * @param path normalized path\r\n * @returns a new array of expanded paths\r\n */\r\nexport function addExpandedDirPath(expandedPaths: string[], path: string): string[] {\r\n    const parentDir = getParentPath(path);\r\n    const cleanedPaths = expandedPaths.filter(p => !(p === path || p === parentDir || path.startsWith(p + '/')));\r\n    return [...cleanedPaths, path];\r\n}\r\n\r\n/**\r\n * Remove `path` from the expanded paths `expandedPaths`. Return new, updated array of expanded paths.\r\n * @param expandedPaths array of expanded paths\r\n * @param path normalized path\r\n * @returns a new array of expanded paths\r\n */\r\nexport function removeExpandedDirPath(expandedPaths: string[], path: string): string[] {\r\n    const parentDir = getParentPath(path);\r\n    const cleanedPaths = expandedPaths.filter(p => !(p === path || p === parentDir || p.startsWith(path + '/')));\r\n    return parentDir !== '' ? [...cleanedPaths, parentDir] : cleanedPaths;\r\n}\r\n\r\nexport function isPathValidAtIndex(path: string[], index: number, name: string): boolean {\r\n    return index < path.length && path[index] === name;\r\n}\r\n\r\nexport function applyFileFilter(nodes: FileNode[], fileFilter: FileFilter): FileNode[] {\r\n    const extSet = new Set<string>(fileFilter.extensions);\r\n    if (extSet.has('*')) {\r\n        return nodes;\r\n    }\r\n    return nodes.filter(node => {\r\n        if (node.isDir) {\r\n            return true;\r\n        }\r\n        const ext = getBasenameExtension(node.name);\r\n        return extSet.has(ext);\r\n    });\r\n}\r\n\r\n/**\r\n * Parse a text value entered by the user into an array of normalized paths.\r\n * @param inputValue text value entered by the user, note this is an un-normalized path\r\n * @param currentDirPath the current, normalized directory\r\n * @param multiSelection if multiple selections are allowed\r\n * @param hostOS host OS name\r\n * @returns an array of normalized paths\r\n */\r\nexport function fromPathInputValue(inputValue: string,\r\n                                   currentDirPath: string,\r\n                                   multiSelection: boolean,\r\n                                   hostOS?: HostOS): string[] {\r\n    inputValue = inputValue.trim()\r\n    if (inputValue === '') {\r\n        return [];\r\n    }\r\n    let paths;\r\n    if (!multiSelection) {\r\n        paths = [inputValue];\r\n    } else {\r\n        const isWindows = hostOS === 'Windows';\r\n        paths = [];\r\n        let escChar = null;\r\n        let token = '';\r\n        for (let i = 0; i < inputValue.length; i++) {\r\n            const char = inputValue[i];\r\n            if (char === '\"' || char === \"'\") {\r\n                if (escChar === null) {\r\n                    escChar = char;\r\n                    token = '';\r\n                } else if (escChar === char) {\r\n                    escChar = null;\r\n                } else {\r\n                    token += char;\r\n                }\r\n            } else if (char === ' ') {\r\n                if (escChar === null) {\r\n                    if (token !== '') {\r\n                        paths.push(token);\r\n                        token = '';\r\n                    }\r\n                } else {\r\n                    token += char;\r\n                }\r\n            } else if (!isWindows && char === '\\\\') {\r\n                // escape char\r\n            } else {\r\n                token += char;\r\n            }\r\n        }\r\n        if (token !== '') {\r\n            paths.push(token);\r\n        }\r\n    }\r\n    return paths.map(p => toAbsolutePath(p, currentDirPath, hostOS));\r\n}\r\n\r\n/**\r\n * Convert path into internal normalized form used in the FileDialog UI.\r\n * @param path a non-normalized path, e.g. from user input\r\n * @param hostOS host OS name\r\n */\r\nfunction normalizePath(path: string, hostOS?: HostOS): string {\r\n    let prefix;\r\n\r\n    if (hostOS === 'Windows') {\r\n        // Normalize back-slashes into forward slashes\r\n        while (path.indexOf('\\\\') >= 0) {\r\n            path = path.replace('\\\\', '/');\r\n        }\r\n        if (path.startsWith('//')) {\r\n            // Note special case on Windows, where '//' are prefixes for network devices\r\n            prefix = '//';\r\n            path = path.substring(2);\r\n        }\r\n    } else {\r\n        // Remove back-slashes, because they escape special characters on non-Windows hosts\r\n        while (path.indexOf('\\\\') >= 0) {\r\n            path = path.replace('\\\\', '');\r\n        }\r\n    }\r\n\r\n    // Normalize by trimming leading '/'\r\n    while (path.startsWith('/')) {\r\n        path = path.substring(1);\r\n    }\r\n    // Normalize by trimming trailing '/'\r\n    while (path.endsWith('/')) {\r\n        path = path.substring(0, path.length - 1);\r\n    }\r\n    // Normalize by trimming double slashes '//'\r\n    while (path.indexOf('//') > 0) {\r\n        path = path.replace('//', '/')\r\n    }\r\n\r\n    return prefix ? prefix + path : path;\r\n}\r\n\r\nexport function denormalizePath(path: string, hostOS?: HostOS) {\r\n    if (hostOS === 'Windows') {\r\n        path = path.split('/').join('\\\\');\r\n        if (!isWindowsRootPath(path)) {\r\n            return '\\\\' + path;\r\n        }\r\n        return path;\r\n    } else {\r\n        return '/' + path;\r\n    }\r\n}\r\n\r\n/**\r\n * Return an absolute path for given `path`. Note that the returned absolute path are normalized and\r\n * *never* start with a slash ('/').\r\n * @param path an absolute or relative path\r\n * @param currentDirPath current, normalized path\r\n * @param hostOS host OS name\r\n */\r\nexport function toAbsolutePath(path: string, currentDirPath: string, hostOS?: HostOS): string {\r\n    const abs = isAbsolutePath(path, hostOS);\r\n    path = normalizePath(path, hostOS);\r\n    if (abs) {\r\n        return path;\r\n    }\r\n    if (currentDirPath === '') {\r\n        return path;\r\n    }\r\n    return currentDirPath + '/' + path;\r\n}\r\n\r\n/**\r\n * Format an array of selected paths into a text value that the user can edit.\r\n * @param selectedPaths array of selected paths\r\n * @param multiSelection if multiple selections are allowed\r\n * @returns a text value that the user can edit\r\n */\r\nexport function toPathInputValue(selectedPaths: string[], multiSelection: boolean): string {\r\n    if (selectedPaths.length === 0) {\r\n        return '';\r\n    }\r\n    if (!multiSelection) {\r\n        return getBasename(selectedPaths[0]);\r\n    }\r\n    return selectedPaths.map(p => escapePath(getBasename((p)))).join(' ');\r\n}\r\n\r\nfunction escapePath(path: string): string {\r\n    if (path.indexOf(' ') >= 0) {\r\n        if (path.indexOf('\"') >= 0) {\r\n            return `'${path}'`;\r\n        } else {\r\n            return `\"${path}\"`;\r\n        }\r\n    }\r\n    return path;\r\n}\r\n","import { Field, FieldType, FieldValue, IFieldProps } from './Field';\r\n\r\nexport type TextFieldType = FieldType<string>;\r\nexport type TextFieldValue = FieldValue<string>;\r\n\r\nexport interface ITextFieldProps extends IFieldProps {\r\n    nullable?: boolean;\r\n}\r\n\r\n/**\r\n * A TextField represents a text input field providing values of type string.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class TextField extends Field<ITextFieldProps> {\r\n\r\n    validateValue(value: TextFieldType): void {\r\n        super.validateValue(value);\r\n        if (!value && !this.props.nullable) {\r\n            throw new Error('Text value expected.');\r\n        }\r\n    }\r\n}\r\n\r\n","import { Classes, InputGroup } from '@blueprintjs/core';\r\nimport * as React from 'react'\r\nimport { isDefined, isDefinedAndNotNull, isString, isUndefinedOrNull } from '../../../common/types';\r\n\r\nexport type FieldType<T> = T | null;\r\n\r\nexport interface FieldValue<T> {\r\n    textValue?: string;\r\n    value?: FieldType<T>;\r\n    error?: Error | any;\r\n}\r\n\r\ntype AnyFieldType = FieldType<any>;\r\ntype AnyFieldValue = FieldValue<any>;\r\n\r\nexport type FieldValidator = (value: AnyFieldType) => any;\r\n\r\nexport interface IFieldProps {\r\n    value: AnyFieldValue | any;\r\n    onChange: (value: AnyFieldValue) => void;\r\n    validator?: FieldValidator;\r\n    placeholder?: string;\r\n    size?: number;\r\n    className?: string;\r\n    style?: { [key: string]: any };\r\n    disabled?: boolean;\r\n    uncontrolled?: boolean;\r\n    type?: string;\r\n}\r\n\r\ntype IFieldState = AnyFieldValue | null;\r\n\r\n\r\nexport function toTextValue(value: AnyFieldValue | any, defaultValue: any = '') {\r\n    if (isFieldValue(value)) {\r\n        return isDefinedAndNotNull(value.textValue) ? value.textValue : `${value.value}`;\r\n    } else if (isString(value)) {\r\n        return value;\r\n    }\r\n    return isDefinedAndNotNull(value) ? `${value}` : defaultValue;\r\n}\r\n\r\nexport function toValue(value: any) {\r\n    if (isFieldValue(value)) {\r\n        return value.value;\r\n    }\r\n    return value;\r\n}\r\n\r\n\r\n/**\r\n * A Field represents a text input field that provides a value of some type\r\n * characterised by the \"valueHandler\" property.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class Field<P extends IFieldProps> extends React.PureComponent<P, IFieldState> {\r\n\r\n    static readonly NOMINAL_CLASS = '';\r\n    static readonly ERROR_CLASS = Classes.INTENT_DANGER;\r\n\r\n    protected _fieldValue: AnyFieldValue;\r\n\r\n    constructor(props: Readonly<P>) {\r\n        super(props);\r\n        this._fieldValue = this.toFieldValue(props.value);\r\n        if (this.props.uncontrolled) {\r\n            this.state = this._fieldValue;\r\n        }\r\n\r\n        this.handleKeyPress = this.handleKeyPress.bind(this);\r\n        this.handleBlur = this.handleBlur.bind(this);\r\n        this.handleInputChange = this.handleInputChange.bind(this);\r\n    }\r\n\r\n    getValue(): AnyFieldType {\r\n        return this._fieldValue.value;\r\n    }\r\n\r\n    setValue(value: AnyFieldValue | any | null) {\r\n        this.setFieldValue(this.newFieldValueFromValue(value));\r\n    }\r\n\r\n    setValueAndTextValue(value: any | null, textValue: string) {\r\n        this.setFieldValue(this.newFieldValueFromValueAndTextValue(value, textValue));\r\n    }\r\n\r\n    getTextValue(): string {\r\n        return this._fieldValue.textValue || '';\r\n    }\r\n\r\n    setTextValue(textValue: string) {\r\n        this.setFieldValue(this.newFieldValueFromTextValue(textValue));\r\n    }\r\n\r\n    getError(): Error | any {\r\n        return this._fieldValue.error;\r\n    }\r\n\r\n    setError(error: Error | null) {\r\n        this.setFieldValue({...this._fieldValue, error});\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: Readonly<P>): void {\r\n        this._fieldValue = this.toFieldValue(nextProps.value);\r\n        if (this.props.uncontrolled) {\r\n            this.setState(this._fieldValue);\r\n        }\r\n    }\r\n\r\n    parseValue(textValue: string): AnyFieldType {\r\n        if (!textValue || textValue === '') {\r\n            return null;\r\n        }\r\n        return textValue;\r\n    }\r\n\r\n    formatValue(value: AnyFieldType): string {\r\n        if (isUndefinedOrNull(value)) {\r\n            return '';\r\n        } else if (isString(value)) {\r\n            return value;\r\n        }\r\n        return `${value}`;\r\n    }\r\n\r\n    validateValue(value: AnyFieldType): void {\r\n        if (this.props.validator) {\r\n            this.props.validator(value);\r\n        }\r\n    }\r\n\r\n    protected handleKeyPress(event: any) {\r\n        if (this.props.uncontrolled && event.charCode === 13) {\r\n            this.props.onChange(this.state);\r\n        }\r\n    }\r\n\r\n    protected handleBlur() {\r\n        if (this.props.uncontrolled) {\r\n            this.props.onChange(this.state);\r\n        }\r\n    }\r\n\r\n    protected handleInputChange(event: any) {\r\n        const textValue = event.target.value;\r\n        this.setTextValue(textValue || '');\r\n    }\r\n\r\n    private newFieldValueFromTextValue(textValue: string): AnyFieldValue {\r\n        let value = null;\r\n        let error;\r\n        try {\r\n            value = this.parseValue(textValue);\r\n            this.validateValue(value);\r\n        } catch (e) {\r\n            value = this._fieldValue ? this._fieldValue.value : value;\r\n            error = e;\r\n        }\r\n        return {textValue, value, error};\r\n    }\r\n\r\n    private newFieldValueFromValue(value: AnyFieldValue | any | null): AnyFieldValue {\r\n        if (isFieldValue(value)) {\r\n            return {...value as AnyFieldValue};\r\n        }\r\n        let textValue;\r\n        let error;\r\n        try {\r\n            textValue = this.formatValue(value);\r\n        } catch (e) {\r\n            textValue = '';\r\n            error = e;\r\n        }\r\n        try {\r\n            this.validateValue(value);\r\n        } catch (e) {\r\n            error = e;\r\n        }\r\n        return {textValue, value, error};\r\n    }\r\n\r\n    private newFieldValueFromValueAndTextValue(value: any, textValue: string): AnyFieldValue {\r\n        let error;\r\n        try {\r\n            this.validateValue(value);\r\n        } catch (e) {\r\n            error = e;\r\n        }\r\n        return {textValue, value, error};\r\n    }\r\n\r\n    private toFieldValue(value: any): AnyFieldValue {\r\n        if (isFieldValue(value)) {\r\n            return value;\r\n        } else if (isString(value)) {\r\n            return this.newFieldValueFromTextValue(value as string);\r\n        } else {\r\n            return this.newFieldValueFromValue(value);\r\n        }\r\n    }\r\n\r\n    private setFieldValue(fieldValue: AnyFieldValue) {\r\n        this._fieldValue = fieldValue;\r\n        if (this.props.uncontrolled) {\r\n            this.setState(fieldValue);\r\n        } else {\r\n            this.props.onChange(fieldValue);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const error = this.getError();\r\n        // console.log(\"Field.render: fieldValue = \", this._fieldValue);\r\n        const errorClassName = Field.ERROR_CLASS + ' ' + this.props.className;\r\n        const nominalClassName = Field.NOMINAL_CLASS + ' ' + this.props.className;\r\n\r\n        return (\r\n            <InputGroup\r\n                value={this.getTextValue()}\r\n                onChange={this.handleInputChange}\r\n                onBlur={this.handleBlur}\r\n                onKeyPress={this.handleKeyPress}\r\n                type={this.props.type || \"text\"}\r\n                className={error ? errorClassName : nominalClassName}\r\n                style={this.props.style}\r\n                size={this.props.size}\r\n                placeholder={this.props.placeholder}\r\n                disabled={this.props.disabled}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport function isFieldValue(value: any): boolean {\r\n    return isDefinedAndNotNull(value) && (isDefined(value.textValue) || isDefined(value.value));\r\n}\r\n\r\n","import * as Cesium from 'cesium';\r\nimport { DirectGeometryObject, Feature } from 'geojson';\r\n\r\nimport { isBoolean, isDefined, isNumber, isString } from '../../../common/types';\r\nimport { SIMPLE_STYLE_DEFAULTS, SimpleStyle } from '../../../common/geojson-simple-style';\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// SimpleStyle\r\n\r\nexport interface CesiumSimpleStyle {\r\n    markerSymbol?: string;\r\n    markerColor?: Cesium.Color;\r\n    markerSize?: number;\r\n    markerCanvas?: HTMLCanvasElement;\r\n    stroke?: Cesium.Color;\r\n    strokeWidth?: number;\r\n    fill?: Cesium.Color;\r\n    title?: string;\r\n    description?: string;\r\n}\r\n\r\nconst MARKER_SIZE_SMALL = 24;\r\nconst MARKER_SIZE_MEDIUM = 48;\r\nconst MARKER_SIZE_LARGE = 64;\r\n\r\nconst MARKER_SIZES = {\r\n    small: MARKER_SIZE_SMALL,\r\n    medium: MARKER_SIZE_MEDIUM,\r\n    large: MARKER_SIZE_LARGE,\r\n};\r\n\r\nexport function simpleStyleToCesium(style: SimpleStyle, defaults?: SimpleStyle): CesiumSimpleStyle {\r\n    const cStyle: CesiumSimpleStyle = {};\r\n\r\n    if (isString(style.stroke) || isNumber(style.strokeOpacity) || isNumber(style.strokeWidth)) {\r\n        const stroke = getString('stroke', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        let color = Cesium.Color.fromCssColorString(stroke);\r\n        const strokeWidth = getNumber('strokeWidth', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        const strokeOpacity = getNumber('strokeOpacity', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        if (strokeOpacity >= 0.0 && strokeOpacity < 1.0) {\r\n            color = Cesium.Color.fromAlpha(color, strokeOpacity);\r\n        }\r\n        cStyle.stroke = color;\r\n        cStyle.strokeWidth = strokeWidth;\r\n    }\r\n\r\n    if (isString(style.fill) || isNumber(style.fillOpacity)) {\r\n        const fill = getString('fill', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        let color = Cesium.Color.fromCssColorString(fill);\r\n        const fillOpacity = getNumber('fillOpacity', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        if (fillOpacity >= 0.0 && fillOpacity < 1.0) {\r\n            color = Cesium.Color.fromAlpha(color, fillOpacity);\r\n        }\r\n        cStyle.fill = color;\r\n    }\r\n\r\n    if (isString(style.markerSymbol) || isString(style.markerColor) || isString(style.markerSize)) {\r\n        const markerSymbol = getString('markerSymbol', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        const markerColor = getString('markerColor', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        const markerSize = getString('markerSize', style, defaults, SIMPLE_STYLE_DEFAULTS);\r\n        const color = Cesium.Color.fromCssColorString(markerColor);\r\n        const size = MARKER_SIZES[markerSize] || MARKER_SIZE_MEDIUM;\r\n        const pinBuilder = new Cesium.PinBuilder();\r\n        if (markerSymbol === '') {\r\n            cStyle.markerCanvas = pinBuilder.fromColor(color, size);\r\n        } else if (markerSymbol.length === 1) {\r\n            cStyle.markerSymbol = markerSymbol;\r\n            cStyle.markerCanvas = pinBuilder.fromText(markerSymbol, color, size);\r\n        } else {\r\n            cStyle.markerSymbol = markerSymbol;\r\n            Promise.resolve(pinBuilder.fromMakiIconId(markerSymbol, color, size)).then((markerCanvas) => {\r\n                cStyle.markerCanvas = markerCanvas;\r\n            });\r\n        }\r\n        cStyle.markerSize = size;\r\n        cStyle.markerColor = color;\r\n    }\r\n\r\n    if (isString(style.title)) {\r\n        cStyle.title = style.title;\r\n    }\r\n\r\n    if (isString(style.description)) {\r\n        cStyle.description = style.description;\r\n    }\r\n\r\n    return cStyle;\r\n}\r\n\r\nexport function entityToSimpleStyle(entity: Cesium.Entity | null): SimpleStyle | null {\r\n    if (!entity) {\r\n        return null;\r\n    } else if (entity.point) {\r\n        return pointGraphicsToSimpleStyle(entity.point);\r\n    } else if (entity.billboard) {\r\n        return billboardGraphicsToSimpleStyle(entity.billboard);\r\n    } else if (entity.label) {\r\n        return labelGraphicsToSimpleStyle(entity.label);\r\n    } else if (entity.polyline) {\r\n        return polylineGraphicsToSimpleStyle(entity.polyline);\r\n    } else if (entity.polygon) {\r\n        return polygonGraphicsToSimpleStyle(entity.polygon);\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function applyStyleToEntityCollection(style: CesiumSimpleStyle, entities: Cesium.Entity[]): void {\r\n    for (let entity of entities) {\r\n        applyStyleToEntity(style, entity);\r\n    }\r\n}\r\n\r\nexport function applyStyleToEntity(style: CesiumSimpleStyle, entity: Cesium.Entity): void {\r\n    if (entity.point) {\r\n        const point = entity.point;\r\n        if (isDefined(style.markerColor)) {\r\n            point.color = new Cesium.ConstantProperty(style.markerColor);\r\n        }\r\n        if (isNumber(style.markerSize)) {\r\n            point.pixelSize = new Cesium.ConstantProperty(16 * (style.markerSize / MARKER_SIZE_SMALL));\r\n        }\r\n    } else if (entity.billboard) {\r\n        const billboard = entity.billboard;\r\n        if (isDefined(style.markerCanvas)) {\r\n            billboard.image = new Cesium.ConstantProperty(style.markerCanvas);\r\n        } else {\r\n            if (isDefined(style.markerColor)) {\r\n                billboard.color = new Cesium.ConstantProperty(style.markerColor);\r\n            }\r\n            if (isNumber(style.markerSize)) {\r\n                billboard.scale = new Cesium.ConstantProperty(style.markerSize / MARKER_SIZE_MEDIUM);\r\n            }\r\n        }\r\n    } else if (entity.label) {\r\n        const label = entity.label;\r\n        if (isDefined(style.title)) {\r\n            label.text = new Cesium.ConstantProperty(style.title);\r\n        }\r\n        if (isDefined(style.markerColor)) {\r\n            label.fillColor = new Cesium.ConstantProperty(style.markerColor);\r\n        }\r\n        if (isNumber(style.markerSize)) {\r\n            label.scale = new Cesium.ConstantProperty(style.markerSize / MARKER_SIZE_MEDIUM);\r\n        }\r\n    } else if (entity.polyline) {\r\n        const polyline = entity.polyline;\r\n        if (isDefined(style.stroke)) {\r\n            polyline.material = new Cesium.ColorMaterialProperty(style.stroke);\r\n        }\r\n        if (isNumber(style.strokeWidth)) {\r\n            polyline.width = new Cesium.ConstantProperty(style.strokeWidth);\r\n        }\r\n    } else if (entity.polygon) {\r\n        const polygon = entity.polygon;\r\n        if (isDefined(style.fill)) {\r\n            polygon.material = new Cesium.ColorMaterialProperty(style.fill);\r\n        }\r\n        if (isDefined(style.stroke)) {\r\n            polygon.outlineColor = new Cesium.ConstantProperty(style.stroke);\r\n        }\r\n        if (isNumber(style.strokeWidth)) {\r\n            polygon.outlineWidth = new Cesium.ConstantProperty(style.strokeWidth);\r\n        }\r\n    }\r\n}\r\n\r\nfunction colorToHexString(value: number): string {\r\n    if (value <= 0) {\r\n        return '00';\r\n    } else if (value >= 1) {\r\n        return 'ff';\r\n    } else {\r\n        const v = Math.floor(255.9999 * value);\r\n        if (v <= 0) {\r\n            return '00';\r\n        } else if (v >= 255) {\r\n            return 'ff';\r\n        } else if (v < 16) {\r\n            return '0' + v.toString(16);\r\n        } else {\r\n            return v.toString(16);\r\n        }\r\n    }\r\n}\r\n\r\nfunction rgbToCssColor(r: number, g: number, b: number): string {\r\n    const rs = colorToHexString(r);\r\n    const gs = colorToHexString(g);\r\n    const bs = colorToHexString(b);\r\n    return '#' + rs + gs + bs;\r\n}\r\n\r\nfunction pointGraphicsToSimpleStyle(point: Cesium.PointGraphics): SimpleStyle {\r\n    const now = Cesium.JulianDate.now();\r\n    const outlineColor = point.outlineColor;\r\n    const outlineWidth = point.outlineWidth;\r\n    const pixelSize = point.pixelSize;\r\n    const color = point.color;\r\n    let markerSize: 'small' | 'medium' | 'large';\r\n    let markerColor: string;\r\n    let markerSymbol: string;\r\n    let stroke: string;\r\n    let strokeWidth: number;\r\n    if (isDefined(pixelSize)) {\r\n        const pixelSizeValue = pixelSize.getValue(now);\r\n        if (pixelSizeValue <= MARKER_SIZE_SMALL) {\r\n            markerSize = 'small';\r\n        } else if (pixelSizeValue <= MARKER_SIZE_MEDIUM) {\r\n            markerSize = 'medium';\r\n        } else {\r\n            markerSize = 'large';\r\n        }\r\n    }\r\n    if (isDefined(color)) {\r\n        const colorValue = color.getValue(now);\r\n        markerColor = rgbToCssColor(colorValue.red, colorValue.green, colorValue.blue);\r\n    }\r\n    if (isDefined(outlineColor)) {\r\n        const colorValue = outlineColor.getValue(now);\r\n        stroke = rgbToCssColor(colorValue.red, colorValue.green, colorValue.blue);\r\n    }\r\n    if (isDefined(outlineWidth)) {\r\n        strokeWidth = outlineWidth.getValue(now);\r\n    }\r\n    return {\r\n        markerSize,\r\n        markerColor,\r\n        markerSymbol,\r\n        stroke,\r\n        strokeWidth,\r\n    };\r\n}\r\n\r\nfunction billboardGraphicsToSimpleStyle(point: Cesium.BillboardGraphics): SimpleStyle {\r\n    const now = Cesium.JulianDate.now();\r\n    const image = point.image;\r\n    const scale = point.scale;\r\n    const color = point.color;\r\n    let markerSymbol: string;\r\n    let markerSize: 'small' | 'medium' | 'large';\r\n    let markerColor: string;\r\n    if (isDefined(image)) {\r\n        const imageValue = image.getValue(now);\r\n        if (isString(imageValue)) {\r\n            markerSymbol = imageValue;\r\n        }\r\n    }\r\n    if (isDefined(scale)) {\r\n        const scaleValue = scale.getValue(now);\r\n        if (scaleValue < 1) {\r\n            markerSize = 'small';\r\n        } else if (scaleValue < 2) {\r\n            markerSize = 'medium';\r\n        } else {\r\n            markerSize = 'large';\r\n        }\r\n    }\r\n    if (isDefined(color)) {\r\n        const colorValue = color.getValue(now);\r\n        markerColor = rgbToCssColor(colorValue.red, colorValue.green, colorValue.blue);\r\n    }\r\n    return {\r\n        markerSymbol,\r\n        markerSize,\r\n        markerColor,\r\n    };\r\n}\r\n\r\nfunction labelGraphicsToSimpleStyle(point: Cesium.LabelGraphics): SimpleStyle {\r\n    const now = Cesium.JulianDate.now();\r\n    const text = point.text && point.text.getValue(now);\r\n    const scale = point.scale && point.scale.getValue(now);\r\n    const fillColor = point.fillColor && point.fillColor.getValue(now);\r\n    let title: string;\r\n    let markerSize: 'small' | 'medium' | 'large';\r\n    let markerColor: string;\r\n    if (isString(text)) {\r\n        title = text;\r\n    }\r\n    if (isNumber(scale)) {\r\n        if (scale < 1) {\r\n            markerSize = 'small';\r\n        } else if (scale < 2) {\r\n            markerSize = 'medium';\r\n        } else {\r\n            markerSize = 'large';\r\n        }\r\n    }\r\n    if (isDefined(fillColor)) {\r\n        markerColor = rgbToCssColor(fillColor.red, fillColor.green, fillColor.blue);\r\n    }\r\n    return {\r\n        title,\r\n        markerSize,\r\n        markerColor,\r\n    };\r\n}\r\n\r\nfunction polylineGraphicsToSimpleStyle(polyline: Cesium.PolylineGraphics): SimpleStyle {\r\n    const now = Cesium.JulianDate.now();\r\n    const width = polyline.width && polyline.width.getValue(now);\r\n    const material = polyline.material && polyline.material.getValue(now);\r\n    const color = material && material.color;\r\n    let stroke: string;\r\n    let strokeOpacity: number;\r\n    let strokeWidth: number;\r\n\r\n    if (isDefined(width)) {\r\n        strokeWidth = width;\r\n    }\r\n    if (isDefined(color)) {\r\n        stroke = rgbToCssColor(color.red, color.green, color.blue);\r\n        strokeOpacity = color.alpha;\r\n    }\r\n    return {\r\n        stroke,\r\n        strokeOpacity,\r\n        strokeWidth\r\n    };\r\n}\r\n\r\nfunction polygonGraphicsToSimpleStyle(polygon: Cesium.PolygonGraphics): SimpleStyle {\r\n    const now = Cesium.JulianDate.now();\r\n    const isFilled = polygon.fill && polygon.fill.getValue(now);\r\n    const material = polygon.material && polygon.material.getValue(now);\r\n    const color = material && material.color;\r\n    const isOutlined = polygon.outline && polygon.outline.getValue(now);\r\n    const outlineColor = polygon.outlineColor && polygon.outlineColor.getValue(now);\r\n    const outlineWidth = polygon.outlineWidth && polygon.outlineWidth.getValue(now);\r\n    let stroke: string;\r\n    let strokeOpacity: number;\r\n    let strokeWidth: number;\r\n    let fill: string;\r\n    let fillOpacity: number;\r\n\r\n    if (isDefined(color)) {\r\n        fill = rgbToCssColor(color.red, color.green, color.blue);\r\n        fillOpacity = color.alpha;\r\n    } else {\r\n        fill = SIMPLE_STYLE_DEFAULTS.fill;\r\n        fillOpacity = SIMPLE_STYLE_DEFAULTS.fillOpacity;\r\n    }\r\n    if (isBoolean(isFilled) && !Boolean(isFilled)) {\r\n        fillOpacity = 0;\r\n    }\r\n\r\n    if (isDefined(outlineColor)) {\r\n        stroke = rgbToCssColor(outlineColor.red, outlineColor.green, outlineColor.blue);\r\n        strokeOpacity = outlineColor.alpha;\r\n    }\r\n    if (isDefined(isOutlined) && !outlineColor) {\r\n        strokeOpacity = 0;\r\n    }\r\n    if (isDefined(outlineWidth)) {\r\n        strokeWidth = outlineWidth;\r\n    }\r\n\r\n    return {\r\n        fill,\r\n        fillOpacity,\r\n        stroke,\r\n        strokeOpacity,\r\n        strokeWidth\r\n    };\r\n}\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Geometry WKT\r\n\r\nexport function entityToGeoJson(entity: Cesium.Entity | null, id: string, properties: any): Feature<any> | null {\r\n    if (!entity) {\r\n        return null;\r\n    }\r\n\r\n    if (entity.position) {\r\n        const p = Cesium.Cartographic.fromCartesian(entity.position.getValue(Cesium.JulianDate.now()));\r\n        const coordinates = [Cesium.Math.toDegrees(p.longitude), Cesium.Math.toDegrees(p.latitude)];\r\n        return _entityToGeoJson(entity, id, properties, {\r\n            type: 'Point',\r\n            coordinates\r\n        });\r\n    }\r\n\r\n    if (entity.polyline) {\r\n        const positions = entity.polyline.positions.getValue(Cesium.JulianDate.now());\r\n        let coordinates = [];\r\n        for (let position of positions) {\r\n            const p = Cesium.Cartographic.fromCartesian(position);\r\n            coordinates.push([Cesium.Math.toDegrees(p.longitude), Cesium.Math.toDegrees(p.latitude)]);\r\n        }\r\n        return _entityToGeoJson(entity, id, properties, {\r\n            type: 'LineString',\r\n            coordinates\r\n        });\r\n    }\r\n\r\n    if (entity.polygon) {\r\n        const hierarchy = entity.polygon.hierarchy.getValue(Cesium.JulianDate.now());\r\n        const positions = hierarchy.positions || hierarchy;\r\n        const holes = hierarchy.holes;\r\n        if (holes && holes.length) {\r\n            throw new Error('entityToGeoJson() does not yet support polygons with holes');\r\n        }\r\n        let ring = [];\r\n        for (let position of positions) {\r\n            const p = Cesium.Cartographic.fromCartesian(position);\r\n            ring.push([Cesium.Math.toDegrees(p.longitude), Cesium.Math.toDegrees(p.latitude)]);\r\n        }\r\n        ring.push([ring[0][0], ring[0][1]]);\r\n        const coordinates = [ring];\r\n        return _entityToGeoJson(entity, id, properties, {\r\n            type: 'Polygon',\r\n            coordinates\r\n        });\r\n    }\r\n\r\n    throw new Error(`entityToGeoJson() called with unsupported entity: ${entity.toString()}`);\r\n}\r\n\r\nexport function _entityToGeoJson(entity: Cesium.Entity, id: string | undefined, properties: any, geometry: DirectGeometryObject): Feature<any> | null {\r\n    id = id || entity.id.toString();\r\n    //const properties = {...featurePropertiesFromSimpleStyle(entityToSimpleStyle(entity))};\r\n    return {type: 'Feature', id, geometry, properties};\r\n}\r\n\r\n\r\nexport function entityToGeometryWkt(entity: Cesium.Entity): string {\r\n\r\n    if (entity.polyline) {\r\n        const positions = entity.polyline.positions.getValue(Cesium.JulianDate.now());\r\n        return `LINESTRING (${cartesian3ArrayToWkt(positions)})`;\r\n    }\r\n\r\n    if (entity.polygon) {\r\n        const hierarchy = entity.polygon.hierarchy.getValue(Cesium.JulianDate.now());\r\n        const positions = hierarchy.positions;\r\n        const holes = hierarchy.holes;\r\n        const exterior = cartesian3ArrayToWktArray(positions);\r\n        if (exterior.length > 2) {\r\n            exterior.push(exterior[0]);\r\n        }\r\n        const linearRings = [`(${exterior.join(', ')})`];\r\n        if (holes && holes.length) {\r\n            for (let hole of holes) {\r\n                const interior = cartesian3ArrayToWktArray(hole.positions);\r\n                if (interior.length > 2) {\r\n                    interior.push(interior[0]);\r\n                }\r\n                linearRings.push(`(${interior.join(', ')})`);\r\n            }\r\n        }\r\n        return `POLYGON (${linearRings.join(', ')})`;\r\n    }\r\n\r\n    if (entity.rectangle) {\r\n        const coordinates = entity.rectangle.coordinates.getValue(Cesium.JulianDate.now());\r\n        const x1 = toDeg(coordinates.west);\r\n        const y1 = toDeg(coordinates.south);\r\n        const x2 = toDeg(coordinates.east);\r\n        const y2 = toDeg(coordinates.north);\r\n        return `POLYGON ((${x1} ${y1}, ${x2} ${y1}, ${x2} ${y2}, ${x1} ${y2}, ${x1} ${y1}))`;\r\n    }\r\n\r\n    if (entity.position) {\r\n        const position = entity.position.getValue(Cesium.JulianDate.now());\r\n        return `POINT (${cartesian3ToWkt(position)})`\r\n    }\r\n\r\n    throw new TypeError('can\\'t understand geometry of selected entity');\r\n}\r\n\r\nexport function canvasToCartographic(viewer: Cesium.Viewer,\r\n                                     canvasPos: Cesium.Cartesian2 | undefined,\r\n                                     degrees: boolean): Cesium.Cartographic | undefined {\r\n    let cartographic;\r\n    if (canvasPos) {\r\n        const ellipsoid = viewer.scene.globe.ellipsoid;\r\n        const cartesian = viewer.camera.pickEllipsoid(canvasPos, ellipsoid);\r\n        if (cartesian) {\r\n            cartographic = ellipsoid.cartesianToCartographic(cartesian);\r\n            if (cartographic && degrees) {\r\n                const factor = 10000.;\r\n                const longitude = Math.round(factor * Cesium.Math.toDegrees(cartographic.longitude)) / factor;\r\n                const latitude = Math.round(factor * Cesium.Math.toDegrees(cartographic.latitude)) / factor;\r\n                cartographic = {longitude, latitude, height: cartographic.height};\r\n            }\r\n        }\r\n    }\r\n    return cartographic;\r\n}\r\n\r\nexport function clientToCanvas(viewer: Cesium.Viewer,\r\n                               clientPos: Cesium.Cartesian2 | undefined): Cesium.Cartesian2 | undefined {\r\n    let canvasPos;\r\n    if (clientPos) {\r\n        const rect = viewer.canvas.getBoundingClientRect();\r\n        const x = clientPos.x;\r\n        const y = clientPos.y;\r\n        if ((x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom)) {\r\n            canvasPos = new Cesium.Cartesian2(x - rect.left, y - rect.top);\r\n        }\r\n    }\r\n    return canvasPos;\r\n}\r\n\r\nexport function pickEntity(viewer: Cesium.Viewer,\r\n                           canvasPos: Cesium.Cartesian2 | undefined): Cesium.Entity | undefined {\r\n    if (canvasPos) {\r\n        const pickedObject = viewer.scene.pick(canvasPos);\r\n        return pickedObject && pickedObject.id;\r\n    }\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Base maps\r\n\r\n/**\r\n * BaseMapOptions consists basically of properties to create an instance of Cesium.UrlTemplateImageryProvider.\r\n * See https://cesium.com/docs/cesiumjs-ref-doc/UrlTemplateImageryProvider.html.\r\n */\r\nexport interface BaseMapOptions {\r\n    url: string;\r\n    tilingScheme?: 'Geographic' | 'WebMercator';\r\n    credit?: string;\r\n    minimumLevel?: number;\r\n    maximumLevel?: number;\r\n    ellipsoid?: { x?: number, y?: number, z?: number };\r\n}\r\n\r\nexport function setViewerBaseMap(viewer: Cesium.Viewer, baseMapOptions: BaseMapOptions | null) {\r\n    let bgMapImageryProvider;\r\n    if (baseMapOptions === null) {\r\n        bgMapImageryProvider = Cesium.createWorldImagery();\r\n    } else {\r\n        const tilingScheme = baseMapOptions.tilingScheme === 'Geographic'\r\n                             ? new Cesium.GeographicTilingScheme()\r\n                             : new Cesium.WebMercatorTilingScheme();\r\n        const ellipsoid = baseMapOptions.ellipsoid && new Cesium.Ellipsoid(baseMapOptions.ellipsoid.x,\r\n                                                                           baseMapOptions.ellipsoid.y,\r\n                                                                           baseMapOptions.ellipsoid.z);\r\n        bgMapImageryProvider = new Cesium.UrlTemplateImageryProvider(\r\n            {\r\n                url: baseMapOptions.url,\r\n                tilingScheme,\r\n                ellipsoid,\r\n                credit: baseMapOptions.credit,\r\n                minimumLevel: baseMapOptions.minimumLevel,\r\n                maximumLevel: baseMapOptions.maximumLevel,\r\n            });\r\n    }\r\n    if (viewer.imageryLayers.length > 0) {\r\n        const oldLayer = viewer.imageryLayers.get(0);\r\n        viewer.imageryLayers.remove(oldLayer);\r\n    }\r\n    viewer.imageryLayers.add(new Cesium.ImageryLayer(bgMapImageryProvider), 0);\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Helpers\r\n\r\nexport function getEntityByEntityId(viewer: Cesium.Viewer, entityId: string): Cesium.Entity | null {\r\n    for (let i = 0; i < viewer.dataSources.length; i++) {\r\n        const dataSource = viewer.dataSources.get(i);\r\n        const entity = dataSource.entities.getById(entityId);\r\n        if (entity) {\r\n            return entity;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction cartesian3ArrayToWktArray(positions: Cesium.Cartesian3[]): string[] {\r\n    return positions.map(p => cartesian3ToWkt(p));\r\n}\r\n\r\nfunction cartesian3ArrayToWkt(positions: Cesium.Cartesian3[]): string {\r\n    return cartesian3ArrayToWktArray(positions).join(', ');\r\n}\r\n\r\nfunction cartesian3ToWkt(position: Cesium.Cartesian3): string {\r\n    const cartographic = Cesium.Cartographic.fromCartesian(position);\r\n    return `${toDeg(cartographic.longitude)} ${toDeg(cartographic.latitude)}`;\r\n}\r\n\r\nfunction toDeg(x: number): number {\r\n    return x * (180. / Math.PI);\r\n}\r\n\r\nfunction _getValue(key: string, predicate: (object: any) => boolean, objects: any[]) {\r\n    for (let o of objects) {\r\n        if (o) {\r\n            const v = o[key];\r\n            if (predicate(v)) {\r\n                return v;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getNumber(key, ...objects) {\r\n    return _getValue(key, isNumber, objects);\r\n}\r\n\r\nfunction getString(key, ...objects) {\r\n    return _getValue(key, isString, objects);\r\n}\r\n","import { isDefined } from './types';\r\n\r\n/**\r\n * GeoJSON \"standard\" for styling geospatial data that can be shared across clients.\r\n * See https://github.com/mapbox/simplestyle-spec/tree/master/1.1.0\r\n */\r\nexport interface SimpleStyle {\r\n    // OPTIONAL: default \"\"\r\n    // A title to show when this item is clicked or\r\n    // hovered over\r\n    readonly title?: string;\r\n\r\n    // OPTIONAL: default \"\"\r\n    // A description to show when this item is clicked or\r\n    // hovered over\r\n    readonly description?: string;\r\n\r\n    // OPTIONAL: default \"medium\"\r\n    // specify the size of the marker. sizes\r\n    // can be different pixel sizes in different\r\n    // implementations\r\n    // Value must be one of\r\n    // \"small\"\r\n    // \"medium\"\r\n    // \"large\"\r\n    readonly markerSize?: 'small' | 'medium' | 'large';\r\n\r\n    // OPTIONAL: default \"\"\r\n    // a symbol to position in the center of this icon\r\n    // if not provided or \"\"; no symbol is overlaid\r\n    // and only the marker is shown\r\n    // Allowed values include\r\n    // - Icon ID\r\n    // - An integer 0 through 9\r\n    // - A lowercase character \"a\" through \"z\"\r\n    readonly markerSymbol?: string;\r\n\r\n    // OPTIONAL: default \"7e7e7e\"\r\n    // the marker's color\r\n    //\r\n    // value must follow COLOR RULES\r\n    readonly markerColor?: string;\r\n\r\n    // OPTIONAL: default \"555555\"\r\n    // the color of a line as part of a polygon; polyline; or\r\n    // multigeometry\r\n    //\r\n    // value must follow COLOR RULES\r\n    readonly stroke?: string;\r\n\r\n    // OPTIONAL: default 1.0\r\n    // the opacity of the line component of a polygon; polyline; or\r\n    // multigeometry\r\n    //\r\n    // value must be a floating point number greater than or equal to\r\n    // zero and less or equal to than one\r\n    readonly strokeOpacity?: number;\r\n\r\n    // OPTIONAL: default 2\r\n    // the width of the line component of a polygon; polyline; or\r\n    // multigeometry\r\n    //\r\n    // value must be a floating point number greater than or equal to 0\r\n    readonly strokeWidth?: number;\r\n\r\n    // OPTIONAL: default \"555555\"\r\n    // the color of the interior of a polygon\r\n    //\r\n    // value must follow COLOR RULES\r\n    readonly fill?: string;\r\n\r\n    // OPTIONAL: default 0.6\r\n    // the opacity of the interior of a polygon. Implementations\r\n    // may choose to set this to 0 for line features.\r\n    //\r\n    // value must be a floating point number greater than or equal to\r\n    // zero and less or equal to than one\r\n    readonly fillOpacity?: number;\r\n}\r\n\r\n/**\r\n * GeoJSON \"standard\" for styling geospatial data that can be shared across clients.\r\n * See https://github.com/mapbox/simplestyle-spec/tree/master/1.1.0\r\n */\r\nexport const SIMPLE_STYLE_DEFAULTS: SimpleStyle = {\r\n    title: '',\r\n    description: '',\r\n    markerSize: 'medium',\r\n    markerSymbol: '',\r\n    markerColor: '#7e7e7e',\r\n    stroke: '#555555',\r\n    strokeOpacity: 1,\r\n    strokeWidth: 2,\r\n    fill: '#555555',\r\n    fillOpacity: 0.6\r\n};\r\n\r\nexport function simpleStyleFromFeatureProperties(properties: any): SimpleStyle {\r\n    const styleProperties = {\r\n        title: properties['title'],\r\n        description: properties['description'],\r\n        markerSymbol: properties['marker-symbol'],\r\n        markerSize: properties['marker-size'],\r\n        markerColor: properties['marker-color'],\r\n        stroke: properties['stroke'],\r\n        strokeOpacity: properties['stroke-opacity'],\r\n        strokeWidth: properties['stroke-width'],\r\n        fill: properties['fill'],\r\n        fillOpacity: properties['fill-opacity'],\r\n    };\r\n\r\n    const simpleStyle = {};\r\n    for (let p of Object.getOwnPropertyNames(styleProperties)) {\r\n        if (isDefined(styleProperties[p])) {\r\n            simpleStyle[p] = styleProperties[p];\r\n        }\r\n    }\r\n\r\n    return simpleStyle;\r\n}\r\n\r\nexport function featurePropertiesFromSimpleStyle(style: SimpleStyle): any {\r\n    const styleProperties = {\r\n        'title': style.title,\r\n        'description': style.description,\r\n        'marker-symbol': style.markerSymbol,\r\n        'marker-size': style.markerSize,\r\n        'marker-color': style.markerColor,\r\n        'stroke': style.stroke,\r\n        'stroke-opacity': style.strokeOpacity,\r\n        'stroke-width': style.strokeWidth,\r\n        'fill': style.fill,\r\n        'fill-opacity': style.fillOpacity,\r\n    };\r\n\r\n    const properties = {};\r\n    for (let p of Object.getOwnPropertyNames(styleProperties)) {\r\n        if (isDefined(styleProperties[p])) {\r\n            properties[p] = styleProperties[p];\r\n        }\r\n    }\r\n\r\n    return properties;\r\n}\r\n","/**\r\n * Used to parse users' text inputs into normalized paths and to format normalized paths into user text outputs.\r\n * Values are according to output of Python's platform.system() call.\r\n */\r\nexport type HostOS = 'Windows' | 'Linux' | 'Java';\r\n\r\n\r\nexport function isAbsolutePath(path: string, hostOS?: HostOS) {\r\n    if (hostOS === 'Windows') {\r\n        return isWindowsRootPath(path) || isLinuxRootPath(path);\r\n    } else {\r\n        return isLinuxRootPath(path);\r\n    }\r\n}\r\n\r\nexport function isLinuxRootPath(path: string): boolean {\r\n    return path.startsWith('/');\r\n}\r\n\r\nexport function isWindowsRootPath(path: string): boolean {\r\n    return isWindowsNetworkDevicePath(path) || isWindowsDrivePath(path);\r\n}\r\n\r\nexport function isWindowsNetworkDevicePath(path: string): boolean {\r\n    return path.startsWith('//') || path.startsWith('\\\\\\\\');\r\n}\r\n\r\nexport function isWindowsDrivePath(path: string): boolean {\r\n    return path.length >= 2\r\n           && /^[a-z]+$/i.test(path[0])\r\n           && path[1] === ':'\r\n           && (path.length === 2 || path[2] === '/' || path[2] === '\\\\');\r\n}\r\n\r\n/**\r\n * Make `path2` absolute with respect to absolute (directory) path `path1`.\r\n * `path1` must be absolute and `path2` must be relative, otherwise the\r\n * result is not defined.\r\n *\r\n * @param path1 first absolute path\r\n * @param path2 second relative path\r\n * @param hostOS host OS identifier\r\n * @returns `path1` relative to `path2`.\r\n */\r\nexport function makeAbsolutePath(path1: string, path2: string, hostOS?: HostOS): string {\r\n    let comps1 = splitPath(path1, hostOS);\r\n    let comps2 = splitPath(path2, hostOS);\r\n    if (comps1.length > 0 && comps1[comps1.length - 1] === '') {\r\n        comps1 = comps1.slice(0, comps1.length - 1);\r\n    }\r\n    if (comps2.length > 0 && comps2[0] === '') {\r\n        comps2 = comps2.slice(1);\r\n    }\r\n    return joinPathComponents(normPathComponents(comps1.concat(comps2)), hostOS);\r\n}\r\n\r\n/**\r\n * Make `path1` relative to another (directory) path `path2`.\r\n * Both paths must be either relative or absolute, otherwise the\r\n * result is not defined.\r\n *\r\n * @param path1 first path\r\n * @param path2 second path\r\n * @param hostOS host OS identifier\r\n * @returns `path1` relative to `path2`.\r\n */\r\nexport function makeRelativePath(path1: string, path2: string, hostOS?: HostOS): string {\r\n    if (path1 === '' || path1 === path2) {\r\n        return \"\";\r\n    }\r\n    const comps1 = splitPath(path1, hostOS);\r\n    const comps2 = splitPath(path2, hostOS);\r\n    let n1 = comps1.length;\r\n    let n2 = comps2.length;\r\n    let n = Math.max(n1, n2);\r\n    let iFirstDiff = Math.min(n1, n2);\r\n    for (let i = 0; i < n; i++) {\r\n        if (i < n1 && i < n2) {\r\n            let comp1 = comps1[i];\r\n            let comp2 = comps2[i];\r\n            if (comp1 !== comp2) {\r\n                iFirstDiff = i;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    if (iFirstDiff === n) {\r\n        return '';\r\n    }\r\n    let relPathComps: string[];\r\n    if (n2 > iFirstDiff) {\r\n        relPathComps = new Array<string>(n2 - iFirstDiff).fill('..');\r\n    } else {\r\n        relPathComps = [];\r\n    }\r\n    if (n1 > iFirstDiff) {\r\n        relPathComps = relPathComps.concat(comps1.slice(iFirstDiff));\r\n    }\r\n    return relPathComps.join('/');\r\n}\r\n\r\n/**\r\n * Normalizes `path`. Removes '.', '..', end trailing file separators.\r\n * @param path the path\r\n * @param hostOS host OS identifier\r\n * @returns a normalized path\r\n */\r\nexport function normPath(path: string, hostOS?: HostOS): string {\r\n    return joinPathComponents(normPathComponents(splitPath(path, hostOS), hostOS));\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\n/**\r\n * Normalizes path `components`. Removes '.', '..', end trailing empty strings.\r\n * @param components the path components\r\n * @param hostOS host OS identifier\r\n * @returns a normalized path components\r\n */\r\nexport function normPathComponents(components: string[], hostOS?: HostOS): string[] {\r\n    const newComponents = Array<string>(components.length);\r\n    let insPos = 0;\r\n    for (let i = 0; i < components.length; i++) {\r\n        const component = components[i];\r\n        if (component === '.') {\r\n            // No-op\r\n        } else if (component === '..') {\r\n            insPos--;\r\n        } else {\r\n            if (insPos < 0) {\r\n                // Cannot normalize\r\n                return components;\r\n            }\r\n            newComponents[insPos] = component;\r\n            insPos++;\r\n        }\r\n    }\r\n    if (insPos < 0) {\r\n        // Cannot normalize\r\n        return components;\r\n    }\r\n    return newComponents.slice(0, insPos);\r\n}\r\n\r\n/**\r\n * Join path components.\r\n * @param components the path components\r\n * @param hostOS host OS identifier\r\n * @returns a path\r\n */\r\nexport function joinPathComponents(components: string[], hostOS?: HostOS): string {\r\n    return components.join(hostOS === 'Windows' ? '\\\\' : '/');\r\n}\r\n\r\n/**\r\n * Split path into path components.\r\n * @param path a path\r\n * @param hostOS host OS identifier\r\n * @returns the path's components\r\n */\r\nexport function splitPath(path: string, hostOS?: HostOS): string[] {\r\n    if (hostOS === 'Windows') {\r\n        if (isWindowsNetworkDevicePath(path) || isWindowsDrivePath(path)) {\r\n            const components = splitPath(path.substring(2));\r\n            if (components.length === 0) {\r\n                return components;\r\n            }\r\n            return [path.substr(0, 2) + components[0]].concat(components.slice(1));\r\n        }\r\n        return path.split(/[/\\\\]/);\r\n    }\r\n    return path.split('/');\r\n}\r\n\r\n/**\r\n * Get the parent dir of path `path`.\r\n * @param path a path\r\n * @param hostOS host OS identifier\r\n * @returns the path's parent path\r\n */\r\nexport function getParentPath(path: string, hostOS?: HostOS): string {\r\n    const components = splitPath(path, hostOS);\r\n    return components.length > 0\r\n           ? joinPathComponents(components.slice(0, components.length - 1), hostOS)\r\n           : '';\r\n}\r\n\r\n/**\r\n * Get the basename of `path`.\r\n * @param path a path\r\n * @param hostOS host OS identifier\r\n * @returns the path's basename\r\n */\r\nexport function getBasename(path: string, hostOS?: HostOS): string {\r\n    const components = splitPath(path, hostOS);\r\n    return components.length > 0\r\n           ? components[components.length - 1]\r\n           : path;\r\n}\r\n\r\n/**\r\n * Get filename extension\r\n * @param basename the filename (a name, not a path!)\r\n */\r\nexport function getBasenameExtension(basename: string): string {\r\n    const index = basename.lastIndexOf('.');\r\n    if (index > 0) {\r\n        return basename.substring(index + 1);\r\n    }\r\n    return '';\r\n}","import { IconName } from '@blueprintjs/core';\r\nimport { Feature, FeatureCollection, GeoJsonObject, Point } from 'geojson';\r\nimport { JSONSchema7 } from 'json-schema';\r\n\r\nimport { SimpleStyle } from '../common/geojson-simple-style';\r\nimport { HostOS } from '../common/paths';\r\nimport { BaseMapOptions } from './components/cesium/cesium-util';\r\nimport { GeometryToolType } from './components/cesium/geometry-tool';\r\nimport { FileNode } from './components/desktop/fs/FileNode';\r\nimport {\r\n    FileFilter,\r\n    MessageBoxOptions,\r\n    MessageBoxResult, OpenDialogOptions, OpenDialogProperty,\r\n    OpenDialogResult,\r\n    SaveDialogOptions, SaveDialogProperty,\r\n    SaveDialogResult\r\n} from './components/desktop/types';\r\nimport { PanelContainerLayout } from './components/PanelContainer';\r\nimport { ViewLayoutState, ViewState } from './components/ViewState';\r\nimport { JobFailure, JobProgress, JobStatus, WebAPIClient } from './webapi';\r\n\r\n\r\n/**\r\n * Interface describing Cate's application state structure.\r\n * Cate's application state is a giant, structured, plain JavaScript object.\r\n *\r\n * It is modelled after the principles explained in http://jamesknelson.com/5-types-react-application-state/.\r\n *\r\n * @author Norman Fomferra\r\n */\r\n\r\nexport interface State {\r\n    data: DataState;\r\n    communication: CommunicationState;\r\n    control: ControlState;\r\n    session: SessionState;\r\n    location: LocationState;\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// DataState\r\n\r\n/**\r\n * Cate's domain data which is usually received from the Cate WebAPI service.\r\n */\r\nexport interface DataState {\r\n    dataStores: DataStoreState[] | null;\r\n    operations: OperationState[] | null;\r\n    workspace: WorkspaceState | null;\r\n    fsRootNode: FileNode;\r\n    colorMaps: ColorMapCategoryState[] | null;\r\n    baseMaps: BaseMapState[];\r\n    workspaceNames: string[] | null;\r\n    hasWebGL: boolean;\r\n}\r\n\r\nexport type WebAPIStatus = 'login' | 'launching' | 'connecting' | 'open' |\r\n    'error' | 'closed' | 'shuttingDown' | 'loggingOut';\r\n\r\nexport interface WebAPIServiceInfo {\r\n    name: string;\r\n    version: string;\r\n    timestamp: string;\r\n    userRootMode: boolean;\r\n    hostOS?: HostOS;\r\n    dependencies?: {[packageName: string]: string};\r\n    autoStopInfo?: WebAPIAutoStopInfo;\r\n}\r\n\r\nexport interface WebAPIAutoStopInfo {\r\n    // Configured auto-stop time in seconds\r\n    availableTime: number;\r\n    // Duration in seconds of service inactivity\r\n    inactivityTime: number;\r\n    // Duration in seconds remaining until service auto-stop\r\n    remainingTime: number;\r\n}\r\n\r\nexport interface HubStatus {\r\n    status: \"ok\" | \"offline\";\r\n    message?: string;\r\n    deployment: \"development\" | \"production\";\r\n}\r\n\r\nexport interface DataStoreNotice {\r\n    id: string;\r\n    title: string;\r\n    content: string;\r\n    icon: IconName | null;\r\n    intent: string | null;\r\n}\r\n\r\nexport interface DataStoreState {\r\n    id: string;\r\n    title: string | null;\r\n    isLocal: boolean;\r\n    description: string | null;\r\n    notices: DataStoreNotice[] | null;\r\n    dataSources?: DataSourceState[] | null;\r\n}\r\n\r\nexport type DataSourceCapability =\r\n    \"open\"\r\n    | \"write_zarr\"\r\n    | \"constrain_time\"\r\n    | \"constrain_region\";\r\n\r\n\r\nexport interface DatasetDescriptor {\r\n    data_id: string;\r\n    data_type: string;\r\n    crs?: string;\r\n    bbox?: [number, number, number, number];\r\n    spatial_res?: number;\r\n    time_range?: [string | null, string | null];\r\n    time_period?: string;\r\n    data_vars?: VariableDescriptor[];\r\n    coords?: VariableDescriptor[];\r\n    abstract?: string;\r\n    catalog_url?: string;\r\n    catalogue_url?: string;\r\n    cci_project?: string;\r\n    info_url?: string;\r\n    licences?: [string];\r\n    title?: string;\r\n    uuid?: string;\r\n    // Anything else:\r\n    // [attr_name: string]: any;\r\n}\r\n\r\nexport interface VariableDescriptor {\r\n    name: string;\r\n    units?: string;\r\n    long_name?: string;\r\n    standard_name?: string;\r\n    dims?: string[];\r\n}\r\n\r\n// TODO: (forman) use this in the future instead of DatasetDescriptor/VariableDescriptor\r\n// {{{{{{{{{{{{\r\n\r\nexport interface DataDescriptor2 {\r\n    data_id: string;\r\n    data_type: string;\r\n    crs?: string | null;\r\n    bbox?: [number, number, number, number] | null;\r\n    time_range?: [string | null, string | null] | null;\r\n    time_period?: string | null;\r\n    open_params_schema?: JSONSchema7 | null;\r\n}\r\n\r\nexport interface GeoDataFrameDescriptor2 extends DataDescriptor2 {\r\n}\r\n\r\nexport interface DatasetDescriptor2 extends DataDescriptor2 {\r\n    spatial_res?: number | null;\r\n    dims?: { [dim_name: string]: number } | null;\r\n    coords?: { [var_name: string]: VariableDescriptor2 } | null;\r\n    data_vars?: { [var_name: string]: VariableDescriptor2 } | null;\r\n    attrs?: { [attr_name: string]: any } | null;\r\n}\r\n\r\nexport interface VariableDescriptor2 {\r\n    name: string;\r\n    dtype: string;\r\n    dims: string[];\r\n    chunks?: number[] | null;\r\n    attrs?: { [attr_name: string]: any } | null;\r\n}\r\n\r\n// }}}}}}}}}}}}\r\n\r\n\r\nexport interface DataSourceState {\r\n    id: string;\r\n    title?: string;\r\n    // TODO: (forman) replace by descriptor in the future\r\n    metaInfo?: DatasetDescriptor;\r\n    metaInfoStatus: 'init' | 'loading' | 'ok' | 'error';\r\n    // TODO: (forman) use this in the future instead of metaInfo\r\n    // descriptor?: DatasetDescriptor2 | GeoDataFrameDescriptor2;\r\n    // descriptorStatus: 'init' | 'loading' | 'ok' | 'error';\r\n    dataType?: string | null;\r\n    capabilities?: DataSourceCapability[] | null;\r\n    temporalCoverage?: [string, string] | null;\r\n}\r\n\r\nexport interface OperationState {\r\n    name: string;\r\n    qualifiedName: string;\r\n    hasMonitor: boolean;\r\n    description: string | null;\r\n    tags: Array<string>;\r\n    inputs: OperationInputState[];\r\n    outputs: OperationOutputState[];\r\n}\r\n\r\nexport interface OperationIOBaseState {\r\n    name: string;\r\n    dataType: string;\r\n    description: string | null;\r\n    units?: string | null;\r\n}\r\n\r\nexport interface OperationInputState extends OperationIOBaseState {\r\n    /* optional properties used mainly for validation */\r\n    defaultValue?: any;\r\n    nullable?: boolean;\r\n    valueSet?: any[];\r\n    valueSetSource?: string;\r\n    valueRange?: [number, number] | [string, string];\r\n    scriptLang?: string;\r\n    fileOpenMode?: 'w' | 'r' | 'rw';\r\n    fileFilters?: FileFilter[];\r\n    fileProps?: OpenDialogProperty[] | SaveDialogProperty[];\r\n    noUI?: boolean;\r\n    password?: boolean;\r\n}\r\n\r\nexport interface OperationOutputState extends OperationIOBaseState {\r\n}\r\n\r\n/**\r\n * An operation argument that refers to a constant value.\r\n */\r\nexport interface OperationArgumentValue {\r\n    value: any;\r\n}\r\n\r\n/**\r\n * An operation argument that refers to another resource.\r\n */\r\nexport interface OperationArgumentSource {\r\n    /**\r\n     * Resource name. May later also use syntax \"<resource>.<outputName>\" or \"<resource>[<variableName>]\".\r\n     */\r\n    source: string;\r\n}\r\n\r\n/**\r\n * Operation argument.\r\n */\r\nexport type OperationArg = OperationArgumentValue | OperationArgumentSource;\r\n\r\n/**\r\n * Positional operation argument list.\r\n */\r\n//export type OperationArgs = OperationArg[];\r\n\r\n/**\r\n * Non-positional operation keyword-arguments.\r\n */\r\nexport type OperationKWArgs = { [name: string]: OperationArg };\r\n\r\n/**\r\n * IMPORTANT: WorkspaceState must reflect what is returned by cate.core.workspace.Workspace.to_json_dict()\r\n */\r\nexport interface WorkspaceState {\r\n    /**\r\n     * The workspace's base directory path.\r\n     */\r\n    baseDir: string;\r\n    /**\r\n     * The workspace's description.\r\n     */\r\n    description: string | null;\r\n    /**\r\n     * Is it a scratch workspace? Scratch workspaces must be saved-as to some real location.\r\n     */\r\n    isScratch: boolean;\r\n    /**\r\n     * Has it been modified since it has been created, opened, or saved?\r\n     */\r\n    isModified: boolean;\r\n    /**\r\n     * Has it been saved before?\r\n     */\r\n    isSaved: boolean;\r\n    /**\r\n     * The workflow and its steps.\r\n     */\r\n    workflow: WorkflowState;\r\n    /**\r\n     * Information about the resources\r\n     */\r\n    resources: ResourceState[];\r\n}\r\n\r\n/**\r\n * IMPORTANT: WorkflowState must reflect what is returned by cate.core.workflow.Workflow.to_json_dict()\r\n */\r\nexport interface WorkflowState {\r\n    steps: WorkflowStepState[];\r\n}\r\n\r\n/**\r\n * IMPORTANT: WorkflowStepState must reflect what is returned by cate.core.workflow.Step.to_json_dict()\r\n */\r\nexport interface WorkflowStepState {\r\n    /**\r\n     * Step ID. The ID will be used as Workspace's resource name.\r\n     */\r\n    id: string;\r\n\r\n    /**\r\n     * Step type (not used yet).\r\n     */\r\n    type: 'operation' | 'workflow' | 'python-expression' | 'python-script' | 'executable';\r\n\r\n    /**\r\n     * The actual action to be performed. Allowed values depend on 'type'.\r\n     * For example, 'op' is the operation's name, if type===\"operation\".\r\n     */\r\n    op: string;\r\n\r\n    /**\r\n     * Whether the step stores resource files for faster opening of workspaces.\r\n     */\r\n    persistent?: boolean;\r\n\r\n    inputs: { [name: string]: WorkflowPortState & string };\r\n    outputs: { [name: string]: WorkflowPortState & string };\r\n}\r\n\r\n/**\r\n * IMPORTANT: WorkflowStepState must reflect what is returned by cate.core.workflow.NodePort.to_json_dict()\r\n */\r\nexport interface WorkflowPortState {\r\n    /**\r\n     * A constant value.\r\n     * Constraint: value!==undefined, if sourceRef===null.\r\n     */\r\n    value: any | undefined;\r\n    /**\r\n     * Reference to a step which provides the value of this port.\r\n     * Constraint: sourceRef!==null, if value===undefined.\r\n     *\r\n     * Source reference can either be the ID of another (single-output) step or it can have the form\r\n     * \"stepId.outputPort\" if it refers to specific output of a (multi-output) step.\r\n     */\r\n    source: string | null;\r\n}\r\n\r\nexport type DimSizes = { [dimName: string]: number };\r\nexport type Attributes = { [attrName: string]: any };\r\n\r\n// TODO (forman): harmonize ResourceState + VariableState, in the end\r\n//                1. ResourceState is-a VariableState\r\n//                2. ResourceState has-zero-or-more VariableStates\r\n//                3. VariableState also has a path name\r\n\r\n/**\r\n * IMPORTANT: ResourceState must reflect what is returned by cate.core.workspace.Workspace.to_json_dict()\r\n */\r\nexport interface ResourceState {\r\n    id: number;\r\n    updateCount: number;\r\n    name: string;\r\n    dataType: string;\r\n    dimSizes?: DimSizes;\r\n    units?: string;\r\n    validMin?: number;\r\n    validMax?: number;\r\n    attributes?: Attributes;\r\n    variables?: VariableState[];\r\n    coordVariables?: VariableState[];\r\n}\r\n\r\n/**\r\n * IMPORTANT: VariableState must reflect what is returned by cate.core.workspace.Workspace.to_json_dict()\r\n */\r\nexport interface VariableState {\r\n    name: string;\r\n    dataType: string;\r\n    numDims?: number;\r\n    dimNames?: string[];\r\n    shape?: number[];\r\n    chunkSizes?: number[];\r\n    units?: string;\r\n    validMin?: number;\r\n    validMax?: number;\r\n    data?: any[];\r\n    attributes?: Attributes;\r\n    isCoord?: boolean;\r\n    isDefault?: boolean;\r\n    imageLayout?: ImageLayout;\r\n    isFeatureAttribute?: boolean;\r\n    isYFlipped?: boolean;\r\n    colorMapName?: string;\r\n    displayMin?: number;\r\n    displayMax?: number;\r\n    // Only given, if variable is scalar, see issue #702\r\n    value?: number | string | boolean;\r\n}\r\n\r\n/**\r\n * Image layout for use with Cesium and OpenLayers.\r\n */\r\nexport interface ImageLayout {\r\n    extent?: {\r\n        /** The westernmost longitude, in radians, in the range [-Pi, Pi]. */\r\n        west: number,\r\n        /** The southernmost latitude, in radians, in the range [-Pi/2, Pi/2]. */\r\n        south: number,\r\n        /** The easternmost longitude, in radians, in the range [-Pi, Pi]. */\r\n        east: number,\r\n        /** The northernmost latitude, in radians, in the range [-Pi/2, Pi/2]. */\r\n        north: number\r\n    };\r\n    ellipsoid?: {\r\n        /** The radius in the x direction. */\r\n        x: number;\r\n        /** The radius in the y direction. */\r\n        y: number;\r\n        /** The radius in the z direction. */\r\n        z: number;\r\n    };\r\n    numLevels: number;\r\n    numLevelZeroTilesX: number;\r\n    numLevelZeroTilesY: number;\r\n    tileWidth: number;\r\n    tileHeight: number;\r\n}\r\n\r\nexport type WorldViewMode = '2D' | '3D';\r\n\r\n/**\r\n * Data object for view type \"world\".\r\n */\r\nexport interface WorldViewDataState {\r\n    /**\r\n     * 2D map or 3D globe?\r\n     */\r\n    viewMode: WorldViewMode;\r\n\r\n    /**\r\n     * ID of the base map, see state.data.baseMaps.\r\n     */\r\n    baseMapId: string;\r\n\r\n    /**\r\n     * Code of the projection used by the 2D map.\r\n     */\r\n    projectionCode: string;\r\n\r\n    /**\r\n     * The layers in a viewer.\r\n     */\r\n    layers: LayerState[];\r\n\r\n    /**\r\n     * The ID of the selected layer.\r\n     */\r\n    selectedLayerId: string | null;\r\n\r\n    /**\r\n     * The ID of the selected entity in Cesium 3D globe.\r\n     */\r\n    selectedEntityId: string | null;\r\n\r\n    /**\r\n     * The position of a layer split. Must be in the range 0 to 1.\r\n     */\r\n    layerSplitPosition;\r\n}\r\n\r\nexport interface FigureViewDataState {\r\n    /**\r\n     * The resource identifier.\r\n     */\r\n    resourceId: number;\r\n    /**\r\n     * Whether the figure has a fixed size or it adapts to the current container size.\r\n     */\r\n    fixedSize: boolean;\r\n}\r\n\r\nexport interface AnimationViewDataState extends FigureViewDataState {\r\n    /**\r\n     * The HTML representing the animation.\r\n     */\r\n    innerHTML?: string;\r\n    /**\r\n     * The response status.\r\n     */\r\n    status?: number;\r\n}\r\n\r\n\r\nexport interface TableViewDataState {\r\n    resName: string;\r\n    varName: string | null;\r\n    dataRows: any[] | null;\r\n    error?: any;\r\n    isLoading?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * State of a layer.\r\n */\r\nexport interface LayerState {\r\n    /**\r\n     * Layer ID.\r\n     */\r\n    id: string;\r\n\r\n    /**\r\n     * Layer type\r\n     */\r\n    type: 'VariableImage' | 'ResourceVector' | 'Image' | 'Vector' | 'Unknown';\r\n\r\n    /**\r\n     * Layer name.\r\n     */\r\n    name?: string | null;\r\n\r\n    /**\r\n     * True if the layer is visible and shown; otherwise, false.\r\n     */\r\n    visible: boolean;\r\n\r\n    /**\r\n     * The layer's opacity.\r\n     */\r\n    opacity?: number;\r\n}\r\n\r\nexport interface ImageStatisticsState {\r\n    /**\r\n     * The true minimum value in the current data subset.\r\n     */\r\n    min: number;\r\n\r\n    /**\r\n     * The true maximum value in the current data subset.\r\n     */\r\n    max: number;\r\n}\r\n\r\nexport const SPLIT_MODE_OFF = 'off';\r\nexport const SPLIT_MODE_LEFT = 'left';\r\nexport const SPLIT_MODE_RIGHT = 'right';\r\nexport type SplitMode = 'off' | 'left' | 'right';\r\n\r\n\r\n/**\r\n * Base of image layers.\r\n */\r\nexport interface ImageLayerBase extends LayerState {\r\n    /**\r\n     * The brightness of this layer. 1.0 uses the unmodified imagery color.\r\n     * Less than 1.0 makes the imagery darker while greater than 1.0 makes it brighter.\r\n     */\r\n    brightness: number;\r\n\r\n    /**\r\n     * The contrast of this layer. 1.0 uses the unmodified imagery color.\r\n     * Less than 1.0 reduces the contrast while greater than 1.0 increases it.\r\n     */\r\n    contrast: number;\r\n\r\n    /**\r\n     * The hue of this layer. 0.0 uses the unmodified imagery color.\r\n     */\r\n    hue: number;\r\n\r\n    /**\r\n     * The saturation of this layer. 1.0 uses the unmodified imagery color.\r\n     * Less than 1.0 reduces the saturation while greater than 1.0 increases it.\r\n     */\r\n    saturation: number;\r\n\r\n    /**\r\n     * The gamma correction to apply to this layer. 1.0 uses the unmodified imagery color.\r\n     */\r\n    gamma: number;\r\n\r\n    /**\r\n     * Split mode.\r\n     */\r\n    splitMode: SplitMode;\r\n}\r\n\r\n/**\r\n * State of an image layer.\r\n */\r\nexport interface ImageLayerState extends ImageLayerBase {\r\n    /**\r\n     * The layer type.\r\n     */\r\n    type: 'Image';\r\n}\r\n\r\n/**\r\n * Base of vector layers.\r\n */\r\nexport interface VectorLayerBase extends LayerState {\r\n    /**\r\n     * Stores the default style for all entities of the layer.\r\n     */\r\n    style?: SimpleStyle;\r\n\r\n    /**\r\n     * Stores the style and any edited entities.\r\n     * This object will only contain keys, if an entities style has changed.\r\n     * Default styles come from the SimpleStyle interface of VectorLayerBase.\r\n     */\r\n    entityStyles?: { [entityId: string]: SimpleStyle };\r\n}\r\n\r\n\r\n/**\r\n * State of a vector layer.\r\n */\r\nexport interface VectorLayerState extends VectorLayerBase {\r\n    /**\r\n     * The layer type.\r\n     */\r\n    type: 'Vector';\r\n\r\n    /**\r\n     * The (GeoJSON-providing) URL or GeoJSON object.\r\n     */\r\n    data: string | GeoJsonObject;\r\n}\r\n\r\n/**\r\n * Resource reference\r\n */\r\nexport interface ResourceRefState {\r\n    /**\r\n     * The id of the resource that contains the variable.\r\n     */\r\n    resId: number;\r\n}\r\n\r\n/**\r\n * Variable reference\r\n */\r\nexport interface VariableRefState extends ResourceRefState {\r\n    /**\r\n     * The name of the variable.\r\n     */\r\n    varName: string;\r\n}\r\n\r\n/**\r\n * Variable data reference\r\n */\r\nexport interface VariableDataRefState extends VariableRefState {\r\n    /**\r\n     * The current index into the variable that results in a 2D-subset (i.e. with dimensions ['lat', 'lon']).\r\n     */\r\n    varIndex: number[];\r\n}\r\n\r\n/**\r\n * State of an image layer that displays a variable.\r\n */\r\nexport interface VariableLayerBase extends LayerState, VariableDataRefState {\r\n    /**\r\n     * Image layer minimum display value.\r\n     */\r\n    displayMin: number;\r\n    /**\r\n     * Image layer maximum display value.\r\n     */\r\n    displayMax: number;\r\n    /**\r\n     * Image layer color map name.\r\n     */\r\n    colorMapName: string;\r\n    /**\r\n     * Whether to blend alpha 0...1 at bottom value range.\r\n     */\r\n    alphaBlending: boolean;\r\n    /**\r\n     * Image enhancement attributes.\r\n     */\r\n    statistics?: ImageStatisticsState;\r\n}\r\n\r\n/**\r\n * State of an image layer that displays a variable.\r\n */\r\nexport interface VariableImageLayerState extends ImageLayerBase, VariableLayerBase {\r\n    /**\r\n     * The layer type.\r\n     */\r\n    type: 'VariableImage';\r\n}\r\n\r\n/**\r\n * State of an image layer that displays a variable.\r\n */\r\nexport interface ResourceVectorLayerState extends VectorLayerBase, ResourceRefState {\r\n    /**\r\n     * The layer type.\r\n     */\r\n    type: 'ResourceVector';\r\n}\r\n\r\n/**\r\n * An object comprising the resource and one of its variables which can be represented as a spatial 2D layer.\r\n */\r\nexport class LayerVariableState {\r\n    /**\r\n     * The resource.\r\n     */\r\n    resource: ResourceState;\r\n    /**\r\n     * A spatial 2D variable within the resource.\r\n     */\r\n    variable: VariableState;\r\n}\r\n\r\nexport interface BaseMapState {\r\n    id: string;\r\n    title: string;\r\n    options: BaseMapOptions | null;\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// ColorMapState\r\n\r\n\r\nexport interface ColorMapState {\r\n    name: string;\r\n    imageData: string;\r\n}\r\n\r\nexport interface ColorMapCategoryState {\r\n    name: string;\r\n    description: string;\r\n    colorMaps: ColorMapState[];\r\n}\r\n\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// CommunicationState\r\n\r\n/**\r\n * Communication state is the status of any not-yet-complete requests to other services.\r\n */\r\nexport interface CommunicationState {\r\n    webAPIServiceURL: string;\r\n    webAPIServiceInfo: WebAPIServiceInfo | null;\r\n    webAPIStatus: WebAPIStatus | null;\r\n    webAPIClient: WebAPIClient | null;\r\n    // A map that stores the current state of any tasks (e.g. data fetch jobs from remote API) given a jobId\r\n    tasks: { [jobId: number]: TaskState; };\r\n}\r\n\r\nexport interface TaskState {\r\n    title?: string;\r\n    status: JobStatus;\r\n    failure?: JobFailure;\r\n    progress?: JobProgress;\r\n    requestLock?: string;\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// ControlState\r\n\r\n\r\n/**\r\n * Control State is state which is specific to a given container component, and which is not stored in the screen’s\r\n * URL or in the HTML5 History API.\r\n */\r\nexport interface ControlState {\r\n\r\n    // TODO (forman): Move following selection properties into SessionState so they can be stored.\r\n    // WorkspacePanel\r\n    selectedWorkspaceResourceName: string | null;\r\n    selectedWorkflowStepId: string | null;\r\n    // VariablesPanel\r\n    selectedVariableName: string | null;\r\n\r\n    selectedCtxOperationName: string | null;\r\n\r\n    // A map that stores the last state of any dialog given a dialogId\r\n    dialogs: { [dialogId: string]: DialogState };\r\n\r\n    // Select directory dialog\r\n    directorySelectDialog: OpenDialogState;\r\n    // Open file dialog\r\n    fileOpenDialog: OpenDialogState;\r\n    // Save file dialog\r\n    fileSaveDialog: SaveDialogState;\r\n    // Browse file dialog\r\n    fileBrowseDialog: BrowseDialogState;\r\n    // Message box\r\n    messageBox: MessageBoxState;\r\n\r\n    // Take care, workspace objects come from Python back-end, therefore must preserve view settings.\r\n    viewLayout: ViewLayoutState;\r\n    views: ViewState<any>[];\r\n    activeViewId: string | null;\r\n\r\n    newPlacemarkToolType: GeometryToolType;\r\n\r\n    // Used to force component update after an entity's properties have changed\r\n    entityUpdateCount: number;\r\n}\r\n\r\nexport interface DialogState {\r\n    isOpen?: boolean;\r\n}\r\n\r\nexport interface OpenDialogState extends DialogState {\r\n    onClose: (result: OpenDialogResult) => any;\r\n    options?: OpenDialogOptions;\r\n    result?: OpenDialogResult;\r\n}\r\n\r\nexport interface SaveDialogState extends DialogState {\r\n    onClose: (result: SaveDialogResult) => any;\r\n    options?: SaveDialogOptions;\r\n    result?: SaveDialogResult;\r\n}\r\n\r\nexport interface BrowseDialogState extends DialogState {\r\n    onClose: (result: OpenDialogResult) => any;\r\n    options?: OpenDialogOptions;\r\n}\r\n\r\nexport interface MessageBoxState extends DialogState {\r\n    onClose?: (result: MessageBoxResult | null) => any;\r\n    options?: MessageBoxOptions;\r\n    result?: MessageBoxResult | null;\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// SessionState\r\n\r\nexport type SavedLayers = { [key: string]: LayerState };\r\n\r\n/**\r\n * Backend-configuration settings.\r\n */\r\nexport interface BackendConfigState {\r\n    dataStoresPath: string;\r\n    useWorkspaceImageryCache: boolean;\r\n    resourceNamePattern: string;\r\n    proxyUrl: string;\r\n}\r\n\r\nexport interface Placemark extends Feature<Point> {\r\n    id: string;\r\n}\r\n\r\nexport interface PlacemarkCollection extends FeatureCollection<Point> {\r\n    features: Placemark[];\r\n}\r\n\r\nexport const STYLE_CONTEXT_ENTITY = 'entity';\r\nexport const STYLE_CONTEXT_LAYER = 'layer';\r\n\r\nexport type StyleContext = 'entity' | 'layer';\r\nexport type WorkspacePanelMode = 'resources' | 'steps';\r\n\r\n/**\r\n * Session state contains information about the human being which is currently using Cate.\r\n * Session state is only ever read when a component is mounted.\r\n * Session state can be used to save preferences.\r\n */\r\nexport interface SessionState {\r\n    mainWindowBounds?: { x: number; y: number; width: number; height: number };\r\n    devToolsOpened?: boolean;\r\n    forceAppBar?: boolean;\r\n    /**\r\n     * lastWorkspacePath != null, only if it is not a scratch-workspace\r\n     */\r\n    lastWorkspacePath?: string | null;\r\n    reopenLastWorkspace?: boolean;\r\n    offlineMode: boolean;\r\n    autoUpdateSoftware: boolean;\r\n    autoShowNewFigures: boolean;\r\n\r\n    // AppMainPage\r\n    panelContainerUndockedMode: boolean;\r\n    leftPanelContainerLayout: PanelContainerLayout;\r\n    rightPanelContainerLayout: PanelContainerLayout;\r\n    selectedLeftTopPanelId: string | null;\r\n    selectedLeftBottomPanelId: string | null;\r\n    selectedRightTopPanelId: string | null;\r\n    selectedRightBottomPanelId: string | null;\r\n\r\n    showLayerTextOverlay: boolean;\r\n    debugWorldView: boolean;\r\n\r\n    /**\r\n     * backendConfig settings are applied on restart (of the WebAPI) only.\r\n     */\r\n    backendConfig: BackendConfigState;\r\n\r\n    // DataSourcesPanel\r\n    selectedDataStoreId: string | null;\r\n    selectedDataSourceId: string | null;\r\n    dataSourceFilterExpr: string;\r\n    dataSourceListHeight: number;\r\n    showDataSourceDetails: boolean;\r\n    showAllDataSources: boolean;\r\n    showDataSourceIDs: boolean;\r\n    showDataStoreDescription: boolean;\r\n    showDataStoreNotices: boolean;\r\n\r\n    // OperationsPanel\r\n    selectedOperationName: string | null;\r\n    operationFilterTags: string[];\r\n    operationFilterExpr: string;\r\n    operationListHeight: number;\r\n    showOperationDetails: boolean;\r\n\r\n    // WorkspacePanel\r\n    workspacePanelMode: WorkspacePanelMode;\r\n    resourceListHeight: number;\r\n    showResourceDetails: boolean;\r\n    workflowStepListHeight: number;\r\n    showWorkflowStepDetails: boolean;\r\n\r\n    // VariablePanel\r\n    variableListHeight: number;\r\n    showVariableDetails: boolean;\r\n\r\n    // LayersPanel\r\n    showSelectedVariableLayer: boolean;\r\n    layerListHeight: number;\r\n    showLayerDetails: boolean;\r\n    lastBaseMapId: string;\r\n    savedLayers: SavedLayers;\r\n    styleContext: StyleContext;\r\n\r\n    // PlacemarksPanel\r\n    placemarkCollection: PlacemarkCollection;\r\n    selectedPlacemarkId: string | null;\r\n    placemarkListHeight: number;\r\n    showPlacemarkDetails: boolean;\r\n    defaultPlacemarkStyle: SimpleStyle;\r\n\r\n    // Preferences\r\n    showDependencies?: boolean;\r\n\r\n    // EU GDPR\r\n    cookieConsentObtained: boolean;\r\n    trackingConsentObtained: boolean;\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// LocationState\r\n\r\nexport class GeographicPosition {\r\n    longitude: number;\r\n    latitude: number;\r\n    height?: number;\r\n}\r\n\r\n/**\r\n * Location state stores information about the current location in space and time.\r\n * Information in this object may change frequently, e.g. due to mouse moves on a Globe.\r\n */\r\nexport interface LocationState {\r\n    globeMousePosition: GeographicPosition | null;\r\n    globeViewPosition: GeographicPosition | null;\r\n    positionData: { [varName: string]: number } | null\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// MessageState\r\n\r\nexport interface MessageActionState {\r\n    text: string;\r\n    onClick?: (...actionArgs) => void;\r\n    href?: string;\r\n    icon?: IconName;\r\n}\r\n\r\nexport interface MessageState {\r\n    type: 'info' | 'success' | 'notification' | 'warning' | 'error';\r\n    text: string | JSX.Element;\r\n    action?: MessageActionState;\r\n}\r\n\r\n","import { IActionProps, ILinkProps, Intent, IToaster, Position, Toaster } from '@blueprintjs/core';\r\nimport { MessageState } from './state';\r\n\r\nlet MessageToaster: IToaster | null = null;\r\n\r\nexport function showToast(message: MessageState, timeout?: number) {\r\n\r\n    if (!MessageToaster) {\r\n        MessageToaster = Toaster.create({\r\n                                            className: 'cate-toaster',\r\n                                            position: Position.BOTTOM,\r\n                                        });\r\n    }\r\n\r\n    let icon;\r\n    let intent;\r\n    if (message.type === 'info') {\r\n        icon = 'info-sign';\r\n        intent = Intent.NONE;\r\n        timeout = timeout || 2500;\r\n    } else if (message.type === 'success') {\r\n        icon = 'tick';\r\n        intent = Intent.SUCCESS;\r\n        timeout = timeout || 2500;\r\n    } else if (message.type === 'notification') {\r\n        icon = 'notifications';\r\n        intent = Intent.PRIMARY;\r\n        timeout = timeout || 2500;\r\n    } else if (message.type === 'warning') {\r\n        icon = 'warning-sign';\r\n        intent = Intent.WARNING;\r\n        timeout = timeout || 6000;\r\n    } else if (message.type === 'error') {\r\n        icon = 'error';\r\n        intent = Intent.DANGER;\r\n        timeout = timeout || 10000;\r\n    } else {\r\n        timeout = timeout || 5000;\r\n    }\r\n\r\n    let action: IActionProps & ILinkProps;\r\n    if (message.action) {\r\n        action = {\r\n            onClick: message.action.onClick,\r\n            text: message.action.text,\r\n            icon: message.action.icon,\r\n            href: message.action.href,\r\n            target: message.action.href ? '_blank' : undefined,\r\n        }\r\n    }\r\n\r\n    MessageToaster.show({\r\n                            message: message.text,\r\n                            icon,\r\n                            intent,\r\n                            action,\r\n                            timeout,\r\n                        });\r\n}\r\n","import { IconName } from '@blueprintjs/icons';\r\nimport * as assert from '../../common/assert';\r\n\r\n\r\nexport type SplitDir = 'hor' | 'ver';\r\n\r\nexport type ViewPath = string;\r\n\r\n\r\nexport interface ViewState<T> {\r\n    id: string;\r\n    title: string;\r\n    icon?: IconName;\r\n    /**\r\n     * The view type is used to lookup the renderer for this kind of view, e.g. \"world\".\r\n     */\r\n    type: string;\r\n    /**\r\n     * Type T of 'data' property depends on 'type' property, e.g. if type is \"world\",\r\n     * data may contains a layer list, the selected layer, and a projection code.\r\n     */\r\n    data: T;\r\n}\r\n\r\nexport type ViewRenderer<T> = (view: ViewState<T>) => JSX.Element;\r\n\r\n\r\n/**\r\n * Definition for a panel of views with one visible at a time.\r\n */\r\nexport interface ViewPanelState {\r\n    viewIds: string[];\r\n    selectedViewId: string | null;\r\n}\r\n\r\n/**\r\n * JSON-serializable view viewLayout\r\n */\r\nexport interface ViewSplitState {\r\n    /**\r\n     * First and second panel is either a view panel given by view IDs or another ViewSplitState.\r\n     */\r\n    layouts: [ViewLayoutState, ViewLayoutState];\r\n\r\n    /**\r\n     * Direction is horizontal/vertical.\r\n     */\r\n    dir: SplitDir;\r\n\r\n    /**\r\n     * Horizontal/vertical position of 1st panel in pixels.\r\n     */\r\n    pos: number;\r\n}\r\n\r\nexport type ViewLayoutState = ViewSplitState | ViewPanelState;\r\n\r\n\r\nexport function isViewSplitState(obj: any) {\r\n    return 'layouts' in obj;\r\n}\r\n\r\nexport function isViewPanelState(obj: any) {\r\n    return 'viewIds' in obj;\r\n}\r\n\r\nexport function getViewPanel(viewLayout: ViewLayoutState, viewPath: ViewPath): ViewPanelState {\r\n    return _getViewPanel(viewLayout, viewPath, 0);\r\n}\r\n\r\nexport function findViewPanel(viewLayout: ViewLayoutState,\r\n                              filter: (viewPanel: ViewPanelState) => boolean): ViewPanelState | null {\r\n    if (isViewPanelState(viewLayout)) {\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        return filter && filter(viewPanel) ? viewPanel : null;\r\n    }\r\n    assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n    const viewSplit = viewLayout as ViewSplitState;\r\n    return findViewPanel(viewSplit.layouts[0], filter) || findViewPanel(viewSplit.layouts[1], filter);\r\n}\r\n\r\nexport function findMoveTargetViewIds(viewLayout: ViewLayoutState, sourceViewId: string): { after: string[]; before: string[] } {\r\n    const result = {before: [], after: []};\r\n    _collectMoveTargetViewIds(viewLayout, sourceViewId, result);\r\n    return result;\r\n}\r\n\r\nexport function moveView(viewLayout: ViewLayoutState,\r\n                         sourceViewId: string,\r\n                         placement: 'before' | 'after',\r\n                         targetViewId: string): ViewLayoutState {\r\n    return _moveView(viewLayout, sourceViewId, placement, targetViewId);\r\n}\r\n\r\nexport function addViewToPanel(viewLayout: ViewLayoutState,\r\n                               placeAfterViewId: string,\r\n                               viewId: string): ViewLayoutState {\r\n    return _addViewToPanel(viewLayout, placeAfterViewId, viewId);\r\n}\r\n\r\nexport function addViewToLayout(viewLayout: ViewLayoutState,\r\n                                viewId: string): ViewLayoutState {\r\n    return _addViewToLayout(viewLayout, viewId);\r\n}\r\n\r\nexport function splitViewPanel(viewLayout: ViewLayoutState,\r\n                               viewPath: ViewPath,\r\n                               dir: SplitDir,\r\n                               pos: number): ViewLayoutState {\r\n    return _splitViewPanel(viewLayout, viewPath, dir, pos, 0);\r\n}\r\n\r\nexport function changeViewSplitPos(viewLayout: ViewLayoutState,\r\n                                   viewPath: ViewPath,\r\n                                   delta: number): ViewLayoutState {\r\n    return _changeViewSplitPos(viewLayout, viewPath, delta, 0);\r\n}\r\n\r\nexport function selectViewInLayout(viewLayout: ViewLayoutState,\r\n                                   viewPath: ViewPath,\r\n                                   viewId: string): ViewLayoutState {\r\n    return _selectViewInLayout(viewLayout, viewPath, viewId, 0);\r\n}\r\n\r\nexport function removeViewFromLayout(viewLayout: ViewLayoutState,\r\n                                     viewPath: ViewPath,\r\n                                     viewId: string): ViewLayoutState {\r\n    return _removeViewFromLayout(viewLayout, viewPath, viewId, 0);\r\n}\r\n\r\nexport function removeAllViewsFromLayout(viewLayout: ViewLayoutState,\r\n                                         viewPath: ViewPath) {\r\n    return _removeViewFromLayout(viewLayout, viewPath, null, 0);\r\n}\r\n\r\n// function removeViewFromViewIds(viewIds: string[], viewId: string): string[] {\r\n//     while (true) {\r\n//         const i = viewIds.indexOf(viewId);\r\n//         if (i >= 0) {\r\n//             viewIds = viewIds.slice(0, i).concat(viewIds.slice(i + 1));\r\n//         } else {\r\n//             break;\r\n//         }\r\n//     }\r\n//     return viewIds;\r\n// }\r\n\r\nexport function addViewToViewArray(views: ViewState<any>[], view: ViewState<any>): ViewState<any>[] {\r\n    return views.concat([view]);\r\n}\r\n\r\nexport function removeViewFromViewArray(views: ViewState<any>[], viewId: string): ViewState<any>[] {\r\n    while (true) {\r\n        const i = views.findIndex(w => w.id === viewId);\r\n        if (i >= 0) {\r\n            views = views.slice(0, i).concat(views.slice(i + 1));\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return views;\r\n}\r\n\r\n\r\nfunction _getViewPanel(viewLayout: ViewLayoutState,\r\n                       viewPath: ViewPath,\r\n                       pathIndex: number): ViewPanelState {\r\n    if (isViewPanelState(viewLayout)) {\r\n        return viewLayout as ViewPanelState;\r\n    }\r\n    if (pathIndex < viewPath.length) {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const layoutIndex = viewPath[pathIndex];\r\n        return _getViewPanel(viewSplit.layouts[layoutIndex], viewPath, pathIndex + 1);\r\n    } else {\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\nexport function _moveView(viewLayout: ViewLayoutState,\r\n                          sourceViewId: string,\r\n                          placement: 'before' | 'after',\r\n                          targetViewId: string): ViewLayoutState {\r\n    if (isViewSplitState(viewLayout)) {\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        let oldLayout1 = viewSplit.layouts[0];\r\n        let oldLayout2 = viewSplit.layouts[1];\r\n        let newLayout1 = _moveView(oldLayout1, sourceViewId, placement, targetViewId);\r\n        let newLayout2 = _moveView(oldLayout2, sourceViewId, placement, targetViewId);\r\n        if (oldLayout1 === newLayout1 && oldLayout2 === newLayout2) {\r\n            // no change!\r\n            return viewSplit;\r\n        }\r\n        if (newLayout1 === null) {\r\n            assert.ok(newLayout2);\r\n            return newLayout2;\r\n        }\r\n        if (newLayout2 === null) {\r\n            return newLayout1;\r\n        }\r\n        return {...viewSplit, layouts: [newLayout1, newLayout2]} as ViewSplitState;\r\n    } else {\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        let viewIds = viewPanel.viewIds;\r\n        let selectedViewId = viewPanel.selectedViewId;\r\n\r\n        const sourceViewIndex = viewIds.findIndex(id => id === sourceViewId);\r\n        if (sourceViewIndex >= 0) {\r\n            // remove sourceViewId\r\n            viewIds = viewIds.slice();\r\n            viewIds.splice(sourceViewIndex, 1);\r\n            if (viewIds.length === 0) {\r\n                // sourceViewId was the last one, so close this panel\r\n                return null;\r\n            }\r\n            if (selectedViewId === sourceViewId && viewIds.length) {\r\n                // the removed view was the selected view, select some other view now\r\n                const selectedViewIndex = sourceViewIndex < viewIds.length ? sourceViewIndex : viewIds.length - 1;\r\n                selectedViewId = viewIds[selectedViewIndex];\r\n            }\r\n        }\r\n\r\n        const targetViewIndex = viewIds.findIndex(id => id === targetViewId);\r\n        if (targetViewIndex >= 0) {\r\n            if (placement === 'before') {\r\n                // insert sourceViewId before\r\n                viewIds = viewIds.slice(0, targetViewIndex).concat([sourceViewId].concat(viewIds.slice(targetViewIndex)));\r\n            } else {\r\n                // insert sourceViewId after\r\n                viewIds = viewIds.slice(0, targetViewIndex + 1).concat([sourceViewId].concat(viewIds.slice(targetViewIndex + 1)));\r\n            }\r\n            selectedViewId = sourceViewId;\r\n        }\r\n        if (viewIds !== viewPanel.viewIds) {\r\n            return {viewIds, selectedViewId};\r\n        }\r\n    }\r\n    // no change!\r\n    return viewLayout;\r\n}\r\n\r\n\r\n// TODO (forman): refactor out similar code with _moveViewToPanel()\r\nfunction _addViewToPanel(viewLayout: ViewLayoutState,\r\n                         placeAfterViewId: string,\r\n                         viewId: string): ViewLayoutState {\r\n    if (isViewSplitState(viewLayout)) {\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        let oldLayout1 = viewSplit.layouts[0];\r\n        let oldLayout2 = viewSplit.layouts[1];\r\n        let newLayout1 = _addViewToPanel(oldLayout1, placeAfterViewId, viewId);\r\n        let newLayout2;\r\n        if (oldLayout1 === newLayout1) {\r\n            newLayout2 = _addViewToPanel(oldLayout2, placeAfterViewId, viewId);\r\n        } else {\r\n            newLayout2 = oldLayout2;\r\n        }\r\n        if (oldLayout1 === newLayout1 && oldLayout2 === newLayout2) {\r\n            // no change!\r\n            return viewSplit;\r\n        }\r\n        const layouts = [newLayout1, newLayout2];\r\n        return {...viewSplit, layouts} as ViewSplitState;\r\n    } else {\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        let oldViewIds = viewPanel.viewIds;\r\n        const placeAfterIndex = oldViewIds.findIndex(id => id === placeAfterViewId);\r\n        if (placeAfterIndex < 0) {\r\n            // no change!\r\n            return viewPanel;\r\n        }\r\n        const insertionIndex = placeAfterIndex + 1;\r\n        const viewIds = oldViewIds.slice(0, insertionIndex).concat([viewId].concat(oldViewIds.slice(insertionIndex)));\r\n        return {viewIds, selectedViewId: viewId};\r\n    }\r\n}\r\n\r\n\r\nfunction _addViewToLayout(viewLayout: ViewLayoutState,\r\n                          viewId: string): ViewLayoutState {\r\n    if (isViewSplitState(viewLayout)) {\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const oldLayout = viewSplit.layouts[0];\r\n        const newLayout = _addViewToLayout(oldLayout, viewId);\r\n        const layouts = [newLayout, viewSplit.layouts[1]];\r\n        return {...viewSplit, layouts} as ViewSplitState;\r\n    } else {\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        const viewIds = viewPanel.viewIds.concat([viewId]);\r\n        return {viewIds, selectedViewId: viewId};\r\n    }\r\n}\r\n\r\n\r\nfunction _splitViewPanel(viewLayout: ViewLayoutState,\r\n                         viewPath: ViewPath,\r\n                         dir: SplitDir,\r\n                         pos: number,\r\n                         pathIndex: number): ViewLayoutState {\r\n    assert.ok(pathIndex <= viewPath.length, 'illegal path index');\r\n    if (pathIndex < viewPath.length) {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const layoutIndex = viewPath.charCodeAt(pathIndex) - 48; // 48 = ascii('0')\r\n        const oldLayout = viewSplit.layouts[layoutIndex];\r\n        const newLayout = _splitViewPanel(oldLayout, viewPath, dir, pos, pathIndex + 1);\r\n        let layouts;\r\n        if (layoutIndex === 0) {\r\n            layouts = [newLayout, viewSplit.layouts[1]];\r\n        } else {\r\n            layouts = [viewSplit.layouts[0], newLayout];\r\n        }\r\n        return {...viewSplit, layouts};\r\n    } else {\r\n        assert.ok(isViewPanelState(viewLayout), 'ViewPanelState expected');\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        let viewIds = viewPanel.viewIds;\r\n        assert.ok(viewIds.length > 1, 'ViewPanelState must have more than one view to be split');\r\n        const selectedViewId = viewPanel.selectedViewId;\r\n        let index = viewIds.findIndex(id => id === selectedViewId);\r\n        if (index === viewIds.length - 1) {\r\n            index -= 1;\r\n        }\r\n        assert.ok(index >= 0);\r\n        const viewIds1 = viewIds.slice(0, index + 1);\r\n        const viewIds2 = viewIds.slice(index + 1);\r\n        return {\r\n            dir, pos,\r\n            layouts: [\r\n                {\r\n                    viewIds: viewIds1,\r\n                    selectedViewId: viewIds1[viewIds1.length - 1],\r\n                },\r\n                {\r\n                    viewIds: viewIds2,\r\n                    selectedViewId: viewIds2[0],\r\n                }\r\n            ],\r\n        };\r\n    }\r\n}\r\n\r\nfunction _changeViewSplitPos(viewLayout: ViewLayoutState,\r\n                             viewPath: ViewPath,\r\n                             delta: number,\r\n                             pathIndex: number): ViewLayoutState {\r\n    assert.ok(pathIndex <= viewPath.length, 'illegal path index');\r\n    if (pathIndex < viewPath.length) {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const layoutIndex = viewPath.charCodeAt(pathIndex) - 48; // 48 = ascii('0')\r\n        const oldLayout = viewSplit.layouts[layoutIndex];\r\n        const newLayout = _changeViewSplitPos(oldLayout, viewPath, delta, pathIndex + 1);\r\n        let layouts;\r\n        if (layoutIndex === 0) {\r\n            layouts = [newLayout, viewSplit.layouts[1]];\r\n        } else {\r\n            layouts = [viewSplit.layouts[0], newLayout];\r\n        }\r\n        return {...viewSplit, layouts};\r\n    } else {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        return {...viewSplit, pos: viewSplit.pos + delta};\r\n    }\r\n}\r\n\r\nfunction _selectViewInLayout(viewLayout: ViewLayoutState,\r\n                             viewPath: ViewPath,\r\n                             viewId: string,\r\n                             pathIndex: number): ViewLayoutState {\r\n    assert.ok(pathIndex <= viewPath.length, 'illegal path index');\r\n    if (pathIndex < viewPath.length) {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const layoutIndex = viewPath.charCodeAt(pathIndex) - 48; // 48 = ascii('0')\r\n        const oldLayout = viewSplit.layouts[layoutIndex];\r\n        const newLayout = _selectViewInLayout(oldLayout, viewPath, viewId, pathIndex + 1);\r\n        if (oldLayout === newLayout) {\r\n            // No change!\r\n            return viewSplit;\r\n        }\r\n        let layouts;\r\n        if (layoutIndex === 0) {\r\n            layouts = [newLayout, viewSplit.layouts[1]];\r\n        } else {\r\n            layouts = [viewSplit.layouts[0], newLayout];\r\n        }\r\n        return {...viewSplit, layouts};\r\n    } else {\r\n        assert.ok(isViewPanelState(viewLayout), 'ViewPanelState expected');\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        let viewIds = viewPanel.viewIds;\r\n        if (viewId === viewPanel.selectedViewId) {\r\n            // No change!\r\n            return viewPanel;\r\n        }\r\n        assert.ok(viewIds.indexOf(viewId) >= 0, 'viewId not found');\r\n        return {viewIds: viewIds, selectedViewId: viewId};\r\n    }\r\n}\r\n\r\nexport function selectView(viewLayout: ViewLayoutState, viewId: string): ViewLayoutState {\r\n    if (isViewSplitState(viewLayout)) {\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const oldLayout1 = viewSplit.layouts[0];\r\n        const oldLayout2 = viewSplit.layouts[1];\r\n        const newLayout1 = selectView(oldLayout1, viewId);\r\n        const newLayout2 = selectView(oldLayout2, viewId);\r\n        if (oldLayout1 !== newLayout1 || oldLayout2 !== newLayout2) {\r\n            return {...viewSplit, layouts: [newLayout1, newLayout2]} as ViewSplitState;\r\n        }\r\n    } else {\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        if (viewId !== viewPanel.selectedViewId) {\r\n            const viewIds = viewPanel.viewIds;\r\n            const selectedViewIndex = viewIds.findIndex(id => id === viewId);\r\n            if (selectedViewIndex >= 0) {\r\n                return {viewIds, selectedViewId: viewId};\r\n            }\r\n        }\r\n    }\r\n    // no change\r\n    return viewLayout;\r\n}\r\n\r\n\r\nfunction _removeViewFromLayout(viewLayout: ViewLayoutState,\r\n                               viewPath: ViewPath,\r\n                               viewId: string | null,\r\n                               pathIndex: number): ViewLayoutState {\r\n    assert.ok(pathIndex <= viewPath.length, 'illegal path index');\r\n    if (pathIndex < viewPath.length) {\r\n        assert.ok(isViewSplitState(viewLayout), 'ViewSplitState expected');\r\n        const viewSplit = viewLayout as ViewSplitState;\r\n        const layoutIndex = viewPath.charCodeAt(pathIndex) - 48; // 48 = ascii('0')\r\n        const oldLayout = viewSplit.layouts[layoutIndex];\r\n        const newLayout = _removeViewFromLayout(oldLayout, viewPath, viewId, pathIndex + 1);\r\n        if (oldLayout === newLayout) {\r\n            // No change!\r\n            return viewSplit;\r\n        }\r\n        if (isViewPanelState(newLayout) && (newLayout as ViewPanelState).viewIds.length === 0) {\r\n            // A panel has been returned which is now empty, so return the other panel that is left.\r\n            if (layoutIndex === 0) {\r\n                return viewSplit.layouts[1];\r\n            } else {\r\n                return viewSplit.layouts[0];\r\n            }\r\n        }\r\n\r\n        let layouts;\r\n        if (layoutIndex === 0) {\r\n            layouts = [newLayout, viewSplit.layouts[1]];\r\n        } else {\r\n            layouts = [viewSplit.layouts[0], newLayout];\r\n        }\r\n\r\n        return {...viewSplit, layouts};\r\n    } else {\r\n        assert.ok(isViewPanelState(viewLayout), 'ViewPanelState expected');\r\n        const viewPanel = viewLayout as ViewPanelState;\r\n        if (viewId) {\r\n            let viewIds = viewPanel.viewIds;\r\n            const viewIndex = viewIds.indexOf(viewId);\r\n            if (viewIndex < 0) {\r\n                // No change!\r\n                return viewPanel;\r\n            }\r\n            viewIds = viewIds.slice(0, viewIndex).concat(viewIds.slice(viewIndex + 1));\r\n            let selectedViewId = viewPanel.selectedViewId;\r\n            if (selectedViewId === viewId) {\r\n                selectedViewId = viewIndex > 0 ? viewIds[viewIndex - 1] : viewIndex < viewIds.length ? viewIds[viewIndex] : null;\r\n            }\r\n            return {viewIds, selectedViewId};\r\n        } else {\r\n            return {viewIds: [], selectedViewId: null};\r\n        }\r\n    }\r\n}\r\n\r\nfunction _collectMoveTargetViewIds(viewLayout: ViewLayoutState, sourceViewId: string, result: { after: string[]; before: string[] }) {\r\n    const viewIds = (viewLayout as ViewPanelState).viewIds;\r\n    if (viewIds) {\r\n        let lastViewId = null;\r\n        for (let i = 0; i < viewIds.length; i++) {\r\n            const viewId = viewIds[i];\r\n            if (viewId !== sourceViewId) {\r\n                const nextViewId = i < viewIds.length + 1 ? viewIds[i + 1] : null;\r\n                if (nextViewId === null || nextViewId !== sourceViewId) {\r\n                    result.after.push(viewId);\r\n                }\r\n                if (lastViewId === null || lastViewId !== sourceViewId) {\r\n                    result.before.push(viewId);\r\n                }\r\n            }\r\n            lastViewId = viewId;\r\n        }\r\n    }\r\n    const layouts = (viewLayout as ViewSplitState).layouts;\r\n    if (layouts) {\r\n        for (let layout of layouts) {\r\n            _collectMoveTargetViewIds(layout, sourceViewId, result);\r\n        }\r\n    }\r\n}\r\n","export const NEW_OPERATION_STEP_DIALOG_ID = 'newOperationStepDialog';\r\nexport const NEW_CTX_OPERATION_STEP_DIALOG_ID = 'newCtxOperationStepDialog';\r\nexport const EDIT_OPERATION_STEP_DIALOG_ID = 'editOperationStepDialog';\r\n\r\n","import * as Cookies from 'js-cookie';\r\n\r\nconst C_COOKIE_CONSENT_OBTAINED = 'cookieConsentObtained';\r\nconst C_TRACKING_CONSENT_OBTAINED = 'trackingConsentObtained';\r\n\r\nconst C_ON = '1';\r\nconst C_OFF = '0';\r\nconst C_OPTIONS: Cookies.CookieAttributes = {expires: 365};\r\n\r\n\r\nexport function isCookieConsentObtained() : boolean {\r\n    return Cookies.get(C_COOKIE_CONSENT_OBTAINED) === C_ON;\r\n}\r\n\r\nexport function isTrackingConsentObtained() : boolean {\r\n    return Cookies.get(C_TRACKING_CONSENT_OBTAINED) === C_ON;\r\n}\r\n\r\nexport function storeCookieConsent(trackingConsentObtained: boolean) {\r\n    Cookies.set(C_COOKIE_CONSENT_OBTAINED, C_ON, C_OPTIONS);\r\n    Cookies.set(C_TRACKING_CONSENT_OBTAINED, trackingConsentObtained ? C_ON : C_OFF, C_OPTIONS);\r\n}\r\n","import { isCookieConsentObtained, isTrackingConsentObtained } from './cookies';\r\nimport {\r\n    CommunicationState,\r\n    ControlState,\r\n    DataState,\r\n    LocationState,\r\n    SessionState,\r\n    STYLE_CONTEXT_ENTITY,\r\n    WorldViewDataState\r\n} from './state';\r\nimport { BASE_MAPS, DEFAULT_BASE_MAP_ID, hasWebGL, MY_PLACES_LAYER, newWorldView } from './state-util';\r\nimport { SimpleStyle } from '../common/geojson-simple-style';\r\nimport { ViewState } from './components/ViewState';\r\n\r\n\r\nexport const DEFAULT_SERVICE_URL = 'http://localhost:9090';\r\n\r\nexport const INITIAL_DATA_STATE: DataState = {\r\n    dataStores: null,\r\n    operations: null,\r\n    workspace: null,\r\n    colorMaps: null,\r\n    baseMaps: BASE_MAPS,\r\n    fsRootNode: {name: '', isDir: true, lastModified: '', size: 0},\r\n    workspaceNames: null,\r\n    hasWebGL: hasWebGL(),\r\n};\r\n\r\nconst INITIAL_WORLD_VIEW: ViewState<WorldViewDataState> = newWorldView();\r\n\r\nexport const INITIAL_CONTROL_STATE: ControlState = {\r\n    selectedWorkflowStepId: null,\r\n    selectedWorkspaceResourceName: null,\r\n    selectedVariableName: null,\r\n\r\n    dialogs: {},\r\n    directorySelectDialog: {\r\n        onClose: () => {\r\n        }\r\n    },\r\n    fileOpenDialog: {\r\n        onClose: () => {\r\n        }\r\n    },\r\n    fileSaveDialog: {\r\n        onClose: () => {\r\n        }\r\n    },\r\n    fileBrowseDialog: {\r\n        onClose: () => {\r\n        }\r\n    },\r\n    messageBox: {},\r\n\r\n    selectedCtxOperationName: null,\r\n\r\n    views: [INITIAL_WORLD_VIEW],\r\n    viewLayout: {\r\n        viewIds: [INITIAL_WORLD_VIEW.id],\r\n        selectedViewId: INITIAL_WORLD_VIEW.id,\r\n    },\r\n    activeViewId: INITIAL_WORLD_VIEW.id,\r\n\r\n    newPlacemarkToolType: 'NoTool',\r\n    entityUpdateCount: 0,\r\n};\r\n\r\n\r\nexport const INITIAL_SESSION_STATE: SessionState = {\r\n    reopenLastWorkspace: false,\r\n    lastWorkspacePath: null,\r\n    autoUpdateSoftware: true,\r\n    autoShowNewFigures: true,\r\n    offlineMode: false,\r\n    showSelectedVariableLayer: true,\r\n    savedLayers: {},\r\n\r\n    selectedDataStoreId: null,\r\n    selectedDataSourceId: null,\r\n    dataSourceFilterExpr: '',\r\n    selectedOperationName: null,\r\n    operationFilterTags: [],\r\n    operationFilterExpr: '',\r\n\r\n    dataSourceListHeight: 200,\r\n    showDataSourceDetails: true,\r\n    resourceListHeight: 100,\r\n    showResourceDetails: true,\r\n    workflowStepListHeight: 100,\r\n    showWorkflowStepDetails: true,\r\n    operationListHeight: 200,\r\n    showOperationDetails: true,\r\n    variableListHeight: 200,\r\n    showVariableDetails: true,\r\n    layerListHeight: 160,\r\n    showLayerDetails: true,\r\n    lastBaseMapId: DEFAULT_BASE_MAP_ID,\r\n\r\n    panelContainerUndockedMode: false,\r\n    leftPanelContainerLayout: {horPos: 300, verPos: 400},\r\n    rightPanelContainerLayout: {horPos: 300, verPos: 400},\r\n    selectedLeftTopPanelId: 'dataSources',\r\n    selectedLeftBottomPanelId: 'operations',\r\n    selectedRightTopPanelId: 'workspace',\r\n    selectedRightBottomPanelId: 'variables',\r\n    placemarkCollection: {\r\n        type: 'FeatureCollection',\r\n        features: []\r\n    },\r\n    selectedPlacemarkId: null,\r\n    placemarkListHeight: 160,\r\n    showPlacemarkDetails: true,\r\n    defaultPlacemarkStyle: {...MY_PLACES_LAYER.style} as SimpleStyle,\r\n\r\n    workspacePanelMode: 'steps',\r\n\r\n    showDataStoreDescription: false,\r\n    showDataStoreNotices: true,\r\n    showDataSourceIDs: true,\r\n    showAllDataSources: false,\r\n\r\n    showLayerTextOverlay: true,\r\n    debugWorldView: false,\r\n    styleContext: STYLE_CONTEXT_ENTITY,\r\n\r\n    backendConfig: {\r\n        dataStoresPath: null,\r\n        useWorkspaceImageryCache: false,\r\n        resourceNamePattern: 'res_{index}',\r\n        proxyUrl: null,\r\n    },\r\n\r\n    cookieConsentObtained: isCookieConsentObtained(),\r\n    trackingConsentObtained: isTrackingConsentObtained(),\r\n};\r\n\r\n\r\nexport const INITIAL_COMMUNICATION_STATE: CommunicationState = {\r\n    webAPIServiceURL: DEFAULT_SERVICE_URL,\r\n    webAPIStatus: null,\r\n    webAPIServiceInfo: null,\r\n    webAPIClient: null,\r\n    tasks: {},\r\n};\r\n\r\nexport const INITIAL_LOCATION_STATE: LocationState = {\r\n    globeMousePosition: null,\r\n    globeViewPosition: null,\r\n    positionData: null,\r\n};\r\n\r\n","import { combineReducers, Reducer } from 'redux';\r\nimport deepEqual from 'deep-equal';\r\n\r\nimport * as assert from '../common/assert';\r\nimport { featurePropertiesFromSimpleStyle } from '../common/geojson-simple-style';\r\nimport { updateObject, updatePropertyObject } from '../common/objutil';\r\nimport { isString } from '../common/types';\r\nimport * as actions from './actions';\r\nimport { Action, OBTAIN_COOKIE_CONSENT, UPDATE_FS_ROOT_NODE } from './actions';\r\nimport { updateFileNode } from './components/desktop/fs/FileNode';\r\nimport {\r\n    addViewToLayout,\r\n    addViewToPanel,\r\n    addViewToViewArray,\r\n    changeViewSplitPos,\r\n    findViewPanel,\r\n    getViewPanel,\r\n    moveView,\r\n    removeViewFromLayout,\r\n    removeViewFromViewArray,\r\n    selectView,\r\n    selectViewInLayout,\r\n    splitViewPanel,\r\n    ViewState\r\n} from './components/ViewState';\r\nimport { NEW_CTX_OPERATION_STEP_DIALOG_ID } from './containers/operation-step-dialog-ids';\r\nimport { storeCookieConsent } from './cookies';\r\nimport {\r\n    INITIAL_COMMUNICATION_STATE,\r\n    INITIAL_CONTROL_STATE,\r\n    INITIAL_DATA_STATE,\r\n    INITIAL_LOCATION_STATE,\r\n    INITIAL_SESSION_STATE\r\n} from './initial-state';\r\nimport {\r\n    CommunicationState,\r\n    ControlState, DataSourceState,\r\n    DataState,\r\n    DataStoreState,\r\n    LayerState,\r\n    LocationState,\r\n    SessionState,\r\n    State,\r\n    VectorLayerBase\r\n} from './state';\r\nimport {\r\n    AUTO_LAYER_ID,\r\n    computeDataSourceCapabilities,\r\n    getFigureViewTitle,\r\n    getPlacemarkTitleAndIndex,\r\n    isImageLayer,\r\n    isVectorLayer,\r\n    newAnimationView,\r\n    newFigureView,\r\n    newTableView,\r\n    newWorldView,\r\n    PLACEMARK_ID_PREFIX,\r\n    updateAutoLayer,\r\n} from './state-util';\r\n\r\n\r\n// Note: reducers are unit-tested through actions.spec.ts\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// state.data reducers\r\n\r\nconst updateDataStores = (state: DataState,\r\n                          action: Action,\r\n                          createDataSources: (dataStore: DataStoreState) => DataSourceState[]): DataState => {\r\n    const dataStoreId = action.payload.dataStoreId;\r\n    const dataStoreIndex = state.dataStores.findIndex(dataStore => dataStore.id === dataStoreId);\r\n    if (dataStoreIndex < 0) {\r\n        throw Error('illegal data store ID: ' + dataStoreId);\r\n    }\r\n    const oldDataStore = state.dataStores[dataStoreIndex];\r\n    const newDataStore = {...oldDataStore, dataSources: createDataSources(oldDataStore)};\r\n    const newDataStores = [...state.dataStores];\r\n    newDataStores[dataStoreIndex] = newDataStore;\r\n    return {...state, dataStores: newDataStores};\r\n};\r\n\r\nconst dataReducer = (state: DataState = INITIAL_DATA_STATE, action: Action): DataState => {\r\n    switch (action.type) {\r\n        case actions.UPDATE_WORKSPACE_NAMES: {\r\n            const workspaceNames = action.payload.workspaceNames || null;\r\n            return {...state, workspaceNames};\r\n        }\r\n        case actions.UPDATE_OPERATIONS: {\r\n            const operations = action.payload.operations;\r\n            return {...state, operations};\r\n        }\r\n        case actions.SET_CURRENT_WORKSPACE: {\r\n            const workspace = action.payload.workspace;\r\n            return {...state, workspace};\r\n        }\r\n        case UPDATE_FS_ROOT_NODE: {\r\n            const {path, updatedFileNode} = action.payload;\r\n            const fsRootNode = updateFileNode(state.fsRootNode, path, updatedFileNode);\r\n            return {...state, fsRootNode};\r\n        }\r\n        case actions.UPDATE_COLOR_MAPS: {\r\n            const colorMaps = action.payload.colorMaps;\r\n            return {...state, colorMaps};\r\n        }\r\n        case actions.UPDATE_DATA_STORES: {\r\n            const dataStores = action.payload.dataStores.slice();\r\n            return {...state, dataStores};\r\n        }\r\n        case actions.UPDATE_DATA_SOURCES: {\r\n            return updateDataStores(state, action, () => {\r\n                return action.payload.dataSources.slice();\r\n            });\r\n        }\r\n        case actions.UPDATE_DATA_SOURCE_META_INFO: {\r\n            return updateDataStores(state, action, dataStore => {\r\n                const newDataSources = [...dataStore.dataSources];\r\n                const {dataSourceId, metaInfo, metaInfoStatus} = action.payload;\r\n                const dataSourceIndex = newDataSources.findIndex(dataSource => dataSource.id === dataSourceId);\r\n                if (dataSourceIndex < 0) {\r\n                    throw Error('illegal data source ID: ' + dataSourceId);\r\n                }\r\n                const oldDataSource = newDataSources[dataSourceIndex];\r\n                let newDataSource = {\r\n                    ...oldDataSource,\r\n                    metaInfo,\r\n                    metaInfoStatus,\r\n                };\r\n                let capabilities = newDataSource.capabilities;\r\n                if (!capabilities && metaInfo && metaInfoStatus === 'ok') {\r\n                    capabilities = computeDataSourceCapabilities(newDataSource);\r\n                }\r\n                if (capabilities !== newDataSource.capabilities) {\r\n                    newDataSource = {...newDataSource, capabilities}\r\n                }\r\n                newDataSources[dataSourceIndex] = newDataSource;\r\n                return newDataSources;\r\n            });\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// state.control reducers\r\n\r\nconst controlReducer = (state: ControlState = INITIAL_CONTROL_STATE, action: Action) => {\r\n    switch (action.type) {\r\n        case actions.RENAME_RESOURCE: {\r\n            const resName = action.payload.resName;\r\n            const newResName = action.payload.newResName;\r\n\r\n            // Rename resName in selectedWorkspaceResourceName\r\n            let selectedWorkspaceResourceName = state.selectedWorkspaceResourceName;\r\n            if (selectedWorkspaceResourceName === resName) {\r\n                selectedWorkspaceResourceName = newResName;\r\n            }\r\n\r\n            // Rename resName in views and their layers\r\n            const views = viewsReducer(state.views, action, state.activeViewId);\r\n\r\n            if (selectedWorkspaceResourceName !== state.selectedWorkspaceResourceName\r\n                || views !== state.views) {\r\n                return {...state, selectedWorkspaceResourceName, views};\r\n            }\r\n            return state;\r\n        }\r\n        case actions.UPDATE_ENTITY_STYLE: {\r\n            const views = viewsReducer(state.views, action, state.activeViewId);\r\n            if (views !== state.views) {\r\n                return {...state, views};\r\n            }\r\n            return state;\r\n        }\r\n        case actions.UPDATE_DATA_SOURCES: {\r\n            const dataSources = action.payload.dataSources;\r\n            const selectedDataSourceId = (dataSources && dataSources.length) ? dataSources[0].id : null;\r\n            return {...state, selectedDataSourceId};\r\n        }\r\n        case actions.UPDATE_OPERATIONS: {\r\n            const operations = action.payload.operations;\r\n            const selectedOperationName = (operations && operations.length) ? operations[0].name : null;\r\n            return {...state, selectedOperationName};\r\n        }\r\n        case actions.SET_SELECTED_VARIABLE: {\r\n            const selectedVariable = action.payload.selectedVariable;\r\n            const selectedVariableName = selectedVariable ? selectedVariable.name : null;\r\n            let views = state.views;\r\n            const newViews = viewsReducer(state.views, action, state.activeViewId);\r\n            if (newViews !== views) {\r\n                views = newViews;\r\n            }\r\n            return {...state, selectedVariableName, views};\r\n        }\r\n        case actions.UPDATE_CONTROL_STATE:\r\n            return {...state, ...action.payload};\r\n        case actions.ADD_PLACEMARK:\r\n            return {...state, newPlacemarkToolType: 'NoTool'};\r\n        case actions.ACTIVATE_NEW_PLACEMARK_TOOL: {\r\n            let newPlacemarkToolType = action.payload.newPlacemarkToolType;\r\n            if (newPlacemarkToolType === state.newPlacemarkToolType) {\r\n                newPlacemarkToolType = 'NoTool';\r\n            }\r\n            return {...state, newPlacemarkToolType};\r\n        }\r\n        case actions.UPDATE_DIALOG_STATE: {\r\n            const dialogs = updatePropertyObject(state.dialogs, action.payload.dialogId, action.payload.dialogState);\r\n            return {...state, dialogs};\r\n        }\r\n        case actions.ADD_WORLD_VIEW: {\r\n            const view = newWorldView(action.payload.baseMapId);\r\n            return addView(state, view, action.payload.placeAfterViewId);\r\n        }\r\n        case actions.SHOW_FIGURE_VIEW: {\r\n            const {resource, placeAfterViewId} = action.payload;\r\n            const figureView = state.views.find(v => v.type === 'figure' && resource.id === v.data.resourceId);\r\n            if (figureView) {\r\n                const viewLayout = selectView(state.viewLayout, figureView.id);\r\n                return {...state, viewLayout};\r\n            } else {\r\n                const view = newFigureView(resource);\r\n                return addView(state, view, placeAfterViewId);\r\n            }\r\n        }\r\n        case actions.SHOW_ANIMATION_VIEW: {\r\n            const {resource, placeAfterViewId} = action.payload;\r\n            const animationView = state.views.find(v => v.type === 'animation' && resource.id === v.data.resourceId);\r\n            if (animationView) {\r\n                const viewLayout = selectView(state.viewLayout, animationView.id);\r\n                return {...state, viewLayout};\r\n            } else {\r\n                const view = newAnimationView(resource);\r\n                return addView(state, view, placeAfterViewId);\r\n            }\r\n        }\r\n        case actions.SHOW_TABLE_VIEW: {\r\n            const {resName, varName, placeAfterViewId} = action.payload;\r\n            // TODO: use resource.id, not .name!!!\r\n            const tableView = state.views.find(v => v.type === 'table' && v.data.resName === resName && v.data.varName === varName);\r\n            if (tableView) {\r\n                const viewLayout = selectView(state.viewLayout, tableView.id);\r\n                return {...state, viewLayout};\r\n            } else {\r\n                const view = newTableView(resName, varName);\r\n                return addView(state, view, placeAfterViewId);\r\n            }\r\n        }\r\n        case actions.ADD_TABLE_VIEW: {\r\n            const {placeAfterViewId, resName, varName} = action.payload;\r\n            const view = newTableView(resName, varName);\r\n            return addView(state, view, placeAfterViewId);\r\n        }\r\n        case actions.SELECT_VIEW: {\r\n            const {viewPath, viewId} = action.payload;\r\n            const viewLayout = selectViewInLayout(state.viewLayout, viewPath, viewId);\r\n            return {...state, viewLayout, activeViewId: viewId};\r\n        }\r\n        case actions.MOVE_VIEW: {\r\n            const {sourceViewId, placement, targetViewId} = action.payload;\r\n            const viewLayout = moveView(state.viewLayout, sourceViewId, placement, targetViewId);\r\n            let activeViewId = state.activeViewId;\r\n            if (activeViewId) {\r\n                const containsActiveId = viewPanel => viewPanel.viewIds.indexOf(activeViewId) >= 0;\r\n                const activeViewPanel = findViewPanel(viewLayout, containsActiveId);\r\n                if (activeViewPanel && activeViewPanel.selectedViewId !== activeViewId) {\r\n                    activeViewId = activeViewPanel.selectedViewId;\r\n                }\r\n            }\r\n            return {...state, viewLayout, activeViewId};\r\n        }\r\n        case actions.CLOSE_VIEW: {\r\n            const viewPath = action.payload.viewPath;\r\n            const viewId = action.payload.viewId;\r\n            const views = removeViewFromViewArray(state.views, viewId);\r\n            const viewLayout = removeViewFromLayout(state.viewLayout, viewPath, viewId);\r\n            let activeViewId = state.activeViewId;\r\n            if (activeViewId === viewId) {\r\n                activeViewId = null;\r\n                let viewPanel = getViewPanel(viewLayout, viewPath);\r\n                if (viewPanel && viewPanel.selectedViewId) {\r\n                    activeViewId = viewPanel.selectedViewId;\r\n                } else {\r\n                    viewPanel = findViewPanel(viewLayout, viewPanel => !!viewPanel.selectedViewId);\r\n                    if (viewPanel) {\r\n                        activeViewId = viewPanel.selectedViewId;\r\n                    }\r\n                }\r\n            }\r\n            return {...state, viewLayout, views, activeViewId};\r\n        }\r\n        case actions.SPLIT_VIEW_PANEL: {\r\n            const viewPath = action.payload.viewPath;\r\n            const dir = action.payload.dir;\r\n            const pos = action.payload.pos;\r\n            const viewLayout = splitViewPanel(state.viewLayout, viewPath, dir, pos);\r\n            return {...state, viewLayout};\r\n        }\r\n        case actions.CHANGE_VIEW_SPLIT_POS: {\r\n            const viewPath = action.payload.viewPath;\r\n            const delta = action.payload.delta;\r\n            const viewLayout = changeViewSplitPos(state.viewLayout, viewPath, delta);\r\n            return {...state, viewLayout};\r\n        }\r\n        case actions.INC_ENTITY_UPDATE_COUNT: {\r\n            const entityUpdateCount = state.entityUpdateCount + 1;\r\n            return {...state, entityUpdateCount};\r\n        }\r\n        case actions.INVOKE_CTX_OPERATION: {\r\n            const {selectedCtxOperationName, inputAssignments} = action.payload;\r\n            let dialogState: any = state.dialogs[NEW_CTX_OPERATION_STEP_DIALOG_ID];\r\n            dialogState = {...dialogState, isOpen: true, inputAssignments};\r\n            return {\r\n                ...state,\r\n                selectedCtxOperationName,\r\n                dialogs: {...state.dialogs, [NEW_CTX_OPERATION_STEP_DIALOG_ID]: dialogState}\r\n            };\r\n        }\r\n        case actions.UPDATE_MOUSE_IDLE_STATE: {\r\n            return {...state, ...action.payload};\r\n        }\r\n        case actions.OPEN_MESSAGE_BOX: {\r\n            return {\r\n                ...state, messageBox: {...state.messageBox, ...action.payload, isOpen: true}\r\n            };\r\n        }\r\n        case actions.CLOSE_MESSAGE_BOX: {\r\n            return {\r\n                ...state, messageBox: {...state.messageBox, ...action.payload, isOpen: false}\r\n            };\r\n        }\r\n        case actions.OPEN_DIRECTORY_SELECT_DIALOG: {\r\n            return {\r\n                ...state, directorySelectDialog: {...state.directorySelectDialog, ...action.payload, isOpen: true}\r\n            };\r\n        }\r\n        case actions.CLOSE_DIRECTORY_SELECT_DIALOG: {\r\n            return {\r\n                ...state,\r\n                directorySelectDialog: {...state.directorySelectDialog, ...action.payload, isOpen: false}\r\n            };\r\n        }\r\n        case actions.OPEN_FILE_OPEN_DIALOG: {\r\n            return {\r\n                ...state, fileOpenDialog: {...state.fileOpenDialog, ...action.payload, isOpen: true}\r\n            };\r\n        }\r\n        case actions.CLOSE_FILE_OPEN_DIALOG: {\r\n            return {\r\n                ...state, fileOpenDialog: {...state.fileOpenDialog, ...action.payload, isOpen: false}\r\n            };\r\n        }\r\n        case actions.OPEN_FILE_SAVE_DIALOG: {\r\n            return {\r\n                ...state, fileSaveDialog: {...state.fileSaveDialog, ...action.payload, isOpen: true}\r\n            };\r\n        }\r\n        case actions.CLOSE_FILE_SAVE_DIALOG: {\r\n            return {\r\n                ...state, fileSaveDialog: {...state.fileSaveDialog, ...action.payload, isOpen: false}\r\n            };\r\n        }\r\n        case actions.OPEN_FILE_BROWSE_DIALOG: {\r\n            return {\r\n                ...state, fileBrowseDialog: {...state.fileBrowseDialog, ...action.payload, isOpen: true}\r\n            };\r\n        }\r\n        case actions.CLOSE_FILE_BROWSE_DIALOG: {\r\n            return {\r\n                ...state, fileBrowseDialog: {...state.fileBrowseDialog, ...action.payload, isOpen: false}\r\n            };\r\n        }\r\n        default: {\r\n            const newViews = viewsReducer(state.views, action, state.activeViewId);\r\n            if (newViews !== state.views) {\r\n                return {...state, views: newViews};\r\n            }\r\n        }\r\n    }\r\n\r\n    return state;\r\n};\r\n\r\n\r\nfunction addView(state: ControlState, view: ViewState<any>, placeAfterViewId: string | null) {\r\n    const newId = view.id;\r\n    const newViews = addViewToViewArray(state.views, view);\r\n    const oldViewLayout = state.viewLayout;\r\n    let newViewLayout;\r\n    if (placeAfterViewId) {\r\n        newViewLayout = addViewToPanel(oldViewLayout, placeAfterViewId, newId);\r\n    }\r\n    if (!newViewLayout || newViewLayout === oldViewLayout) {\r\n        // Could not be inserted, so use following call which will always succeed.\r\n        newViewLayout = addViewToLayout(oldViewLayout, newId);\r\n    }\r\n    return {...state, viewLayout: newViewLayout, views: newViews, activeViewId: newId};\r\n}\r\n\r\n\r\nconst viewsReducer = (state: ViewState<any>[], action: Action, activeViewId: string) => {\r\n    // delegate action to all children\r\n    let newViews = null;\r\n    for (let i = 0; i < state.length; i++) {\r\n        const oldView = state[i];\r\n        const newView = viewReducer(oldView, action, activeViewId);\r\n        if (oldView !== newView) {\r\n            if (!newViews) {\r\n                newViews = state.slice(0, i);\r\n            }\r\n        }\r\n        if (newViews && newView) {\r\n            newViews.push(newView);\r\n        }\r\n    }\r\n    return newViews || state;\r\n};\r\n\r\n\r\nconst viewReducer = (state: ViewState<any>, action: Action, activeViewId: string) => {\r\n    const isActiveView = state.id === activeViewId;\r\n    switch (action.type) {\r\n        case actions.RENAME_RESOURCE: {\r\n            if (state.type === 'world') {\r\n                const layers = layersReducer(state.data.layers, action, isActiveView);\r\n                if (layers !== state.data.layers) {\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            } else if (state.type === 'figure') {\r\n                let title = getFigureViewTitle(action.payload.resName);\r\n                if (state.title === title) {\r\n                    title = getFigureViewTitle(action.payload.newResName);\r\n                    return {...state, title};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_ENTITY_STYLE: {\r\n            const viewId = action.payload.viewId;\r\n            if (state.id === viewId && state.type === 'world') {\r\n                const layers = layersReducer(state.data.layers, action, isActiveView);\r\n                if (layers !== state.data.layers) {\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_SHOW_SELECTED_VARIABLE_LAYER: {\r\n            if (state.type === 'world') {\r\n                const layers = layersReducer(state.data.layers, action, isActiveView);\r\n                if (layers !== state.data.layers) {\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        // TODO (forman): clean up code duplication here, following actions are basically all the same\r\n        //                SET_SELECTED_ENTITY_ID,\r\n        //                SET_SELECTED_LAYER_ID,\r\n        //                SET_VIEW_MODE,\r\n        //                SET_PROJECTION_CODE,\r\n        //                SET_SPLIT_LAYER_ID,\r\n        //                SET_SPLIT_LAYER_POS\r\n        //\r\n        case actions.SET_SELECTED_LAYER_ID: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id && state.type === 'world') {\r\n                const selectedLayerId = action.payload.selectedLayerId;\r\n                return {...state, data: {...state.data, selectedLayerId}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_SELECTED_ENTITY_ID: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id && state.type === 'world') {\r\n                const selectedEntityId = action.payload.selectedEntityId;\r\n                return {...state, data: {...state.data, selectedEntityId}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_VIEW_MODE: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const viewMode = action.payload.viewMode;\r\n                return {...state, data: {...state.data, viewMode}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_LAYER_SPLIT_POSITION: {\r\n            const {viewId, layerSplitPosition} = action.payload;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                return {...state, data: {...state.data, layerSplitPosition}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_BASE_MAP_ID: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const baseMapId = action.payload.baseMapId;\r\n                return {...state, data: {...state.data, baseMapId}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_PROJECTION_CODE: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const projectionCode = action.payload.projectionCode;\r\n                return {...state, data: {...state.data, projectionCode}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.ADD_LAYER: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const layer = action.payload.layer;\r\n                const selectLayer = action.payload.selectLayer;\r\n                const selectedLayerId = selectLayer ? layer.id : state.data.selectedLayerId;\r\n                const layers = state.data.layers.concat([layer]);\r\n                return {...state, data: {...state.data, layers, selectedLayerId}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.REMOVE_LAYER: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const layerId = action.payload.id;\r\n                const layers = state.data.layers.slice();\r\n                let selectedLayerId = state.data.selectedLayerId;\r\n                if (layerId === selectedLayerId) {\r\n                    selectedLayerId = null;\r\n                }\r\n                const layerIndex = layers.findIndex(l => l.id === layerId);\r\n                if (layerIndex >= 0) {\r\n                    layers.splice(layerIndex, 1);\r\n                    return {...state, data: {...state.data, layers, selectedLayerId}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.MOVE_LAYER_UP: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const layerId = action.payload.id;\r\n                const layers = state.data.layers.slice();\r\n                const layerIndex = layers.findIndex(l => l.id === layerId);\r\n                assert.ok(layerIndex >= 0, 'layerIndex >= 0');\r\n                if (layerIndex > 0) {\r\n                    const temp = layers[layerIndex - 1];\r\n                    layers[layerIndex - 1] = layers[layerIndex];\r\n                    layers[layerIndex] = temp;\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.MOVE_LAYER_DOWN: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const layerId = action.payload.id;\r\n                const layers = state.data.layers.slice();\r\n                const layerIndex = layers.findIndex(l => l.id === layerId);\r\n                assert.ok(layerIndex >= 0, 'layerIndex >= 0');\r\n                if (layerIndex >= 0 && layerIndex < layers.length - 1) {\r\n                    const temp = layers[layerIndex + 1];\r\n                    layers[layerIndex + 1] = layers[layerIndex];\r\n                    layers[layerIndex] = temp;\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_LAYER: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const layer = action.payload.layer;\r\n                const layers = state.data.layers.slice();\r\n                const layerIndex = layers.findIndex(l => l.id === layer.id);\r\n                assert.ok(layerIndex >= 0, 'layerIndex >= 0');\r\n                // layers[layerIndex] = {...layers[layerIndex], ...layer};\r\n                layers[layerIndex] = updateObject(layers[layerIndex], layer);\r\n                return {...state, data: {...state.data, layers}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_LAYER_STYLE: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'world');\r\n                const {layerId, style} = action.payload;\r\n                const layers = state.data.layers.slice();\r\n                const layerIndex = layers.findIndex(l => l.id === layerId);\r\n                assert.ok(layerIndex >= 0, 'layerIndex >= 0');\r\n                let layer = layers[layerIndex];\r\n                layers[layerIndex] = {...layer, style: {...layer.style, ...style}};\r\n                return {...state, data: {...state.data, layers}};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_TABLE_VIEW_DATA: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'table');\r\n                const data = {...state.data, ...action.payload};\r\n                return {...state, data};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_ANIMATION_VIEW_DATA: {\r\n            const viewId = action.payload.viewId;\r\n            if (viewId === state.id) {\r\n                assert.ok(state.type === 'animation');\r\n                const data = {...state.data, ...action.payload};\r\n                return {...state, data};\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            if (state.type === 'world') {\r\n                const layers = layersReducer(state.data.layers, action, isActiveView);\r\n                if (layers !== state.data.layers) {\r\n                    return {...state, data: {...state.data, layers}};\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\nconst layersReducer = (state: LayerState[], action: Action, isActiveView: boolean) => {\r\n    // delegate action to all children\r\n    let newLayers;\r\n    for (let i = 0; i < state.length; i++) {\r\n        const oldLayer = state[i];\r\n        const newLayer = layerReducer(oldLayer, action, isActiveView);\r\n        if (oldLayer !== newLayer) {\r\n            if (!newLayers) {\r\n                newLayers = state.slice(0, i);\r\n            }\r\n        }\r\n        if (newLayers && newLayer) {\r\n            newLayers.push(newLayer);\r\n        }\r\n    }\r\n    return newLayers || state;\r\n};\r\n\r\nconst layerReducer = (state: LayerState, action: Action, isActiveView: boolean) => {\r\n    switch (action.type) {\r\n        case actions.RENAME_RESOURCE: {\r\n            const resName = action.payload.resName;\r\n            const newResName = action.payload.newResName;\r\n            if ((state as any).resName === resName) {\r\n                return {...state, resName: newResName};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_ENTITY_STYLE: {\r\n            const {layerId, entityId, style} = action.payload;\r\n            if (state.id === layerId && isVectorLayer(state)) {\r\n                const vectorLayer = state as VectorLayerBase;\r\n                const entityStyles = vectorLayer.entityStyles;\r\n                const oldStyle = entityStyles && entityStyles[entityId];\r\n                const newStyle = {...oldStyle, ...style};\r\n                if (!deepEqual(oldStyle, newStyle)) {\r\n                    return {...state, entityStyles: {...entityStyles, [entityId]: newStyle}};\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_SHOW_SELECTED_VARIABLE_LAYER: {\r\n            if (state.id === AUTO_LAYER_ID) {\r\n                const showSelectedVariableLayer = action.payload.showSelectedVariableLayer;\r\n                return {...state, visible: showSelectedVariableLayer};\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_SELECTED_VARIABLE: {\r\n            if (state.id === AUTO_LAYER_ID && isActiveView) {\r\n                const resource = action.payload.resource;\r\n                const selectedVariable = action.payload.selectedVariable;\r\n                const savedLayers = action.payload.savedLayers;\r\n                return updateAutoLayer(state, resource, selectedVariable, savedLayers);\r\n            }\r\n            break;\r\n        }\r\n        case actions.SET_LAYER_SPLIT_MODE: {\r\n            const {layerId, splitMode} = action.payload;\r\n            if (state.id === layerId && isImageLayer(state)) {\r\n                return {...state, splitMode};\r\n            }\r\n            break;\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// state.session reducers\r\n\r\nlet updatePlacemarkProperties = function (state: SessionState, placemarkId: any, properties: any) {\r\n    const features = state.placemarkCollection.features.slice();\r\n    const featureIndex = features.findIndex(f => f.id === placemarkId);\r\n    const oldFeature = featureIndex >= 0 && features[featureIndex];\r\n    assert.ok(oldFeature);\r\n    const oldProperties = oldFeature && oldFeature.properties;\r\n    const newProperties = {...oldProperties, ...properties};\r\n    const newFeature = {...oldFeature, properties: newProperties};\r\n    if (featureIndex >= 0) {\r\n        features[featureIndex] = newFeature;\r\n    } else {\r\n        features.push(newFeature);\r\n    }\r\n    const placemarkCollection = {...state.placemarkCollection, features};\r\n    return {...state, placemarkCollection};\r\n};\r\n\r\nlet updatePlacemarkGeometry = function (state: SessionState, placemarkId: any, geometry: any) {\r\n    const features = state.placemarkCollection.features.slice();\r\n    const featureIndex = features.findIndex(f => f.id === placemarkId);\r\n    const oldFeature = featureIndex >= 0 && features[featureIndex];\r\n    assert.ok(oldFeature);\r\n    const oldGeometry = oldFeature && oldFeature.geometry;\r\n    const newGeometry = {...oldGeometry, ...geometry};\r\n    const newFeature = {...oldFeature, geometry: newGeometry};\r\n    if (featureIndex >= 0) {\r\n        features[featureIndex] = newFeature;\r\n    } else {\r\n        features.push(newFeature);\r\n    }\r\n    const placemarkCollection = {...state.placemarkCollection, features};\r\n    return {...state, placemarkCollection};\r\n};\r\n\r\nconst sessionReducer = (state: SessionState = INITIAL_SESSION_STATE, action: Action): SessionState => {\r\n    switch (action.type) {\r\n        case actions.SET_SELECTED_ENTITY_ID: {\r\n            const selectedEntityId = action.payload.selectedEntityId || null;\r\n            let selectedPlacemarkId = null;\r\n            if (isString(selectedEntityId) && selectedEntityId.startsWith(PLACEMARK_ID_PREFIX)) {\r\n                selectedPlacemarkId = selectedEntityId;\r\n            }\r\n            if (selectedPlacemarkId !== state.selectedPlacemarkId) {\r\n                return {...state, selectedPlacemarkId};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_INITIAL_STATE:\r\n            return {...state, ...action.payload.session};\r\n        case actions.UPDATE_SESSION_STATE:\r\n            return {...state, ...action.payload};\r\n        case actions.SET_SHOW_SELECTED_VARIABLE_LAYER:\r\n            return {...state, ...action.payload};\r\n        case actions.SET_BASE_MAP_ID:\r\n            return {...state, lastBaseMapId: action.payload.baseMapId};\r\n        case actions.SAVE_LAYER: {\r\n            const {key, layer} = action.payload;\r\n            // const savedLayers = {...state.savedLayers, [key]: layer};\r\n            const savedLayers = updateObject(state.savedLayers, {[key]: layer});\r\n            return {...state, savedLayers};\r\n        }\r\n        case actions.ADD_PLACEMARK: {\r\n            let placemark = action.payload.placemark;\r\n            let features = state.placemarkCollection.features;\r\n            let properties = {...placemark.properties};\r\n            // Set initial title\r\n            const {title, index} = getPlacemarkTitleAndIndex(placemark, state.placemarkCollection);\r\n            if (title) {\r\n                properties = {...properties, title};\r\n                if (placemark.geometry.type === 'Point') {\r\n                    properties['marker-symbol'] = index.toString(16).slice(-1);\r\n                }\r\n                placemark = {...placemark, properties}\r\n            }\r\n            features = features.concat([placemark]);\r\n            const placemarkCollection = {...state.placemarkCollection, features};\r\n            return {...state, placemarkCollection, selectedPlacemarkId: placemark.id};\r\n        }\r\n        case actions.REMOVE_PLACEMARK: {\r\n            const placemarkId = action.payload.placemarkId;\r\n            let features = state.placemarkCollection.features;\r\n            const removedFeatureIndex = features.findIndex(f => f.id === placemarkId);\r\n            if (removedFeatureIndex >= 0) {\r\n                features = features.slice();\r\n                features.splice(removedFeatureIndex, 1);\r\n                let selectedPlacemarkId = null;\r\n                if (removedFeatureIndex < features.length) {\r\n                    selectedPlacemarkId = features[removedFeatureIndex].id;\r\n                } else if (features.length > 0) {\r\n                    selectedPlacemarkId = features[features.length - 1].id;\r\n                }\r\n                const placemarkCollection = {...state.placemarkCollection, features};\r\n                return {...state, placemarkCollection, selectedPlacemarkId};\r\n            }\r\n            break;\r\n        }\r\n        case actions.UPDATE_PLACEMARK_GEOMETRY: {\r\n            const {placemarkId, geometry} = action.payload;\r\n            return updatePlacemarkGeometry(state, placemarkId, geometry);\r\n        }\r\n        case actions.UPDATE_PLACEMARK_PROPERTIES: {\r\n            const {placemarkId, properties} = action.payload;\r\n            return updatePlacemarkProperties(state, placemarkId, properties);\r\n        }\r\n        case actions.UPDATE_PLACEMARK_STYLE: {\r\n            const {placemarkId, style} = action.payload;\r\n            const properties = featurePropertiesFromSimpleStyle(style);\r\n            const defaultPlacemarkStyle = {...state.defaultPlacemarkStyle, ...style};\r\n            return {...updatePlacemarkProperties(state, placemarkId, properties), defaultPlacemarkStyle};\r\n        }\r\n        case OBTAIN_COOKIE_CONSENT: {\r\n            const {trackingConsentObtained} = action.payload;\r\n            storeCookieConsent(trackingConsentObtained)\r\n            return {...state, cookieConsentObtained: true, trackingConsentObtained};\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// state.communication reducers\r\n\r\nconst communicationReducer = (state: CommunicationState = INITIAL_COMMUNICATION_STATE, action: Action) => {\r\n    switch (action.type) {\r\n        case actions.SET_WEBAPI_SERVICE_URL: {\r\n            const webAPIServiceURL = action.payload.webAPIServiceURL;\r\n            return {...state, webAPIServiceURL};\r\n        }\r\n        case actions.SET_WEBAPI_STATUS: {\r\n            const webAPIStatus = action.payload.webAPIStatus;\r\n            return {...state, webAPIStatus};\r\n        }\r\n        case actions.SET_WEBAPI_CLIENT: {\r\n            const webAPIClient = action.payload.webAPIClient;\r\n            return {...state, webAPIClient, webAPIStatus: 'open'};\r\n        }\r\n        case actions.SET_WEBAPI_SERVICE_INFO: {\r\n            const webAPIServiceInfo = action.payload.webAPIServiceInfo;\r\n            return {\r\n                ...state,\r\n                webAPIServiceInfo: {\r\n                    ...state.webAPIServiceInfo,\r\n                    ...webAPIServiceInfo\r\n                }\r\n            };\r\n        }\r\n        case actions.SET_WEBAPI_AUTO_STOP_INFO: {\r\n            const autoStopInfo = action.payload.webAPIAutoStopInfo;\r\n            return {\r\n                ...state,\r\n                webAPIServiceInfo: {\r\n                    ...state.webAPIServiceInfo,\r\n                    autoStopInfo\r\n                }\r\n            };\r\n        }\r\n        case actions.UPDATE_HUB_STATUS: {\r\n            return {\r\n                ...state,\r\n                hubStatus: action.payload\r\n            }\r\n        }\r\n        case actions.UPDATE_TASK_STATE:\r\n            return {\r\n                ...state,\r\n                tasks: updatePropertyObject(state.tasks, action.payload.jobId, action.payload.taskState)\r\n            };\r\n        case actions.REMOVE_TASK_STATE: {\r\n            const tasks = {...state.tasks};\r\n            delete tasks[action.payload.jobId];\r\n            return {...state, tasks};\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// state.location reducers\r\n\r\n//noinspection JSUnusedLocalSymbols\r\nconst locationReducer = (state: LocationState = INITIAL_LOCATION_STATE, action: Action) => {\r\n    if (action.type === actions.SET_GLOBE_MOUSE_POSITION) {\r\n        const globeMousePosition = action.payload.position;\r\n        if (state.globeMousePosition !== globeMousePosition) {\r\n            return {...state, globeMousePosition};\r\n        }\r\n    } else if (action.type === actions.SET_GLOBE_VIEW_POSITION) {\r\n        const globeViewPosition = action.payload.position;\r\n        const positionData = action.payload.positionData;\r\n        if (state.globeViewPosition !== globeViewPosition || state.positionData !== positionData) {\r\n            return {...state, globeViewPosition, positionData};\r\n        }\r\n    }\r\n    return state;\r\n};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Combined State reducer\r\n\r\nexport const stateReducer = combineReducers<State>({\r\n                                                       data: dataReducer as Reducer<DataState>,\r\n                                                       control: controlReducer as Reducer<ControlState>,\r\n                                                       session: sessionReducer as Reducer<SessionState>,\r\n                                                       communication: communicationReducer as Reducer<CommunicationState>,\r\n                                                       location: locationReducer as Reducer<LocationState>,\r\n                                                   });\r\n\r\n\r\n\r\n\r\n\r\n","import * as React from 'react';\r\nimport { Button, Checkbox, Classes, Collapse, Drawer, Intent, Position } from '@blueprintjs/core';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport { State } from '../state';\r\nimport { obtainCookieConsent } from '../actions';\r\n\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IGdprBannerProps {\r\n    cookieConsentObtained: boolean;\r\n    trackingConsentObtained: boolean;\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IGdprBannerProps {\r\n    return {\r\n        cookieConsentObtained: state.session.cookieConsentObtained,\r\n        trackingConsentObtained: state.session.trackingConsentObtained,\r\n    };\r\n}\r\n\r\nconst GdprBanner: React.FC<IGdprBannerProps & IDispatch> = (\r\n    {\r\n        cookieConsentObtained,\r\n        trackingConsentObtained,\r\n        dispatch,\r\n    }\r\n) => {\r\n    const [customizeMode, setCustomizeMode] = React.useState(false);\r\n    const [trackingAllowed, setTrackingAllowed] = React.useState(trackingConsentObtained);\r\n\r\n    if (cookieConsentObtained) {\r\n        return null;\r\n    }\r\n\r\n    const handleConsent = () => {\r\n        dispatch(obtainCookieConsent(customizeMode ? trackingAllowed : true));\r\n    };\r\n\r\n    const handleTrackingAllowed = (e: React.FormEvent<HTMLInputElement>) => {\r\n        setTrackingAllowed(e.currentTarget.checked);\r\n    };\r\n\r\n    return (\r\n        <Drawer\r\n            title=\"Data Protection Notice\"\r\n            icon=\"info-sign\"\r\n            position={Position.BOTTOM}\r\n            isOpen={true}\r\n            isCloseButtonShown={false}\r\n            canOutsideClickClose={false}\r\n            canEscapeKeyClose={false}\r\n            size={240}\r\n        >\r\n            <div className={Classes.DRAWER_BODY}>\r\n                <div className={Classes.DIALOG_BODY}>\r\n                    We use cookies so you can optimally use this website.\r\n                    Some cookies that are necessary for the operation of Cate App.\r\n                    In addition, we use cookies for statistical purposes.\r\n                    You can adjust the data protection settings or agree to all cookies\r\n                    directly. <a href='https://climate.esa.int/en/privacy/'>Privacy Statement</a>\r\n                </div>\r\n\r\n                <div className={Classes.DIALOG_FOOTER}>\r\n                    <div className={Classes.DIALOG_FOOTER_ACTIONS}>\r\n                        <Button\r\n                            intent={Intent.PRIMARY}\r\n                            onClick={handleConsent}\r\n                        >\r\n                            {customizeMode ? \"I agree to selected Cookies\" : \"I agree to all Cookies\"}\r\n                        </Button>\r\n                        <Button\r\n                            rightIcon={customizeMode ? 'caret-up' : 'caret-down'}\r\n                            onClick={() => setCustomizeMode(!customizeMode)}\r\n                        >\r\n                            Settings\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <Collapse isOpen={customizeMode}>\r\n                    <div className={Classes.DIALOG_BODY}>\r\n                        <Checkbox\r\n                            checked={true}\r\n                        >\r\n                            <strong>Functional</strong>: Cate does not work without functional cookies.\r\n                            We'll just save your consent with this notice and possibly auto-login information\r\n                            if you use the Cate cloud services.\r\n                        </Checkbox>\r\n                        <Checkbox\r\n                            checked={trackingAllowed}\r\n                            onChange={handleTrackingAllowed}\r\n                        >\r\n                            <strong>Tracking</strong>: Cate uses the open source software\r\n                            tool <a href=\"https://matomo.org/\">Matomo</a>, which uses cookies.\r\n                            With these cookies we count Cate App visits - of course anonymously.\r\n                            Matomo fully complies to the EU General Data Protection Regulation (GDPR).\r\n                        </Checkbox>\r\n                    </div>\r\n                </Collapse>\r\n            </div>\r\n        </Drawer>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(GdprBanner);\r\n","import * as React from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport { Menu, MenuDivider, MenuItem } from '@blueprintjs/core';\r\nimport {\r\n    closeWorkspaceInteractive,\r\n    deleteWorkspaceInteractive,\r\n    newWorkspaceInteractive,\r\n    openWorkspaceInteractive,\r\n    saveWorkspaceAsInteractive,\r\n    saveWorkspaceInteractive\r\n} from '../actions';\r\nimport { State } from '../state';\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IWorkspacesMenuProps {\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IWorkspacesMenuProps {\r\n    return {};\r\n}\r\n\r\nconst _WorkspacesMenu: React.FC<IWorkspacesMenuProps & IDispatch> = (props) => {\r\n\r\n    const handleNew = () => {\r\n        props.dispatch(newWorkspaceInteractive());\r\n    };\r\n\r\n    const handleOpen = () => {\r\n        props.dispatch(openWorkspaceInteractive() as any);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        props.dispatch(closeWorkspaceInteractive() as any);\r\n    };\r\n\r\n    const handleSave = () => {\r\n        props.dispatch(saveWorkspaceInteractive() as any);\r\n    };\r\n\r\n    const handleSaveAs = () => {\r\n        props.dispatch(saveWorkspaceAsInteractive());\r\n    };\r\n\r\n    const handleDelete = () => {\r\n        props.dispatch(deleteWorkspaceInteractive() as any);\r\n    };\r\n\r\n    return (\r\n        <Menu>\r\n            <MenuItem\r\n                text=\"New Workspace\"\r\n                icon=\"folder-new\"\r\n                onClick={handleNew}\r\n            />\r\n            <MenuItem\r\n                text=\"Open Workspace\"\r\n                icon=\"folder-shared-open\"\r\n                onClick={handleOpen}\r\n            />\r\n            <MenuItem\r\n                text=\"Close Workspace\"\r\n                icon=\"folder-close\"\r\n                onClick={handleClose}\r\n            />\r\n            <MenuDivider/>\r\n            <MenuItem\r\n                text=\"Save Workspace\"\r\n                icon=\"add-to-folder\"\r\n                onClick={handleSave}\r\n            />\r\n            <MenuItem\r\n                text=\"Save Workspace As...\"\r\n                onClick={handleSaveAs}\r\n            />\r\n            <MenuDivider/>\r\n            <MenuItem\r\n                text=\"Delete Workspace\"\r\n                icon=\"trash\"\r\n                onClick={handleDelete}\r\n            />\r\n        </Menu>\r\n    );\r\n};\r\n\r\nconst WorkspacesMenu = connect(mapStateToProps)(_WorkspacesMenu);\r\nexport default WorkspacesMenu;","import * as React from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport { Menu, MenuDivider, MenuItem } from '@blueprintjs/core';\r\n\r\nimport { State } from '../state';\r\nimport { fileDownloadInteractive, fileUploadInteractive, showItemInFolder } from \"../actions\";\r\n\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IFilesMenuProps {\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IFilesMenuProps {\r\n    return {};\r\n}\r\n\r\nconst _FilesMenu: React.FC<IFilesMenuProps & IDispatch> = (props) => {\r\n    const handleUploadFiles = () => {\r\n        props.dispatch(fileUploadInteractive());\r\n    };\r\n\r\n    const handleDownloadFiles = () => {\r\n        props.dispatch(fileDownloadInteractive());\r\n    };\r\n\r\n    const handleBrowseFiles = () => {\r\n        props.dispatch(showItemInFolder('') as any);\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <Menu>\r\n                <MenuItem\r\n                    text=\"Upload Files...\"\r\n                    icon=\"upload\"\r\n                    onClick={handleUploadFiles}\r\n                />\r\n                <MenuDivider/>\r\n                <MenuItem\r\n                    text=\"Download Files...\"\r\n                    icon=\"download\"\r\n                    onClick={handleDownloadFiles}\r\n                />\r\n                <MenuDivider/>\r\n                <MenuItem\r\n                    text=\"Browse Files...\"\r\n                    icon=\"folder-close\"\r\n                    onClick={handleBrowseFiles}\r\n                />\r\n            </Menu>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst FilesMenu = connect(mapStateToProps)(_FilesMenu);\r\nexport default FilesMenu;\r\n","import { Menu, MenuItem } from '@blueprintjs/core';\r\nimport * as React from 'react';\r\nimport { connect, Dispatch } from \"react-redux\";\r\n\r\nimport { State } from '../state';\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IHelpMenuProps {\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IHelpMenuProps {\r\n    return {};\r\n}\r\n\r\nconst _HelpMenu: React.FC<IHelpMenuProps & IDispatch> = () => {\r\n\r\n    const openUrl = (url: string) => {\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <Menu>\r\n                <MenuItem\r\n                    text=\"Cate Documentation\"\r\n                    onClick={() => openUrl(\"http://cate.readthedocs.io\")}\r\n                />\r\n                <MenuItem\r\n                    text=\"Cate Website\"\r\n                    onClick={() => openUrl(\"https://climate.esa.int/en/explore/analyse-climate-data\")}\r\n                />\r\n                <MenuItem\r\n                    text=\"Cate on GitHub\"\r\n                    onClick={() => openUrl(\"https://github.com/CCI-Tools/cate\")}\r\n                />\r\n                <MenuItem\r\n                    text=\"ESA Climate Office Helpdesk\"\r\n                    onClick={() => openUrl(\"https://climate.esa.int/en/helpdesk\")}\r\n                />\r\n            </Menu>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst HelpMenu = connect(mapStateToProps)(_HelpMenu)\r\nexport default HelpMenu\r\n","import * as React from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport {\r\n    Button,\r\n    Navbar,\r\n    NavbarDivider,\r\n    NavbarGroup,\r\n    Popover,\r\n    PopoverPosition,\r\n} from '@blueprintjs/core';\r\n\r\nimport * as actions from '../actions';\r\nimport { State } from '../state';\r\nimport cateIcon from '../resources/cate-icon-128.png';\r\nimport WorkspacesMenu from './WorkspacesMenu';\r\nimport FilesMenu from './FilesMenu';\r\nimport HelpMenu from './HelpMenu';\r\n\r\n\r\nconst TITLE_STYLE = {marginLeft: 10};\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IAppBarProps {\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IAppBarProps {\r\n    return {\r\n    };\r\n}\r\n\r\n\r\nconst _AppBar: React.FC<IAppBarProps & IDispatch> = (\r\n    {\r\n        dispatch,\r\n    }\r\n) => {\r\n\r\n    const handlePreferencesClick = () => {\r\n        dispatch(actions.showPreferencesDialog());\r\n    };\r\n\r\n    return (\r\n        <Navbar>\r\n            <NavbarGroup>\r\n                <img src={cateIcon} width={32} height={32} alt={'Cate icon'}/>\r\n                <h2 style={TITLE_STYLE}>Cate - ESA CCI Toolbox</h2>\r\n            </NavbarGroup>\r\n            <NavbarGroup align=\"right\">\r\n                <Popover content={<WorkspacesMenu/>} position={PopoverPosition.BOTTOM}>\r\n                    <Button className=\"bp3-minimal\" rightIcon={'caret-down'}>Workspaces</Button>\r\n                </Popover>\r\n                <Popover content={<FilesMenu/>} position={PopoverPosition.BOTTOM}>\r\n                    <Button className=\"bp3-minimal\" rightIcon={'caret-down'}>Files</Button>\r\n                </Popover>\r\n                <Popover content={<HelpMenu/>} position={PopoverPosition.BOTTOM}>\r\n                    <Button className=\"bp3-minimal\" rightIcon={'caret-down'}>Help</Button>\r\n                </Popover>\r\n                <NavbarDivider/>\r\n                <Button\r\n                    className=\"bp3-minimal\"\r\n                    icon='cog'\r\n                    onClick={handlePreferencesClick}\r\n                />\r\n            </NavbarGroup>\r\n        </Navbar>\r\n    );\r\n}\r\n\r\nconst AppBar = connect(mapStateToProps)(_AppBar);\r\nexport default AppBar;\r\n\r\n\r\n","import * as React from 'react';\r\nimport { Icon, Intent, NonIdealState, Spinner } from '@blueprintjs/core';\r\nimport { IconName } from '@blueprintjs/icons';\r\n\r\nexport const ICON_CIRCLE: IconName = 'circle';\r\nexport const ICON_DISABLE: IconName = 'disable';\r\n\r\nexport const CONFIG_ERROR_MESSAGE = (\r\n    <span>This is very likely a configuration error.</span>\r\n);\r\n\r\nexport const NO_WORKSPACE = (\r\n    <NonIdealState\r\n        title=\"No workspace\"\r\n        description={<span>Try <strong>File / New</strong> or <strong>File / Open</strong> from the main menu.</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_WORKSPACE_RESOURCES = (\r\n    <NonIdealState\r\n        title=\"No workspace resources\"\r\n        icon=\"database\"\r\n        description={<span>Open a dataset in DATA SOURCES panel or add a <code>read_</code> operation step from the OPERATIONS panel.</span>}\r\n    />\r\n);\r\n\r\nexport const NO_WORKFLOW_STEPS = (\r\n    <NonIdealState\r\n        title=\"No workflow steps\"\r\n        icon=\"flows\"\r\n        description={<span>Open a dataset in DATA SOURCES panel or add a <code>read_</code> operation step from the OPERATIONS panel.</span>}\r\n    />\r\n);\r\n\r\nexport const NO_DATA_STORES_FOUND = (\r\n    <NonIdealState\r\n        title=\"No data stores found\"\r\n        icon=\"offline\"\r\n        description={CONFIG_ERROR_MESSAGE}/>\r\n);\r\n\r\nexport const NO_LOCAL_DATA_SOURCES = (\r\n    <NonIdealState\r\n        title=\"No data sources\"\r\n        icon={ICON_CIRCLE}\r\n        description={<span>You can add a new data source using the \"+\" button below.</span>}/>\r\n);\r\n\r\nexport const DATA_SOURCES_LOADING = (\r\n    <NonIdealState\r\n        title=\"Loading data sources...\"\r\n        icon={<div style={{marginTop: 14}}><Spinner intent={Intent.PRIMARY}/></div>}\r\n        description={\r\n            <div className=\"bp3-text-small bp3-text-muted\">\r\n                Note: If loading seems to take forever,\r\n                try switching to another data store in between,\r\n                then come back to the desired one.\r\n            </div>\r\n        }/>\r\n);\r\n\r\nexport const NO_DATA_SOURCES_FOUND = (\r\n    <NonIdealState\r\n        title=\"No data sources found\"\r\n        icon={ICON_CIRCLE}\r\n        description={CONFIG_ERROR_MESSAGE}/>\r\n);\r\n\r\nexport const NO_OPERATIONS_FOUND = (\r\n    <NonIdealState\r\n        title=\"No operations found\"\r\n        description={CONFIG_ERROR_MESSAGE}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_VARIABLES = (\r\n    <NonIdealState\r\n        title=\"No variables\"\r\n        icon={ICON_CIRCLE}\r\n        description={`Select a resource in the WORKSPACE panel first.`}/>\r\n);\r\n\r\nexport const NO_VARIABLES_EMPTY_RESOURCE = (resourceName) => (\r\n    <NonIdealState\r\n        title=\"No variables\"\r\n        icon={ICON_CIRCLE}\r\n        description={`Selected resource \"${resourceName}\" doesn't contain any variables.`}/>\r\n);\r\n\r\nexport const NO_ACTIVE_VIEW = (\r\n    <NonIdealState\r\n        title=\"No active view\"\r\n        description=\"Add a new view first.\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_WEB_GL = (\r\n    <NonIdealState\r\n        title=\"Can't open world view\"\r\n        description=\"Cate's world view component requires WebGL, which doesn't seem to be supported by your environment. This is likely on virtualized HW with low graphics capabilities. Sorry!\"\r\n        icon={ICON_DISABLE}/>\r\n);\r\n\r\nexport const NO_PLACES = (\r\n    <NonIdealState\r\n        title=\"No places\"\r\n        description={<span>Press the tool buttons below to add a new place.</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_PLACE_SELECTED = (\r\n    <NonIdealState\r\n        title=\"No place selected\"\r\n        description=\"Select a place to show and edit its details.\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_LAYERS_NO_VIEW = (\r\n    <NonIdealState\r\n        title=\"No layers\"\r\n        description=\"To show layers, activate a world view\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_LAYERS_EMPTY_VIEW = (\r\n    <NonIdealState\r\n        title=\"No layers\"\r\n        description={<span>Press the <Icon icon=\"add\"/> button to add a layer.</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_LAYER_SELECTED = (\r\n    <NonIdealState\r\n        title=\"No layer selected\"\r\n        description=\"Select a layer to browse and edit its details.\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_LAYER_FOR_STYLE = (\r\n    <NonIdealState\r\n        title=\"Styles unavailable\"\r\n        description=\"Select a layer in the LAYERS panel to modify its style.\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_ENTITY_FOR_STYLE = (\r\n    <NonIdealState\r\n        title=\"Styles unavailable\"\r\n        description=\"Select an entity in the World View to modify its style.\"\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_CHARTS = (\r\n    <NonIdealState\r\n        title=\"No charts\"\r\n        description={<span>Press the <Icon icon=\"add\"/> button to add a new chart.</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const NO_TABLE_DATA = (\r\n    <NonIdealState\r\n        title=\"No table data\"\r\n        description={<span>The resource seems to be empty or an error occurred.</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n\r\nexport const LOADING_TABLE_DATA_FAILED = (error: any) => (\r\n    <NonIdealState\r\n        title=\"Loading table data failed\"\r\n        description={<span>{`${error}`}</span>}\r\n        icon={ICON_CIRCLE}/>\r\n);\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport * as assert from '../../common/assert';\r\nimport { shallowEqual } from '../../common/shallow-equal';\r\n\r\nexport interface IExternalObjectComponentProps<E, ES> {\r\n    id: string;\r\n    externalObjectStore?: ExternalObjectStore<E, ES>;\r\n    style?: CSSProperties;\r\n    className?: string;\r\n    debug?: boolean;\r\n}\r\n\r\nexport interface ExternalObjectRef<E, ES> {\r\n    /**\r\n     * The reference to the external object.\r\n     */\r\n    object: E;\r\n\r\n    /**\r\n     * The current state of the external object.\r\n     */\r\n    state?: ES;\r\n\r\n    /**\r\n     * The HTML element that contains the external object.\r\n     */\r\n    container: HTMLElement;\r\n}\r\n\r\nexport type ExternalObjectStore<E, S> = { [id: string]: ExternalObjectRef<E, S> };\r\n\r\n/**\r\n * A React component that lets the *container* DOM element of a \"external object\" hook into the\r\n * real DOM created by React once this component is mounted. When we say external object, we refer to the fact that\r\n * such objects are kept in an in-memory store to let them survive unmounting from the real DOM through React.\r\n * The *container* DOM element of a external object is the root of a DOM tree that shall not be controlled by React\r\n * directly.\r\n *\r\n * Furthermore:\r\n *\r\n *   - The child elements of the *container* (often a \"canvas\" element) are usually controlled by a dedicated\r\n *     JavaScript API provided by a 3rd party library.\r\n *   - The *container* is associated with a complex JavaScript state which is manipulated by that JavaScript API.\r\n *   - Both the displayed content in the DOM child elements and associated JavaScript state are expensive to regenerate\r\n *     from the virtual DOM when implemented as a pure React component.\r\n *\r\n * Examples for native components are the *Cesium.Viewer* of the CesiumJS library or the *ol.Map* object of the\r\n * OpenLayers 3 library.\r\n *\r\n * Note that this is different from React's notion of an \"uncontrolled component\", where form data is handled\r\n * by the DOM itself. While this is also true for a PermanentComponent, we still consider the React component's\r\n * props to be the single source of truth. Therefore changes in this component's props must be reflected in\r\n * the \"external object\" so that it stays in snc with the current props.\r\n *\r\n * When the parent container of a PermanentComponent is mounted, the following steps are performed\r\n *   1. lookup the external object from the store using this component's *id* property;\r\n *   2. if such external object cannot be found, we will create the external object by calling\r\n *      *createPermanentObject()* and put the external object into this component's *store* using this component's *id*\r\n *      property so it will survive unmounting;\r\n *   3. append the *container* element of the external object to the \"div\" element controlled by this PermanentComponent;\r\n *   4. call *externalObjectMounted()*;\r\n *   5. get the previous props using the *id*;\r\n *   6. call *updatePermanentObject()* with the previous and current props so a delta can be computed and applied to\r\n *      the external component.\r\n *\r\n * When a PermanentComponent is unmounted, the following steps are performed:\r\n *   1. lookup the external object from the store using this component's *id* property;\r\n *   2. remove the external object's *container* element from the \"div\" element controlled by this PermanentComponent;\r\n *   3. it will call \"externalObjectUnmounted\".\r\n *\r\n * Note that the external object is removed from the store only if the \"dispose()\" method is called.\r\n *\r\n * @author Norman Fomferra\r\n * @version 0.5\r\n */\r\nexport abstract class ExternalObjectComponent<E, ES, P extends IExternalObjectComponentProps<E, ES>, S>\r\n    extends React.PureComponent<P, S> {\r\n    private static readonly DEFAULT_EXTERNAL_OBJECT_STORE: Object = {};\r\n\r\n    private parentContainer: HTMLElement | null;\r\n\r\n    constructor(props: P) {\r\n        super(props);\r\n        ExternalObjectComponent.checkProps(props);\r\n        this.parentContainer = null;\r\n        this.onRef = this.onRef.bind(this);\r\n    }\r\n\r\n    private static checkProps(props: any) {\r\n        if (!props.id) {\r\n            throw new Error('cannot construct ExternalObjectComponent without id');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the external object reference.\r\n     *\r\n     * Think twice, before using this method.\r\n     * The single source of truth should be your app's state.\r\n     *\r\n     * @returns the external object reference or null.\r\n     */\r\n    getExternalObjectRef(): ExternalObjectRef<E, ES> | null {\r\n        return this.externalObjectStore[this.props.id] || null;\r\n    }\r\n\r\n    // TODO (forman): we can probably simplify ExternalObjectComponent by getting rid of the intermediate container\r\n    //                created by newContainer(id), if we add the following methods to be overidden by clients,\r\n    //                in case this is needed. The default impls would do nothing:\r\n    //                     attachExternalObject(parentContainer, object)\r\n    //                     detachExternalObject(parentContainer, object)\r\n\r\n    /**\r\n     * Create a new container for the external object.\r\n     *\r\n     * @param id The id.\r\n     */\r\n    abstract newContainer(id: string): HTMLElement;\r\n\r\n    /**\r\n     * Create a new external object.\r\n     *\r\n     * @param parentContainer The parent container HTML element which either holds *container* or the *object*.\r\n     * @param container The HTML element created by *newContainer()*, if any.\r\n     */\r\n    abstract newExternalObject(parentContainer: HTMLElement, container: HTMLElement): E;\r\n\r\n    /**\r\n     * Called when the props of this component change and the delta between the external component's\r\n     * state (given by *prevState*) and this components props (given by *nextState*) must be reflected in\r\n     * the external object state.\r\n     *\r\n     * Clients must implement this method by computing the delta between *prevState* and *nextState* and update their\r\n     * external object accordingly.\r\n     *\r\n     * @param object The external object.\r\n     * @param prevState The previous state, may be null or undefined.\r\n     * @param nextState The next state, never null, always defined.\r\n     * @param parentContainer The parent container HTML element which either holds *container* or the *object*.\r\n     * @param container The HTML element created by *newContainer()*, if any.\r\n     */\r\n    abstract updateExternalObject(object: E, prevState: ES, nextState: ES,\r\n                                  parentContainer: HTMLElement, container: HTMLElement): void;\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    /**\r\n     * Extract the state of the external object encoded in the given props.\r\n     * The default implementation simply returns a shallow copy of the previous state\r\n     * overwritten by the given props.\r\n     *\r\n     * @param props The props which take precedence over the previous state.\r\n     * @param prevState The previous state.\r\n     * @returns {{}} State of the external object extracted from props.\r\n     */\r\n    propsToExternalObjectState(props: Readonly<P>, prevState?: Readonly<ES>): ES {\r\n        return {...prevState as any, ...props as any};\r\n    }\r\n\r\n    /**\r\n     * Called if the *externalObject* has been mounted and is now a child of the *parentContainer*.\r\n     *\r\n     * @param object The external object.\r\n     * @param props The props for the external object to be mounted.\r\n     * @param parentContainer The parent container HTML element which either holds *container* or the *object*.\r\n     * @param container The HTML element created by *newContainer()*, if any.\r\n     */\r\n    externalObjectMounted(object: E, props: Readonly<P>, parentContainer: HTMLElement, container: HTMLElement): void {\r\n    }\r\n\r\n    /**\r\n     * Called if the *externalObject* has been unmounted and is no longer a child of *parentContainer*.\r\n     *\r\n     * @param object The external object.\r\n     * @param props The props for the external object to be unmounted.\r\n     * @param parentContainer The parent container HTML element which either holds *container* or the *object*.\r\n     * @param container The HTML element created by *newContainer()*, if any.\r\n     */\r\n    externalObjectUnmounted(object: E, props: Readonly<P>, parentContainer: HTMLElement, container: HTMLElement): void {\r\n    }\r\n\r\n\r\n    // TODO (forman): optimize me: don't override componentWillUpdate(), instead override...\r\n    // - componentWillReceiveProps() to do what componentWillUpdate() currently does AND set whether render() does need to be called\r\n    // - shouldComponentUpdate() to return whether render() need to be called\r\n    /**\r\n     * Invoked by React immediately before rendering when new props or state are being received.\r\n     * This method is not called for the initial render.\r\n     *\r\n     * We use this as an opportunity to synchronize the external object's state with the next props being received.\r\n     *\r\n     * @param nextProps the next props\r\n     */\r\n    componentWillUpdate(nextProps: Readonly<P & ES>) {\r\n        if (this.props.debug) {\r\n            console.log('ExternalObjectComponent.componentWillUpdate nextProps.id =', nextProps.id);\r\n        }\r\n        ExternalObjectComponent.checkProps(nextProps);\r\n        if (this.props.id === nextProps.id) {\r\n            this.updateExternalComponentAndSaveProps(nextProps);\r\n        } else if (this.parentContainer) {\r\n            this.remountExternalObject(this.parentContainer, nextProps);\r\n        }\r\n    }\r\n\r\n    private onRef(parentContainer: HTMLElement | null) {\r\n        if (this.props.debug) {\r\n            console.log('ExternalObjectComponent.onRef: this.props =', this.props);\r\n        }\r\n        this.remountExternalObject(parentContainer, this.props as Readonly<P & ES>);\r\n    }\r\n\r\n    /**\r\n     * Renders a \"div\" element which serves as the parent container for this component's external object.\r\n     * The \"div\" element will have the \"id\" attribute set to this.props.id.\r\n     *\r\n     * @returns {JSX.Element}\r\n     */\r\n    render(): JSX.Element {\r\n        return (\r\n            <div id={this.props.id}\r\n                 className={this.props.className}\r\n                 style={this.props.style}\r\n                 ref={this.onRef}\r\n            >\r\n                {this.renderChildren()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    protected renderChildren() {\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Removes the current external object from cache and creates a new one with the current props.\r\n     * Clients may call this method to force a regeneration of their external component.\r\n     */\r\n    forceRegeneration() {\r\n        let externalObjectStore = this.externalObjectStore;\r\n        let externalObjectRef = externalObjectStore[this.props.id];\r\n        if (externalObjectRef) {\r\n            delete externalObjectStore[this.props.id];\r\n            if (this.parentContainer && externalObjectRef.container) {\r\n                this.parentContainer.removeChild(externalObjectRef.container);\r\n            }\r\n            this.remountExternalObject(this.parentContainer, this.props as Readonly<P & ES>);\r\n        }\r\n    }\r\n\r\n    protected remountExternalObject(parentContainer: HTMLElement | null, props: Readonly<P & ES>) {\r\n        if (props.debug) {\r\n            console.log('ExternalObjectComponent.remountExternalObject: props.id =', props.id);\r\n        }\r\n        if (parentContainer) {\r\n            if (parentContainer.id !== props.id) {\r\n                this.unmountExternalObject(parentContainer, this.props as Readonly<P & ES>);\r\n            }\r\n            if (props.id in this.externalObjectStore) {\r\n                this.mountExistingExternalObject(parentContainer, props);\r\n            } else {\r\n                this.mountNewExternalObject(parentContainer, props);\r\n            }\r\n        } else if (this.parentContainer) {\r\n            this.unmountExternalObject(this.parentContainer, props);\r\n        }\r\n    }\r\n\r\n    private mountNewExternalObject(parentContainer: HTMLElement, props: Readonly<P & ES>) {\r\n        if (props.debug) {\r\n            console.log('ExternalObjectComponent.mountNewExternalObject: props.id =', props.id);\r\n        }\r\n        const container = this.newContainer(props.id);\r\n        if (container) {\r\n            if (props.debug) {\r\n                console.log('ExternalObjectComponent: attaching new external object with id =', props.id);\r\n            }\r\n            parentContainer.appendChild(container);\r\n        }\r\n        const object = this.newExternalObject(parentContainer, container);\r\n        this.externalObjectStore[props.id] = {object, container};\r\n        this.parentContainer = parentContainer;\r\n        this.externalObjectMounted(object, props, parentContainer, container);\r\n        this.updateExternalComponentAndSaveProps(props);\r\n    }\r\n\r\n    private mountExistingExternalObject(parentContainer: HTMLElement, props: Readonly<P & ES>) {\r\n        if (props.debug) {\r\n            console.log('ExternalObjectComponent.mountExistingExternalObject: props.id =', props.id);\r\n        }\r\n        const externalObjectRef = this.externalObjectStore[props.id];\r\n        assert.ok(externalObjectRef);\r\n        const container = externalObjectRef.container;\r\n        if (container && !parentContainer.contains(container)) {\r\n            if (props.debug) {\r\n                console.log('ExternalObjectComponent: attaching existing external object with id =', props.id);\r\n            }\r\n            parentContainer.appendChild(container);\r\n        }\r\n        this.parentContainer = parentContainer;\r\n        this.externalObjectMounted(externalObjectRef.object, props, parentContainer, container);\r\n        this.updateExternalComponentAndSaveProps(props);\r\n    }\r\n\r\n    private unmountExternalObject(parentContainer: HTMLElement, props: Readonly<P & ES>) {\r\n        if (this.props.debug) {\r\n            console.log('ExternalObjectComponent.unmountExternalObject: parentContainer.id =', parentContainer.id);\r\n        }\r\n        const externalObjectRef = this.externalObjectStore[parentContainer.id];\r\n        assert.ok(externalObjectRef);\r\n        const container = externalObjectRef.container;\r\n        if (container && parentContainer.contains(container)) {\r\n            if (props.debug) {\r\n                console.log('ExternalObjectComponent: detaching external object with id =', container.id);\r\n            }\r\n            parentContainer.removeChild(container);\r\n        }\r\n        this.parentContainer = null;\r\n        this.externalObjectUnmounted(externalObjectRef.object, props, parentContainer, container);\r\n    }\r\n\r\n    private updateExternalComponentAndSaveProps(nextProps: Readonly<P>): void {\r\n        const externalObjectRef = this.externalObjectStore[nextProps.id];\r\n        assert.ok(externalObjectRef);\r\n        // Get previous props\r\n        const prevState = externalObjectRef.state;\r\n        const nextState = this.propsToExternalObjectState(nextProps, prevState);\r\n        if (this.props.debug) {\r\n            console.log('ExternalObjectComponent: updating existing external object');\r\n            console.log('  this.props.id =', this.props.id);\r\n            console.log('  nextProps.id  =', nextProps.id);\r\n            console.log('  prevState     =', prevState);\r\n            console.log('  nextState     =', nextState);\r\n        }\r\n        if (this.shouldExternalObjectUpdate(prevState, nextState)) {\r\n            this.updateExternalObject(\r\n                externalObjectRef.object,\r\n                prevState, nextState,\r\n                this.parentContainer,\r\n                externalObjectRef.container\r\n            );\r\n        }\r\n        // Remember new state\r\n        externalObjectRef.state = nextState;\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    protected shouldExternalObjectUpdate(prevState: ES, nextState: ES): boolean {\r\n        return !shallowEqual(prevState, nextState);\r\n    }\r\n\r\n    private get externalObjectStore(): ExternalObjectStore<E, ES> {\r\n        return (this.props.externalObjectStore || ExternalObjectComponent.DEFAULT_EXTERNAL_OBJECT_STORE) as ExternalObjectStore<E, ES>;\r\n    }\r\n}\r\n","export function shallowEqual(v1: any, v2: any): boolean {\r\n    if (v1 === v2) {\r\n        return true;\r\n    }\r\n    if (v1 && v2) {\r\n        const t1: string = typeof v1;\r\n        const t2: string = typeof v2;\r\n        if (t1 !== t2) {\r\n            return false;\r\n        }\r\n        if (t1 === 'Array') {\r\n            if (!v1.length !== !v2.length) {\r\n                return false;\r\n            }\r\n            if (!v1.length && !v2.length) {\r\n                return true;\r\n            }\r\n            for (let i = 0; i < v1.length; i++) {\r\n                if (v1[i] !== v2[i]) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        } else if (t1 === 'object') {\r\n            const names1 = Object.getOwnPropertyNames(v1);\r\n            const names2 = Object.getOwnPropertyNames(v2);\r\n            if (!names1.length !== !names2.length) {\r\n                return false;\r\n            }\r\n            if (!names1.length && !names2.length) {\r\n                return true;\r\n            }\r\n            for (let propertyName of names1) {\r\n                if (v1[propertyName] !== v2[propertyName]) {\r\n                    return false;\r\n                }\r\n            }\r\n            for (let propertyName of names2) {\r\n                if (v1[propertyName] !== v2[propertyName]) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n","import deepEqual from 'deep-equal';\r\nimport * as assert from './assert';\r\n\r\ntype ObjectWithId = { id: any; }\r\n\r\n/**\r\n * An action on an array of objects.\r\n */\r\nexport interface ArrayAction<T extends ObjectWithId> {\r\n    /**\r\n     * Action type, must be one of:  'ADD', 'REMOVE', 'UPDATE', 'MOVE'\r\n     */\r\n    type: 'ADD' | 'REMOVE' | 'UPDATE' | 'MOVE';\r\n    /**\r\n     * For type 'ADD': the insertion index.\r\n     * For type 'UPDATE': the index of the element to be updated.\r\n     * For type 'MOVE': the index from where to move.\r\n     */\r\n    index: number;\r\n    /**\r\n     * For type 'ADD' and 'UPDATE': the new element.\r\n     */\r\n    newElement?: T;\r\n    /**\r\n     * For type 'REMOVE' and 'UPDATE': the old element.\r\n     */\r\n    oldElement?: T;\r\n    /**\r\n     * For type 'UPDATE': the object containing change information.\r\n     */\r\n    change?: any;\r\n    /**\r\n     * For type 'MOVE': number of steps to move. May be negative to move an element down.\r\n     */\r\n    numSteps?: number;\r\n}\r\n\r\n/**\r\n * A diff for arrays whose elements are unique objects with an \"id\" property of any type.\r\n * An \"id\" property is considered equal to another if it shallow-equals the other i.e. element.id === other.id.\r\n *\r\n * By default, if the computeChange function is not provided, the \"change\" object between two elements\r\n * with same \"id\" property is computed by deepEqual from the \"deep-equal\" package.\r\n *\r\n * @param oldArray The first array, whose elements are all defined an non-null.\r\n * @param newArray The second array, whose elements are all defined an non-null.\r\n * @param computeChange An optional function used to compute an application-specific \"change\"\r\n *        between two elements with equal \"id\" properties.\r\n *        Signature: (element1, element2) => any\r\n * @returns {ArrayAction<T>[]} An array of actions to be performed to make oldArray equal to newArray.\r\n */\r\nexport function arrayDiff<T extends ObjectWithId>(oldArray: T[], newArray: T[], computeChange?: (e1: any, e2: any) => any): ArrayAction<T>[] {\r\n\r\n    const actions = [] as ArrayAction<T>[];\r\n    const currentArray = oldArray.slice();\r\n\r\n    // REMOVE first, so we have less actions afterwards\r\n    const newIds = new Set<string>(newArray.map(l => l.id));\r\n    for (let oldIndex = oldArray.length - 1; oldIndex >= 0; oldIndex--) {\r\n        const oldElement = oldArray[oldIndex];\r\n        if (!newIds.has(oldElement.id)) {\r\n            actions.push({type: 'REMOVE', index: oldIndex, oldElement});\r\n            currentArray.splice(oldIndex, 1);\r\n        }\r\n    }\r\n\r\n    assert.ok(currentArray.length <= newArray.length);\r\n\r\n    for (let newIndex = 0; newIndex < newArray.length; newIndex++) {\r\n        const newElement = newArray[newIndex];\r\n        assert.ok(!!newElement);\r\n        const currentElement = currentArray[newIndex];\r\n        if (!currentElement) {\r\n            actions.push({type: 'ADD', index: newIndex, newElement});\r\n            currentArray.push(newElement);\r\n        } else if (newElement.id !== currentElement.id) {\r\n            let currentIndex = -1;\r\n            for (let i = newIndex + 1; i < currentArray.length; i++) {\r\n                if (currentArray[i].id === newElement.id) {\r\n                    currentIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            if (currentIndex === -1) {\r\n                actions.push({type: 'ADD', index: newIndex, newElement});\r\n                currentArray.splice(newIndex, 0, newElement);\r\n            } else {\r\n                // Note: the current algorithm will only produce negative values for numSteps (= MOVE down)\r\n                actions.push({type: 'MOVE', index: currentIndex, numSteps: newIndex - currentIndex});\r\n                const layer = currentArray[currentIndex];\r\n                currentArray.splice(currentIndex, 1);\r\n                currentArray.splice(newIndex, 0, layer);\r\n                newIndex = newIndex - 1;\r\n            }\r\n        } else {\r\n            if (computeChange) {\r\n                const change = computeChange(currentElement, newElement);\r\n                if (change !== null && typeof change !== 'undefined') {\r\n                    actions.push({type: 'UPDATE', index: newIndex, oldElement: currentElement, newElement, change});\r\n                }\r\n            } else if (!deepEqual(currentElement, newElement)) {\r\n                actions.push({type: 'UPDATE', index: newIndex, oldElement: currentElement, newElement});\r\n            }\r\n        }\r\n    }\r\n\r\n    return actions;\r\n}\r\n\r\n","import * as React from 'react';\r\n\r\nexport interface ISliderProps {\r\n    splitPos: number;\r\n    onChange: (splitPosition: number) => void;\r\n}\r\n\r\nexport class SplitSlider extends React.PureComponent<ISliderProps, null> {\r\n    static readonly DIV_STYLE: React.CSSProperties = {\r\n        position: 'absolute',\r\n        left: '50%',\r\n        top: '0px',\r\n        backgroundColor: 'rgba(255, 255, 0, 0.5)',\r\n        width: '2px',\r\n        height: '100%',\r\n        zIndex: 5,\r\n        cursor: 'col-resize',\r\n    };\r\n\r\n    sliderElement: HTMLDivElement | null;\r\n    dragStartX: number;\r\n\r\n    constructor(props: ISliderProps) {\r\n        super(props);\r\n        this.handleRef = this.handleRef.bind(this);\r\n        this.mouseDown = this.mouseDown.bind(this);\r\n        this.mouseUp = this.mouseUp.bind(this);\r\n        this.sliderMove = this.sliderMove.bind(this);\r\n    }\r\n\r\n    mouseDown(e) {\r\n        this.dragStartX = e.clientX - this.sliderElement.offsetLeft;\r\n        window.addEventListener('mousemove', this.sliderMove, true);\r\n    }\r\n\r\n    mouseUp() {\r\n        window.removeEventListener('mousemove', this.sliderMove, true);\r\n    }\r\n\r\n    sliderMove(e) {\r\n        const splitPosition = (e.clientX - this.dragStartX) / this.sliderElement.parentElement.offsetWidth;\r\n        this.props.onChange(splitPosition);\r\n    }\r\n\r\n    handleRef(sliderElement: HTMLDivElement) {\r\n        if (sliderElement) {\r\n            sliderElement.addEventListener('mousedown', this.mouseDown, false);\r\n            window.addEventListener('mouseup', this.mouseUp, false);\r\n            this.dragStartX = 0;\r\n        } else if (this.sliderElement) {\r\n            this.sliderElement.removeEventListener('mousedown', this.mouseDown, false);\r\n        }\r\n        this.sliderElement = sliderElement;\r\n    }\r\n\r\n    render() {\r\n        const left = (100 * this.props.splitPos) + '%';\r\n        return (<div style={{...SplitSlider.DIV_STYLE, left}}\r\n                     ref={this.handleRef}/>);\r\n    }\r\n}\r\n\r\n\r\n","import * as Cesium from 'cesium'\r\nimport { isDefined } from '../../../common/types';\r\n\r\n\r\nexport const pointHeight = 10;\r\nexport const polylineHeight = 5;\r\nexport const polygonHeight = 0;\r\n\r\nexport const pointColor = new Cesium.ColorMaterialProperty(Cesium.Color.CHARTREUSE.withAlpha(0.9));\r\nexport const polylineColor = new Cesium.ColorMaterialProperty(Cesium.Color.YELLOW.withAlpha(0.9));\r\nexport const polylineWidth = 2;\r\nexport const polygonColor = new Cesium.ColorMaterialProperty(Cesium.Color.AQUA.withAlpha(0.7));\r\n\r\nexport type GeometryToolType = 'PointTool' | 'PolylineTool' | 'PolygonTool' | 'BoxTool' | 'NoTool';\r\n\r\nclass Click {\r\n    position: Cesium.Cartesian2;\r\n}\r\n\r\nclass Movement {\r\n    // noinspection JSUnusedGlobalSymbols\r\n    startPosition?: Cesium.Cartesian2;\r\n    endPosition: Cesium.Cartesian2;\r\n}\r\n\r\nexport abstract class ToolContext {\r\n\r\n    abstract newEntity(entity: Cesium.Entity): void;\r\n\r\n    abstract addToolEntity(entityT: Cesium.Entity): void;\r\n\r\n    abstract removeAllToolEntities(): void;\r\n\r\n    abstract pickEllipsoid(position: Cesium.Cartesian2): Cesium.Cartesian3 | undefined;\r\n\r\n    abstract cartesianWithHeightDelta(cartesian: Cesium.Cartesian3, height: number): Cesium.Cartesian3;\r\n\r\n    abstract cartesianToCartographic(cartesian: Cesium.Cartesian3): Cesium.Cartographic;\r\n\r\n    abstract cartographicToCartesian(cartographic: Cesium.Cartographic): Cesium.Cartesian3;\r\n}\r\n\r\nexport abstract class ToolContextBase extends ToolContext {\r\n    private _tool: Tool;\r\n\r\n    protected constructor() {\r\n        super();\r\n        this._tool = NO_TOOL;\r\n    }\r\n\r\n    set tool(tool: Tool) {\r\n        if (tool !== this._tool) {\r\n            this._tool.deactivate();\r\n            this._tool.context = null;\r\n            this._tool = tool;\r\n            this._tool.context = this;\r\n            this._tool.activate();\r\n        }\r\n    }\r\n\r\n    get tool(): Tool {\r\n        return this._tool;\r\n    }\r\n\r\n    onLeftClick(leftClick: Click): void {\r\n        this._tool.handleLeftClick(leftClick);\r\n    }\r\n\r\n    onLeftDoubleClick(leftClick: Click): void {\r\n        this._tool.handleLeftDoubleClick(leftClick);\r\n    }\r\n\r\n    onMouseMove(movement: Movement): void {\r\n        this._tool.handleMouseMove(movement);\r\n    }\r\n}\r\n\r\n\r\nexport class CesiumToolContext extends ToolContextBase {\r\n    private _viewer: Cesium.Viewer;\r\n    private _ellipsoid: Cesium.Ellipsoid;\r\n    private _toolDataSource: Cesium.CustomDataSource;\r\n    private _handler: Cesium.ScreenSpaceEventHandler;\r\n    private _onNewEntity?: (entity: Cesium.Entity) => void;\r\n\r\n    constructor(viewer: Cesium.Viewer, onNewEntity?: (entity: Cesium.Entity) => void) {\r\n        super();\r\n        this._viewer = viewer;\r\n        this._ellipsoid = viewer.scene.globe.ellipsoid;\r\n        this._toolDataSource = new Cesium.CustomDataSource('Tool Data Source');\r\n        viewer.dataSources.add(this._toolDataSource);\r\n        const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);\r\n        handler.setInputAction(leftClick => {\r\n            if (this.tool.isActive()) {\r\n                this.onLeftClick(leftClick);\r\n                this._viewer.scene.requestRender();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        handler.setInputAction(doubleClick => {\r\n            if (this.tool.isActive()) {\r\n                this.onLeftDoubleClick(doubleClick);\r\n                this._viewer.scene.requestRender();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        handler.setInputAction(movement => {\r\n            if (this.tool.isActive()) {\r\n                this.onMouseMove(movement);\r\n                this._viewer.scene.requestRender();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this._handler = handler;\r\n        this._onNewEntity = onNewEntity;\r\n    }\r\n\r\n    newEntity(entity: Cesium.Entity): void {\r\n        if (this._onNewEntity) {\r\n            this._onNewEntity(new Cesium.Entity(entity));\r\n        } else {\r\n            this._viewer.entities.add(entity);\r\n        }\r\n    }\r\n\r\n    addToolEntity(entity: Cesium.Entity): void {\r\n        this._toolDataSource.entities.add(entity);\r\n    }\r\n\r\n    removeAllToolEntities(): void {\r\n        this._toolDataSource.entities.removeAll();\r\n    }\r\n\r\n    pickEllipsoid(position: Cesium.Cartesian2): Cesium.Cartesian3 {\r\n        return this._viewer.camera.pickEllipsoid(position, this._ellipsoid);\r\n    }\r\n\r\n    cartesianWithHeightDelta(cartesian: Cesium.Cartesian3, height: number): Cesium.Cartesian3 {\r\n        const cartographic = this._ellipsoid.cartesianToCartographic(cartesian);\r\n        cartographic.height += height;\r\n        return this._ellipsoid.cartographicToCartesian(cartographic);\r\n    }\r\n\r\n    cartesianToCartographic(cartesian: Cesium.Cartesian3): Cesium.Cartographic {\r\n        return this._ellipsoid.cartesianToCartographic(cartesian);\r\n    }\r\n\r\n    cartographicToCartesian(cartographic: Cesium.Cartographic): Cesium.Cartesian3 {\r\n        return this._ellipsoid.cartographicToCartesian(cartographic);\r\n    }\r\n\r\n    destroy() {\r\n        this._handler.destroy();\r\n    }\r\n}\r\n\r\nexport interface Tool {\r\n    readonly type: string;\r\n\r\n    context: ToolContext | null;\r\n\r\n    isActive(): boolean;\r\n\r\n    activate(): void;\r\n\r\n    deactivate(): void;\r\n\r\n    handleLeftClick(leftClick: Click): void;\r\n\r\n    handleLeftDoubleClick(leftClick: Click): void;\r\n\r\n    handleMouseMove(movement: Movement): void;\r\n}\r\n\r\n\r\nabstract class ToolBase implements Tool {\r\n    readonly type: string;\r\n    private _context: ToolContext | null = null;\r\n\r\n    constructor(type: string) {\r\n        this.type = type;\r\n    }\r\n\r\n    set context(context: ToolContext | null) {\r\n        this._context = context;\r\n    }\r\n\r\n    get context(): ToolContext | null {\r\n        return this._context;\r\n    }\r\n\r\n    isActive(): boolean {\r\n        return this._context !== null;\r\n    }\r\n\r\n    activate() {\r\n    }\r\n\r\n    deactivate() {\r\n    }\r\n\r\n    handleLeftClick(leftClick: Click) {\r\n    }\r\n\r\n    handleLeftDoubleClick(leftClick: Click) {\r\n    }\r\n\r\n    handleMouseMove(movement: Movement) {\r\n    }\r\n}\r\n\r\nexport class NoTool extends ToolBase {\r\n    constructor() {\r\n        super('NoTool');\r\n    }\r\n}\r\n\r\nexport const NO_TOOL = new NoTool();\r\n\r\nexport class PointTool extends ToolBase {\r\n\r\n    constructor() {\r\n        super('PointTool');\r\n    }\r\n\r\n    handleLeftClick(leftClick) {\r\n        const position = this.context.pickEllipsoid(leftClick.position);\r\n        if (isDefined(position)) {\r\n            this.context.newEntity(new Cesium.Entity({\r\n                                                         position,\r\n                                                         point: {\r\n                                                             pixelSize: 6,\r\n                                                             //color: Cesium.Color.RED,\r\n                                                             //outlineColor: Cesium.Color.WHITE,\r\n                                                             outlineWidth: 1\r\n                                                         },\r\n                                                     }));\r\n        }\r\n    }\r\n}\r\n\r\nclass PolyTool extends ToolBase {\r\n\r\n    private readonly genPolygon: boolean;\r\n\r\n    // Note polylinePositions and polygonPositions differ in height\r\n    private polylinePositions: Cesium.Cartesian3[] | null = null;\r\n    private polygonPositions: Cesium.Cartesian3[] | null = null;\r\n\r\n    private polylineEntity: Cesium.Entity | null = null;\r\n    private polygonEntity: Cesium.Entity | null = null;\r\n\r\n    private hasRubberband: boolean = false;\r\n\r\n    constructor(type: string, genPolygon: boolean) {\r\n        super(type);\r\n        this.genPolygon = genPolygon;\r\n    }\r\n\r\n    deactivate() {\r\n        this.reset();\r\n    }\r\n\r\n    handleLeftClick(leftClick: Click) {\r\n        this.addPoint(leftClick.position);\r\n    }\r\n\r\n    handleMouseMove(movement: Movement) {\r\n        this.moveLastPoint(movement.endPosition);\r\n    }\r\n\r\n    handleLeftDoubleClick(leftClick: Click) {\r\n        this.endInteraction();\r\n    }\r\n\r\n    private addPoint(screenPosition: Cesium.Cartesian2) {\r\n        let position = this.context.pickEllipsoid(screenPosition);\r\n        if (isDefined(position)) {\r\n            position = this.context.cartesianWithHeightDelta(position, pointHeight);\r\n            // Add point graphics\r\n            if (this.updatePositions(position)) {\r\n                this.context.addToolEntity(new Cesium.Entity({\r\n                                                                 position,\r\n                                                                 //allowPicking: false,\r\n                                                                 point: {\r\n                                                                     show: true,\r\n                                                                     outlineColor: Cesium.Color.BLACK,\r\n                                                                     outlineWidth: 1,\r\n                                                                     color: pointColor,\r\n                                                                     pixelSize: 10,\r\n                                                                 }\r\n                                                             }));\r\n            }\r\n            this.hasRubberband = false;\r\n        }\r\n    }\r\n\r\n    private endInteraction() {\r\n        if (this.polygonEntity !== null) {\r\n            this.context.newEntity(new Cesium.Entity({\r\n                                                         polygon: {\r\n                                                             // check: why doesn't this work?\r\n                                                             // hierarchy: this.polygonEntity.hierarchy,\r\n                                                             hierarchy: new Cesium.PolygonHierarchy(this.polygonPositions),\r\n                                                             material: polygonColor,\r\n                                                         }\r\n                                                     }));\r\n        } else if (this.polylineEntity !== null) {\r\n            this.context.newEntity(new Cesium.Entity({\r\n                                                         polyline: {\r\n                                                             // check: why doesn't this work?\r\n                                                             // positions: this.polylinePositions.positions,\r\n                                                             positions: this.polylinePositions,\r\n                                                             material: polylineColor,\r\n                                                         }\r\n                                                     }));\r\n        }\r\n        this.reset();\r\n    }\r\n\r\n    private moveLastPoint(screenPosition: Cesium.Cartesian2) {\r\n        if (!this.polylinePositions) {\r\n            return;\r\n        }\r\n        const position = this.context.pickEllipsoid(screenPosition);\r\n        if (isDefined(position)) {\r\n            this.updatePositions(position);\r\n            this.hasRubberband = true;\r\n        }\r\n    }\r\n\r\n    private updatePositions(position: Cesium.Cartesian3): boolean {\r\n        const polylinePoint = this.context.cartesianWithHeightDelta(position, polylineHeight);\r\n        let newPointAdded = true;\r\n        if (this.polylinePositions === null) {\r\n            this.polylinePositions = [polylinePoint];\r\n        } else {\r\n            const numPoints = this.polylinePositions.length;\r\n            if (this.hasRubberband) {\r\n                this.polylinePositions[numPoints - 1] = polylinePoint;\r\n            } else {\r\n                if (polylinePoint.equals(this.polylinePositions[numPoints - 1])) {\r\n                    newPointAdded = false;\r\n                } else {\r\n                    this.polylinePositions.push(polylinePoint);\r\n                }\r\n            }\r\n        }\r\n        if (this.polylinePositions.length > 1) {\r\n            let positions = this.polylinePositions.slice();\r\n            if (!this.polylineEntity) {\r\n                this.polylineEntity = new Cesium.Entity({\r\n                                                            //allowPicking: false,\r\n                                                            polyline: {\r\n                                                                positions: positions,\r\n                                                                width: polylineWidth,\r\n                                                                //followSurface: true,\r\n                                                                material: polylineColor,\r\n                                                            }\r\n                                                        })\r\n                this.context.addToolEntity(this.polylineEntity);\r\n            } else if (newPointAdded) {\r\n                this.polylineEntity.polyline.positions = new Cesium.ConstantProperty(positions);\r\n            }\r\n        }\r\n\r\n        if (newPointAdded && this.genPolygon) {\r\n            const polygonPoint = this.context.cartesianWithHeightDelta(position, polygonHeight);\r\n            if (!this.polygonPositions) {\r\n                this.polygonPositions = [polygonPoint];\r\n            } else {\r\n                const numPoints = this.polygonPositions.length;\r\n                if (this.hasRubberband) {\r\n                    this.polygonPositions[numPoints - 1] = polygonPoint;\r\n                } else {\r\n                    this.polygonPositions.push(polygonPoint);\r\n                }\r\n            }\r\n            if (this.polygonPositions.length > 2) {\r\n                let positions = this.polygonPositions.slice();\r\n                if (!this.polygonEntity) {\r\n                    this.polygonEntity = new Cesium.Entity({\r\n                                                               //allowPicking: false,\r\n                                                               polygon: {\r\n                                                                   hierarchy: new Cesium.PolygonHierarchy(positions),\r\n                                                                   material: polygonColor,\r\n                                                               }\r\n                                                           });\r\n                    this.context.addToolEntity(this.polygonEntity);\r\n                } else {\r\n                    this.polygonEntity.polygon.hierarchy = new Cesium.ConstantProperty(new Cesium.PolygonHierarchy(positions));\r\n                }\r\n            }\r\n        }\r\n\r\n        return newPointAdded;\r\n    }\r\n\r\n    private reset() {\r\n        this.polylinePositions = null;\r\n        this.polygonPositions = null;\r\n        this.polylineEntity = null;\r\n        this.polygonEntity = null;\r\n        this.hasRubberband = false;\r\n        if (this.context !== null) {\r\n            this.context.removeAllToolEntities();\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class PolylineTool extends PolyTool {\r\n\r\n    constructor() {\r\n        super('PolylineTool', false);\r\n    }\r\n}\r\n\r\nexport class PolygonTool extends PolyTool {\r\n\r\n    constructor() {\r\n        super('PolygonTool', true);\r\n    }\r\n}\r\n\r\nexport class BoxTool extends ToolBase {\r\n\r\n    private position1: Cesium.Cartesian3 | null = null;\r\n    private position2: Cesium.Cartesian3 | null = null;\r\n    private polygonEntity: Cesium.Entity | null = null;\r\n\r\n    constructor() {\r\n        super('BoxTool');\r\n    }\r\n\r\n    deactivate() {\r\n        this.reset();\r\n    }\r\n\r\n    handleLeftClick(leftClick: Click) {\r\n        this.setPosition(leftClick.position, true);\r\n    }\r\n\r\n    handleLeftDoubleClick(leftClick: Click) {\r\n        this.setPosition(leftClick.position, true);\r\n    }\r\n\r\n    handleMouseMove(movement: Movement) {\r\n        if (this.position1) {\r\n            this.setPosition(movement.endPosition, false);\r\n        }\r\n    }\r\n\r\n    private setPosition(screenPosition: Cesium.Cartesian2, doAdd: boolean) {\r\n        const position = this.context.pickEllipsoid(screenPosition);\r\n        if (isDefined(position)) {\r\n            if (this.position1 === null) {\r\n                this.position1 = position;\r\n            } else {\r\n                this.position2 = position;\r\n                const positions = this.getPositions();\r\n                if (doAdd) {\r\n                    this.context.newEntity(new Cesium.Entity({\r\n                                                                 polygon: {\r\n                                                                     hierarchy: new Cesium.PolygonHierarchy(positions),\r\n                                                                     material: polygonColor,\r\n                                                                 }\r\n                                                             }));\r\n                    this.reset();\r\n                    return;\r\n                }\r\n                if (this.polygonEntity === null) {\r\n                    this.polygonEntity = new Cesium.Entity({\r\n                                                               // allowPicking: false,\r\n                                                               polygon: {\r\n                                                                   hierarchy: new Cesium.PolygonHierarchy(positions),\r\n                                                                   material: polygonColor,\r\n                                                               }\r\n                                                           });\r\n                    this.context.addToolEntity(this.polygonEntity);\r\n                } else {\r\n                    this.polygonEntity.polygon.hierarchy = new Cesium.ConstantProperty(new Cesium.PolygonHierarchy(positions));\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getPositions(): Cesium.Cartesian3[] {\r\n        const carto1 = this.context.cartesianToCartographic(this.position1);\r\n        const carto2 = this.context.cartesianToCartographic(this.position2);\r\n        const lon1 = carto1.longitude;\r\n        const lat1 = carto1.latitude;\r\n        const lon2 = carto2.longitude;\r\n        const lat2 = carto2.latitude;\r\n        const height = 0.5 * (carto1.height + carto2.height);\r\n        return [\r\n            this.context.cartographicToCartesian(new Cesium.Cartographic(lon1, lat1, height)),\r\n            this.context.cartographicToCartesian(new Cesium.Cartographic(lon2, lat1, height)),\r\n            this.context.cartographicToCartesian(new Cesium.Cartographic(lon2, lat2, height)),\r\n            this.context.cartographicToCartesian(new Cesium.Cartographic(lon1, lat2, height)),\r\n        ];\r\n    }\r\n\r\n    reset() {\r\n        this.position1 = null;\r\n        this.position2 = null;\r\n        this.polygonEntity = null;\r\n        if (this.context !== null) {\r\n            this.context.removeAllToolEntities();\r\n        }\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport * as Cesium from 'cesium';\r\nimport { diff } from 'deep-object-diff'\r\nimport { Feature, FeatureCollection, Point } from 'geojson';\r\nimport { ContextMenu } from '@blueprintjs/core';\r\n\r\nimport { ExternalObjectComponent, IExternalObjectComponentProps } from '../ExternalObjectComponent'\r\nimport { isBoolean, isNumber, isString } from '../../../common/types';\r\nimport { arrayDiff } from '../../../common/array-diff';\r\nimport { SimpleStyle } from '../../../common/geojson-simple-style';\r\nimport { SplitSlider } from './SplitSlider';\r\nimport {\r\n    applyStyleToEntity,\r\n    applyStyleToEntityCollection,\r\n    BaseMapOptions,\r\n    canvasToCartographic,\r\n    clientToCanvas,\r\n    getEntityByEntityId,\r\n    pickEntity, setViewerBaseMap,\r\n    simpleStyleToCesium\r\n} from './cesium-util';\r\nimport {\r\n    BoxTool,\r\n    CesiumToolContext,\r\n    GeometryToolType,\r\n    NO_TOOL,\r\n    PointTool,\r\n    PolygonTool,\r\n    PolylineTool\r\n} from './geometry-tool';\r\n\r\n\r\ninterface Placemark extends Feature<Point> {\r\n    id: string;\r\n}\r\n\r\ninterface PlacemarkCollection extends FeatureCollection<Point> {\r\n    features: Placemark[];\r\n}\r\n\r\n/**\r\n * Describes a layer to be displayed on the Cesium globe.\r\n */\r\nexport interface LayerDescriptor {\r\n    id: string;\r\n    name?: string | null;\r\n    visible: boolean;\r\n}\r\n\r\n/**\r\n * Describes an image layer (imagery provider) to be displayed on the Cesium globe.\r\n */\r\nexport interface ImageLayerDescriptor extends LayerDescriptor {\r\n    opacity?: number;\r\n    brightness?: number;\r\n    contrast?: number;\r\n    hue?: number;\r\n    saturation?: number;\r\n    gamma?: number;\r\n    splitMode: 'right' | 'left' | 'off';\r\n\r\n    imageryProvider: ((viewer: Cesium.Viewer, options: any) => Cesium.ImageryProvider) | Cesium.ImageryProvider;\r\n    imageryProviderOptions: any;\r\n}\r\n\r\n/**\r\n * Describes a vector data layer (entity data source) to be displayed on the Cesium globe.\r\n */\r\nexport interface VectorLayerDescriptor extends LayerDescriptor {\r\n    style?: SimpleStyle;\r\n    entityStyles?: { [entityId: string]: SimpleStyle };\r\n    dataSource: ((viewer: Cesium.Viewer, options: any) => Cesium.DataSource | Promise<Cesium.DataSource>) | Cesium.DataSource | Promise<Cesium.DataSource>;\r\n    dataSourceOptions?: any;\r\n}\r\n\r\nexport interface LayerDescriptors {\r\n    vectorLayerDescriptors?: VectorLayerDescriptor[];\r\n    imageLayerDescriptors?: ImageLayerDescriptor[];\r\n}\r\n\r\n// Bing Maps Key associated with Account Id 1441410 (= norman.fomferra@brockmann-consult.de)\r\n// * Application Name: CCI Toolbox\r\n// * Key / Application Type: Basic / Dev/Test\r\n// * Application URL: http://cci.esa.int/\r\n//\r\n\r\nCesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhNzYzYzJjYS00YzY5LTQzN2ItOWQzNy03NWZmZTQyMjU1ZDgiLCJpZCI6MjAwNTAsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NzY2NjU5ODN9.f-uN5Ocljn77-O2aDNEGPSr8HRHym5RA0aqSWKMgYYk';\r\n\r\ninterface CesiumGlobeStateBase {\r\n    selectedPlacemarkId?: string;\r\n    baseMapOptions: BaseMapOptions | null;\r\n    imageLayerDescriptors?: ImageLayerDescriptor[];\r\n    vectorLayerDescriptors?: VectorLayerDescriptor[];\r\n    overlayHtml?: HTMLElement | null;\r\n    splitLayerPosition?: number;\r\n    geometryToolType?: GeometryToolType;\r\n}\r\n\r\ntype DataSourceMap = { [layerId: string]: Cesium.DataSource };\r\n\r\ninterface CesiumGlobeState extends CesiumGlobeStateBase {\r\n    dataSourceMap: DataSourceMap;\r\n}\r\n\r\nexport type GeographicPosition = { latitude: number, longitude: number, height?: number };\r\nexport type CanvasPosition = { x: number, y: number };\r\n\r\nexport interface ICesiumGlobeProps extends IExternalObjectComponentProps<Cesium.Viewer, CesiumGlobeState>, CesiumGlobeStateBase {\r\n    offlineMode?: boolean;\r\n    onLeftUp?: (geoPos: GeographicPosition, canvasPos: CanvasPosition, entity?: Cesium.Entity) => void;\r\n    onLeftClick?: (geoPos: GeographicPosition, canvasPos: CanvasPosition, entity?: Cesium.Entity) => void;\r\n    onRightClick?: (geoPos: GeographicPosition, canvasPos: CanvasPosition, entity?: Cesium.Entity) => void;\r\n    onMouseMove?: (geoPos: GeographicPosition, canvasPos: CanvasPosition) => void;\r\n    renderContextMenu?: (geoPos: GeographicPosition, canvasPos: CanvasPosition, entity?: Cesium.Entity) => JSX.Element | null;\r\n    onSelectedEntityChanged?: (selectedEntity: Cesium.Entity | null) => void;\r\n    onNewEntityAdded?: (newEntity: Cesium.Entity) => void;\r\n    onViewerMounted?: (id: string, viewer: Cesium.Viewer) => void;\r\n    onViewerUnmounted?: (id: string, viewer: Cesium.Viewer) => void;\r\n    onLayerSplitPosChange?: (splitLayerPos: number) => void;\r\n}\r\n\r\nconst CENTRAL_EUROPE_BOX = Cesium.Rectangle.fromDegrees(-30, 20, 40, 80);\r\nconst EMPTY_ARRAY = [];\r\nCesium.Camera.DEFAULT_VIEW_RECTANGLE = CENTRAL_EUROPE_BOX;\r\nCesium.Camera.DEFAULT_VIEW_FACTOR = 0;\r\n\r\ninterface ICesiumGlobeState {\r\n    isContextMenuOpen: boolean;\r\n}\r\n\r\n/**\r\n * A component that wraps a Cesium 3D Globe.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class CesiumGlobe extends ExternalObjectComponent<Cesium.Viewer, CesiumGlobeState, ICesiumGlobeProps, ICesiumGlobeState> {\r\n    private cesiumEventHandler: any;\r\n    private selectedEntityChangeHandler: any;\r\n    private toolContext: CesiumToolContext;\r\n\r\n    constructor(props: ICesiumGlobeProps) {\r\n        super(props);\r\n        this.handleRemoteBaseLayerError = this.handleRemoteBaseLayerError.bind(this);\r\n        this.state = {isContextMenuOpen: false};\r\n    }\r\n\r\n    get viewer(): Cesium.Viewer | null {\r\n        const externalObjectRef = this.getExternalObjectRef();\r\n        return !!externalObjectRef ? externalObjectRef.object : null;\r\n    }\r\n\r\n    protected renderChildren() {\r\n        if (isNumber(this.props.splitLayerPosition)) {\r\n            return (<SplitSlider splitPos={this.props.splitLayerPosition}\r\n                                 onChange={this.props.onLayerSplitPosChange}/>);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    newContainer(id: string): HTMLElement {\r\n        const div = document.createElement('div');\r\n        div.setAttribute('id', 'cesium-container-' + id);\r\n        div.setAttribute('style', 'width: 100%; height: 100%; overflow: hidden;');\r\n        return div;\r\n    }\r\n\r\n    newExternalObject(parentContainer: HTMLElement, container: HTMLElement): Cesium.Viewer {\r\n\r\n        let baseLayerImageryProvider;\r\n        if (this.props.offlineMode) {\r\n            baseLayerImageryProvider = CesiumGlobe.getStaticNaturalEarthImageryProvider();\r\n        }\r\n\r\n        const cesiumViewerOptions: Cesium.Viewer.ConstructorOptions = {\r\n            animation: false,\r\n            baseLayerPicker: false,\r\n            selectionIndicator: true,\r\n            fullscreenButton: false,\r\n            geocoder: false,\r\n            homeButton: false,\r\n            infoBox: false,\r\n            sceneModePicker: true,\r\n            timeline: false,\r\n            navigationHelpButton: false,\r\n            navigationInstructionsInitiallyVisible: false,\r\n            automaticallyTrackDataSourceClocks: false,\r\n            imageryProvider: baseLayerImageryProvider,\r\n            // Create a viewer that will not render frames based on changes in simulation time.\r\n            // https://cesium.com/blog/2018/01/24/cesium-scene-rendering-performance/\r\n            requestRenderMode: true,\r\n            maximumRenderTimeChange: Infinity,\r\n        };\r\n\r\n        // Create the CesiumCesium.Viewer\r\n        //noinspection UnnecessaryLocalVariableJS\r\n        const viewer = new Cesium.Viewer(container, cesiumViewerOptions);\r\n\r\n        // Register context mnenu\r\n        // Note, for some reason we cannot use BlueprintJS' @ContextMenuTarget interface here\r\n        container.oncontextmenu = (event: PointerEvent) => this.handleContextMenu(viewer, event);\r\n\r\n        if (this.props.debug) {\r\n            // Show a little overlay panel with FPS. Useful for optimisations.\r\n            viewer.scene.debugShowFramesPerSecond = true;\r\n        }\r\n\r\n        if (!this.props.offlineMode) {\r\n            setViewerBaseMap(viewer, this.props.baseMapOptions);\r\n        }\r\n\r\n        // knockout is used by Cesium to update the style attributes of the selectionIndicator\r\n        // when using multiple views this breaks, for unknown reason\r\n        // to get this working we update the 'style' attribute of the selectionIndicatorElement manually\r\n        // https://github.com/AnalyticalGraphicsInc/cesium/blob/master/Source/Widgets/SelectionIndicator/SelectionIndicatorViewModel.js\r\n\r\n        const viewModel = viewer.selectionIndicator.viewModel;\r\n\r\n        const originalUpdate = viewModel.update;\r\n        viewModel.update = function () {\r\n            // TODO (forman): Note viewModel.update() is called all over the time.\r\n            //  Check if this is cause for OOM-Error on Firefox.\r\n            // console.log(\"newExternalObject: viewModel.update()!\");\r\n            const vm = viewModel as any;\r\n            originalUpdate.apply(this);\r\n            const styleValue = `top : ${vm._screenPositionY}; left : ${vm._screenPositionX};`;\r\n            vm._selectionIndicatorElement.setAttribute('style', styleValue);\r\n        };\r\n\r\n        return viewer;\r\n    }\r\n\r\n    private handleRemoteBaseLayerError(event) {\r\n        console.error('CesiumGlobe: error: ', event.message, event.timesRetried, event.error);\r\n        let ref = this.getExternalObjectRef();\r\n        if (ref) {\r\n            const viewer: Cesium.Viewer = ref.object;\r\n            // On error, exchange the remote base layer with a static one.\r\n            let imageryLayer = viewer.imageryLayers.get(0);\r\n            viewer.imageryLayers.remove(imageryLayer, true);\r\n            let staticNaturalEarthImageryProvider = CesiumGlobe.getStaticNaturalEarthImageryProvider();\r\n            viewer.imageryLayers.addImageryProvider(staticNaturalEarthImageryProvider, 0);\r\n        }\r\n    }\r\n\r\n    private handleContextMenu(viewer: Cesium.Viewer, event: PointerEvent) {\r\n        const renderContextMenu = this.props.renderContextMenu;\r\n        if (renderContextMenu) {\r\n            const screenPos = new Cesium.Cartesian2(event.clientX, event.clientY);\r\n            const canvasPos = clientToCanvas(viewer, screenPos);\r\n            const cartographic = canvasToCartographic(viewer, canvasPos, true);\r\n            const entity = pickEntity(viewer, canvasPos);\r\n            const contextMenu = renderContextMenu(cartographic, canvasPos, entity);\r\n            if (contextMenu) {\r\n                event.preventDefault();\r\n                // invoke static API, getting coordinates from mouse event\r\n                ContextMenu.show(\r\n                    contextMenu,\r\n                    {left: event.clientX, top: event.clientY},\r\n                    () => this.setState({isContextMenuOpen: false}),\r\n                );\r\n                this.setState({isContextMenuOpen: true});\r\n            }\r\n        }\r\n    }\r\n\r\n    private static getStaticNaturalEarthImageryProvider() {\r\n        // Cesium.buildModuleUrl.setBaseUrl('./');\r\n        const baseUrl = Cesium.buildModuleUrl('');\r\n        const imageryProviderOptions = {\r\n            url: baseUrl + 'Assets/Textures/NaturalEarthII/{z}/{x}/{reverseY}.jpg',\r\n            tilingScheme: new Cesium.GeographicTilingScheme(),\r\n            minimumLevel: 0,\r\n            maximumLevel: 2,\r\n            credit: 'Natural Earth II: Tileset Copyright © 2012-2014 Analytical Graphics, Inc. (AGI). Original data courtesy Natural Earth and in the public domain.'\r\n        };\r\n        return new Cesium.UrlTemplateImageryProvider(imageryProviderOptions);\r\n    }\r\n\r\n    propsToExternalObjectState(props: ICesiumGlobeProps & CesiumGlobeState, prevState?: CesiumGlobeState): CesiumGlobeState {\r\n        const selectedPlacemarkId = props.selectedPlacemarkId;\r\n        const baseMapOptions = props.baseMapOptions;\r\n        const imageLayerDescriptors = props.imageLayerDescriptors || EMPTY_ARRAY;\r\n        const vectorLayerDescriptors = props.vectorLayerDescriptors || EMPTY_ARRAY;\r\n        const overlayHtml = props.overlayHtml || null;\r\n        const geometryToolType = props.geometryToolType;\r\n        const splitLayerPosition = props.splitLayerPosition;\r\n        const dataSourceMap = (prevState && prevState.dataSourceMap) || {};\r\n        return {\r\n            selectedPlacemarkId,\r\n            baseMapOptions,\r\n            imageLayerDescriptors,\r\n            vectorLayerDescriptors,\r\n            overlayHtml,\r\n            geometryToolType,\r\n            splitLayerPosition,\r\n            dataSourceMap,\r\n        };\r\n    }\r\n\r\n    updateExternalObject(viewer: Cesium.Viewer, prevState: CesiumGlobeState, nextState: CesiumGlobeState): void {\r\n\r\n        const prevBaseMapOptions = (prevState && prevState.baseMapOptions) || null;\r\n        const prevSelectedPlacemarkId = (prevState && prevState.selectedPlacemarkId) || null;\r\n        const prevImageLayerDescriptors = (prevState && prevState.imageLayerDescriptors) || EMPTY_ARRAY;\r\n        const prevVectorLayerDescriptors = (prevState && prevState.vectorLayerDescriptors) || EMPTY_ARRAY;\r\n        const prevOverlayHtml = (prevState && prevState.overlayHtml) || null;\r\n        const prevSplitLayerPosition = (prevState && prevState.splitLayerPosition);\r\n        const prevGeometryToolType = (prevState && prevState.geometryToolType) || 'NoTool';\r\n\r\n        const nextBaseMapOptions = nextState.baseMapOptions;\r\n        const nextSelectedPlacemarkId = nextState.selectedPlacemarkId || null;\r\n        const nextImageLayerDescriptors = nextState.imageLayerDescriptors || EMPTY_ARRAY;\r\n        const nextVectorLayerDescriptors = nextState.vectorLayerDescriptors || EMPTY_ARRAY;\r\n        const nextOverlayHtml = nextState.overlayHtml;\r\n        const nextSplitLayerPosition = nextState.splitLayerPosition;\r\n        const nextGeometryToolType = nextState.geometryToolType || 'NoTool';\r\n\r\n        let shouldRequestRender = false;\r\n\r\n        if (prevBaseMapOptions !== nextBaseMapOptions && !this.props.offlineMode) {\r\n            setViewerBaseMap(viewer, nextBaseMapOptions);\r\n        }\r\n\r\n        if (prevImageLayerDescriptors !== nextImageLayerDescriptors) {\r\n            this.updateImageLayers(viewer,\r\n                                   prevImageLayerDescriptors,\r\n                                   nextImageLayerDescriptors);\r\n            shouldRequestRender = true;\r\n        }\r\n        if (prevVectorLayerDescriptors !== nextVectorLayerDescriptors) {\r\n            this.updateVectorLayers(viewer,\r\n                                    prevVectorLayerDescriptors,\r\n                                    nextVectorLayerDescriptors,\r\n                                    nextState.dataSourceMap,\r\n                                    nextSelectedPlacemarkId);\r\n            shouldRequestRender = true;\r\n        }\r\n        if (prevSelectedPlacemarkId !== nextSelectedPlacemarkId) {\r\n            this.updatePlacemarkSelection(viewer, nextSelectedPlacemarkId);\r\n            shouldRequestRender = true;\r\n        }\r\n        if (prevOverlayHtml !== nextOverlayHtml) {\r\n            CesiumGlobe.updateOverlayHtml(viewer, prevOverlayHtml, nextOverlayHtml);\r\n            shouldRequestRender = true;\r\n        }\r\n        if (prevSplitLayerPosition !== nextSplitLayerPosition) {\r\n            if (isNumber(nextSplitLayerPosition)) {\r\n                viewer.scene.imagerySplitPosition = nextSplitLayerPosition;\r\n            }\r\n            shouldRequestRender = true;\r\n        }\r\n        if (prevGeometryToolType !== nextGeometryToolType) {\r\n            this.activateGeometryTool(viewer, nextGeometryToolType);\r\n        }\r\n        if (shouldRequestRender) {\r\n            // Explicitly render a new frame\r\n            viewer.scene.requestRender();\r\n        }\r\n    }\r\n\r\n    externalObjectMounted(viewer: Cesium.Viewer, props: Readonly<ICesiumGlobeProps>): void {\r\n\r\n        function handleInputAction(canvasPosition, shouldPickEntity: boolean, callback) {\r\n            if (callback) {\r\n                // Check: Maybe we should disable events while a tool is active\r\n                // if (this.props.geometryToolType !== \"NoTool\") {\r\n                //     return;\r\n                // }\r\n                const cartographic = canvasToCartographic(viewer, canvasPosition, true);\r\n                if (shouldPickEntity) {\r\n                    callback(cartographic, canvasPosition, pickEntity(viewer, canvasPosition));\r\n                } else {\r\n                    callback(cartographic, canvasPosition);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.cesiumEventHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);\r\n        this.cesiumEventHandler.setInputAction(\r\n            (event) => handleInputAction(event.position, true, props.onLeftUp),\r\n            Cesium.ScreenSpaceEventType.LEFT_UP\r\n        );\r\n        this.cesiumEventHandler.setInputAction(\r\n            (event) => handleInputAction(event.position, true, props.onLeftClick),\r\n            Cesium.ScreenSpaceEventType.LEFT_CLICK\r\n        );\r\n        this.cesiumEventHandler.setInputAction(\r\n            (event) => handleInputAction(event.position, true, props.onRightClick),\r\n            Cesium.ScreenSpaceEventType.RIGHT_CLICK\r\n        );\r\n        this.cesiumEventHandler.setInputAction(\r\n            (event) => handleInputAction(event.endPosition, false, props.onMouseMove),\r\n            Cesium.ScreenSpaceEventType.MOUSE_MOVE\r\n        );\r\n\r\n        this.selectedEntityChangeHandler = (selectedEntity: Cesium.Entity | null) => {\r\n            if (props.onSelectedEntityChanged) {\r\n                props.onSelectedEntityChanged(selectedEntity);\r\n            }\r\n        };\r\n        viewer.selectedEntityChanged.addEventListener(this.selectedEntityChangeHandler);\r\n\r\n        this.toolContext = new CesiumToolContext(viewer, props.onNewEntityAdded);\r\n        this.activateGeometryTool(viewer, props.geometryToolType);\r\n\r\n        viewer.scene.requestRender();\r\n\r\n        if (props.onViewerMounted) {\r\n            props.onViewerMounted(props.id, viewer);\r\n        }\r\n    }\r\n\r\n    externalObjectUnmounted(viewer: Cesium.Viewer, props: Readonly<ICesiumGlobeProps>): void {\r\n        if (this.cesiumEventHandler) {\r\n            this.cesiumEventHandler.destroy();\r\n            this.cesiumEventHandler = null;\r\n        }\r\n\r\n        if (this.selectedEntityChangeHandler) {\r\n            viewer.selectedEntityChanged.removeEventListener(this.selectedEntityChangeHandler);\r\n            this.selectedEntityChangeHandler = null;\r\n        }\r\n\r\n        if (this.toolContext) {\r\n            this.toolContext.destroy();\r\n            this.toolContext = null;\r\n        }\r\n\r\n        if (props.onViewerUnmounted) {\r\n            props.onViewerUnmounted(props.id, viewer);\r\n        }\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private updatePlacemarkSelection(viewer: Cesium.Viewer, selectedPlacemarkId: string | null) {\r\n        const selectedEntity = (selectedPlacemarkId && getEntityByEntityId(viewer, selectedPlacemarkId)) || null;\r\n        const selectedEntityInViewer = viewer.selectedEntity || null;\r\n        if (this.props.debug) {\r\n            console.log('CesiumGlobe: updating selected placemark: ', selectedEntityInViewer, selectedEntity);\r\n        }\r\n        if (selectedEntityInViewer !== selectedEntity) {\r\n            viewer.selectedEntity = selectedEntity;\r\n        }\r\n    }\r\n\r\n    private updatePlacemarks(entities: Cesium.EntityCollection,\r\n                             currentPlacemarks: PlacemarkCollection,\r\n                             nextPlacemarks: PlacemarkCollection,\r\n                             style: SimpleStyle): Promise<Cesium.GeoJsonDataSource[]> {\r\n        if (this.props.debug) {\r\n            console.log('CesiumGlobe: updating placemarks');\r\n        }\r\n        const actions = arrayDiff<Placemark>((currentPlacemarks && currentPlacemarks.features) || EMPTY_ARRAY,\r\n                                             (nextPlacemarks && nextPlacemarks.features) || EMPTY_ARRAY);\r\n        const promises: Promise<Cesium.GeoJsonDataSource>[] = [];\r\n        for (let action of actions) {\r\n            if (this.props.debug) {\r\n                console.log('CesiumGlobe: next placemark action', action);\r\n            }\r\n            switch (action.type) {\r\n                case 'ADD': {\r\n                    const placemark = action.newElement;\r\n                    const visible = placemark.properties['visible'];\r\n                    const dataSourcePromise = Cesium.GeoJsonDataSource.load(placemark, simpleStyleToCesium(style));\r\n                    promises.push(dataSourcePromise.then(dataSource => {\r\n                        CesiumGlobe.moveEntities(dataSource.entities, entities, isBoolean(visible) ? visible : true);\r\n                        return dataSource;\r\n                    }));\r\n                    break;\r\n                }\r\n                case 'REMOVE': {\r\n                    let placemark = action.oldElement;\r\n                    entities.removeById(placemark.id);\r\n                    break;\r\n                }\r\n                case 'UPDATE':\r\n                    const oldPlacemark = action.oldElement;\r\n                    const newPlacemark = action.newElement;\r\n                    const visible = newPlacemark.properties['visible'];\r\n                    const dataSourcePromise = Cesium.GeoJsonDataSource.load(newPlacemark, simpleStyleToCesium(style));\r\n                    promises.push(dataSourcePromise.then(dataSource => {\r\n                        entities.removeById(oldPlacemark.id);\r\n                        CesiumGlobe.moveEntities(dataSource.entities, entities, isBoolean(visible) ? visible : true);\r\n                        return dataSource;\r\n                    }));\r\n                    break;\r\n                default:\r\n                    console.error(`CesiumGlobe: unhandled placemark action type \"${action.type}\"`);\r\n            }\r\n        }\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    private updateImageLayers(viewer: Cesium.Viewer,\r\n                              currentLayers: ImageLayerDescriptor[],\r\n                              nextLayers: ImageLayerDescriptor[]) {\r\n        if (this.props.debug) {\r\n            console.log('CesiumGlobe: updating image layers');\r\n        }\r\n        const actions = arrayDiff<ImageLayerDescriptor>(currentLayers, nextLayers);\r\n        let imageryLayer: Cesium.ImageryLayer;\r\n        let newLayer: ImageLayerDescriptor;\r\n        let oldLayer: ImageLayerDescriptor;\r\n        for (let action of actions) {\r\n            if (this.props.debug) {\r\n                console.log('CesiumGlobe: next image layer action', action);\r\n            }\r\n            // cesiumIndex is +1 because of its base layer at cesiumIndex=0\r\n            const cesiumIndex = action.index + 1;\r\n            switch (action.type) {\r\n                case 'ADD':\r\n                    imageryLayer = this.addLayer(viewer, action.newElement, cesiumIndex);\r\n                    if (!imageryLayer) {\r\n                        // TODO (forman): Check, if we still get here.\r\n                        //                Possible reason, new globe views may not have their\r\n                        //                'selectedVariable' layer correctly initialized.\r\n                        console.error('CesiumGlobe: no imageryLayer at index ' + cesiumIndex);\r\n                        break;\r\n                    }\r\n                    CesiumGlobe.setLayerProps(imageryLayer, action.newElement);\r\n                    break;\r\n                case 'REMOVE':\r\n                    imageryLayer = viewer.imageryLayers.get(cesiumIndex);\r\n                    //assert.ok(imageryLayer);\r\n                    if (!imageryLayer) {\r\n                        console.error('CesiumGlobe: no imageryLayer at index ' + cesiumIndex);\r\n                        break;\r\n                    }\r\n                    this.removeLayer(viewer, imageryLayer, cesiumIndex);\r\n                    break;\r\n                case 'UPDATE':\r\n                    imageryLayer = viewer.imageryLayers.get(cesiumIndex);\r\n                    //assert.ok(imageryLayer);\r\n                    if (!imageryLayer) {\r\n                        console.error('CesiumGlobe: no imageryLayer at index ' + cesiumIndex);\r\n                        break;\r\n                    }\r\n                    oldLayer = action.oldElement;\r\n                    newLayer = action.newElement;\r\n                    if (oldLayer.imageryProviderOptions.url !== newLayer.imageryProviderOptions.url) {\r\n                        // It is a pitty that Cesium API does not allow for changing the\r\n                        // URL in place. The current approach, namely remove/add, causes flickering.\r\n                        this.removeLayer(viewer, imageryLayer, cesiumIndex);\r\n                        imageryLayer = this.addLayer(viewer, newLayer, cesiumIndex);\r\n                        imageryLayer.minificationFilter = Cesium.TextureMinificationFilter.NEAREST;\r\n                        imageryLayer.magnificationFilter = Cesium.TextureMagnificationFilter.NEAREST;\r\n                    }\r\n                    // update imageryLayer\r\n                    CesiumGlobe.setLayerProps(imageryLayer, newLayer);\r\n                    break;\r\n                case 'MOVE':\r\n                    imageryLayer = viewer.imageryLayers.get(cesiumIndex);\r\n                    //assert.ok(imageryLayer);\r\n                    if (!imageryLayer) {\r\n                        console.error('CesiumGlobe: no imageryLayer at index ' + cesiumIndex);\r\n                        break;\r\n                    }\r\n                    if (action.numSteps < 0) {\r\n                        for (let i = 0; i < -action.numSteps; i++) {\r\n                            viewer.imageryLayers.lower(imageryLayer);\r\n                        }\r\n                    } else {\r\n                        for (let i = 0; i < action.numSteps; i++) {\r\n                            viewer.imageryLayers.raise(imageryLayer);\r\n                        }\r\n                    }\r\n                    break;\r\n                default:\r\n                    console.error(`CesiumGlobe: unhandled layer action type \"${action.type}\"`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private updateVectorLayers(viewer: Cesium.Viewer,\r\n                               currentLayers: VectorLayerDescriptor[],\r\n                               nextLayers: VectorLayerDescriptor[],\r\n                               dataSourceMap: DataSourceMap,\r\n                               selectedPlacemarkId: string | null) {\r\n        if (this.props.debug) {\r\n            console.log('CesiumGlobe: updating vector layers');\r\n        }\r\n        const actions = arrayDiff<VectorLayerDescriptor>(currentLayers, nextLayers);\r\n        for (let action of actions) {\r\n            if (this.props.debug) {\r\n                console.log('CesiumGlobe: next vector layer action', action);\r\n            }\r\n            //const index = action.index;\r\n            switch (action.type) {\r\n                case 'ADD': {\r\n                    this.addDataSource(viewer, action.newElement, dataSourceMap);\r\n                    break;\r\n                }\r\n                case 'REMOVE': {\r\n                    this.removeDataSource(viewer, action.oldElement, dataSourceMap);\r\n                    break;\r\n                }\r\n                case 'UPDATE': {\r\n                    this.updateDataSource(viewer, action.oldElement, action.newElement, dataSourceMap, selectedPlacemarkId);\r\n                    break;\r\n                }\r\n                case 'MOVE': {\r\n                    // order of dataSources seems to have no effect in Cesium\r\n                    break;\r\n                }\r\n                default:\r\n                    console.error(`CesiumGlobe: unhandled layer action type \"${action.type}\"`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private static updateOverlayHtml(viewer: Cesium.Viewer, prevOverlayHtml: HTMLElement, nextOverlayHtml: HTMLElement) {\r\n        // console.log('updateOverlayHtml', prevOverlayHtml, nextOverlayHtml);\r\n        if (nextOverlayHtml) {\r\n            if (prevOverlayHtml) {\r\n                if (!viewer.container.contains(prevOverlayHtml)) {\r\n                    // TODO (forman): Check, if we still get here.\r\n                    console.warn('CesiumGlobe: previous HTML element is not a child', prevOverlayHtml);\r\n                    return;\r\n                }\r\n                viewer.container.replaceChild(nextOverlayHtml, prevOverlayHtml);\r\n            } else {\r\n                viewer.container.appendChild(nextOverlayHtml);\r\n            }\r\n        } else if (prevOverlayHtml) {\r\n            if (!viewer.container.contains(prevOverlayHtml)) {\r\n                // TODO (forman): Check, if we still get here.\r\n                console.warn('CesiumGlobe: previous HTML element is not a child', prevOverlayHtml);\r\n                return;\r\n            }\r\n            viewer.container.removeChild(prevOverlayHtml);\r\n        }\r\n    }\r\n\r\n    private static getImageryProvider(viewer: Cesium.Viewer, layerDescriptor: ImageLayerDescriptor): Cesium.ImageryProvider {\r\n        if (layerDescriptor.imageryProvider) {\r\n            if (typeof layerDescriptor.imageryProvider === 'function') {\r\n                return layerDescriptor.imageryProvider(viewer, layerDescriptor.imageryProviderOptions);\r\n            } else {\r\n                return layerDescriptor.imageryProvider;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // https://cesiumjs.org/Cesium/Build/Documentation/GeoJsonDataSource.html\r\n    private static getDataSource(viewer: Cesium.Viewer, dataSourceDescriptor: VectorLayerDescriptor): Cesium.DataSource | Promise<Cesium.DataSource> {\r\n        if (typeof dataSourceDescriptor.dataSource === 'function') {\r\n            return dataSourceDescriptor.dataSource(viewer, dataSourceDescriptor.dataSourceOptions);\r\n        } else {\r\n            return dataSourceDescriptor.dataSource;\r\n        }\r\n    }\r\n\r\n    private addDataSource(viewer: Cesium.Viewer,\r\n                          layer: VectorLayerDescriptor,\r\n                          dataSourceMap: DataSourceMap): void {\r\n        const dataSource = CesiumGlobe.getDataSource(viewer, layer);\r\n        viewer.dataSources.add(dataSource).then((resolvedDataSource) => {\r\n            if (this.props.debug) {\r\n                console.log(`CesiumGlobe: added data source: ${layer.name}`);\r\n            }\r\n            dataSourceMap[layer.id] = resolvedDataSource;\r\n            this.setDataSourceProps(viewer, resolvedDataSource, layer);\r\n        });\r\n    }\r\n\r\n    private removeDataSource(viewer: Cesium.Viewer,\r\n                             layer: VectorLayerDescriptor,\r\n                             dataSourceMap: DataSourceMap) {\r\n        const dataSource = dataSourceMap[layer.id];\r\n        if (dataSource) {\r\n            delete dataSourceMap[layer.id];\r\n            viewer.dataSources.remove(dataSource, true);\r\n            if (this.props.debug) {\r\n                console.log(`CesiumGlobe: removed data source: ${layer.name}`);\r\n            }\r\n            viewer.scene.requestRender();\r\n        }\r\n    }\r\n\r\n    private updateDataSource(viewer: Cesium.Viewer,\r\n                             oldLayer: VectorLayerDescriptor,\r\n                             newLayer: VectorLayerDescriptor,\r\n                             dataSourceMap: DataSourceMap,\r\n                             selectedPlacemarkId: string | null) {\r\n        const layerId = newLayer.id;\r\n        const dataSource = dataSourceMap[layerId];\r\n        if (!dataSource) {\r\n            console.warn('CesiumGlobe: dataSource for vector layer not ready yet, layerId =', layerId);\r\n            return;\r\n        }\r\n        const oldData = oldLayer.dataSourceOptions.data;\r\n        const newData = newLayer.dataSourceOptions.data;\r\n        if (oldData !== newData) {\r\n            if (isString(newData)) {\r\n                // URL change: must load new dataSource\r\n                this.removeDataSource(viewer, oldLayer, dataSourceMap);\r\n                this.addDataSource(viewer, newLayer, dataSourceMap);\r\n            } else {\r\n                // Change of placemarks (a GeoJSON FeatureCollection)\r\n                this.updatePlacemarks(dataSource.entities, oldData, newData, newLayer.style).then(() => {\r\n                    if (selectedPlacemarkId) {\r\n                        const selectedEntity = dataSource.entities.getById(selectedPlacemarkId);\r\n                        if (selectedEntity && selectedEntity !== viewer.selectedEntity) {\r\n                            viewer.selectedEntity = selectedEntity;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        const oldStyle = oldLayer.style;\r\n        const newStyle = newLayer.style;\r\n        if (oldStyle !== newStyle) {\r\n            const styleDelta = diff(oldStyle, newStyle);\r\n            if (Object.getOwnPropertyNames(styleDelta).length > 0) {\r\n                const cStyle = simpleStyleToCesium(styleDelta, newStyle);\r\n                applyStyleToEntityCollection(cStyle, dataSource.entities.values);\r\n            }\r\n        }\r\n        const oldEntityStyles = oldLayer.entityStyles;\r\n        const newEntityStyles = newLayer.entityStyles;\r\n        if (oldEntityStyles !== newEntityStyles) {\r\n            const entityStylesDelta = diff(oldEntityStyles, newEntityStyles);\r\n            for (let entityId of Object.getOwnPropertyNames(entityStylesDelta)) {\r\n                const entity = dataSource.entities.getById(entityId);\r\n                if (entity) {\r\n                    const entityStyleDelta = entityStylesDelta[entityId];\r\n                    if (Object.getOwnPropertyNames(entityStyleDelta).length > 0) {\r\n                        const cStyle = simpleStyleToCesium(entityStyleDelta, newEntityStyles[entityId]);\r\n                        applyStyleToEntity(cStyle, entity)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.setDataSourceProps(viewer, dataSource, newLayer);\r\n    }\r\n\r\n    private addLayer(viewer: Cesium.Viewer, layerDescriptor: ImageLayerDescriptor, layerIndex: number): Cesium.ImageryLayer {\r\n        const imageryProvider = CesiumGlobe.getImageryProvider(viewer, layerDescriptor);\r\n        const imageryLayer = viewer.imageryLayers.addImageryProvider(imageryProvider, layerIndex);\r\n        if (this.props.debug) {\r\n            console.log(`CesiumGlobe: added imagery layer #${layerIndex}: ${layerDescriptor.name}`);\r\n        }\r\n        return imageryLayer;\r\n    }\r\n\r\n    private removeLayer(viewer: Cesium.Viewer, imageryLayer: Cesium.ImageryLayer, layerIndex: number): void {\r\n        viewer.imageryLayers.remove(imageryLayer, true);\r\n        if (this.props.debug) {\r\n            console.log(`CesiumGlobe: removed imagery layer #${layerIndex}`);\r\n        }\r\n    }\r\n\r\n    private static setLayerProps(imageryLayer: Cesium.ImageryLayer,\r\n                                 layerDescriptor: ImageLayerDescriptor) {\r\n        //imageryLayer.name = layerDescriptor.name;\r\n        imageryLayer.show = layerDescriptor.visible;\r\n        imageryLayer.alpha = layerDescriptor.opacity;\r\n        imageryLayer.brightness = layerDescriptor.brightness;\r\n        imageryLayer.contrast = layerDescriptor.contrast;\r\n        imageryLayer.hue = layerDescriptor.hue;\r\n        imageryLayer.saturation = layerDescriptor.saturation;\r\n        imageryLayer.gamma = layerDescriptor.gamma;\r\n        imageryLayer.minificationFilter = Cesium.TextureMinificationFilter.NEAREST;\r\n        imageryLayer.magnificationFilter = Cesium.TextureMagnificationFilter.NEAREST;\r\n\r\n        if (layerDescriptor.splitMode === 'left') {\r\n            imageryLayer.splitDirection = Cesium.ImagerySplitDirection.LEFT;\r\n        } else if (layerDescriptor.splitMode === 'right') {\r\n            imageryLayer.splitDirection = Cesium.ImagerySplitDirection.RIGHT;\r\n        } else {\r\n            imageryLayer.splitDirection = Cesium.ImagerySplitDirection.NONE;\r\n        }\r\n    }\r\n\r\n    private setDataSourceProps(viewer: Cesium.Viewer,\r\n                               dataSource: Cesium.DataSource | Promise<Cesium.DataSource>,\r\n                               dataSourceDescriptor: VectorLayerDescriptor) {\r\n        Promise.resolve(dataSource).then((resolvedDataSource: Cesium.DataSource) => {\r\n            //resolvedDataSource.name = dataSourceDescriptor.name;\r\n            resolvedDataSource.show = dataSourceDescriptor.visible;\r\n            viewer.scene.requestRender();\r\n        });\r\n    }\r\n\r\n    private static moveEntities(from: Cesium.EntityCollection, to: Cesium.EntityCollection, show: boolean) {\r\n        for (let entity of from.values.slice()) {\r\n            entity.show = show;\r\n            to.add(entity);\r\n            from.remove(entity);\r\n        }\r\n    }\r\n\r\n    activateGeometryTool(viewer: Cesium.Viewer, geometryToolType: GeometryToolType) {\r\n        const tool = this.toolContext.tool;\r\n        if (geometryToolType !== tool.type) {\r\n            if (geometryToolType === 'NoTool') {\r\n                this.toolContext.tool = NO_TOOL;\r\n            } else if (geometryToolType === 'PointTool') {\r\n                this.toolContext.tool = new PointTool();\r\n            } else if (geometryToolType === 'PolylineTool') {\r\n                this.toolContext.tool = new PolylineTool();\r\n            } else if (geometryToolType === 'PolygonTool') {\r\n                this.toolContext.tool = new PolygonTool();\r\n            } else if (geometryToolType === 'BoxTool') {\r\n                this.toolContext.tool = new BoxTool();\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { DirectGeometryObject, GeoJsonObject, Position } from 'geojson';\r\n\r\nexport type GeometryType =\r\n    'Point'\r\n    | 'LineString'\r\n    | 'Polygon'\r\n    | 'Geometry'\r\n    | 'MultiPoint'\r\n    | 'MultiLineString'\r\n    | 'MultiPolygon'\r\n    | 'Geometry'\r\n    | 'GeometryCollection';\r\n\r\nconst WKT_GEOMETRY_TYPES = new Set([\r\n                                       'POINT',\r\n                                       'LINESTRING',\r\n                                       'POLYGON',\r\n                                       'MULTIPOINT',\r\n                                       'MULTILINESTRING',\r\n                                       'MULTIPOLYGON',\r\n                                       'GEOMETRYCOLLECTION',\r\n                                   ]);\r\n\r\nconst WKT_GEOMETRIES_TEXT = new Array(WKT_GEOMETRY_TYPES.values()).map(s => `\"${s}\"`).join(', ');\r\n\r\nfunction isAlpha(c: string) {\r\n    return (c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z');\r\n}\r\n\r\nfunction parseFloatWithError(textValue: string, errorText?: string) {\r\n    const value = parseFloat(textValue);\r\n    if (isNaN(value) && textValue.toLowerCase() !== 'nan') {\r\n        throw new Error(errorText || 'Value must be a number.');\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function validateGeometryValue(value: string, geometryType: GeometryType) {\r\n    if (!value) {\r\n        return;\r\n    }\r\n    value = value.trim();\r\n    if (value === '') {\r\n        return;\r\n    }\r\n\r\n    let isWKT = false;\r\n    if (isAlpha(value)) {\r\n        isWKT = true;\r\n        // Quick and dirty WKT validation\r\n        let i = 1;\r\n        for (; i < value.length && isAlpha(value[i]); i++) {\r\n        }\r\n\r\n        const geometryName = value.substr(0, i).toUpperCase();\r\n        value = value.substr(i);\r\n\r\n        validateWKTGeometryType(geometryName, geometryType);\r\n        validateWKTBody(value, geometryName);\r\n    }\r\n\r\n    let coordParts = value.split(/[\\s,()]+/);\r\n    let i1;\r\n    let i2;\r\n    if (coordParts.length && coordParts[0] === '') {\r\n        i1 = 1;\r\n    }\r\n    if (coordParts.length && coordParts[coordParts.length - 1] === '') {\r\n        i2 = coordParts.length - 1;\r\n    }\r\n\r\n    if (i1 > 0 && i2 > 0) {\r\n        coordParts = coordParts.slice(i1, i2);\r\n    } else if (i1 > 0) {\r\n        coordParts = coordParts.slice(i1);\r\n    } else if (i2 > 0) {\r\n        coordParts = coordParts.slice(0, i2);\r\n    }\r\n    if (coordParts.length % 2 !== 0) {\r\n        throw new Error('Illegal number of coordinates.');\r\n    }\r\n    if (!isWKT) {\r\n        if (geometryType === 'Point') {\r\n            if (coordParts.length !== 2) {\r\n                throw new Error('Point must have \"<Longitude>, <Latitude>\" syntax.');\r\n            }\r\n        } else if (geometryType === 'Polygon') {\r\n            if (coordParts.length !== 4) {\r\n                throw new Error('Bounding box must have \"<E>, <S>, <W>, <N>\" syntax.');\r\n            }\r\n        } else {\r\n            throw new Error('Invalid WKT.');\r\n        }\r\n    }\r\n    for (let i = 0; i < coordParts.length; i += 2) {\r\n        const lon = parseFloatWithError(coordParts[i], 'Longitude value must be a number.');\r\n        const lat = parseFloatWithError(coordParts[i + 1], 'Latitude value must be a number.');\r\n        validateGeoCoordinate(lon, lat);\r\n    }\r\n}\r\n\r\nfunction validateWKTGeometryType(value: string, geometryType: GeometryType) {\r\n    const geometryTypeUC = geometryType.toUpperCase();\r\n\r\n    if (geometryType === 'Geometry') {\r\n        if (!WKT_GEOMETRY_TYPES.has(value)) {\r\n            throw new Error(`${geometryType} WKT must start with one of ${WKT_GEOMETRIES_TEXT}.`)\r\n        }\r\n    } else {\r\n        if (!value.startsWith(geometryTypeUC)) {\r\n            throw new Error(`${geometryType} WKT must start with \"${geometryTypeUC}\".`)\r\n        }\r\n    }\r\n}\r\n\r\nfunction validateWKTBody(value: string, geometryType: string) {\r\n    let expectedMinCommaCount;\r\n    let expectedMinDepthCount;\r\n    let expectedMaxDepthCount;\r\n    if (geometryType === 'POINT') {\r\n        expectedMinCommaCount = 0;\r\n        expectedMinDepthCount = 1;\r\n        expectedMaxDepthCount = 1;\r\n    } else if (geometryType === 'LINESTRING') {\r\n        expectedMinCommaCount = 1;\r\n        expectedMinDepthCount = 1;\r\n        expectedMaxDepthCount = 1;\r\n    } else if (geometryType === 'POLYGON') {\r\n        expectedMinCommaCount = 3;\r\n        expectedMinDepthCount = 2;\r\n        expectedMaxDepthCount = 2;\r\n    } else if (geometryType === 'MULTIPOINT') {\r\n        expectedMinCommaCount = 1;\r\n        expectedMinDepthCount = 1;\r\n        expectedMaxDepthCount = 2;\r\n    } else if (geometryType === 'MULTILINESTRING') {\r\n        expectedMinCommaCount = 1;\r\n        expectedMinDepthCount = 2;\r\n        expectedMaxDepthCount = 2;\r\n    } else if (geometryType === 'MULTIPOLYGON') {\r\n        expectedMinCommaCount = 3;\r\n        expectedMinDepthCount = 3;\r\n        expectedMaxDepthCount = 3;\r\n    } else if (geometryType === 'GEOMETRYCOLLECTION') {\r\n        expectedMinCommaCount = 0;\r\n        expectedMinDepthCount = 1;\r\n        expectedMaxDepthCount = 3;\r\n    }\r\n    let commaCount = 0;\r\n    let depthCount = 0;\r\n    let maxDepthCount = 0;\r\n    for (let i = 0; i < value.length; i++) {\r\n        let c = value[i];\r\n        if (c === '(') {\r\n            depthCount++;\r\n            if (depthCount > expectedMaxDepthCount) {\r\n                throw new Error('Invalid WKT, too many \"(\".');\r\n            }\r\n            maxDepthCount = Math.max(maxDepthCount, depthCount);\r\n        } else if (c === ')') {\r\n            depthCount--;\r\n            if (depthCount < 0) {\r\n                throw new Error('Invalid WKT, too many \")\".');\r\n            }\r\n            if (depthCount === 0) {\r\n                if (commaCount < expectedMinCommaCount) {\r\n                    throw new Error('Invalid WKT, too few coordinates.');\r\n                }\r\n                commaCount = 0;\r\n            }\r\n        } else if (c === ',') {\r\n            commaCount++;\r\n        }\r\n    }\r\n    if (depthCount !== 0) {\r\n        throw new Error('Invalid WKT, too many \"(\".');\r\n    }\r\n    if (maxDepthCount < expectedMinDepthCount) {\r\n        throw new Error('Invalid WKT, too few \"(\".');\r\n    }\r\n}\r\n\r\nexport function validateGeoCoordinate(lon: number, lat: number) {\r\n    if (lon < -180 || lon > 180) {\r\n        throw new Error('Longitude must be in the range -180 to +180 degrees.');\r\n    }\r\n    if (lat < -90 || lat > 90) {\r\n        throw new Error('Latitude must be in the range -90 to +90 degrees.');\r\n    }\r\n}\r\n\r\nexport function isBox(geometry: DirectGeometryObject) {\r\n    if (geometry.type === 'Polygon' && geometry.coordinates.length === 1) {\r\n        const positions = geometry.coordinates[0] as Position[];\r\n        if (positions.length === 5) {\r\n            const x0 = positions[0][0];\r\n            const y0 = positions[0][1];\r\n            const x1 = positions[1][0];\r\n            const y1 = positions[1][1];\r\n            const x2 = positions[2][0];\r\n            const y2 = positions[2][1];\r\n            const x3 = positions[3][0];\r\n            const y3 = positions[3][1];\r\n            const x4 = positions[4][0];\r\n            const y4 = positions[4][1];\r\n            const dx1 = x1 - x0;\r\n            const dy1 = y1 - y0;\r\n            const dx2 = x2 - x1;\r\n            const dy2 = y2 - y1;\r\n            const dx3 = x3 - x2;\r\n            const dy3 = y3 - y2;\r\n            const dx4 = x4 - x3;\r\n            const dy4 = y4 - y3;\r\n            return (dx1 === 0.0 && dy2 === 0 && dx3 === 0.0 && dy4 === 0)\r\n                   || (dy1 === 0 && dx2 === 0.0 && dy3 === 0 && dx4 === 0.0);\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport function geometryGeoJsonToCsv(geometry: DirectGeometryObject, sep?: string) {\r\n    sep = sep || ',';\r\n    const header = `longitude${sep}latitude\\n`;\r\n    if (geometry.type === 'Point') {\r\n        const position = geometry.coordinates;\r\n        return `${header}${position[0]}${sep}${position[1]}\\n`;\r\n    } else if (geometry.type === 'LineString') {\r\n        const coordinates = geometry.coordinates;\r\n        let a = [];\r\n        for (let position of coordinates) {\r\n            a.push(`${position[0]}${sep}${position[1]}\\n`)\r\n        }\r\n        return `${header}${a.join('')}`;\r\n    } else if (geometry.type === 'Polygon') {\r\n        const coordinates = geometry.coordinates;\r\n        let a = [];\r\n        for (let ring of coordinates) {\r\n            if (a.length > 0) {\r\n                a.push(`# hole:\\n`)\r\n            }\r\n            for (let position of ring as any) {\r\n                a.push(`${position[0]}${sep}${position[1]}\\n`)\r\n            }\r\n        }\r\n        return `${header}${a.join('')}`;\r\n    }\r\n    return '';\r\n}\r\n\r\nexport function geometryGeoJsonToGeometryWkt(geometry: DirectGeometryObject): string {\r\n\r\n    if (geometry.type === 'Point') {\r\n        const position = geometry.coordinates;\r\n        return `POINT (${position[0]} ${position[1]})`\r\n    } else if (geometry.type === 'LineString') {\r\n        const coordinates = geometry.coordinates;\r\n        let a = [];\r\n        for (let position of coordinates) {\r\n            a.push(`${position[0]} ${position[1]}`)\r\n        }\r\n        return `LINESTRING (${a.join(', ')})`;\r\n    } else if (geometry.type === 'Polygon') {\r\n        const coordinates = geometry.coordinates;\r\n        let a1 = [];\r\n        for (let ring of coordinates) {\r\n            let a2 = [];\r\n            for (let position of ring as any) {\r\n                a2.push(`${position[0]} ${position[1]}`)\r\n            }\r\n            a1.push(`(${a2.join(', ')})`)\r\n        }\r\n        return `POLYGON (${a1.join(', ')})`;\r\n    }\r\n    return '';\r\n}\r\n\r\n\r\nexport function geoJsonToText(geoJson: GeoJsonObject) {\r\n    return JSON.stringify(geoJson, null, 2);\r\n}\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport {\r\n    LayerState,\r\n    OperationState,\r\n    Placemark,\r\n    PlacemarkCollection,\r\n    ResourceState,\r\n    SPLIT_MODE_OFF,\r\n    State,\r\n    VariableImageLayerState,\r\n    WorkspaceState,\r\n    WorldViewDataState,\r\n} from '../state';\r\nimport * as selectors from '../selectors';\r\nimport { EMPTY_ARRAY, EMPTY_OBJECT } from '../selectors';\r\nimport * as actions from '../actions';\r\nimport { NO_WEB_GL } from '../messages';\r\nimport {\r\n    CanvasPosition,\r\n    CesiumGlobe,\r\n    GeographicPosition,\r\n    ImageLayerDescriptor,\r\n    LayerDescriptors\r\n} from '../components/cesium/CesiumGlobe';\r\nimport { findVariableIndexCoordinates, PLACEMARK_ID_PREFIX } from '../state-util';\r\nimport { ViewState } from '../components/ViewState';\r\nimport { convertLayersToLayerDescriptors } from './globe-view-layers';\r\nimport * as Cesium from 'cesium';\r\nimport { GeometryToolType } from '../components/cesium/geometry-tool';\r\nimport { BaseMapOptions, entityToGeoJson, entityToGeometryWkt } from '../components/cesium/cesium-util';\r\nimport { featurePropertiesFromSimpleStyle, SimpleStyle } from '../../common/geojson-simple-style';\r\nimport { Menu, MenuDivider, MenuItem } from '@blueprintjs/core';\r\nimport { GEOMETRY_LIKE_TYPE, POINT_LIKE_TYPE, POLYGON_LIKE_TYPE } from '../../common/cate-types';\r\nimport { geometryGeoJsonToGeometryWkt } from '../../common/geometry-util';\r\n\r\ninterface IGlobeViewOwnProps {\r\n    view: ViewState<WorldViewDataState>;\r\n}\r\n\r\ninterface IGlobeViewProps extends IGlobeViewOwnProps {\r\n    baseUrl: string;\r\n    operations: OperationState[] | null;\r\n    workspace: WorkspaceState | null;\r\n    offlineMode: boolean;\r\n    placemarks: PlacemarkCollection;\r\n    selectedLayer: LayerState | null;\r\n    selectedLayerId: string | null;\r\n    selectedPlacemarkId: string | null;\r\n    baseMapOptions: BaseMapOptions | null,\r\n    isDialogOpen: boolean;\r\n    showLayerTextOverlay: boolean;\r\n    debugWorldView: boolean;\r\n    hasWebGL: boolean;\r\n    externalObjectStore: any;\r\n    newPlacemarkToolType: GeometryToolType;\r\n    defaultPlacemarkStyle: SimpleStyle;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IGlobeViewOwnProps): IGlobeViewProps {\r\n    return {\r\n        view: ownProps.view,\r\n        baseUrl: selectors.webAPIRestUrlSelector(state),\r\n        operations: selectors.operationsSelector(state),\r\n        workspace: selectors.workspaceSelector(state),\r\n        offlineMode: selectors.offlineModeSelector(state),\r\n        placemarks: selectors.placemarkCollectionSelector(state),\r\n        selectedLayer: selectors.selectedLayerSelector(state),\r\n        selectedLayerId: selectors.selectedLayerIdSelector(state),\r\n        selectedPlacemarkId: selectors.selectedPlacemarkIdSelector(state),\r\n        baseMapOptions: selectors.baseMapOptionsSelector(state),\r\n        isDialogOpen: selectors.isDialogOpenSelector(state),\r\n        showLayerTextOverlay: state.session.showLayerTextOverlay,\r\n        debugWorldView: state.session.debugWorldView,\r\n        hasWebGL: state.data.hasWebGL,\r\n        externalObjectStore: selectors.externalObjectStoreSelector(state),\r\n        newPlacemarkToolType: selectors.newPlacemarkToolTypeSelector(state),\r\n        defaultPlacemarkStyle: selectors.defaultPlacemarkStyleSelector(state),\r\n    };\r\n}\r\n\r\n/**\r\n * This component displays a 3D globe with a number of layers.\r\n */\r\nclass GlobeView extends React.Component<IGlobeViewProps & IGlobeViewOwnProps & DispatchProp<State>> {\r\n    static readonly CESIUM_GLOBE_STYLE: CSSProperties = {\r\n        position: 'relative',\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden'\r\n    };\r\n    static readonly POS_UPDATE_PERIOD: number = 500;\r\n\r\n    intervalHandle: number | null;\r\n    lastPosition: GeographicPosition | null;\r\n    positionChanged: boolean;\r\n\r\n    constructor(props: IGlobeViewProps & IGlobeViewOwnProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.intervalHandle = null;\r\n        this.lastPosition = null;\r\n        this.positionChanged = false;\r\n        this.handleMouseMove = this.handleMouseMove.bind(this);\r\n        this.handleSelectedEntityChanged = this.handleSelectedEntityChanged.bind(this);\r\n        this.handleNewEntityAdded = this.handleNewEntityAdded.bind(this);\r\n        this.handleSplitLayerPosChange = this.handleSplitLayerPosChange.bind(this);\r\n        this.handlePosDataUpdate = this.handlePosDataUpdate.bind(this);\r\n        this.renderContextMenu = this.renderContextMenu.bind(this);\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        this.intervalHandle = window.setInterval(this.handlePosDataUpdate, GlobeView.POS_UPDATE_PERIOD);\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        window.clearInterval(this.intervalHandle);\r\n    }\r\n\r\n    handlePosDataUpdate() {\r\n        if (this.positionChanged) {\r\n            this.props.dispatch(actions.setGlobeViewPosition(this.lastPosition) as any);\r\n            this.positionChanged = false;\r\n        }\r\n    }\r\n\r\n    handleMouseMove(newPosition: GeographicPosition | undefined | null) {\r\n        const lastPosition = this.lastPosition;\r\n        if (newPosition !== lastPosition) {\r\n            if (!newPosition || !lastPosition\r\n                || newPosition.longitude !== lastPosition.longitude\r\n                || newPosition.latitude !== lastPosition.latitude) {\r\n                this.props.dispatch(actions.setGlobeMousePosition(newPosition));\r\n                this.lastPosition = newPosition;\r\n                this.positionChanged = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleSelectedEntityChanged(selectedEntity: Cesium.Entity | null) {\r\n        this.props.dispatch(actions.notifySelectedEntityChange(this.props.view.id, this.props.selectedLayer, selectedEntity) as any);\r\n    }\r\n\r\n    handleNewEntityAdded(newEntity: Cesium.Entity) {\r\n        // Logic should actually go to actions.ts or reducers.ts, but newEntity:Cesium.Entity is not serializable.\r\n        const properties = this.newPlacemarkProperties();\r\n        const feature = entityToGeoJson(newEntity, `${PLACEMARK_ID_PREFIX}${newEntity.id}`, properties);\r\n        this.props.dispatch(actions.addPlacemark(feature as Placemark));\r\n    }\r\n\r\n    handleSplitLayerPosChange(layerSplitPosition: number) {\r\n        this.props.dispatch(actions.setLayerSplitPosition(this.props.view.id, layerSplitPosition));\r\n    }\r\n\r\n    renderContextMenu(geoPos: GeographicPosition, canvasPos: CanvasPosition, entity?: Cesium.Entity) {\r\n\r\n        if (!geoPos && !entity) {\r\n            return null;\r\n        }\r\n\r\n        const entityId = entity && entity.id;\r\n        let placemark;\r\n        if (entityId && entityId.startsWith(PLACEMARK_ID_PREFIX) && this.props.placemarks) {\r\n            placemark = this.props.placemarks.features.find(p => p.id === entityId);\r\n        }\r\n\r\n        let wkt;\r\n        if (placemark) {\r\n            wkt = geometryGeoJsonToGeometryWkt(placemark.geometry);\r\n        } else if (entity) {\r\n            wkt = entityToGeometryWkt(entity);\r\n        } else if (geoPos) {\r\n            wkt = `POINT (${geoPos.longitude} ${geoPos.latitude})`;\r\n        }\r\n\r\n        let key = 0;\r\n\r\n        const menuItems = [];\r\n        if (geoPos) {\r\n            const properties = this.newPlacemarkProperties();\r\n            const action = actions.addPointPlacemark(geoPos.longitude, geoPos.latitude, properties);\r\n            menuItems.push(<MenuItem key={key}\r\n                                     icon=\"map-marker\"\r\n                                     text=\"Place point marker here\"\r\n                                     onClick={() => this.props.dispatch(action)}/>);\r\n            key++;\r\n        }\r\n\r\n        if (wkt) {\r\n            menuItems.push(<MenuItem key={key} icon=\"clipboard\" text=\"Copy geometry WKT\"\r\n                                     onClick={() => actions.copyTextToClipboard(wkt)}/>);\r\n            key++;\r\n        }\r\n\r\n        const operations = this.props.operations;\r\n        if (entity && operations) {\r\n\r\n            let expectedInputType;\r\n            if (wkt.startsWith('POINT ')) {\r\n                expectedInputType = POINT_LIKE_TYPE;\r\n            } else if (wkt.startsWith('POLYGON ')) {\r\n                expectedInputType = POLYGON_LIKE_TYPE;\r\n            }\r\n\r\n            if (expectedInputType) {\r\n                let dividerAdded = false;\r\n                for (let operation of operations) {\r\n                    let geometryInput;\r\n                    for (let input of operation.inputs) {\r\n                        const dataType = input.dataType;\r\n                        if (dataType === expectedInputType || dataType === GEOMETRY_LIKE_TYPE) {\r\n                            geometryInput = input;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (geometryInput) {\r\n                        if (!dividerAdded) {\r\n                            menuItems.push(<MenuDivider key={key}/>);\r\n                            dividerAdded = true;\r\n                            key++;\r\n                        }\r\n                        const inputAssignments = {\r\n                            [geometryInput.name]: {\r\n                                isValueUsed: true,\r\n                                constantValue: wkt,\r\n                                resourceName: null\r\n                            }\r\n                        };\r\n                        const action = actions.invokeCtxOperation(operation, inputAssignments);\r\n                        const text = `${operation.name}()`;\r\n                        menuItems.push(<MenuItem key={key}\r\n                                                 icon=\"function\" text={text}\r\n                                                 onClick={() => this.props.dispatch(action as any)}/>);\r\n                        key++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return (<Menu>{menuItems}</Menu>);\r\n    }\r\n\r\n    private newPlacemarkProperties() {\r\n        return {visible: true, ...featurePropertiesFromSimpleStyle(this.props.defaultPlacemarkStyle)};\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.hasWebGL) {\r\n            return NO_WEB_GL;\r\n        }\r\n\r\n        const view = this.props.view;\r\n        const viewId = this.props.view.id;\r\n        const layers = view.data.layers;\r\n        const placemarks = this.props.placemarks;\r\n        const showLayerTextOverlay = this.props.showLayerTextOverlay;\r\n        const workspace = this.props.workspace;\r\n        const resources = (workspace && workspace.resources) || EMPTY_ARRAY;\r\n\r\n        // TODO (nf): Note that following local vars descriptors, splitLayerIndex, overlayHtml...\r\n        // ...could be provided by selectors but there is a dependency on this.props.view which is\r\n        // an own component property.\r\n        // May be solved by\r\n        // - https://github.com/reactjs/reselect/blob/master/README.md#accessing-react-props-in-selectors\r\n        // - https://github.com/reactjs/reselect/blob/master/README.md#q-how-do-i-create-a-selector-that-takes-an-argument\r\n        //\r\n        let descriptors;\r\n        let selectedPlacemarkId = null;\r\n        if (workspace) {\r\n            const baseUrl = this.props.baseUrl;\r\n            const baseDir = workspace.baseDir;\r\n            descriptors = convertLayersToLayerDescriptors(layers, resources, placemarks, baseUrl, baseDir);\r\n            selectedPlacemarkId = this.props.selectedPlacemarkId;\r\n        } else {\r\n            descriptors = EMPTY_OBJECT as LayerDescriptors;\r\n        }\r\n        const imageLayerDescriptors = descriptors.imageLayerDescriptors || EMPTY_ARRAY;\r\n        const vectorLayerDescriptors = descriptors.vectorLayerDescriptors || EMPTY_ARRAY;\r\n        let splitLayerPosition;\r\n        if (hasSplitLayer(imageLayerDescriptors)) {\r\n            splitLayerPosition = view.data.layerSplitPosition;\r\n        }\r\n        const overlayHtml = getOverlayHtml(layers, showLayerTextOverlay, viewId, resources);\r\n\r\n        return (\r\n            <CesiumGlobe id={'CesiumGlobe-' + view.id}\r\n                         debug={this.props.debugWorldView}\r\n                         externalObjectStore={this.props.externalObjectStore}\r\n                         selectedPlacemarkId={selectedPlacemarkId}\r\n                         baseMapOptions={this.props.baseMapOptions}\r\n                         imageLayerDescriptors={imageLayerDescriptors}\r\n                         vectorLayerDescriptors={vectorLayerDescriptors}\r\n                         splitLayerPosition={splitLayerPosition}\r\n                         overlayHtml={overlayHtml}\r\n                         onLayerSplitPosChange={this.handleSplitLayerPosChange}\r\n                         offlineMode={this.props.offlineMode}\r\n                         style={GlobeView.CESIUM_GLOBE_STYLE}\r\n                         onMouseMove={this.props.isDialogOpen ? null : this.handleMouseMove}\r\n                         onSelectedEntityChanged={this.handleSelectedEntityChanged}\r\n                         onNewEntityAdded={this.handleNewEntityAdded}\r\n                         geometryToolType={this.props.newPlacemarkToolType}\r\n                         renderContextMenu={this.renderContextMenu}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(GlobeView);\r\n\r\nfunction getOverlayHtml(layers: LayerState[],\r\n                        showLayerTextOverlay: boolean,\r\n                        viewId,\r\n                        resources: ResourceState[]): HTMLDivElement {\r\n    let overlayHtml: HTMLDivElement = null;\r\n    if (!showLayerTextOverlay) {\r\n        return overlayHtml;\r\n    }\r\n    // let layerInfoCount = 0;\r\n    for (let layerIndex = 0; layerIndex < layers.length; layerIndex++) {\r\n        let layer = layers[layerIndex] as any as VariableImageLayerState;\r\n        if (layer.type === 'VariableImage') {\r\n            if (layer.visible) {\r\n                const indexCoords = findVariableIndexCoordinates(resources, layer);\r\n                if (!overlayHtml) {\r\n                    overlayHtml = document.createElement('div');\r\n                    overlayHtml.id = 'CesiumGlobeOverlay-' + viewId;\r\n                    overlayHtml.style.position = 'absolute';\r\n                    overlayHtml.style['z-index'] = 10;\r\n                    overlayHtml.style['pointer-events'] = 'none';\r\n                    overlayHtml.style['padding'] = '1em';\r\n                    overlayHtml.style['background-color'] = 'rgba(0, 0, 0, 0.25)';\r\n                }\r\n                let varText;\r\n                if (indexCoords && indexCoords.length) {\r\n                    varText = layer.name + ' at ' + indexCoords.map(e => e.join(' = ')).join(', ');\r\n                } else {\r\n                    varText = layer.name;\r\n                }\r\n                const textDivElement = document.createElement('div');\r\n                textDivElement.style['font-size'] = '1.4em';\r\n                textDivElement.innerText = varText;\r\n                overlayHtml.appendChild(textDivElement);\r\n                overlayHtml.style.top = '0';\r\n                overlayHtml.style.width = '100%';\r\n                // layerInfoCount++;\r\n            }\r\n        }\r\n    }\r\n    return overlayHtml;\r\n}\r\n\r\nfunction hasSplitLayer(layerDescriptors: ImageLayerDescriptor[]) {\r\n    for (let ld of layerDescriptors) {\r\n        const splitMode = ld.splitMode || SPLIT_MODE_OFF;\r\n        if (splitMode !== SPLIT_MODE_OFF) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n\r\n","const _DEBUG_WEB_SOCKET_RPC = false;\r\n\r\nexport type MplFigureMessageCallback = (message: string) => any;\r\nexport type MplFigureCommandData = { name: string };\r\nexport type MplFigureCommandListener = (figureId: number, commandData: MplFigureCommandData) => void;\r\n\r\n/**\r\n * A source for figure commands.\r\n */\r\nexport interface MplFigureCommandSource {\r\n    addCommandListener(figureId: number, listener: MplFigureCommandListener): void;\r\n\r\n    removeCommandListener(figureId: number, listener: MplFigureCommandListener): void;\r\n\r\n    removeCommandListeners(figureId: number): void;\r\n}\r\n\r\n/**\r\n * Default impl. of MplFigureCommandSource interface\r\n */\r\nexport class MplFigureCommandSourceImpl implements MplFigureCommandSource {\r\n    private listenersMap: { [id: number]: Set<MplFigureCommandListener> };\r\n\r\n    constructor() {\r\n        this.listenersMap = {};\r\n        this.dispatchCommand = this.dispatchCommand.bind(this);\r\n    }\r\n\r\n    addCommandListener(figureId: number, listener: MplFigureCommandListener): void {\r\n        let listeners = this.listenersMap[figureId];\r\n        if (!listeners) {\r\n            listeners = new Set<MplFigureCommandListener>();\r\n            this.listenersMap[figureId] = listeners;\r\n        }\r\n        listeners.add(listener);\r\n        // console.log('MplFigureCommandSourceImpl.addCommandListener', figureId, listener);\r\n    }\r\n\r\n    removeCommandListener(figureId: number, listener: MplFigureCommandListener): void {\r\n        // console.log('MplFigureCommandSourceImpl.removeCommandListener', figureId, listener);\r\n        const listeners = this.listenersMap[figureId];\r\n        if (listeners) {\r\n            listeners.delete(listener);\r\n            if (listeners.size === 0) {\r\n                delete this.listenersMap[figureId];\r\n            }\r\n        }\r\n    }\r\n\r\n    removeCommandListeners(figureId: number): void {\r\n        // console.log('MplFigureCommandSourceImpl.removeCommandListeners', figureId);\r\n        delete this.listenersMap[figureId];\r\n    }\r\n\r\n    dispatchCommand(figureId: number, commandData: MplFigureCommandData) {\r\n        const listeners = this.listenersMap[figureId];\r\n        if (listeners) {\r\n            listeners.forEach((listener: MplFigureCommandListener) => {\r\n                listener(figureId, commandData);\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Represents a figure in matplotlib's web backend.\r\n * This class is a port of \"mpl.js\" from matplotlib's web_agg.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class MplFigure {\r\n\r\n    readonly id: number;\r\n    private webSocket: WebSocket;\r\n    private commandSource?: MplFigureCommandSource;\r\n    private onMessage?: MplFigureMessageCallback;\r\n    private parentElement: HTMLDivElement;\r\n    private figureImageCanvas: HTMLCanvasElement;\r\n    private rubberBandCanvas: HTMLCanvasElement;\r\n    private imageObj: any;\r\n    private imageMode: string;\r\n    private waiting: boolean;\r\n    private lastKey: number | null;\r\n    private resizeTimer: number | null;\r\n    private lastSize: { width: number; height: number };\r\n\r\n    constructor(figureId: number,\r\n                webSocketUrl: string,\r\n                parentElement: HTMLDivElement,\r\n                commandSource?: MplFigureCommandSource,\r\n                onMessage?: MplFigureMessageCallback) {\r\n\r\n        this.id = figureId;\r\n        this.parentElement = parentElement;\r\n        this.commandSource = commandSource;\r\n        this.onMessage = onMessage;\r\n        this.imageMode = 'full';\r\n        this.imageObj = new Image();\r\n        this.lastSize = {width: 0, height: 0};\r\n\r\n        this.handleCommand = this.handleCommand.bind(this);\r\n        this.processMessage = this.processMessage.bind(this);\r\n\r\n        this.initCanvas();\r\n\r\n        this.waiting = false;\r\n\r\n        this.imageObj.onload = () => {\r\n            const canvasContext = this.figureImageCanvas.getContext('2d');\r\n            if (this.imageMode === 'full') {\r\n                // Full resources could contain transparency (where diff resources\r\n                // almost always do), so we need to clear the canvas so that\r\n                // there is no ghosting.\r\n                canvasContext.clearRect(0, 0, this.figureImageCanvas.width, this.figureImageCanvas.height);\r\n            }\r\n            canvasContext.drawImage(this.imageObj, 0, 0);\r\n        };\r\n\r\n        this.imageObj.onunload = function () {\r\n            this.webSocket.removeEventListener('message', this.processMessage);\r\n        };\r\n\r\n        this.webSocket = new WebSocket(webSocketUrl);\r\n        this.webSocket.onopen = () => {\r\n            if (this.commandSource) {\r\n                this.commandSource.addCommandListener(this.id, this.handleCommand);\r\n            }\r\n\r\n            this.webSocket.addEventListener('message', this.processMessage);\r\n            const supportsBinary = !!this.webSocket.binaryType;\r\n            if (!supportsBinary) {\r\n                console.warn('This browser does not support binary websocket messages. ' +\r\n                             'Figure update performance may be slow.');\r\n            }\r\n            this.sendMessage('supports_binary', {value: supportsBinary});\r\n            this.sendMessage('send_image_mode');\r\n            this.sendRefresh();\r\n            this.sendResize();\r\n\r\n            this.resizeTimer = window.setInterval(() => {\r\n                const width = this.parentElement.clientWidth;\r\n                const height = this.parentElement.clientHeight;\r\n                const validSize = width > 0 && height > 0;\r\n                const sizeChange = this.lastSize.width !== width || this.lastSize.height !== height;\r\n                if (validSize && sizeChange) {\r\n                    this.lastSize = {width, height};\r\n                    this.sendResize(width, height);\r\n                }\r\n            }, 500);\r\n        };\r\n\r\n        this.webSocket.onclose = () => {\r\n            if (this.commandSource) {\r\n                this.commandSource.removeCommandListener(this.id, this.handleCommand);\r\n            }\r\n            if (this.resizeTimer) {\r\n                window.clearInterval(this.resizeTimer);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calls a command on this figure.\r\n     *\r\n     * @param figureId An object that must have a property \"name\" of type string.\r\n     * @param commandData An object that must have a property \"name\" of type string.\r\n     */\r\n    private handleCommand(figureId: number, commandData: MplFigureCommandData): void {\r\n        if (figureId === this.id) {\r\n            this.sendMessage('toolbar_button', commandData);\r\n        } else {\r\n            console.warn(`received invalid figure ID: expected #${this.id}, got #${figureId} for data ${commandData}`);\r\n        }\r\n    }\r\n\r\n    private initCanvas() {\r\n        const handleKeyboardEvent = this.handleKeyboardEvent.bind(this);\r\n        this.parentElement.onkeydown = wrapEvent('key_press', handleKeyboardEvent);\r\n        this.parentElement.onkeyup = wrapEvent('key_release', handleKeyboardEvent);\r\n        this.parentElement.onwheel = (event: WheelEvent) => {\r\n            const name = 'scroll';\r\n            const step = (event.deltaY < 0) ? 1 : -1;\r\n            this.handleMouseEvent(event, {name, step});\r\n        };\r\n\r\n        const figureImageCanvas = document.createElement('canvas');\r\n        figureImageCanvas.id = 'mpl-figure-image-' + this.id;\r\n        figureImageCanvas.setAttribute('style', 'left: 0; top: 0; z-index: 0; outline: 0');\r\n        this.figureImageCanvas = figureImageCanvas;\r\n\r\n        const rubberBandCanvas = document.createElement('canvas');\r\n        rubberBandCanvas.id = 'mpl-rubber-band-' + this.id;\r\n        rubberBandCanvas.setAttribute('style', 'position: absolute; left: 0; top: 0; z-index: 1;');\r\n        const handleMouseEvent = this.handleMouseEvent.bind(this);\r\n        rubberBandCanvas.onmousedown = wrapEvent('button_press', handleMouseEvent);\r\n        rubberBandCanvas.onmouseup = wrapEvent('button_release', handleMouseEvent);\r\n        rubberBandCanvas.onmousemove = wrapEvent('motion_notify', handleMouseEvent);\r\n        rubberBandCanvas.onmouseenter = wrapEvent('figure_enter', handleMouseEvent);\r\n        rubberBandCanvas.onmouseleave = wrapEvent('figure_leave', handleMouseEvent);\r\n        const rubberBandContext = rubberBandCanvas.getContext('2d');\r\n        rubberBandContext.strokeStyle = '#000000';\r\n        this.rubberBandCanvas = rubberBandCanvas;\r\n\r\n        this.parentElement.appendChild(figureImageCanvas);\r\n        this.parentElement.appendChild(rubberBandCanvas);\r\n    }\r\n\r\n    private resizeCanvas(width, height) {\r\n        // Keep the size of the figure image canvas and rubber band canvas in sync.\r\n        this.figureImageCanvas.setAttribute('width', width);\r\n        this.figureImageCanvas.setAttribute('height', height);\r\n        this.rubberBandCanvas.setAttribute('width', width);\r\n        this.rubberBandCanvas.setAttribute('height', height);\r\n    };\r\n\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n    // Outgoing messages\r\n\r\n    sendResize(width?: number, height?: number) {\r\n        width = width || this.parentElement.clientWidth;\r\n        height = height || this.parentElement.clientHeight;\r\n        // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,\r\n        // which will in turn request a refresh of the image.\r\n        this.sendMessage('resize', {width, height});\r\n    }\r\n\r\n    sendDrawMessage() {\r\n        if (!this.waiting) {\r\n            this.waiting = true;\r\n            this.sendMessage('draw');\r\n        }\r\n    }\r\n\r\n    sendRefresh() {\r\n        this.sendMessage('refresh');\r\n    }\r\n\r\n    sendCanvasUpdated() {\r\n        // Called whenever the canvas gets updated.\r\n        this.sendMessage('ack');\r\n    }\r\n\r\n    sendMessage(type: string, properties?: any) {\r\n        const jsonText = JSON.stringify({...properties, type, figure_id: this.id});\r\n        if (_DEBUG_WEB_SOCKET_RPC) {\r\n            console.log(`MplFigure.sendMessage: ${jsonText}`);\r\n        }\r\n        this.webSocket.send(jsonText);\r\n    }\r\n\r\n    // Outgoing messages\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n\r\n    /**\r\n     * Process incoming WebSocket messages.\r\n     *\r\n     * @param evt The WebSocket message event\r\n     */\r\n    private processMessage(evt: MessageEvent) {\r\n        // console.log(`MplFigure.processMessage: ${evt.data}`);\r\n        if (evt.data instanceof Blob) {\r\n            const blobData = evt.data as any;\r\n\r\n            /* Free the memory for the previous frames */\r\n            if (this.imageObj.src) {\r\n                (window.URL || window['webkitURL']).revokeObjectURL(this.imageObj.src);\r\n            }\r\n\r\n            this.imageObj.src = (window.URL || window['webkitURL']).createObjectURL(blobData);\r\n            this.sendCanvasUpdated();\r\n            this.waiting = false;\r\n            return;\r\n        } else if (typeof evt.data === 'string' && evt.data.slice(0, 21) === 'data:image/png;base64') {\r\n            this.imageObj.src = evt.data;\r\n            this.sendCanvasUpdated();\r\n            this.waiting = false;\r\n            return;\r\n        }\r\n\r\n        const jsonText = evt.data;\r\n        const msg = JSON.parse(jsonText);\r\n        const msgType = msg['type'];\r\n\r\n        // Call the  \"handle_${msgType}\" callback, which takes\r\n        // the JSON message as its only argument.\r\n        try {\r\n            const callback = this['handle_' + msgType];\r\n            if (callback) {\r\n                try {\r\n                    // console.log(`Calling: handle_${msg_type}(${jsonText})`);\r\n                    callback.bind(this)(msg);\r\n                } catch (e) {\r\n                    console.error('Exception inside the \\'handler_' + msgType + '\\' callback:', e, e.stack, msg);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error('No handler for the \\'' + msgType + '\\' message type: ', msg);\r\n        }\r\n    }\r\n\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n    // Handlers for incoming messages\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_resize(msg) {\r\n        const size = msg['size'];\r\n        if (size[0] !== this.figureImageCanvas.width || size[1] !== this.figureImageCanvas.height) {\r\n            this.resizeCanvas(size[0], size[1]);\r\n            this.sendRefresh();\r\n        }\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_rubberband(msg) {\r\n        let x0 = msg['x0'];\r\n        let y0 = this.figureImageCanvas.height - msg['y0'];\r\n        let x1 = msg['x1'];\r\n        let y1 = this.figureImageCanvas.height - msg['y1'];\r\n        x0 = Math.floor(x0) + 0.5;\r\n        //noinspection JSSuspiciousNameCombination\r\n        y0 = Math.floor(y0) + 0.5;\r\n        x1 = Math.floor(x1) + 0.5;\r\n        //noinspection JSSuspiciousNameCombination\r\n        y1 = Math.floor(y1) + 0.5;\r\n        const xMin = Math.min(x0, x1);\r\n        const yMin = Math.min(y0, y1);\r\n        const width = Math.abs(x1 - x0);\r\n        const height = Math.abs(y1 - y0);\r\n\r\n        const rubberBandCanvasContext = this.rubberBandCanvas.getContext('2d');\r\n        rubberBandCanvasContext.clearRect(0, 0, this.figureImageCanvas.width, this.figureImageCanvas.height);\r\n        rubberBandCanvasContext.strokeRect(xMin, yMin, width, height);\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_figure_label(msg) {\r\n        // console.warn(`MplFigure.handle_figure_label() - unhandled, figure #${this.id}`, msg);\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_message(msg) {\r\n        if (this.onMessage) {\r\n            this.onMessage(msg['message']);\r\n        }\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_cursor(msg) {\r\n        const cursor = msg['cursor'];\r\n        this.rubberBandCanvas.style.cursor = {0: 'pointer', 1: 'default', 2: 'crosshair', 3: 'move'}[cursor];\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_draw() {\r\n        // Request the server to send over a new figure.\r\n        this.sendDrawMessage();\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private handle_image_mode(msg) {\r\n        this.imageMode = msg['mode'];\r\n    }\r\n\r\n    // Handlers for incoming messages\r\n    ///////////////////////////////////////////////////////////////////////////////\r\n\r\n    private handleMouseEvent(event: MouseEvent, extraData) {\r\n        const name = extraData.name;\r\n        const step = extraData.step;\r\n        const canvas_pos = findpos(event);\r\n\r\n        if (name === 'button_press') {\r\n            this.figureImageCanvas.focus();\r\n            this.parentElement.focus();\r\n        }\r\n\r\n        const x = canvas_pos.x;\r\n        const y = canvas_pos.y;\r\n\r\n        this.sendMessage(name, {\r\n            x, y,\r\n            button: event.button,\r\n            step,\r\n            guiEvent: simpleKeys(event)\r\n        });\r\n\r\n        /* This prevents the web browser from automatically changing to\r\n         * the text insertion cursor when the button is pressed.  We want\r\n         * to control all of the cursor setting manually through the\r\n         * 'cursor' event from matplotlib */\r\n        event.preventDefault();\r\n        return false;\r\n    }\r\n\r\n    private handleKeyboardEvent(event: KeyboardEvent, extraData) {\r\n        const name = extraData.name;\r\n\r\n        // Prevent repeat events\r\n        if (name === 'key_press') {\r\n            if (event.which === this.lastKey)\r\n                return;\r\n            else\r\n                this.lastKey = event.which;\r\n        }\r\n        if (name === 'key_release')\r\n            this.lastKey = null;\r\n\r\n        let value = '';\r\n        if (event.ctrlKey && event.which !== 17)\r\n            value += 'ctrl+';\r\n        if (event.altKey && event.which !== 18)\r\n            value += 'alt+';\r\n        if (event.shiftKey && event.which !== 16)\r\n            value += 'shift+';\r\n\r\n        value += 'k';\r\n        value += event.which.toString();\r\n\r\n        this.sendMessage(name, {\r\n            key: value,\r\n            guiEvent: simpleKeys(event)\r\n        });\r\n    }\r\n}\r\n\r\n\r\nfunction wrapEvent<E extends Event>(name: string, callback: (event: E, userData: any) => void): (event: E) => void {\r\n    return (event: E) => {\r\n        callback(event, {name});\r\n    };\r\n}\r\n\r\n// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas\r\nfunction findpos(e: MouseEvent) {\r\n    //this section is from http://www.quirksmode.org/js/events_properties.html\r\n    let targ;\r\n    if (e.target)\r\n        targ = e.target;\r\n    else if (e.srcElement)\r\n        targ = e.srcElement;\r\n    if (targ.nodeType === 3) // defeat Safari bug\r\n        targ = targ.parentNode;\r\n\r\n    const bodyRect = document.body.getBoundingClientRect();\r\n    const elemRect = targ.getBoundingClientRect();\r\n    const offsetX = elemRect.left - bodyRect.left;\r\n    const offsetY = elemRect.top - bodyRect.top;\r\n\r\n    const x = e.pageX - offsetX;\r\n    const y = e.pageY - offsetY;\r\n\r\n    return {'x': x, 'y': y};\r\n}\r\n\r\n/*\r\n * return a copy of an object with only non-object keys\r\n * we need this to avoid circular references\r\n * http://stackoverflow.com/a/24161582/3208463\r\n */\r\nfunction simpleKeys(original) {\r\n    return Object.keys(original).reduce(function (obj, key) {\r\n        if (typeof original[key] !== 'object')\r\n            obj[key] = original[key];\r\n        return obj;\r\n    }, {});\r\n}\r\n","import { ExternalObjectComponent, IExternalObjectComponentProps } from '../ExternalObjectComponent'\r\nimport { MplFigure, MplFigureCommandSource, MplFigureMessageCallback } from './MplFigure';\r\n\r\n\r\nexport interface FigureState {\r\n    figureUpdateCount: number;\r\n}\r\n\r\ninterface IFigureContainerProps extends IExternalObjectComponentProps<MplFigure, FigureState>, FigureState {\r\n    figureId: number;\r\n    figureUpdateCount: number;\r\n    figureHeight?: any;\r\n    webSocketUrl: string;\r\n    commandSource?: MplFigureCommandSource;\r\n    onMessage?: MplFigureMessageCallback;\r\n}\r\n\r\n/**\r\n * A component that wraps a div that holds a matplotlib figure.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class MplFigureContainer extends ExternalObjectComponent<MplFigure, FigureState, IFigureContainerProps, null> {\r\n\r\n    propsToExternalObjectState(props: IFigureContainerProps & FigureState, prevState?: FigureState): FigureState {\r\n        return {figureUpdateCount: props.figureUpdateCount};\r\n    }\r\n\r\n    newContainer(id: string): HTMLDivElement {\r\n        const figureDiv = document.createElement('div');\r\n        figureDiv.setAttribute('id', 'mpl-figure-container-' + id);\r\n        figureDiv.setAttribute('style', 'width: 100%; position: relative;');\r\n        if (this.props.figureHeight) {\r\n            figureDiv.style.height = this.props.figureHeight;\r\n        }\r\n        if (this.props.debug) {\r\n            console.log('MplFigureContainer.newContainer:', figureDiv);\r\n        }\r\n        return figureDiv;\r\n    }\r\n\r\n    newExternalObject(parentContainer: HTMLElement, figureDiv: HTMLDivElement): MplFigure {\r\n        return new MplFigure(this.props.figureId,\r\n                             this.props.webSocketUrl,\r\n                             figureDiv,\r\n                             this.props.commandSource,\r\n                             this.props.onMessage);\r\n    }\r\n\r\n    updateExternalObject(figure: MplFigure,\r\n                         prevState: FigureState,\r\n                         nextState: FigureState,\r\n                         parentContainer: HTMLElement,\r\n                         container: HTMLElement): void {\r\n        if (this.props.debug) {\r\n            console.log('MplFigureContainer.updateExternalObject: ', figure, prevState, nextState);\r\n        }\r\n        if (prevState && prevState.figureUpdateCount !== nextState.figureUpdateCount) {\r\n            figure.sendRefresh();\r\n            figure.sendResize();\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {CSSProperties} from 'react';\r\nimport {AnchorButton, IconName, Intent, PopoverPosition, Tooltip} from '@blueprintjs/core';\r\n\r\nexport interface IToolButtonProps {\r\n    onClick?: () => void;\r\n    className?: string;\r\n    disabled?: boolean;\r\n    icon?: IconName;\r\n    intent?: Intent;\r\n    tooltipContent?: JSX.Element | string;\r\n    tooltipPosition?: PopoverPosition;\r\n    style?: CSSProperties;\r\n    text?: string;\r\n    active?: boolean;\r\n    large?: boolean;\r\n}\r\n\r\nexport function ToolButton(props: IToolButtonProps) {\r\n    let className;\r\n    if (!props.large) {\r\n        className = 'bp3-small';\r\n    }\r\n    if (props.className && props.className !== '') {\r\n        className = `${className} ${props.className}`;\r\n    }\r\n    const button = (\r\n        <AnchorButton\r\n            className={className}\r\n            onClick={props.onClick}\r\n            disabled={props.disabled}\r\n            icon={props.icon}\r\n            intent={props.intent}\r\n            style={props.style}\r\n            text={props.text}\r\n            active={props.active}\r\n        />\r\n    );\r\n    if (props.tooltipContent) {\r\n        return (\r\n            <Tooltip\r\n                content={props.tooltipContent}\r\n                position={props.tooltipPosition || PopoverPosition.AUTO}\r\n            >\r\n                {button}\r\n            </Tooltip>\r\n        );\r\n    } else {\r\n        return button;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { MplFigureCommandListener, MplFigureCommandSourceImpl } from './MplFigure';\r\nimport { MplFigureContainer } from './MplFigureContainer';\r\nimport { ButtonGroup, Tag } from '@blueprintjs/core';\r\nimport { ToolButton } from '../ToolButton';\r\n\r\n\r\ninterface IFigurePanelProps {\r\n    id: string;\r\n    figureId: number;\r\n    figureUpdateCount: number;\r\n    figureName: string;\r\n    figureHeight?: any;\r\n    webSocketUrl: string;\r\n    onDownload: MplFigureCommandListener;\r\n}\r\n\r\ninterface IFigurePanelState {\r\n    message?: string;\r\n}\r\n\r\nconst FIGURE_COMMAND_SOURCE = new MplFigureCommandSourceImpl();\r\n\r\n\r\n/**\r\n * A component that wraps a div that holds a matplotlib figure.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class MplFigurePanel extends React.Component<IFigurePanelProps, IFigurePanelState> {\r\n    static readonly DIV_STYLE: CSSProperties = {width: '100%', overflow: 'auto'};\r\n    static readonly CONTAINER_DIV_STYLE: CSSProperties = {\r\n        width: '100%',\r\n        overflow: 'hidden',\r\n        padding: '0.2em 0.2em 0 0.2em'\r\n    };\r\n\r\n    constructor(props: IFigurePanelProps) {\r\n        super(props);\r\n        this.state = {};\r\n        this.handleFigureMessage = this.handleFigureMessage.bind(this);\r\n    }\r\n\r\n    // TODO (forman): inform MplFigurePanel if view is closed!\r\n    static handleClose(figureId: number) {\r\n        FIGURE_COMMAND_SOURCE.removeCommandListeners(figureId);\r\n    }\r\n\r\n    handleFigureMessage(message: string) {\r\n        this.setState({message});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div style={MplFigurePanel.DIV_STYLE}>\r\n                <MplFigureContainer figureId={this.props.figureId}\r\n                                    figureUpdateCount={this.props.figureUpdateCount}\r\n                                    figureHeight={this.props.figureHeight || '30em'}\r\n                                    id={this.props.id}\r\n                                    debug={false}\r\n                                    webSocketUrl={this.props.webSocketUrl}\r\n                                    style={MplFigurePanel.CONTAINER_DIV_STYLE}\r\n                                    commandSource={FIGURE_COMMAND_SOURCE}\r\n                                    onMessage={this.handleFigureMessage}/>\r\n                <MplFigureToolbar figureId={this.props.figureId}\r\n                                  message={this.state.message}\r\n                                  onCommand={FIGURE_COMMAND_SOURCE.dispatchCommand}\r\n                                  onDownload={this.props.onDownload}/>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface IMplFigureToolbarProps {\r\n    figureId: number;\r\n    message: string;\r\n    onCommand: MplFigureCommandListener;\r\n    onDownload: MplFigureCommandListener;\r\n}\r\n\r\nclass MplFigureToolbar extends React.PureComponent<IMplFigureToolbarProps, null> {\r\n\r\n    static readonly DIV_STYLE: CSSProperties = {display: 'flex', alignItems: 'center', padding: '0.2em'};\r\n\r\n    commands: any[];\r\n\r\n    constructor(props: IMplFigureToolbarProps) {\r\n        super(props);\r\n\r\n        this.commands = [\r\n            {\r\n                label: 'Home',\r\n                tooltip: 'Reset original view',\r\n                icon: 'home',\r\n                name: 'home',\r\n            },\r\n            {\r\n                label: 'Back',\r\n                tooltip: 'Back to  previous view',\r\n                icon: 'chevron-left',\r\n                name: 'back',\r\n            },\r\n            {\r\n                label: 'Forward',\r\n                tooltip: 'Forward to next view',\r\n                icon: 'chevron-right',\r\n                name: 'forward',\r\n            },\r\n            {\r\n                label: 'Pan',\r\n                tooltip: 'Pan axes with left mouse, zoom with right',\r\n                icon: 'move',\r\n                name: 'pan',\r\n            },\r\n            {\r\n                label: 'Zoom',\r\n                tooltip: 'Zoom to rectangle',\r\n                icon: 'zoom-in',\r\n                name: 'zoom',\r\n            },\r\n            {\r\n                label: 'Save As',\r\n                tooltip: 'Save as image',\r\n                icon: 'download',\r\n                name: 'download',\r\n            }\r\n        ];\r\n\r\n        for (let command of this.commands) {\r\n            const name = command['name'];\r\n            let callback;\r\n            if (name === 'download') {\r\n                callback = () => {\r\n                    // console.log(`MplFigureToolbar: \"${name}\" clicked for figure #${this.props.figureId}!`);\r\n                    this.props.onDownload(this.props.figureId, {name});\r\n                };\r\n            } else {\r\n                callback = () => {\r\n                    // console.log(`MplFigureToolbar: \"${name}\" clicked for figure #${this.props.figureId}!`);\r\n                    this.props.onCommand(this.props.figureId, {name});\r\n                };\r\n            }\r\n            command['callback'] = callback;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const buttons = [];\r\n        for (let i in this.commands) {\r\n            const command = this.commands[i];\r\n            const name = command['name'];\r\n            if (name) {\r\n                const tooltipText = command['tooltip'];\r\n                const icon = command['icon'];\r\n                const onClick = command['callback'];\r\n                buttons.push(\r\n                    <ToolButton key={i}\r\n                                tooltipContent={tooltipText}\r\n                                icon={icon}\r\n                                onClick={onClick}/>\r\n                );\r\n            }\r\n        }\r\n\r\n        let messageTag;\r\n        if (this.props.message) {\r\n            messageTag = (<Tag className=\"bp3-minimal\">{this.props.message}</Tag>);\r\n        }\r\n\r\n        return (\r\n            <div style={MplFigureToolbar.DIV_STYLE}>\r\n                {messageTag}\r\n                <span style={{flex: 'auto'}}/>\r\n                <ButtonGroup>{buttons}</ButtonGroup>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { FigureViewDataState, ResourceState, State } from '../state';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { ViewState } from '../components/ViewState';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { MplFigurePanel } from '../components/matplotlib/MplFigurePanel';\r\nimport { getMPLDownloadUrl, getMPLWebSocketUrl } from '../state-util';\r\nimport { Card } from '@blueprintjs/core';\r\n\r\n\r\ninterface IFigureViewOwnProps {\r\n    view: ViewState<FigureViewDataState>;\r\n}\r\n\r\ninterface IFigureViewProps extends IFigureViewOwnProps {\r\n    baseUrl: string;\r\n    baseDir: string | null;\r\n    figureResources: ResourceState[];\r\n    mplWebSocketUrl: string;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IFigureViewOwnProps): IFigureViewProps {\r\n    return {\r\n        view: ownProps.view,\r\n        baseUrl: selectors.webAPIRestUrlSelector(state),\r\n        baseDir: selectors.workspaceBaseDirSelector(state),\r\n        figureResources: selectors.figureResourcesSelector(state),\r\n        mplWebSocketUrl: selectors.mplWebSocketUrlSelector(state),\r\n    };\r\n}\r\n\r\n/**\r\n * This component displays a 2D map with a number of layers.\r\n */\r\nclass FigureView extends React.Component<IFigureViewProps & DispatchProp<State>, null> {\r\n    static readonly DIV_STYLE = {width: '100%', height: '100%', overflowX: 'hidden', overflowY: 'auto'};\r\n\r\n    constructor(props: IFigureViewProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.onDownload = this.onDownload.bind(this);\r\n    }\r\n\r\n    onDownload(figureId: number) {\r\n        const imageBaseUrl = getMPLDownloadUrl(this.props.baseUrl, this.props.baseDir, figureId);\r\n        this.props.dispatch(actions.saveFigureImageAs(imageBaseUrl, figureId) as any);\r\n    }\r\n\r\n    render() {\r\n        const view = this.props.view;\r\n        const figureResource = this.getFigureResource();\r\n        if (!figureResource) {\r\n            return (<Card>Figure not found.</Card>);\r\n        }\r\n        const compId = `MplFigurePanel-${figureResource.id}-${view.id}`;\r\n        return (\r\n            <MplFigurePanel\r\n                key={compId}\r\n                id={compId}\r\n                figureId={figureResource.id}\r\n                figureUpdateCount={figureResource.updateCount}\r\n                figureName={figureResource.name}\r\n                webSocketUrl={getMPLWebSocketUrl(this.props.mplWebSocketUrl, this.props.baseDir, figureResource.id)}\r\n                onDownload={this.onDownload}\r\n            />\r\n        );\r\n    }\r\n\r\n    getFigureResource(): ResourceState | null {\r\n        const figureViewData = this.props.view.data;\r\n        return this.props.figureResources.find(r => r.id === figureViewData.resourceId);\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(FigureView);\r\n\r\n\r\n","import * as React from 'react';\nimport { State, WebAPIServiceInfo } from '../state';\nimport { ModalDialog } from '../components/ModalDialog';\nimport { connect, DispatchProp } from 'react-redux';\nimport * as selectors from '../selectors';\nimport { ServiceInfoAPI } from '../webapi/apis/ServiceInfoAPI';\n\n// Duration in seconds the ServiceAutoCloseDialog is\n// shown before server auto-shutdown.\n//\nconst DIALOG_DURATION_MIN = (process.env.NODE_ENV === 'development' ? 1 : 15) * 60;\n\ninterface IServiceAutoCloseDialogProps {\n    webAPIServiceInfo: WebAPIServiceInfo | null;\n    webAPIServiceURL: string;\n}\n\nfunction mapStateToProps(state: State): IServiceAutoCloseDialogProps {\n    return {\n        webAPIServiceInfo: selectors.webAPIServiceInfoSelector(state),\n        webAPIServiceURL: selectors.webAPIServiceURLSelector(state),\n    };\n}\n\nconst ServiceAutoCloseDialog: React.FC<IServiceAutoCloseDialogProps & DispatchProp<State>> = (\n    {\n        webAPIServiceInfo,\n        webAPIServiceURL,\n    }\n) => {\n    if (!webAPIServiceInfo) {\n        return null;\n    }\n\n    const autoStopInfo = webAPIServiceInfo.autoStopInfo;\n    if (!autoStopInfo) {\n        return null;\n    }\n\n    const {availableTime, remainingTime, inactivityTime} = autoStopInfo;\n    if (!availableTime || !remainingTime || !inactivityTime) {\n        return null;\n    }\n\n    const remainingTimeMin = 1;  // = dialog disappears 1s before shutdown\n    const remainingTimeMax = Math.max(DIALOG_DURATION_MIN, 0.75 * availableTime);\n    const shouldShow = remainingTime > remainingTimeMin\n                       && remainingTime < remainingTimeMax;\n    if (!shouldShow) {\n        return null;\n    }\n\n    const canConfirm = () => {\n        return true;\n    }\n\n    const handleClose = () => {\n        // Make any harmless REST call so the\n        // server's inactivity timer is reset:\n        try {\n            // noinspection JSIgnoredPromiseFromCall\n            new ServiceInfoAPI().getServiceInfo(webAPIServiceURL);\n        } catch (error) {\n            console.error(error);\n        }\n    }\n\n    const renderBody = () => {\n        return (\n            <div>\n                <p>\n                    The Cate service will shut down soon due to inactivity\n                    since {formatSeconds(inactivityTime)}. After the shutdown\n                    you will need to reconnect/login first. Unsaved changes will be lost.\n                </p>\n                <p>\n                    The remaining time is <strong>{formatSeconds(remainingTime)}</strong>.\n                </p>\n                <p>\n                    Press \"Keep Alive\" to prevent the shutdown.\n                </p>\n            </div>\n        );\n    }\n\n    return (\n        <ModalDialog\n            isOpen={true}\n            title=\"Service Shutdown Ahead\"\n            icon=\"offline\"\n            noCancelButton={true}\n            confirmTitle=\"Keep Alive\"\n            confirmIconName=\"link\"\n            confirmTooltip=\"Requests keeping the service available.\"\n            onCancel={handleClose}\n            onConfirm={handleClose}\n            canConfirm={canConfirm}\n            renderBody={renderBody}\n        />\n    );\n}\n\nexport default connect(mapStateToProps)(ServiceAutoCloseDialog);\n\n\nfunction formatSeconds(value: number): string {\n    const hours = Math.floor(value / 3600);\n    const remainder = value - hours * 3600;\n    const minutes = Math.floor(remainder / 60);\n    const seconds = Math.round(remainder - minutes * 60);\n    const parts = [];\n    if (hours > 0) {\n        parts.push(`${hours} hour${hours !== 1 ? 's': ''}`);\n    }\n    if (minutes > 0) {\n        parts.push(`${minutes} minute${minutes !== 1 ? 's': ''}`);\n    }\n    parts.push(`${seconds} second${seconds !== 1 ? 's': ''}`);\n    return parts.join(', ');\n}","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { ResourceState, State, TableViewDataState } from '../state';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { ViewState } from '../components/ViewState';\r\nimport { Spinner } from '@blueprintjs/core';\r\nimport { Cell, Column, Table } from '@blueprintjs/table';\r\nimport * as assert from '../../common/assert';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { LOADING_TABLE_DATA_FAILED, NO_TABLE_DATA } from '../messages';\r\n\r\ninterface ITableViewOwnProps {\r\n    view: ViewState<TableViewDataState>;\r\n}\r\n\r\ninterface ITableViewProps {\r\n    viewId: string;\r\n    viewData: TableViewDataState,\r\n    resources: ResourceState[];\r\n    resNames: string[];\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: ITableViewOwnProps): ITableViewProps {\r\n    return {\r\n        viewId: ownProps.view.id,\r\n        viewData: ownProps.view.data,\r\n        resources: selectors.resourcesSelector(state),\r\n        resNames: selectors.resourceNamesSelector(state),\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * This component displays a 2D map with a number of layers.\r\n */\r\nclass TableView extends React.PureComponent<ITableViewProps & ITableViewOwnProps & DispatchProp<State>, null> {\r\n    static readonly TABLE_CONTAINER_STYLE: CSSProperties = {\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden',\r\n        display: 'flex',\r\n        flexDirection: 'column'\r\n    };\r\n    static readonly LOADING_CONTAINER_STYLE: CSSProperties = {\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center' as any\r\n    };\r\n\r\n    componentWillMount(): void {\r\n        const viewData = this.props.viewData;\r\n        if (!viewData.dataRows && !viewData.isLoading && !viewData.error) {\r\n            this.props.dispatch(actions.loadTableViewData(this.props.viewId, viewData.resName, viewData.varName) as any);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div style={TableView.TABLE_CONTAINER_STYLE}>\r\n                {this.renderDataTable()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderDataTable() {\r\n        const viewData = this.props.viewData;\r\n        assert.ok(viewData);\r\n\r\n        if (viewData.isLoading) {\r\n            return (\r\n                <div style={TableView.LOADING_CONTAINER_STYLE}>\r\n                    <Spinner className=\"bp3-large\"/>\r\n                    <p>Loading table data...</p>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (viewData.error) {\r\n            return LOADING_TABLE_DATA_FAILED(viewData.error);\r\n        }\r\n\r\n        const dataRows = viewData.dataRows;\r\n        if (!dataRows || !dataRows.length) {\r\n            return NO_TABLE_DATA;\r\n        }\r\n\r\n        const firstRow = dataRows[0];\r\n        const columnNames = Object.getOwnPropertyNames(firstRow).filter(name => name !== '');\r\n\r\n        const getData = (row: number, col: number) => {\r\n            return dataRows[row][columnNames[col]];\r\n        };\r\n\r\n        const children = [];\r\n        for (let i in columnNames) {\r\n            const renderCell = (row: number, col: number) => {\r\n                return (<Cell>{getData(row, col)}</Cell>);\r\n            };\r\n            children.push(<Column key={i} name={columnNames[i]} cellRenderer={renderCell}/>);\r\n        }\r\n\r\n        return (<Table numRows={dataRows.length}\r\n                       enableRowHeader={true}\r\n                       getCellClipboardData={getData}\r\n                       children={children as any}/>);\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(TableView);\r\n\r\n","import * as React from 'react'\r\n\r\nexport type SplitDir = 'hor' | 'ver';\r\n\r\n// TODO (forman): add splitter width, color, handleIcon, etc. style props\r\ninterface ISplitterProps {\r\n    dir?: SplitDir;\r\n    onChange: (delta: number) => any;\r\n}\r\n\r\ninterface IButtonEvent {\r\n    button: number;\r\n    buttons: number;\r\n}\r\n\r\ninterface IScreenEvent {\r\n    screenX: number;\r\n    screenY: number;\r\n}\r\n\r\ntype EventListenerItem = [string, (any) => any];\r\n\r\n\r\n/**\r\n * A splitter component.\r\n * In order to work properly, clients must provide the onChange which is a callback that receives the delta position\r\n * either in x-direction if direction is \"hor\" or y-direction if direction is \"ver\". The callback must then\r\n * adjust either a container's width if direction is \"hor\" or its height if direction is \"ver\".\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class Splitter extends React.PureComponent<ISplitterProps, any> {\r\n    private lastPosition: null | number = null;\r\n    private bodyEventListeners: Array<EventListenerItem>;\r\n\r\n    constructor(props: ISplitterProps) {\r\n        super(props);\r\n        if (!props.onChange) {\r\n            throw Error('onChange property must be provided');\r\n        }\r\n        this.bodyEventListeners = [\r\n            ['mousemove', this.onBodyMouseMove.bind(this)],\r\n            ['mouseup', this.onBodyMouseUp.bind(this)],\r\n            ['onmouseenter', this.onBodyMouseEnter.bind(this)],\r\n            ['onmouseleave', this.onBodyMouseLeave.bind(this)],\r\n        ];\r\n    }\r\n\r\n    private onMouseDown(event: React.MouseEvent<HTMLDivElement>) {\r\n        if (this.isButton1Pressed(event)) {\r\n            this.lastPosition = this.getCurrentPosition(event);\r\n            this.removeBodyMouseListeners();\r\n            this.addBodyMouseListeners();\r\n        } else {\r\n            this.lastPosition = null;\r\n        }\r\n    }\r\n\r\n    private onBodyMouseMove(event: MouseEvent) {\r\n        if (this.lastPosition === null || !this.isButton1Pressed(event)) {\r\n            return;\r\n        }\r\n        const currentPosition = this.getCurrentPosition(event);\r\n        const positionDelta = currentPosition - this.lastPosition;\r\n        this.lastPosition = currentPosition;\r\n        if (positionDelta !== 0) {\r\n            this.props.onChange(positionDelta);\r\n        }\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private onBodyMouseUp(event: MouseEvent) {\r\n        // console.log(\"onBodyMouseUp: \", event, this);\r\n        this.endDragging();\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private onBodyMouseEnter(event: MouseEvent) {\r\n        // console.log(\"onBodyMouseEnter: \", event, this);\r\n        this.endDragging();\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private onBodyMouseLeave(event: MouseEvent) {\r\n        // console.log(\"onBodyMouseLeave: \", event, this);\r\n        this.endDragging();\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private isButton1Pressed(event: IButtonEvent) {\r\n        return event.button === 0 && event.buttons === 1;\r\n    }\r\n\r\n    private getCurrentPosition(event: IScreenEvent) {\r\n        return this.props.dir === 'hor' ? event.screenX : event.screenY;\r\n    }\r\n\r\n    private endDragging() {\r\n        this.removeBodyMouseListeners();\r\n        this.lastPosition = null;\r\n    }\r\n\r\n    private addBodyMouseListeners() {\r\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\r\n                                            document.body.addEventListener(pair[0], pair[1]));\r\n    }\r\n\r\n    private removeBodyMouseListeners() {\r\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\r\n                                            document.body.removeEventListener(pair[0], pair[1]));\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.removeBodyMouseListeners();\r\n    }\r\n\r\n    render() {\r\n        const className = this.props.dir === 'hor' ? 'cate-splitter-hor' : 'cate-splitter-ver';\r\n        return (\r\n            <div\r\n                className={className}\r\n                onMouseDown={this.onMouseDown.bind(this)}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\n\r\n","import * as React from 'react'\r\nimport { SplitDir, Splitter } from './Splitter';\r\n\r\n\r\nexport interface ISplitPaneProps {\r\n    dir: SplitDir;\r\n    initialSize?: number;\r\n    onChange?: (newSize: number, oldSize: number) => void;\r\n}\r\n\r\nexport interface ISplitPaneState {\r\n    size: number;\r\n}\r\n\r\n/**\r\n * A simple SplitPane component which must have exactly two child elements.\r\n *\r\n * Properties:\r\n * - dir: the split direction, either \"hor\" or \"ver\"\r\n * - initialSize: the initial width (\"hor\") or height (\"ver\") of the first child's container\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class SplitPane extends React.PureComponent<ISplitPaneProps, ISplitPaneState> {\r\n\r\n    constructor(props: ISplitPaneProps) {\r\n        super(props);\r\n        this.handleSplitDelta = this.handleSplitDelta.bind(this);\r\n        this.state = {size: props.initialSize};\r\n    }\r\n\r\n    private handleSplitDelta(delta: number) {\r\n        this.setState((state: ISplitPaneState) => {\r\n            const oldSize = state.size;\r\n            const newSize = oldSize + delta;\r\n            if (this.props.onChange) {\r\n                this.props.onChange(newSize, oldSize);\r\n            }\r\n            return {size: newSize};\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let containerClass;\r\n        let childContainer1Style;\r\n        let childContainer2Style;\r\n        const splitterSize = 4; // px\r\n        if (this.props.dir === 'hor') {\r\n            const width1 = this.state.size;\r\n            const width2 = `calc(100% - ${width1 + splitterSize}px)`;\r\n            containerClass = 'cate-split-pane-hor';\r\n            childContainer1Style = {flex: 'none', width: width1, height: '100%'};\r\n            childContainer2Style = {flex: 'auto', width: width2, height: '100%'};\r\n        } else {\r\n            const height1 = this.state.size;\r\n            const height2 = `calc(100% - ${height1 + splitterSize}px)`;\r\n            containerClass = 'cate-split-pane-ver';\r\n            childContainer1Style = {flex: 'none', width: '100%', height: height1};\r\n            childContainer2Style = {flex: 'auto', width: '100%', height: height2};\r\n        }\r\n        return (\r\n            <div className={containerClass}>\r\n                <div style={childContainer1Style}>\r\n                    {this.props.children[0]}\r\n                </div>\r\n                <Splitter dir={this.props.dir} onChange={this.handleSplitDelta}/>\r\n                <div style={childContainer2Style}>\r\n                    {this.props.children[1]}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { SplitPane } from './SplitPane';\r\nimport { Switch } from '@blueprintjs/core';\r\n\r\n\r\nexport interface IContentWithDetailsPanelProps {\r\n    showDetails: boolean;\r\n    onShowDetailsChange: (value: boolean) => void;\r\n    contentHeight?: number;\r\n    onContentHeightChange?: (value: number) => void;\r\n    actionComponent?: JSX.Element | null;\r\n    isSplitPanel?: boolean;\r\n}\r\n\r\n\r\nexport class ContentWithDetailsPanel extends React.PureComponent<IContentWithDetailsPanelProps, any> {\r\n\r\n    constructor(props: IContentWithDetailsPanelProps) {\r\n        super(props);\r\n        this.handleSwitchChange = this.handleSwitchChange.bind(this);\r\n        this.handleContentHeightChange = this.handleContentHeightChange.bind(this);\r\n    }\r\n\r\n    private handleSwitchChange(event) {\r\n        this.props.onShowDetailsChange(event.target.checked);\r\n    }\r\n\r\n    private handleContentHeightChange(newSize: number, oldSize: number) {\r\n        if (this.props.onContentHeightChange) {\r\n            this.props.onContentHeightChange(newSize);\r\n        }\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        const contentChild = this.props.children[0];\r\n        const detailsChild = this.props.children[1];\r\n\r\n        const detailsSwitch = (<Switch checked={this.props.showDetails}\r\n                                       style={{alignSelf: 'flex-end', marginBottom: 0}}\r\n                                       label=\"Details\"\r\n                                       disabled={!detailsChild}\r\n                                       onChange={this.handleSwitchChange}/>);\r\n\r\n        const detailsContentPanel = this.props.showDetails ? detailsChild : null;\r\n\r\n        let detailsControlPanel;\r\n        if (this.props.actionComponent) {\r\n            detailsControlPanel = (\r\n                <div style={{display: 'flex', alignItems: 'flex-end'}}>\r\n                    {detailsSwitch}\r\n                    <span style={{flex: 'auto'}}/>\r\n                    {this.props.actionComponent}\r\n                </div>\r\n            );\r\n        } else {\r\n            detailsControlPanel = detailsSwitch;\r\n        }\r\n\r\n        const detailsPanel = (\r\n            <div>\r\n                {detailsControlPanel}\r\n                {detailsContentPanel}\r\n            </div>\r\n        );\r\n\r\n        let contentWithDetailsPanel;\r\n        if (this.props.isSplitPanel) {\r\n            contentWithDetailsPanel = (\r\n                <SplitPane dir=\"ver\"\r\n                           initialSize={this.props.contentHeight || 300}\r\n                           onChange={this.handleContentHeightChange}>\r\n                    {contentChild}\r\n                    {detailsPanel}\r\n                </SplitPane>);\r\n        } else {\r\n            contentWithDetailsPanel = (\r\n                <div>\r\n                    {contentChild}\r\n                    {detailsPanel}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return contentWithDetailsPanel;\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { AnchorButton } from '@blueprintjs/core';\r\n\r\nimport { DataSourceState } from '../state';\r\nimport { getDataSourceUrls } from '../state-util';\r\n\r\n\r\ninterface DataSourceLinksProps {\r\n    dataSource: DataSourceState;\r\n    style?: React.CSSProperties;\r\n}\r\n\r\nconst DataSourceLinks: React.FC<DataSourceLinksProps> = (\r\n    {\r\n        dataSource,\r\n        style,\r\n    }) => {\r\n\r\n    const {catalogUrl, infoUrl} = getDataSourceUrls(dataSource);\r\n    if (!catalogUrl && !infoUrl) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div style={{display: \"flex\", justifyContent: \"flex-end\", ...style}}>\r\n            {catalogUrl &&\r\n             <AnchorButton\r\n                 href={catalogUrl}\r\n                 target={\"_blank\"}\r\n                 style={{float: 'right', margin: 4}}>\r\n                 Catalogue\r\n             </AnchorButton>}\r\n            {infoUrl &&\r\n             <AnchorButton\r\n                 href={infoUrl}\r\n                 target={\"_blank\"}\r\n                 style={{float: 'right', margin: 4}}>\r\n                 More Info\r\n             </AnchorButton>}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DataSourceLinks;\r\n","import * as React from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkGFM from 'remark-gfm';\r\nimport { Colors } from '@blueprintjs/core';\r\n\r\nconst CODE_STYLE = {\r\n    fontFamily: 'Source Code Pro, Consolas, monospace',\r\n    color: Colors.LIGHT_GRAY1,\r\n};\r\n\r\nconst MARKDOWN_COMPONENTS = {\r\n    em: ({node, ...props}) => <em className=\"user-selectable\" {...props}/>,\r\n    li: ({node, ...props}) => <li className=\"user-selectable\" {...props}/>,\r\n    p: ({node, ...props}) => <p className=\"user-selectable\" {...props}/>,\r\n    span: ({node, ...props}) => <span className=\"user-selectable\" {...props}/>,\r\n    div: ({node, ...props}) => <div className=\"user-selectable\" {...props}/>,\r\n    code: ({node, ...props}) => <code className=\"user-selectable\" style={CODE_STYLE} {...props}/>,\r\n    pre: ({node, ...props}) => <pre className=\"user-selectable\" style={CODE_STYLE} {...props}/>,\r\n};\r\n\r\ninterface IMarkdownProps {\r\n    source: string;\r\n}\r\n\r\nconst Markdown: React.FC<IMarkdownProps> = ({source}) => {\r\n    return (\r\n        <ReactMarkdown\r\n            remarkPlugins={[remarkGFM]}\r\n            components={MARKDOWN_COMPONENTS}\r\n            linkTarget='_blank'\r\n        >\r\n            {source}\r\n        </ReactMarkdown>\r\n    );\r\n}\r\n\r\n\r\nexport default Markdown;\r\n","import * as React from 'react'\r\nimport { CSSProperties, ReactNode } from 'react'\r\n\r\ninterface IScrollablePanelContentProps {\r\n    children?: ReactNode;\r\n}\r\n\r\nconst STYLE: CSSProperties = {width: '100%', height: '100%', overflow: 'auto'};\r\n\r\nexport function ScrollablePanelContent(props: IScrollablePanelContentProps) {\r\n    return (<div style={STYLE}>{props.children}</div>);\r\n}\r\n","import * as React from 'react';\r\nimport { Card, Tab, Tabs } from '@blueprintjs/core';\r\nimport { Cell, Column, Table, TruncatedFormat } from '@blueprintjs/table';\r\n\r\nimport { DataSourceState } from '../state';\r\nimport DataSourceLinks from './DataSourceLinks';\r\nimport Markdown from './Markdown';\r\nimport { ScrollablePanelContent } from './ScrollableContent';\r\n\r\n\r\nconst COVERAGE_PANEL_STYLE: React.CSSProperties = {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    justifyContent: 'space-around'\r\n};\r\n\r\ninterface DetailPart {\r\n    title: string;\r\n    id: string;\r\n    element: JSX.Element;\r\n}\r\n\r\ninterface IDataSourceDetailsProps {\r\n    dataSource: DataSourceState\r\n}\r\n\r\nconst DataSourceDetails: React.FC<IDataSourceDetailsProps> = ({dataSource}) => {\r\n\r\n    if (!dataSource) {\r\n        return null;\r\n    }\r\n\r\n    let metaInfoKeys;\r\n    let variables;\r\n\r\n    const metaInfo = dataSource.metaInfo;\r\n\r\n    if (metaInfo) {\r\n        metaInfoKeys = Object.keys(metaInfo).filter(key => key !== 'data_vars'\r\n                                                           && key !== 'coords');\r\n        if (metaInfo.data_vars) {\r\n            variables = metaInfo.data_vars;\r\n        }\r\n    }\r\n\r\n    const details: DetailPart[] = [\r\n        renderAbstract(dataSource),\r\n        renderVariablesTable(variables),\r\n        renderMetaInfoTable(metaInfo, metaInfoKeys),\r\n        renderMetaInfoLicences(metaInfo),\r\n    ];\r\n\r\n    return (\r\n        <Tabs id=\"dsDetails\" renderActiveTabPanelOnly={true}>\r\n            {details.map(d => <Tab key={d.id} id={d.id} title={d.title} panel={d.element}/>)}\r\n        </Tabs>\r\n    );\r\n}\r\n\r\nexport default DataSourceDetails;\r\n\r\n\r\nfunction renderAbstract(dataSource: DataSourceState): DetailPart {\r\n\r\n    const metaInfo = dataSource.metaInfo;\r\n\r\n    let spatialCoverage;\r\n    let temporalCoverage;\r\n    let summary;\r\n    if (metaInfo) {\r\n        if (Array.isArray(metaInfo.bbox)) {\r\n            const [x_min, y_min, x_max, y_max] = metaInfo.bbox;\r\n            spatialCoverage = (\r\n                <div>\r\n                    <h5>Spatial coverage</h5>\r\n                    <table>\r\n                        <tbody>\r\n                        <tr>\r\n                            <td/>\r\n                            <td className=\"user-selectable\">{y_max}&#176;</td>\r\n                            <td/>\r\n                        </tr>\r\n                        <tr>\r\n                            <td className=\"user-selectable\">{x_min}&#176;</td>\r\n                            <td/>\r\n                            <td className=\"user-selectable\">{x_max}&#176;</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td/>\r\n                            <td className=\"user-selectable\">{y_min}&#176;</td>\r\n                            <td/>\r\n                        </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <br/>\r\n                </div>\r\n            );\r\n        }\r\n        if (dataSource.metaInfo && dataSource.metaInfo.time_range) {\r\n            let [start, end] = dataSource.metaInfo.time_range;\r\n            if (!start && !end) {\r\n                start = end = 'unknown';\r\n            } else if (!start) {\r\n                start = 'unknown';\r\n            } else if (!end) {\r\n                end = 'today';\r\n            }\r\n            temporalCoverage = (\r\n                <div><h5>Temporal coverage</h5>\r\n                    <table>\r\n                        <tbody>\r\n                        <tr>\r\n                            <td>Start</td>\r\n                            <td className=\"user-selectable\">{start}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>End</td>\r\n                            <td className=\"user-selectable\">{end}</td>\r\n                        </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <br/>\r\n                </div>\r\n            );\r\n        }\r\n        if (metaInfo.abstract) {\r\n            summary = (\r\n                <div><h5>Summary</h5>\r\n                    <Markdown source={metaInfo.abstract}/>\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    let element;\r\n    if (spatialCoverage || temporalCoverage || summary) {\r\n        element = (\r\n            <ScrollablePanelContent>\r\n                <Card>\r\n                    <DataSourceLinks dataSource={dataSource}/>\r\n                    <div style={COVERAGE_PANEL_STYLE}>\r\n                        {spatialCoverage}\r\n                        {temporalCoverage}\r\n                    </div>\r\n                    {summary}\r\n                </Card>\r\n            </ScrollablePanelContent>\r\n        );\r\n    } else {\r\n        element = (\r\n            <Card>\r\n                <DataSourceLinks dataSource={dataSource}/>\r\n                <p>No abstract available.</p>\r\n            </Card>\r\n        );\r\n    }\r\n\r\n    return {title: 'Abstract', id: 'abstract', element};\r\n}\r\n\r\nfunction renderVariablesTable(variables?: any[]): DetailPart {\r\n    let element;\r\n    if (variables && variables.length > 0) {\r\n        const renderName = (rowIndex: number) => {\r\n            const variable = variables[rowIndex];\r\n            return (\r\n                <Cell tooltip={variable.long_name}>\r\n                    <TruncatedFormat className=\"user-selectable\">{variable.name}</TruncatedFormat>\r\n                </Cell>\r\n            );\r\n        };\r\n\r\n        const renderUnit = (rowIndex: number) => {\r\n            const variable = variables[rowIndex];\r\n            return (\r\n                <Cell>\r\n                    <TruncatedFormat className=\"user-selectable\">{variable.units || '-'}</TruncatedFormat>\r\n                </Cell>\r\n            );\r\n        };\r\n\r\n        const getCellClipboardData = (row: number, col: number) => {\r\n            // TODO: implement me\r\n            console.error('not implemented: getCellClipboardData: ', row, col);\r\n        };\r\n\r\n        element = (\r\n            <Table numRows={variables.length}\r\n                   enableRowHeader={false}\r\n                   getCellClipboardData={getCellClipboardData}>\r\n                <Column name=\"Name\" cellRenderer={renderName}/>\r\n                <Column name=\"Units\" cellRenderer={renderUnit}/>\r\n            </Table>\r\n        );\r\n    } else {\r\n        element = <Card>No information about variables available.</Card>;\r\n    }\r\n    return {title: 'Variables', id: 'var', element};\r\n}\r\n\r\nfunction renderMetaInfoTable(metaInfo?: any, metaInfoKeys?: string[]): DetailPart {\r\n    let element;\r\n    if (metaInfo && metaInfoKeys) {\r\n\r\n        const renderKey = (rowIndex: number) => {\r\n            const key = metaInfoKeys[rowIndex];\r\n            return <Cell><TruncatedFormat>{key}</TruncatedFormat></Cell>;\r\n        };\r\n\r\n        const renderValue = (rowIndex: number) => {\r\n            const key = metaInfoKeys[rowIndex];\r\n            return <Cell><TruncatedFormat>{metaInfo[key]}</TruncatedFormat></Cell>;\r\n        };\r\n\r\n        const getCellClipboardData = (row: number, col: number) => {\r\n            // TODO: implement me\r\n            console.error('not implemented: getCellClipboardData: ', row, col);\r\n        };\r\n\r\n        element = (\r\n            <Table numRows={metaInfoKeys.length}\r\n                   enableRowHeader={false}\r\n                   getCellClipboardData={getCellClipboardData}>\r\n                <Column name=\"Key\" cellRenderer={renderKey}/>\r\n                <Column name=\"Value\" cellRenderer={renderValue}/>\r\n            </Table>\r\n        );\r\n    } else {\r\n        element = <Card>No global meta-information available.</Card>;\r\n    }\r\n\r\n    return {title: 'Meta-Info', id: 'meta', element};\r\n}\r\n\r\nfunction renderMetaInfoLicences(metaInfo: any): DetailPart {\r\n    let element;\r\n    if (metaInfo && metaInfo.licences) {\r\n        element = (\r\n            <div>\r\n                <Markdown source={metaInfo.licences}/>\r\n            </div>\r\n        );\r\n    } else {\r\n        element = <Card>No license information available.</Card>;\r\n    }\r\n    return {title: 'Licences', id: 'licences', element};\r\n}\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { Colors, Icon, Intent } from '@blueprintjs/core';\r\n\r\nimport { DataSourceState } from '../state';\r\n\r\nimport { EcvMeta } from '../ecv-meta';\r\nimport _ecvMeta from '../resources/ecv-meta.json';\r\nimport { canOpenDataSource } from '../state-util';\r\n\r\nconst ECV_META: EcvMeta = _ecvMeta;\r\n\r\n\r\nconst ITEM_STYLE: CSSProperties = {display: 'flex', alignItems: 'flex-start'};\r\nconst ID_STYLE: CSSProperties = {color: Colors.BLUE5, fontSize: '0.8em'};\r\nconst WARN_ICON_STYLE: CSSProperties = {marginRight: 4};\r\nconst DATA_TYPE_STYLE: CSSProperties = {color: Colors.GREEN4, fontSize: '0.8em', marginLeft: 4};\r\nconst TEXT_ICON_STYLE: CSSProperties = {\r\n    width: 32,\r\n    height: 32,\r\n    flex: 'none',\r\n    marginRight: 6,\r\n    borderRadius: 16,\r\n    textAlign: 'center',\r\n    color: 'white',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n};\r\n\r\ninterface DataSourceItemProps {\r\n    dataSource: DataSourceState;\r\n    showDataSourceIDs: boolean;\r\n}\r\n\r\nconst DataSourceItem: React.FC<DataSourceItemProps> = ({dataSource, showDataSourceIDs}) => {\r\n    const metaInfo = dataSource.metaInfo;\r\n\r\n    const {backgroundColor, label} = dataSourceToTextIconProps(dataSource);\r\n    const icon = <div style={{...TEXT_ICON_STYLE, backgroundColor}}>{label}</div>;\r\n\r\n    let title = dataSource.title || (metaInfo && metaInfo.title);\r\n    if (!title || title === dataSource.id) {\r\n        title = dataSourceToTitle(dataSource);\r\n    }\r\n\r\n    const isNotVerified = !canOpenDataSource(dataSource);\r\n    let warnIcon;\r\n    if (isNotVerified) {\r\n        warnIcon = <Icon icon={\"warning-sign\"} intent={Intent.WARNING} iconSize={16} style={WARN_ICON_STYLE}/>\r\n    }\r\n\r\n    let typeSpec;\r\n    if (dataSource.dataType) {\r\n        typeSpec = <span style={DATA_TYPE_STYLE}>{dataSource.dataType}</span>;\r\n    }\r\n\r\n    return (\r\n        <div style={ITEM_STYLE}>\r\n            {icon}\r\n            {showDataSourceIDs ? (\r\n                <div>\r\n                    <div className=\"user-selectable\">{warnIcon}{title}{typeSpec}</div>\r\n                    <div className=\"user-selectable\" style={ID_STYLE}>{dataSource.id}</div>\r\n                </div>\r\n            ) : (\r\n                 <span className=\"user-selectable\">{warnIcon}{title}{typeSpec}</span>\r\n             )}\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\nexport default DataSourceItem;\r\n\r\n\r\nfunction dataSourceToTitle(dataSource: DataSourceState) {\r\n    const title = dataSource.id\r\n                            .replace(/\\./g, ' ')\r\n                            .replace(/-/g, ' ')\r\n                            .replace(/_/g, '-');\r\n    if (title.startsWith('esacci ')) {\r\n        return title.substr('esacci '.length);\r\n    }  else if (title.startsWith('ESACCI ')) {\r\n        return title.substr('ESACCI '.length);\r\n    }\r\n    return title;\r\n}\r\n\r\nfunction dataSourceToTextIconProps(dataSource: DataSourceState) {\r\n    let ecvId;\r\n    let label;\r\n    const id = dataSource.id.toLowerCase();\r\n\r\n    // The following are CCI specific hacks\r\n    if (id.startsWith('esacci.')) {\r\n        const idParts = id.split('.', 2);\r\n        if (idParts.length > 1) {\r\n            ecvId = idParts[1];\r\n        }\r\n    }\r\n    if (!ecvId && id.startsWith('esacci-')) {\r\n        const idParts = id.split('-', 2);\r\n        if (idParts.length > 1) {\r\n            ecvId = idParts[1];\r\n        }\r\n    }\r\n    if (!ecvId) {\r\n        ecvId = id;\r\n    }\r\n    let actualEcvId = ECV_META.mappings[ecvId];\r\n    if (actualEcvId) {\r\n        ecvId = actualEcvId;\r\n    }\r\n    const ecvMetaItem = ecvId && ECV_META.ecvs[ecvId];\r\n    let backgroundColor;\r\n    if (ecvMetaItem) {\r\n        backgroundColor = ECV_META.colors[ecvMetaItem.color] || ecvMetaItem.color;\r\n        label = ecvMetaItem.label || label;\r\n    }\r\n    if (!backgroundColor) {\r\n        backgroundColor = ECV_META.colors[\"default\"] || \"#0BB7A0\";\r\n    }\r\n    if (!label) {\r\n        label = (ecvId && ecvId.substr(0, 3).toUpperCase()) || '?';\r\n    }\r\n    return {backgroundColor, label};\r\n}\r\n\r\n","import * as React from 'react';\r\n\r\nimport { DataSourceState } from '../state';\r\nimport DataSourceItem from './DataSourceItem';\r\nimport { ListBox, ListBoxSelectionMode } from './ListBox';\r\nimport { ScrollablePanelContent } from './ScrollableContent';\r\n\r\n\r\ninterface IDataSourcesListProps {\r\n    dataSources: DataSourceState[];\r\n    selectedDataSourceId: string | null;\r\n    setSelectedDataSourceId: (selectedDataSourceId: string) => void;\r\n    showDataSourceIDs: boolean;\r\n    doubleClickAction: (dataSource: DataSourceState) => any;\r\n}\r\n\r\nconst DataSourcesList: React.FC<IDataSourcesListProps> = (\r\n    {\r\n        dataSources,\r\n        selectedDataSourceId,\r\n        setSelectedDataSourceId,\r\n        showDataSourceIDs,\r\n        doubleClickAction,\r\n    }\r\n) => {\r\n    const getItemKey = (dataSource: DataSourceState) => {\r\n        return dataSource.id;\r\n    };\r\n\r\n    const renderDataSourceItem = (dataSource: DataSourceState) => {\r\n        return <DataSourceItem dataSource={dataSource} showDataSourceIDs={showDataSourceIDs}/>;\r\n    }\r\n\r\n    const handleDataSourceSelected = (newSelection: Array<React.Key>) => {\r\n        if (newSelection.length > 0) {\r\n            setSelectedDataSourceId(newSelection[0] as string);\r\n        } else {\r\n            setSelectedDataSourceId(null);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <ScrollablePanelContent>\r\n            <ListBox\r\n                // key is here to force re-render on change of showDataSourceIDs\r\n                key={'DataSourcesList-' + showDataSourceIDs}\r\n                items={dataSources}\r\n                getItemKey={getItemKey}\r\n                renderItem={renderDataSourceItem}\r\n                selectionMode={ListBoxSelectionMode.SINGLE}\r\n                selection={selectedDataSourceId}\r\n                onItemDoubleClick={doubleClickAction}\r\n                onSelection={handleDataSourceSelected}\r\n            />\r\n        </ScrollablePanelContent>\r\n    );\r\n}\r\n\r\nexport default DataSourcesList;\r\n\r\n","import * as React from 'react';\r\nimport { H5 } from '@blueprintjs/core';\r\nimport { DataSourceState } from '../state';\r\nimport DataSourceLinks from '../components/DataSourceLinks';\r\n\r\ninterface DataSourceOpenHintProps {\r\n    dataSource: DataSourceState;\r\n    isSandboxedMode: boolean;\r\n}\r\n\r\nconst DataSourceOpenHint: React.FC<DataSourceOpenHintProps> = (\r\n    {\r\n        dataSource,\r\n        isSandboxedMode,\r\n    }\r\n) => {\r\n\r\n    let manualInterventionNotice;\r\n    if (isSandboxedMode) {\r\n        manualInterventionNotice = (\r\n            <p>This data source cannot be opened directly from its data store.\r\n                You may\r\n                <ol>\r\n                    <li>Download it manually to your computer;</li>\r\n                    <li>Upload it using <strong>Files / Upload Files</strong>;</li>\r\n                    <li>Use one of the available <code>read_xxx()</code> operations\r\n                        to open the uploaded data. \"xxx\" is determined by the type\r\n                        and format of the data.\r\n                    </li>\r\n                </ol>\r\n            </p>\r\n        );\r\n    } else {\r\n        manualInterventionNotice = (\r\n            <p>This data source cannot be opened directly from its data store.\r\n                You may\r\n                <ol>\r\n                    <li>Download it manually to your computer;</li>\r\n                    <li>Use one of the available <code>read_xxx()</code> operations\r\n                        to open the downloaded data. \"xxx\" is determined by the type\r\n                        and format of the data.\r\n                    </li>\r\n                </ol>\r\n            </p>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <H5>Manual intervention required</H5>\r\n            {manualInterventionNotice}\r\n            <DataSourceLinks dataSource={dataSource} style={{marginTop: 8}}/>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default DataSourceOpenHint;\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, InputGroup, Intent } from '@blueprintjs/core';\r\nimport { DialogState, State } from '../state';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { OpenDialogOptions } from \"../components/desktop/types\";\r\nimport { getParentPath } from \"../../common/paths\";\r\n\r\ninterface IAddDatasetDialogProps {\r\n    isOpen: boolean;\r\n}\r\n\r\ninterface IAddDatasetDialogState extends DialogState {\r\n    dataSourceName: string;\r\n    filePathPattern: string;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IAddDatasetDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(AddDatasetDialog.DIALOG_ID)(state);\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n    };\r\n}\r\n\r\nclass AddDatasetDialog extends React.Component<IAddDatasetDialogProps & DispatchProp<State>, IAddDatasetDialogState> {\r\n    static readonly DIALOG_ID = 'addDatasetDialog';\r\n\r\n    constructor(props: IAddDatasetDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {dataSourceName: '', filePathPattern: ''};\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onDataSourceNameChange = this.onDataSourceNameChange.bind(this);\r\n        this.onFilePathPatternChange = this.onFilePathPatternChange.bind(this);\r\n        this.showSelectDirectoryDialog = this.showSelectDirectoryDialog.bind(this);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IAddDatasetDialogProps) {\r\n        this.setState({dataSourceName: '', filePathPattern: ''});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(AddDatasetDialog.DIALOG_ID));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        return !!this.state.dataSourceName && !!this.state.filePathPattern;\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(AddDatasetDialog.DIALOG_ID, this.state));\r\n        this.props.dispatch(actions.addLocalDataset(this.state.dataSourceName, this.state.filePathPattern) as any);\r\n    }\r\n\r\n    private onDataSourceNameChange(ev: any) {\r\n        this.setState({dataSourceName: ev.target.value} as IAddDatasetDialogState);\r\n    }\r\n\r\n    private onFilePathPatternChange(ev: any) {\r\n        this.setState({filePathPattern: ev.target.value} as IAddDatasetDialogState);\r\n    }\r\n\r\n    private showSelectDirectoryDialog() {\r\n        const openDialogOptions: OpenDialogOptions = {\r\n            title: 'Select Directory',\r\n            buttonLabel: 'Select',\r\n            defaultPath: this.state.filePathPattern !== '' ? getParentPath(this.state.filePathPattern) : undefined,\r\n        };\r\n        this.props.dispatch(actions.showDirectorySelectDialog(openDialogOptions, (dirPath: string | null) => {\r\n            if (dirPath) {\r\n                this.setState({filePathPattern: dirPath + '/*.nc'} as IAddDatasetDialogState);\r\n            }\r\n        }) as any);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title=\"Add file data source\"\r\n                icon=\"add\"\r\n                confirmTitle=\"Add\"\r\n                confirmIconName=\"add\"\r\n                confirmTooltip=\"Add file data source.\"\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        return (\r\n            <div>\r\n                <p>Define a new file data source using a file path pattern.</p>\r\n\r\n                <p style={{marginTop: '1em'}}>Name:</p>\r\n                <InputGroup\r\n                    type=\"text\"\r\n                    style={{width: '100%'}}\r\n                    value={this.state.dataSourceName}\r\n                    onChange={this.onDataSourceNameChange}\r\n                />\r\n                <p style={{marginTop: '1em'}}>Path pattern<span className=\"bp3-text-muted\"> (can contain wildcards like \"*\" or \"?\")</span>:\r\n                </p>\r\n                <ControlGroup style={{flexGrow: 1, width: '100%'}}>\r\n                    <InputGroup\r\n                        type=\"text\"\r\n                        fill={true}\r\n                        value={this.state.filePathPattern}\r\n                        onChange={this.onFilePathPatternChange}\r\n                    />\r\n                    <AnchorButton intent={Intent.PRIMARY} style={{flex: 'none'}}\r\n                                  onClick={this.showSelectDirectoryDialog}>...</AnchorButton>\r\n                </ControlGroup>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(AddDatasetDialog);\r\n","/**\r\n * Converts a milliseconds time value to an ISO date string.\r\n * @param millis Time in milliseconds\r\n * @returns {string} ISO date string\r\n */\r\nexport function formatMillisAsISODateString(millis: number) {\r\n    return new Date(millis).toISOString().slice(0, 10);\r\n}\r\n\r\n/**\r\n * Converts a time value to an ISO date string.\r\n * @param date Time as date\r\n * @returns {string} ISO date string\r\n */\r\nexport function formatDateAsISODateString(date: Date) {\r\n    const isoDate = new Date(date.getTime() - (date.getTimezoneOffset() * 60000));\r\n    return isoDate.toISOString().slice(0, 10);\r\n}\r\n\r\n/**\r\n * Format a data type name for human readers.\r\n *\r\n * @param name fully qualified data type name\r\n * @param fullyQualified if the type name should be (kept) fully qualified\r\n * @returns {any}\r\n */\r\nexport function formatDataTypeName(name: string | null, fullyQualified: boolean): string {\r\n    if (name && !fullyQualified) {\r\n        const indexColon = name.lastIndexOf(':');\r\n        if (indexColon >= 1) {\r\n            name = name.substr(0, indexColon);\r\n        }\r\n        const indexDot = name.lastIndexOf('.');\r\n        if (indexDot >= 0) {\r\n            name = name.substr(indexDot + 1);\r\n        }\r\n    }\r\n    return name;\r\n}\r\n","import { DateRange } from '@blueprintjs/datetime';\r\nimport { Field, FieldType, IFieldProps } from './Field';\r\nimport { formatDateAsISODateString } from '../../../common/format';\r\nimport { isUndefinedOrNull } from '../../../common/types';\r\n\r\nexport type DateFieldType = FieldType<Date>;\r\n\r\nexport interface IDateFieldProps extends IFieldProps {\r\n    nullable?: boolean;\r\n    min?: Date;\r\n    max?: Date;\r\n}\r\n\r\nexport const DEFAULT_MIN_DATE = new Date('1980-01-01');\r\nexport const DEFAULT_MAX_DATE = new Date(Date.now());\r\nexport const DEFAULT_DATE_RANGE: DateRange = [DEFAULT_MIN_DATE, DEFAULT_MAX_DATE];\r\n\r\nexport class DateField extends Field<IDateFieldProps> {\r\n\r\n    public static defaultProps: Partial<IFieldProps> = {\r\n        uncontrolled: true,\r\n        placeholder: 'YYYY-MM-DD'\r\n    };\r\n\r\n    parseValue(textValue: string): DateFieldType {\r\n        return parseDate(textValue, this.props.nullable);\r\n    }\r\n\r\n    formatValue(value: DateFieldType): string {\r\n        return formatDate(value);\r\n    }\r\n\r\n    validateValue(value: DateFieldType) {\r\n        super.validateValue(value);\r\n        validateDate(value, this.props.nullable, this.props.min, this.props.max);\r\n    }\r\n}\r\n\r\nexport function parseDate(textValue: string, nullable: boolean, name?: string): Date | null {\r\n    if (!textValue || textValue.trim() === '') {\r\n        if (nullable) {\r\n            return null;\r\n        }\r\n        throw new Error('Date must be given.');\r\n    }\r\n    const dateRegex = /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/;\r\n    if (!dateRegex.test(textValue.trim())) {\r\n        throw new Error('Date not valid: >' + textValue + '<');\r\n    }\r\n    let millis;\r\n    try {\r\n        millis = Date.parse(textValue.trim());\r\n    } catch (e) {\r\n        throw new Error(`Invalid ${name || 'date'}.`);\r\n    }\r\n    return new Date(millis);\r\n}\r\n\r\nexport function formatDate(value: Date | null): string {\r\n    if (isUndefinedOrNull(value)) {\r\n        return '';\r\n    }\r\n    return formatDateAsISODateString(value);\r\n}\r\n\r\nexport function validateDate(date: Date | null, nullable: boolean | null, min: Date | null, max: Date | null, name?: string) {\r\n    if (!date) {\r\n        if (!nullable) {\r\n            throw Error('Date value expected.');\r\n        }\r\n        return;\r\n    }\r\n    if (min && date.valueOf() < min.valueOf()) {\r\n        throw new Error(`${name || 'Date'} must not be before ${formatDate(min)}.`);\r\n    }\r\n    if (max && date.valueOf() > max.valueOf()) {\r\n        throw new Error(`${name || 'Date'} must not be after ${formatDate(max)}.`);\r\n    }\r\n}\r\n\r\n","import { DateRange } from '@blueprintjs/datetime';\r\nimport { Field, FieldType, FieldValue, IFieldProps } from './Field';\r\nimport { isUndefinedOrNull } from '../../../common/types';\r\nimport { formatDate, parseDate, validateDate } from './DateField';\r\n\r\nexport type DateRangeFieldType = FieldType<DateRange>;\r\nexport type DateRangeFieldValue = FieldValue<DateRange>;\r\n\r\ninterface IDateRangeFieldProps extends IFieldProps {\r\n    nullable?: boolean;\r\n    min?: Date;\r\n    max?: Date;\r\n}\r\n\r\nexport class DateRangeField extends Field<IDateRangeFieldProps> {\r\n\r\n    public static defaultProps: Partial<IFieldProps> = {\r\n        uncontrolled: true,\r\n        placeholder: 'YYYY-MM-DD, YYYY-MM-DD',\r\n        size: 24\r\n    };\r\n\r\n    parseValue(textValue: string): DateRangeFieldType {\r\n        return parseDateRange(textValue, this.props.nullable);\r\n    }\r\n\r\n    formatValue(value: DateRangeFieldType): string {\r\n        return formatDateRange(value);\r\n    }\r\n\r\n    validateValue(value: DateRangeFieldType) {\r\n        super.validateValue(value);\r\n        validateDateRange(value, this.props.nullable, this.props.min, this.props.max);\r\n    }\r\n}\r\n\r\n\r\nexport function parseDateRange(textValue: string, nullable: boolean): DateRange | null {\r\n    if (!textValue || textValue.trim() === '') {\r\n        if (nullable) {\r\n            return null;\r\n        }\r\n        throw new Error('Date range must be given.');\r\n    }\r\n    const dateStrings = textValue.split(',');\r\n    if (dateStrings.length !== 2 || dateStrings[0].trim() === '' || dateStrings[1].trim() === '') {\r\n        throw new Error('Invalid date range.');\r\n    }\r\n    const date1 = parseDate(dateStrings[0], true, 'first date');\r\n    const date2 = parseDate(dateStrings[1], true, 'second date');\r\n    if (!date1 && !date2) {\r\n        return null;\r\n    }\r\n    return [date1, date2];\r\n}\r\n\r\nexport function formatDateRange(value: DateRange | null): string {\r\n    if (isUndefinedOrNull(value)) {\r\n        return '';\r\n    }\r\n    const date1 = value[0];\r\n    const date2 = value[1];\r\n    if (!date1 && !date2) {\r\n        return '';\r\n    }\r\n    return formatDate(date1) + ',' + formatDate(date2);\r\n}\r\n\r\nexport function validateDateRange(value: DateRange | null, nullable: boolean | null, min: Date | null, max: Date | null) {\r\n    if (!value) {\r\n        if (!nullable) {\r\n            throw Error('Date range value expected.');\r\n        }\r\n        return;\r\n    }\r\n    const date1 = value[0];\r\n    const date2 = value[1];\r\n    validateDate(date1, nullable, min, max, 'First date');\r\n    validateDate(date2, nullable, min, max, 'Second date');\r\n    if (date1 && date2 && date1.valueOf() > date2.valueOf()) {\r\n        throw new Error('First date must not be after second date.');\r\n    }\r\n}\r\n","import * as React from 'react';\r\n\r\n\r\nconst LONG_ID_STYLE: React.CSSProperties = {wordWrap: 'break-word'};\r\n\r\nexport interface ILongIdLabelProps {\r\n    label: string;\r\n    longId: string;\r\n}\r\n\r\nconst LongIdLabel = ({label, longId}: ILongIdLabelProps) => {\r\n    return (\r\n        <React.Fragment>\r\n            <p>{label}</p>\r\n            <div style={LONG_ID_STYLE}><strong>{longId}</strong></div>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nexport default LongIdLabel;","import * as React from 'react'\r\n\r\nimport { Field, FieldType, FieldValue, IFieldProps } from './Field';\r\nimport { Intent, NumericInput } from '@blueprintjs/core';\r\nimport { isNumber, isUndefinedOrNull } from '../../../common/types';\r\n\r\n\r\nexport type NumericFieldType = FieldType<number>;\r\nexport type NumericFieldValue = FieldValue<number>;\r\n\r\n\r\nexport interface INumericFieldProps extends IFieldProps {\r\n    nullable?: boolean;\r\n    min?: number;\r\n    max?: number;\r\n    cols?: number;\r\n    isInt?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * A NumberField is an input field that provides a floating point number.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class NumericField extends Field<INumericFieldProps> {\r\n\r\n    constructor(props: INumericFieldProps) {\r\n        super(props);\r\n        this.handleNumericInputChange = this.handleNumericInputChange.bind(this);\r\n    }\r\n\r\n    parseValue(textValue: string): NumericFieldType {\r\n        if (!textValue || textValue.trim() === '') {\r\n            return null;\r\n        }\r\n        const value = parseFloat(textValue);\r\n        if (isNaN(value) && textValue.toLowerCase() !== 'nan') {\r\n            throw new Error('Please enter a valid number.');\r\n        }\r\n        return value;\r\n    }\r\n\r\n    formatValue(value: NumericFieldType): string {\r\n        if (isUndefinedOrNull(value)) {\r\n            return '';\r\n        }\r\n        return value.toString();\r\n    }\r\n\r\n    validateValue(value: NumericFieldType): void {\r\n        super.validateValue(value);\r\n        validateNumber(value, this.props.nullable, this.props.min, this.props.max, this.props.isInt);\r\n    }\r\n\r\n    private handleNumericInputChange(value: number, textValue: string) {\r\n        this.setValueAndTextValue(value, textValue);\r\n    }\r\n\r\n    render() {\r\n        return (<NumericInput value={this.getTextValue()}\r\n                              onValueChange={this.handleNumericInputChange}\r\n                              onBlur={this.handleBlur}\r\n                              onKeyPress={this.handleKeyPress}\r\n                              style={this.props.style}\r\n                              intent={this.getError() ? Intent.DANGER : Intent.NONE}\r\n                              min={this.props.min}\r\n                              max={this.props.max}\r\n            // cols={this.props.cols}\r\n                              size={this.props.size}\r\n                              minorStepSize={this.props.isInt ? 1 : 0.1}\r\n                              selectAllOnFocus={true}\r\n        />);\r\n    }\r\n}\r\n\r\nexport function validateNumber(value: number | null, nullable?: boolean, min?: number | null, max?: number | null, isInt?: boolean): void {\r\n    if (isUndefinedOrNull(value)) {\r\n        if (!nullable) {\r\n            throw Error('Numeric value expected');\r\n        }\r\n        return;\r\n    }\r\n    if (!isNumber(value)) {\r\n        throw new Error(`Value must be a number.`);\r\n    }\r\n    if (isInt && value !== Math.floor(value)) {\r\n        throw new Error('Value must be an integer.');\r\n    }\r\n    if (isNumber(min) && value < min) {\r\n        throw new Error(`Value must be >= ${this.props.min}.`);\r\n    }\r\n    if (isNumber(max) && value > max) {\r\n        throw new Error(`Value must be <= ${this.props.max}.`);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumericField, NumericFieldValue } from './field/NumericField';\r\n\r\n// TODO (forman): rename west, south, east, north to lonMin, latMin, lonMax, latMax because we use negative values\r\n\r\nexport interface RegionValue {\r\n    west: NumericFieldValue;\r\n    south: NumericFieldValue;\r\n    east: NumericFieldValue;\r\n    north: NumericFieldValue;\r\n}\r\n\r\ninterface IRegionProps {\r\n    value: RegionValue;\r\n    onChange: (region: RegionValue) => void;\r\n    disabled?: boolean;\r\n    uncontrolled?: boolean;\r\n}\r\n\r\nexport const GLOBAL: RegionValue = {\r\n    west: {value: -180},\r\n    south: {value: -90},\r\n    east: {value: 180},\r\n    north: {value: 90},\r\n};\r\n\r\n/**\r\n * An editor for objects which have the properties west, east, south, north of type number.\r\n */\r\nexport class Region extends React.PureComponent<IRegionProps, null> {\r\n    private static readonly NUMBER_FIELD_STYLE = {textAlign: 'right'};\r\n\r\n    constructor(props: IRegionProps) {\r\n        super(props);\r\n        this.onEastChange = this.onEastChange.bind(this);\r\n        this.onSouthChange = this.onSouthChange.bind(this);\r\n        this.onWestChange = this.onWestChange.bind(this);\r\n        this.onNorthChange = this.onNorthChange.bind(this);\r\n    }\r\n\r\n    onWestChange(value: NumericFieldValue) {\r\n        this.props.onChange({...this.props.value, west: value});\r\n    }\r\n\r\n    onEastChange(value: NumericFieldValue) {\r\n        this.props.onChange({...this.props.value, east: value});\r\n    }\r\n\r\n    onNorthChange(value: NumericFieldValue) {\r\n        this.props.onChange({...this.props.value, north: value});\r\n    }\r\n\r\n    onSouthChange(value: NumericFieldValue) {\r\n        this.props.onChange({...this.props.value, south: value});\r\n    }\r\n\r\n    render() {\r\n        let value = this.props.value;\r\n        return (\r\n            <div>\r\n                <div style={{display: 'flex', alignItems: 'baseline', justifyContent: 'flex-start', padding: 2}}>\r\n                    <div style={{flexGrow: 0, width: '14em'}}>Lon. from</div>\r\n                    <div\r\n                        style={{\r\n                            flexGrow: 1,\r\n                            width: '100%'\r\n                        }}>{this.renderField((value && value.west) || null, -180, 180, this.onWestChange)}</div>\r\n                    <div style={{flexGrow: 0, width: '4em'}}> to</div>\r\n                    <div\r\n                        style={{\r\n                            flexGrow: 1,\r\n                            width: '100%'\r\n                        }}>{this.renderField((value && value.east) || null, -180, 180, this.onEastChange)}</div>\r\n                </div>\r\n                <div style={{display: 'flex', alignItems: 'baseline', justifyContent: 'flex-start', padding: 2}}>\r\n                    <div style={{flexGrow: 0, width: '14em'}}>Lat. from</div>\r\n                    <div\r\n                        style={{\r\n                            flexGrow: 1,\r\n                            width: '100%'\r\n                        }}>{this.renderField((value && value.south) || null, -90, 90, this.onSouthChange)}</div>\r\n                    <div style={{flexGrow: 0, width: '4em'}}>to</div>\r\n                    <div\r\n                        style={{\r\n                            flexGrow: 1,\r\n                            width: '100%'\r\n                        }}>{this.renderField((value && value.north) || null, -90, 90, this.onNorthChange)}</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderField(value: NumericFieldValue, min: number, max: number, onChange: (number) => void) {\r\n        return (<NumericField value={value}\r\n                              style={Region.NUMBER_FIELD_STYLE}\r\n                              min={min}\r\n                              max={max}\r\n                              size={10}\r\n                              onChange={onChange}\r\n                              disabled={this.props.disabled}\r\n                              nullable={true}\r\n                              uncontrolled={this.props.uncontrolled}\r\n        />);\r\n    }\r\n}\r\n\r\n\r\n","import * as React from 'react';\r\nimport { Tooltip } from '@blueprintjs/core';\r\nimport { formatDataTypeName } from '../../common/format';\r\n\r\nconst DATA_TYPE_STYLE: React.CSSProperties = {color: 'rgba(0,255,0,0.8)', fontSize: '0.8em'};\r\nconst TOOLTIP_STYLE: React.CSSProperties = {width: \"15em\"};\r\n\r\nexport interface ILabelWithTypeProps {\r\n    label: string;\r\n    dataType: string | null;\r\n    fullyQualified?: boolean;\r\n    units?: string;\r\n    tooltipText?: string;\r\n    em?: boolean;\r\n    style?: { [cssProperty: string]: any; }\r\n}\r\n\r\n/**\r\n * A label with a data type and optional units and tooltip text.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport const LabelWithType: React.FC<ILabelWithTypeProps> = (\r\n    {\r\n        label,\r\n        units,\r\n        dataType,\r\n        fullyQualified,\r\n        tooltipText,\r\n        em,\r\n        style,\r\n    }) => {\r\n\r\n    const labelText = label;\r\n    const dataTypeText = formatDataTypeName(dataType, fullyQualified);\r\n    const unitsText = units && units !== '' ? ` (${units})` : '';\r\n\r\n    let content = (\r\n        <span>{em ? <em>{labelText}</em> : labelText} {unitsText} <span\r\n            style={DATA_TYPE_STYLE}>{dataTypeText} </span></span>\r\n    );\r\n\r\n    if (tooltipText && tooltipText !== '') {\r\n        content = (\r\n            <Tooltip\r\n                content={<div style={TOOLTIP_STYLE}>{tooltipText}</div>}\r\n                position={'top'}\r\n            >\r\n                {content}\r\n            </Tooltip>\r\n        );\r\n    }\r\n\r\n    return <span style={style}>{content}</span>;\r\n}\r\n\r\n\r\n","import * as React from 'react';\r\nimport { ResourceState, VariableState } from '../state';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { LabelWithType } from '../components/LabelWithType';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\n\r\ninterface IVariablesDialogProps {\r\n    isOpen: boolean;\r\n    value: string[];\r\n    resource: ResourceState;\r\n    onConfirm: (value: string[]) => void;\r\n    onCancel: () => void;\r\n    multiSelect?: boolean;\r\n}\r\n\r\ninterface IVariablesDialogState {\r\n    value: string[] | null;\r\n}\r\n\r\nexport class VariablesDialog extends React.Component<IVariablesDialogProps, IVariablesDialogState> {\r\n\r\n    constructor(props: IVariablesDialogProps) {\r\n        super(props);\r\n        this.onSelection = this.onSelection.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.state = {value: this.props.value};\r\n    }\r\n\r\n    private onSelection(value: string[]) {\r\n        this.setState({value});\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.onConfirm(this.state.value);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog\r\n                isOpen={this.props.isOpen}\r\n                title={this.props.multiSelect ? 'Select Variables' : 'Select Variable'}\r\n                icon=\"variable\"\r\n                onConfirm={this.onConfirm}\r\n                onCancel={this.props.onCancel}\r\n                renderBody={this.renderBody}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const variables = this.props.resource.variables;\r\n        if (!variables) {\r\n            return (<p>{`Resource \"${this.props.resource.name}\" does not seem to have any variables.`}</p>);\r\n        }\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <p>{this.props.multiSelect ? 'Select one or more the variables:' : 'Select variable:'}</p>\r\n                <ListBox items={variables}\r\n                         getItemKey={VariablesDialog.getVariableItemKey}\r\n                         renderItem={VariablesDialog.renderVariableItem}\r\n                         selectionMode={this.props.multiSelect ? ListBoxSelectionMode.MULTIPLE : ListBoxSelectionMode.SINGLE}\r\n                         selection={this.state.value}\r\n                         style={{height: '20em'}}\r\n                         onSelection={this.onSelection}\r\n                         onItemDoubleClick={this.state.value ? this.onConfirm : null}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private static getVariableItemKey(variable: VariableState) {\r\n        return variable.name;\r\n    }\r\n\r\n    private static renderVariableItem(variable: VariableState) {\r\n        const dataType = variable.dimNames ? `${variable.dataType}[${variable.dimNames}]` : `${variable.dataType}`;\r\n        return (\r\n            <div>\r\n                <LabelWithType label={variable.name}\r\n                               dataType={dataType}\r\n                               units={variable.units}\r\n                               tooltipText={variable.attributes && variable.attributes.long_name}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, Intent } from '@blueprintjs/core';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue, toTextValue } from '../../components/field/Field';\r\nimport { TextField } from '../../components/field/TextField';\r\nimport { VariablesDialog } from '../VariablesDialog';\r\nimport { ResourceState } from '../../state';\r\n\r\ninterface IVariableNamesValueEditorProps extends IValueEditorProps<string> {\r\n    resource: ResourceState;\r\n    multi?: boolean;\r\n}\r\n\r\ninterface IVariableNamesValueEditorState {\r\n    isDetailsEditorOpen: boolean;\r\n}\r\n\r\nexport class VarNameValueEditor extends React.Component<IVariableNamesValueEditorProps, IVariableNamesValueEditorState> {\r\n\r\n    private static DIV_STYLE = {display: 'flex', justifySelf: 'stretch'};\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n    private static BUTTON_STYLE = {flexGrow: 0};\r\n\r\n    constructor(props: IVariableNamesValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n        this.validate = this.validate.bind(this);\r\n        this.state = {isDetailsEditorOpen: false};\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    validate(value: string) {\r\n        validateVarNamesText(value, this.props.input.nullable, this.props.multi, this.props.resource);\r\n    }\r\n\r\n    render() {\r\n        const textValue = toTextValue(this.props.value);\r\n        const varNames = textValue !== '' ? textValue.split(',').map(name => name.trim()) : [];\r\n        const hasSelectableVariables = this.props.resource && this.props.resource.variables && this.props.resource.variables.length;\r\n\r\n        return (\r\n            <ControlGroup fill={true} style={VarNameValueEditor.DIV_STYLE}>\r\n                <TextField\r\n                    value={this.props.value}\r\n                    validator={this.validate}\r\n                    placeholder={this.props.multi ? 'Enter variable names, separated by comma' : 'Enter variable name'}\r\n                    onChange={this.onChange}\r\n                    nullable={this.props.input.nullable}\r\n                    style={VarNameValueEditor.TEXT_FIELD_STYLE}\r\n                />\r\n\r\n                <AnchorButton intent={Intent.PRIMARY}\r\n                              onClick={() => this.setState({isDetailsEditorOpen: true})}\r\n                              disabled={!hasSelectableVariables}\r\n                              style={VarNameValueEditor.BUTTON_STYLE}>...</AnchorButton>\r\n\r\n                <VariablesDialog isOpen={this.state.isDetailsEditorOpen}\r\n                                 resource={this.props.resource}\r\n                                 multiSelect={this.props.multi}\r\n                                 value={varNames}\r\n                                 onConfirm={(value: string[]) => {\r\n                                     const textValue = value ? value.join(', ') : null;\r\n                                     this.setState({isDetailsEditorOpen: false});\r\n                                     this.onChange({textValue, value: textValue});\r\n                                 }}\r\n                                 onCancel={() => {\r\n                                     this.setState({isDetailsEditorOpen: false} as any);\r\n                                 }}/>\r\n            </ControlGroup>\r\n        );\r\n    }\r\n}\r\n\r\nexport function validateVarNamesText(value: string | null, nullable: boolean, multi: boolean, resource: ResourceState) {\r\n    if (!value || value.trim() === '') {\r\n        if (!nullable) {\r\n            throw new Error(multi ? 'One or more variable names expected.' : 'Variable name expected.');\r\n        }\r\n        return;\r\n    }\r\n    const varNames = value.split(',');\r\n    if (multi) {\r\n        for (let varName of varNames) {\r\n            if (varName.trim() === '') {\r\n                throw new Error('Value must be a comma-separated list of variable names.');\r\n            }\r\n        }\r\n    } else {\r\n        if (varNames.length !== 1) {\r\n            throw new Error('Value must be a single variable name.');\r\n        }\r\n        if (varNames[0].trim() === '') {\r\n            throw new Error('Value must be a variable name.');\r\n        }\r\n    }\r\n    if (resource && resource.variables) {\r\n        const validNames = new Set(resource.variables.map(v => v.name));\r\n        for (let varName of varNames) {\r\n            if (!validNames.has(varName)) {\r\n                throw new Error(`\"${varName}\" is not a name of any variable in resource ${resource.name}.`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {\r\n    Card,\r\n    Checkbox,\r\n    Collapse,\r\n    InputGroup,\r\n    Intent,\r\n    Label,\r\n    Tooltip,\r\n    Icon,\r\n} from '@blueprintjs/core';\r\nimport { IconNames } from '@blueprintjs/icons';\r\nimport * as React from 'react';\r\n\r\nimport * as types from '../../common/cate-types';\r\nimport { formatDateAsISODateString } from '../../common/format';\r\nimport { DateRangeField, DateRangeFieldValue, validateDateRange } from '../components/field/DateRangeField';\r\nimport { TextFieldValue } from '../components/field/TextField';\r\nimport LongIdLabel from '../components/LongIdLabel';\r\nimport { GLOBAL, Region, RegionValue } from '../components/Region';\r\nimport { DataSourceState, ResourceState, VariableState } from '../state';\r\nimport { VarNameValueEditor } from './editor/VarNameValueEditor';\r\n\r\ntype TimeRangeValue = [string, string];\r\n\r\nexport interface IDataAccessComponentOptions {\r\n\r\n    hasTimeConstraint: boolean;\r\n    dateRange: DateRangeFieldValue | null;\r\n\r\n    hasRegionConstraint: boolean;\r\n    region: RegionValue | null;\r\n\r\n    hasVariablesConstraint: boolean;\r\n    variableNames: TextFieldValue | null;\r\n\r\n    isCacheDataSourceSelected?: boolean;\r\n    cachedDataSourceId?: string;\r\n    cachedDataSourceTitle?: string;\r\n\r\n    openDatasetResourceName: string;\r\n}\r\n\r\nexport interface IDataAccessComponentProps {\r\n    options: IDataAccessComponentOptions;\r\n    onChange: (options: IDataAccessComponentOptions) => any;\r\n    dataSource: DataSourceState | null;\r\n    isLocalDataSource: boolean;\r\n    temporalCoverage: TimeRangeValue | null;\r\n    canConstrainRegion: boolean;\r\n    canConstrainTime: boolean;\r\n    canConstrainVariables: boolean;\r\n    canCache: boolean;\r\n}\r\n\r\n\r\nconst WARNINGS_PANEL_STYLE: React.CSSProperties = {\r\n    marginTop: 8,\r\n    marginBottom: 8,\r\n};\r\n\r\n\r\nconst WARNING_ICON = (<Icon icon={IconNames.WARNING_SIGN} intent={Intent.WARNING}/>);\r\nconst ERROR_ICON = (<Icon icon={IconNames.ERROR} intent={Intent.DANGER}/>);\r\nconst ISSUE_ICON = (<Icon icon={IconNames.ISSUE} intent={Intent.PRIMARY}/>);\r\n\r\nconst TIME_RANGE_STYLE: React.CSSProperties = {\r\n    marginTop: 4,\r\n    marginBottom: 4,\r\n};\r\n\r\n/**\r\n * A components that yields IDataAccessComponentOptions as value.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class DataAccessComponent extends React.Component<IDataAccessComponentProps, null> {\r\n    static readonly VAR_NAMES_INPUT = {name: 'varNames', dataType: 'string', description: null, nullable: true};\r\n    static readonly SUB_PANEL_STYLE = {marginTop: '1em'};\r\n    static readonly OPTION_CHECK_STYLE = {marginTop: '1em'};\r\n    static readonly OPTION_DIV_STYLE = {marginLeft: '2em'};\r\n\r\n    constructor(props: IDataAccessComponentProps) {\r\n        super(props);\r\n        this.onHasTimeConstraintChange = this.onHasTimeConstraintChange.bind(this);\r\n        this.onDateRangeChange = this.onDateRangeChange.bind(this);\r\n        this.onHasRegionConstraintChange = this.onHasRegionConstraintChange.bind(this);\r\n        this.onRegionChange = this.onRegionChange.bind(this);\r\n        this.onHasVariablesConstraintChange = this.onHasVariablesConstraintChange.bind(this);\r\n        this.onVariableNamesChange = this.onVariableNamesChange.bind(this);\r\n        this.onMakeLocalSelectedChange = this.onMakeLocalSelectedChange.bind(this);\r\n        this.onMakeLocalDataSourceIdChange = this.onMakeLocalDataSourceIdChange.bind(this);\r\n        this.onOpenDatasetResourceNameChange = this.onOpenDatasetResourceNameChange.bind(this);\r\n    }\r\n\r\n    private onDateRangeChange(dateRange: DateRangeFieldValue) {\r\n        this.props.onChange({...this.props.options, dateRange});\r\n    }\r\n\r\n    private onRegionChange(region: RegionValue) {\r\n        this.props.onChange({...this.props.options, region});\r\n    }\r\n\r\n    private onHasTimeConstraintChange(ev: any) {\r\n        this.props.onChange({...this.props.options, hasTimeConstraint: ev.target.checked});\r\n    }\r\n\r\n    private onHasRegionConstraintChange(ev: any) {\r\n        this.props.onChange({...this.props.options, hasRegionConstraint: ev.target.checked});\r\n    }\r\n\r\n    private onHasVariablesConstraintChange(ev: any) {\r\n        this.props.onChange({...this.props.options, hasVariablesConstraint: ev.target.checked});\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private onVariableNamesChange(unused: any, variableNames: TextFieldValue) {\r\n        this.props.onChange({...this.props.options, variableNames});\r\n    }\r\n\r\n    private onMakeLocalSelectedChange(ev: any) {\r\n        this.props.onChange({...this.props.options, isCacheDataSourceSelected: ev.target.checked});\r\n    }\r\n\r\n    private onMakeLocalDataSourceIdChange(ev: any) {\r\n        this.props.onChange({...this.props.options, cachedDataSourceId: ev.target.value});\r\n    }\r\n\r\n    private onOpenDatasetResourceNameChange(ev: any) {\r\n        this.props.onChange({...this.props.options, openDatasetResourceName: ev.target.value});\r\n    }\r\n\r\n    private static dataSourceVarToVariable(dsVar: any): VariableState {\r\n        return {name: dsVar.name, units: dsVar.units || '-', dataType: types.DATA_ARRAY_TYPE};\r\n    }\r\n\r\n    private static dataSourceToResource(dataSource: DataSourceState): ResourceState {\r\n        if (dataSource) {\r\n            const metaInfo = dataSource.metaInfo;\r\n            if (metaInfo && metaInfo.data_vars && metaInfo.data_vars.length) {\r\n                return {\r\n                    name: dataSource.id,\r\n                    dataType: types.DATASET_TYPE,\r\n                    variables: metaInfo.data_vars.map(v => DataAccessComponent.dataSourceVarToVariable(v)),\r\n                } as ResourceState;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.dataSource) {\r\n            return null;\r\n        }\r\n        const options = this.props.options;\r\n\r\n        // TODO (forman): turn timeConstraintsPanel,\r\n        //      regionConstraintsPanel,\r\n        //      variablesConstraintPanel into components\r\n\r\n        let minDate = new Date('1970-01-01');\r\n        let maxDate = new Date(Date.now());\r\n        const temporalCoverage = this.props.temporalCoverage;\r\n        if (temporalCoverage) {\r\n            if (temporalCoverage[0]) {\r\n                minDate = new Date(temporalCoverage[0]);\r\n            }\r\n            if (temporalCoverage[1]) {\r\n                maxDate = new Date(temporalCoverage[1]);\r\n            }\r\n        }\r\n\r\n        const temporalCoverageText = temporalCoverage && (\r\n            <div style={TIME_RANGE_STYLE}>{`Available time range: ${temporalCoverage.join(', ')}`}</div>\r\n        );\r\n\r\n        const hasTimeConstraint = options.hasTimeConstraint;\r\n        const dateRange = hasTimeConstraint ? options.dateRange : null;\r\n        const timeConstraintsPanel = (<div style={DataAccessComponent.SUB_PANEL_STYLE}>\r\n            <Checkbox\r\n                disabled={!temporalCoverage || !this.props.canConstrainTime}\r\n                checked={hasTimeConstraint}\r\n                label=\"Time constraint\"\r\n                onChange={this.onHasTimeConstraintChange}\r\n            />\r\n            <Collapse isOpen={hasTimeConstraint}>\r\n                <div style={DataAccessComponent.OPTION_DIV_STYLE}>\r\n                    <DateRangeField\r\n                        nullable={true}\r\n                        min={minDate}\r\n                        max={maxDate}\r\n                        value={dateRange}\r\n                        onChange={this.onDateRangeChange}\r\n                    />\r\n                    {temporalCoverageText}\r\n                </div>\r\n            </Collapse>\r\n        </div>);\r\n\r\n        const hasRegionConstraint = options.hasRegionConstraint;\r\n        const region = hasRegionConstraint ? options.region || GLOBAL : options.region;\r\n        const regionConstraintsPanel = (\r\n            <div style={DataAccessComponent.SUB_PANEL_STYLE}>\r\n                <Checkbox\r\n                    disabled={!this.props.canConstrainRegion}\r\n                    checked={hasRegionConstraint}\r\n                    label=\"Region constraint\"\r\n                    onChange={this.onHasRegionConstraintChange}\r\n                />\r\n                <Collapse isOpen={this.props.canConstrainRegion && hasRegionConstraint}>\r\n                    <div style={DataAccessComponent.OPTION_DIV_STYLE}>\r\n                        <Region\r\n                            value={region}\r\n                            disabled={!hasRegionConstraint}\r\n                            onChange={this.onRegionChange}\r\n                        />\r\n                    </div>\r\n                </Collapse>\r\n            </div>\r\n        );\r\n\r\n        const hasVariablesConstraint = options.hasVariablesConstraint;\r\n        const res = DataAccessComponent.dataSourceToResource(this.props.dataSource);\r\n        const variablesConstraintPanel = (\r\n            <div style={DataAccessComponent.SUB_PANEL_STYLE}>\r\n                <Checkbox\r\n                    disabled={!this.props.canConstrainVariables}\r\n                    checked={hasVariablesConstraint}\r\n                    label=\"Variables constraint\"\r\n                    onChange={this.onHasVariablesConstraintChange}\r\n                />\r\n                <Collapse isOpen={hasVariablesConstraint}>\r\n                    <div style={DataAccessComponent.OPTION_DIV_STYLE}>\r\n                        <VarNameValueEditor input={DataAccessComponent.VAR_NAMES_INPUT}\r\n                                            value={options.variableNames}\r\n                                            onChange={this.onVariableNamesChange}\r\n                                            resource={res}\r\n                                            multi={true}/>\r\n                    </div>\r\n                </Collapse>\r\n            </div>\r\n        );\r\n\r\n        let cacheConfigPanel;\r\n        if (this.props.canCache && !this.props.isLocalDataSource) {\r\n            const isMakeLocalSelected = options.isCacheDataSourceSelected;\r\n            cacheConfigPanel = (<div style={DataAccessComponent.SUB_PANEL_STYLE}>\r\n                    <Tooltip content={\"If unchecked, remote data will be accessed \" +\r\n                                      \"using an available protocol, e.g. OPeNDAP.\"}>\r\n                        <Checkbox\r\n                            checked={isMakeLocalSelected}\r\n                            label=\"Cache data source (allocates space on disk)\"\r\n                            onChange={this.onMakeLocalSelectedChange}\r\n                        />\r\n                    </Tooltip>\r\n                    <Collapse isOpen={isMakeLocalSelected}>\r\n                        <div style={DataAccessComponent.OPTION_DIV_STYLE}>\r\n                            <Label>\r\n                                Unique identifier for the new local data source\r\n                                <span className=\"bp3-text-muted\"> (optional)</span>\r\n                                <InputGroup\r\n                                    style={{width: '100%'}}\r\n                                    type=\"text\"\r\n                                    value={options.cachedDataSourceId}\r\n                                    onChange={this.onMakeLocalDataSourceIdChange}\r\n                                />\r\n                            </Label>\r\n                        </div>\r\n                    </Collapse>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const messages: Array<[React.ReactNode, React.ReactNode]> = [];\r\n        if (this.props.dataSource.metaInfoStatus === 'ok') {\r\n            if (!this.props.canConstrainTime) {\r\n                messages.push([WARNING_ICON, \"This dataset has no (recognised) temporal coverage.\"]);\r\n            }\r\n            if (!this.props.canConstrainRegion) {\r\n                messages.push([WARNING_ICON,\r\n                               <span>This dataset has no (recognised) spatial coverage\r\n                                   and hence it will not show up\r\n                                   in the <strong>World View</strong>.</span>]);\r\n            }\r\n            if (!this.props.canConstrainVariables) {\r\n                messages.push([WARNING_ICON, \"This datasets has no (recognised) variables.\"]);\r\n            }\r\n        } else if (this.props.dataSource.metaInfoStatus === 'loading') {\r\n            messages.push([ISSUE_ICON, \"Please wait while dataset metadata is loaded...\"]);\r\n        } else if (this.props.dataSource.metaInfoStatus === 'error') {\r\n            messages.push([ERROR_ICON, \"Failed to load dataset metadata.\"]);\r\n        }\r\n\r\n        let messagesPanel;\r\n        if (messages.length > 0) {\r\n            messagesPanel = (\r\n                <Card style={WARNINGS_PANEL_STYLE}>\r\n                    {\r\n                        messages.map(([i, t]) =>\r\n                                         <div>{i}&nbsp;&nbsp;{t}</div>)\r\n                    }\r\n                </Card>);\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <LongIdLabel\r\n                    label={this.props.isLocalDataSource\r\n                           ? 'Data source (local):'\r\n                           : 'Data source:'}\r\n                    longId={this.props.dataSource.title}\r\n                />\r\n                {timeConstraintsPanel}\r\n                {regionConstraintsPanel}\r\n                {variablesConstraintPanel}\r\n                {cacheConfigPanel}\r\n                {/*{resourceNamePanel}*/}\r\n                {messagesPanel}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    static validateOptions(isLocalDataSource: boolean, options: IDataAccessComponentOptions): boolean {\r\n        if (!options) {\r\n            return false;\r\n        }\r\n\r\n        let validTimeConstraint = true;\r\n        if (options.hasTimeConstraint && options.dateRange) {\r\n            validTimeConstraint = !options.dateRange.error;\r\n        }\r\n\r\n        let validRegion = true;\r\n        if (options.hasRegionConstraint && options.region) {\r\n            const west = options.region.west.value;\r\n            const east = options.region.east.value;\r\n            const south = options.region.south.value;\r\n            const north = options.region.north.value;\r\n            const eps = 360. / 40000.; // 1km\r\n            const validWest = west >= -180 && west <= 180;\r\n            const validEast = east >= -180 && east <= 180;\r\n            const validNorth = north >= -90 && north <= 90;\r\n            const validSouth = south >= -90 && south <= 90;\r\n            const validEastWest = validWest && validEast && Math.abs(west - east) >= eps;\r\n            const validSouthNorth = validSouth && validNorth && (north - south) >= eps;\r\n            validRegion = validEastWest && validSouthNorth;\r\n        }\r\n\r\n        let validVariableNames = true;\r\n        if (options.hasVariablesConstraint && options.variableNames) {\r\n            validVariableNames = !options.variableNames.error;\r\n        }\r\n\r\n        let validDataSourceId = true;\r\n        if (!isLocalDataSource && options.isCacheDataSourceSelected) {\r\n            const makeLocalDataSourceId = options.cachedDataSourceId;\r\n            if (makeLocalDataSourceId && !/[^\\\\/:*?\"<>|\\r\\n]+$/im.test(makeLocalDataSourceId)) {\r\n                validDataSourceId = false;\r\n            }\r\n        }\r\n\r\n        return validTimeConstraint && validRegion && validVariableNames && validDataSourceId;\r\n    }\r\n\r\n    static optionsToErrors(options: IDataAccessComponentOptions) {\r\n        const inputErrors = {};\r\n        if (options.hasTimeConstraint && options.dateRange && options.dateRange.error) {\r\n            inputErrors['Time constraint'] = options.dateRange.error\r\n        }\r\n        if (options.hasVariablesConstraint && options.variableNames && options.variableNames.error) {\r\n            inputErrors['Variables constraint'] = options.variableNames.error\r\n        }\r\n        return inputErrors;\r\n    }\r\n\r\n\r\n    static optionsToOperationArguments(options: IDataAccessComponentOptions) {\r\n        let args = {};\r\n        if (options.hasTimeConstraint && options.dateRange && options.dateRange.value) {\r\n            const t0 = formatDateAsISODateString(options.dateRange.value[0]);\r\n            const t1 = formatDateAsISODateString(options.dateRange.value[1]);\r\n            args = {\r\n                time_range: `${t0},${t1}`,\r\n            };\r\n        }\r\n        if (options.hasRegionConstraint && options.region) {\r\n            const region = options.region;\r\n            args = {\r\n                ...args,\r\n                region: `${region.west.value},${region.south.value},${region.east.value},${region.north.value}`\r\n            };\r\n        }\r\n        if (options.hasVariablesConstraint && options.variableNames) {\r\n            const variableNames = options.variableNames.value;\r\n            args = {\r\n                ...args,\r\n                var_names: variableNames\r\n            };\r\n        }\r\n        if (options.isCacheDataSourceSelected) {\r\n            args = {\r\n                ...args,\r\n                force_local: true\r\n            };\r\n            if (options.cachedDataSourceId) {\r\n                args = {\r\n                    ...args,\r\n                    local_ds_id: options.cachedDataSourceId\r\n                };\r\n            }\r\n        }\r\n        return args;\r\n    }\r\n\r\n    static defaultOptions(isLocalDataSource: boolean, temporalCoverage: TimeRangeValue): IDataAccessComponentOptions {\r\n        let minDate = null;\r\n        let maxDate = null;\r\n        if (temporalCoverage && temporalCoverage[0]) {\r\n            try {\r\n                minDate = new Date(temporalCoverage[0]);\r\n            } catch (e) {\r\n                // ok\r\n            }\r\n        }\r\n        if (temporalCoverage && temporalCoverage[1]) {\r\n            try {\r\n                maxDate = new Date(temporalCoverage[1]);\r\n            } catch (e) {\r\n                // ok\r\n            }\r\n        }\r\n\r\n        return {\r\n            hasTimeConstraint: false,\r\n            dateRange: {value: [minDate, maxDate]},\r\n\r\n            hasRegionConstraint: false,\r\n            region: null,\r\n\r\n            hasVariablesConstraint: false,\r\n            variableNames: null,\r\n\r\n            isCacheDataSourceSelected: !isLocalDataSource,\r\n            cachedDataSourceId: '',\r\n\r\n            openDatasetResourceName: '',\r\n        };\r\n    }\r\n\r\n    // static adjustLocalDataSourceName(options: IDataAccessComponentOptions, dataSource: DataSourceState): IDataAccessComponentOptions {\r\n    //     if (!options.cachedDataSourceId || options.cachedDataSourceId === '') {\r\n    //         let dataSourceId = dataSource && dataSource.id;\r\n    //         if (!dataSourceId) {\r\n    //             dataSourceId = 'unnamed';\r\n    //         }\r\n    //         return {...options, cachedDataSourceId: 'local.' + dataSourceId};\r\n    //     }\r\n    //     return options;\r\n    // }\r\n\r\n    static ensureDateRangeIsValidated(options: IDataAccessComponentOptions, temporalCoverage: TimeRangeValue): IDataAccessComponentOptions {\r\n        if (options.hasTimeConstraint && options.dateRange && temporalCoverage) {\r\n            try {\r\n                const minDate = temporalCoverage[0] ? new Date(temporalCoverage[0]) : new Date('1980-01-01');\r\n                const maxDate = temporalCoverage[1] ? new Date(temporalCoverage[1]) : new Date(Date.now());\r\n\r\n                // re-validate, because min, max may have changed\r\n                validateDateRange(options.dateRange.value, true, minDate, maxDate);\r\n                return {...options, dateRange: {...options.dateRange, error: null}};\r\n            } catch (e) {\r\n                return {...options, dateRange: {...options.dateRange, error: e}};\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n}\r\n\r\n\r\n","import * as React from 'react';\r\nimport { ReactChild } from 'react';\r\nimport { HTMLSelect, Popover, PopoverInteractionKind, PopoverPosition, Switch, Tooltip, Alignment } from '@blueprintjs/core';\r\nimport { LabelWithType } from '../../components/LabelWithType';\r\nimport { ResourceState } from '../../state';\r\nimport * as cateTypes from '../../../common/cate-types';\r\nimport { isAssignableFrom } from '../../../common/cate-types';\r\nimport { formatDataTypeName } from '../../../common/format';\r\n\r\nexport interface IInputEditorProps {\r\n    name: string;\r\n    dataType: string;\r\n    valueEditor?: JSX.Element;\r\n    tooltipText?: string;\r\n    units?: string;\r\n    resources: Array<ResourceState>;\r\n    resourceName?: string | null;\r\n    isValueEditorShown?: boolean;\r\n    /**\r\n     * Notified if a resource is selected or deselected.\r\n     * @param resourceName The resource name or null\r\n     * @param isValueEditorShown whether the value editor is shown and active\r\n     */\r\n    onChange?: (resourceName: string | null, isValueEditorShown: boolean) => void;\r\n}\r\n\r\n/**\r\n * A component that is used as editor for an input of some workflow step, e.g. operation.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class InputEditor extends React.PureComponent<IInputEditorProps, null> {\r\n\r\n    private static readonly LABEL_STYLE = \r\n            {justifySelf: 'end', justifyContent: 'end'};\r\n    private static readonly EDITOR_SWITCH_STYLE = {margin: 0}\r\n    private static readonly RESOURCE_NAME_STYLE = {justifySelf: 'stretch'};\r\n\r\n    render() {\r\n\r\n        let editor;\r\n        if (this.isValueEditorShown()) {\r\n            editor = this.props.valueEditor;\r\n        } else {\r\n            editor = this.renderResourceNameEditor();\r\n        }\r\n\r\n        const editorSwitch = this.renderEditorSwitch();\r\n        return (\r\n           <React.Fragment key={this.props.name}>\r\n                <LabelWithType style={InputEditor.LABEL_STYLE}\r\n                               label={this.props.name}\r\n                               units={this.props.units}\r\n                               dataType={this.props.dataType}\r\n                               tooltipText={this.props.tooltipText}/>\r\n                {editor}\r\n                {editorSwitch}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private handleChange(resourceName: string, isValueEditorShown: boolean) {\r\n        // console.log('InputEditor: handleChange', resourceName, isValueEditorShown);\r\n        if (this.props.onChange) {\r\n            this.props.onChange(resourceName, isValueEditorShown);\r\n        }\r\n    }\r\n\r\n    private renderResourceNameEditor() {\r\n        const NULL_VALUE = '__null__';\r\n        const firstResourceOption = (<option key='__first__' value={NULL_VALUE}>Select resource</option>);\r\n        const otherResourceOptions = (this.props.resources || [])\r\n            .filter(resource => this.isDataTypeCompatible(resource))\r\n            .map(resource => <option key={resource.name} value={resource.name}>{resource.name}</option>);\r\n        const resourceOptions = [firstResourceOption].concat(otherResourceOptions);\r\n\r\n        let editor = (\r\n            <div className=\"bp3-intent-primary\" style={InputEditor.RESOURCE_NAME_STYLE}>\r\n                <HTMLSelect\r\n                    fill={true}\r\n                    style={InputEditor.RESOURCE_NAME_STYLE}\r\n                    value={this.props.resourceName || NULL_VALUE}\r\n                    disabled={otherResourceOptions.length === 0}\r\n                    onChange={(event: any) => this.handleChange(event.target.value === NULL_VALUE ? null : event.target.value, false)}\r\n                >\r\n                    {resourceOptions}\r\n                </HTMLSelect>\r\n            </div>\r\n        );\r\n\r\n        if (otherResourceOptions.length === 0) {\r\n            editor = (\r\n                <Popover interactionKind={PopoverInteractionKind.HOVER} hoverOpenDelay={0} hoverCloseDelay={0}\r\n                         position={PopoverPosition.TOP}\r\n                         fill={true}\r\n                         >\r\n                    {editor}\r\n                    <div style={{padding: 8}}>\r\n                        This parameter requires a resource of type <span\r\n                        style={{color: 'rgba(0,255,0,0.8)'}}>{formatDataTypeName(this.props.dataType, false)}</span>.\r\n                        <br/>\r\n                        Currently, no resources of this type are available.<br/>\r\n                        {renderTypeInstanceHintText(this.props.dataType)}\r\n                    </div>\r\n                </Popover>\r\n            );\r\n        }\r\n\r\n        return editor;\r\n    }\r\n\r\n    private renderEditorSwitch() {\r\n        const valueEditorShown = this.isValueEditorShown();\r\n        const valueEditorDisabled = this.isValueEditorDisabled();\r\n        const resourceSelectorDisabled = !this.hasCompatibleResources();\r\n        const switchDisabled = valueEditorDisabled || resourceSelectorDisabled;\r\n        return (\r\n            <span>\r\n                <Tooltip\r\n                    content={(valueEditorShown ? 'Switch to resource selection' : 'Switch to value entry')\r\n                             + (switchDisabled ? ' (disabled)' : '')}>\r\n                    <Switch checked={valueEditorShown}\r\n                            disabled={switchDisabled}\r\n                            alignIndicator={Alignment.LEFT}\r\n                            style={InputEditor.EDITOR_SWITCH_STYLE}\r\n                            onChange={(event: any) =>\r\n                                      this.handleChange(this.props.resourceName, event.target.checked)}/>\r\n                </Tooltip>\r\n            </span>\r\n        );\r\n    }\r\n\r\n    private isDataTypeCompatible(resource) {\r\n        return isAssignableFrom(this.props.dataType, resource.dataType);\r\n    }\r\n\r\n    private hasCompatibleResources() {\r\n        return (this.props.resources || []).some(resource => this.isDataTypeCompatible(resource));\r\n    }\r\n\r\n    private isValueEditorDisabled() {\r\n        return !this.props.valueEditor;\r\n    }\r\n\r\n    private isValueEditorShown() {\r\n        return !!(this.props.isValueEditorShown && this.props.valueEditor);\r\n    }\r\n}\r\n\r\n/**\r\n * Render a hint text how to produce an instance of the desired target type.\r\n *\r\n * @param targetDataType The name of the target data type used in Cate's Python API\r\n * @returns {string} the hint text.\r\n */\r\nfunction renderTypeInstanceHintText(targetDataType: string): ReactChild {\r\n    switch (targetDataType) {\r\n        case cateTypes.DATASET_TYPE:\r\n            return <span>Datasets can be opened from the <b>DATA SOURCES</b> panel.<br/>\r\n                You can also use operations like <code>open_dataset</code> or <br/>\r\n                <code>read_netcdf</code> to produce resources of this type.</span>;\r\n        case cateTypes.DATASET_LIKE_TYPE:\r\n            return <span>Datasets can be opened from the <b>DATA SOURCES</b> panel.<br/>\r\n                You can also use operations like <code>open_dataset</code>, <br/>\r\n                or <code>read_netcdf</code> to produce resources of this type.</span>;\r\n        case cateTypes.DATA_FRAME_TYPE:\r\n            return <span>You can use operations like <code>read_csv</code>, <code>read_geo_data</code><br/>\r\n                to produce resources of this type.</span>;\r\n        case cateTypes.DATA_FRAME_LIKE_TYPE:\r\n            return <span>You can use operations like <code>read_csv</code>, <code>read_geo_data</code>,<br/>\r\n                or <code>open_dataset</code> to produce resources of this type.</span>;\r\n        case cateTypes.ND_ARRAY_TYPE:\r\n            return '';\r\n        case cateTypes.SERIES_TYPE:\r\n            return '';\r\n    }\r\n    return '';\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { Checkbox } from '@blueprintjs/core';\r\n\r\nexport function BooleanValueEditor(props: IValueEditorProps<boolean>) {\r\n    return (\r\n        <Checkbox className=\"bp3-large\"\r\n                  checked={(props.value as any) || false}\r\n                  indeterminate={props.value === null}\r\n                  style={{marginTop: '0', marginBottom: '0'}}\r\n                  onChange={(event: any) => props.onChange(props.input, event.target.checked)}/>\r\n    );\r\n}\r\n","import { HTMLSelect } from '@blueprintjs/core';\r\nimport * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { OperationInputState } from '../../state';\r\n\r\n\r\nexport class ValueSetValueEditor extends React.PureComponent<IValueEditorProps<any>, null> {\r\n    static readonly NULL_VALUE = '__null__';\r\n    private static readonly VALUE_SELECTOR_STYLE = {justifySelf: 'stretch'};\r\n\r\n    private onChange(value: any) {\r\n        this.props.onChange(this.props.input, value === ValueSetValueEditor.NULL_VALUE ? null : value);\r\n    }\r\n\r\n    static isValueSetGiven(input: OperationInputState) {\r\n        return input.valueSet && input.valueSet.length;\r\n    }\r\n\r\n    render() {\r\n        const valueSet = this.props.input.valueSet;\r\n        const hasValueSet = valueSet && valueSet.length;\r\n        if (!hasValueSet) {\r\n            return null;\r\n        }\r\n        let options = valueSet.map((v, i) => (<option key={i} value={v}>{v}</option>));\r\n        if (this.props.input.nullable) {\r\n            options = [<option key={-1} value={ValueSetValueEditor.NULL_VALUE}/>].concat(...options);\r\n        }\r\n        const value = this.props.value || ValueSetValueEditor.NULL_VALUE;\r\n        return (\r\n            <div className=\"bp3-select\">\r\n                <HTMLSelect\r\n                    fill={true}\r\n                    style={ValueSetValueEditor.VALUE_SELECTOR_STYLE}\r\n                    value={value}\r\n                    onChange={(event: any) => this.onChange(event.target.value)}\r\n                >\r\n                    {options}\r\n                </HTMLSelect>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { ValueSetValueEditor } from './ValueSetValueEditor';\r\nimport { NumericField } from '../../components/field/NumericField';\r\n\r\n// TODO (forman): complete me, i.e. use input.valueRange!\r\n\r\nexport function IntegerValueEditor(props: IValueEditorProps<number>) {\r\n    if (ValueSetValueEditor.isValueSetGiven(props.input)) {\r\n        return (\r\n            <ValueSetValueEditor input={props.input}\r\n                                 value={props.value}\r\n                                 onChange={props.onChange}/>);\r\n    } else {\r\n        return (\r\n            <NumericField isInt={true}\r\n                          size={10}\r\n                          value={props.value}\r\n                          nullable={props.input.nullable}\r\n                          onChange={value => props.onChange(props.input, value)}\r\n            />\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { ValueSetValueEditor } from './ValueSetValueEditor';\r\nimport { NumericField } from '../../components/field/NumericField';\r\n\r\n// TODO (forman): complete me, i.e. use input.valueRange!\r\n\r\nexport function FloatValueEditor(props: IValueEditorProps<number>) {\r\n    if (ValueSetValueEditor.isValueSetGiven(props.input)) {\r\n        return (\r\n            <ValueSetValueEditor input={props.input}\r\n                                 value={props.value}\r\n                                 onChange={props.onChange}/>);\r\n    } else {\r\n        return (\r\n            <NumericField isInt={false}\r\n                          size={10}\r\n                          value={props.value}\r\n                          nullable={props.input.nullable}\r\n                          onChange={value => props.onChange(props.input, value)}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { ValueSetValueEditor } from './ValueSetValueEditor';\r\nimport { TextField } from '../../components/field/TextField';\r\n\r\n\r\nexport function TextValueEditor(props: IValueEditorProps<string>) {\r\n    if (ValueSetValueEditor.isValueSetGiven(props.input)) {\r\n        return (\r\n            <ValueSetValueEditor input={props.input}\r\n                                 value={props.value}\r\n                                 onChange={props.onChange}/>);\r\n    } else {\r\n        const type = props.input.password ? \"password\" : \"text\";\r\n        return (\r\n            <TextField size={24}\r\n                       value={props.value}\r\n                       nullable={props.input.nullable}\r\n                       onChange={value => props.onChange(props.input, value)}\r\n                       type={type}\r\n            />\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { Button, Intent, ControlGroup } from '@blueprintjs/core';\r\n\r\nimport { HostOS, makeAbsolutePath, makeRelativePath } from '../../../common/paths';\r\nimport { toTextValue } from '../../components/field/Field';\r\nimport { IValueEditorProps, ValueEditorCallback, ValueEditorValue } from './ValueEditor';\r\nimport * as actions from '../../actions';\r\nimport { OperationInputState, State } from '../../state';\r\nimport { TextField } from '../../components/field/TextField';\r\nimport { OpenDialogResult, SaveDialogResult } from \"../../components/desktop/types\";\r\n\r\n\r\nconst DIV_STYLE = {display: 'flex', justifySelf: 'stretch'};\r\nconst TEXT_FIELD_STYLE = {flexGrow: 1};\r\nconst BUTTON_STYLE = {flexGrow: 0};\r\n\r\ninterface IFileValueEditorOwnProps extends IValueEditorProps<string> {\r\n}\r\n\r\ninterface IFileValueEditorProps extends IFileValueEditorOwnProps {\r\n    hostOS?: HostOS;\r\n    workspaceDir: string | null;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IFileValueEditorOwnProps): IFileValueEditorProps  {\r\n    return {\r\n        ...ownProps,\r\n        hostOS: state.communication.webAPIServiceInfo.hostOS,\r\n        workspaceDir: state.data.workspace ? state.data.workspace.baseDir : null\r\n    };\r\n}\r\n\r\n// TODO (forman): complete me, i.e. validate file name\r\n\r\nconst _FileValueEditor: React.FC<IFileValueEditorProps & DispatchProp<State>> = (\r\n    {\r\n        input,\r\n        value,\r\n        onChange,\r\n        hostOS,\r\n        workspaceDir,\r\n        dispatch\r\n    }) => {\r\n\r\n    value = (value as any) || '';\r\n\r\n    const toRelativePath = (path: string) => {\r\n        if (workspaceDir !== null) {\r\n            return makeRelativePath(path, workspaceDir, hostOS);\r\n        }\r\n        return path\r\n    };\r\n\r\n    const toAbsolutePath = (path: string) => {\r\n        if (workspaceDir !== null) {\r\n            return makeAbsolutePath(workspaceDir, path, hostOS);\r\n        }\r\n        return path\r\n    };\r\n\r\n    let showFileDialogCallback;\r\n    if (input.fileOpenMode === 'w') {\r\n        showFileDialogCallback = (input: OperationInputState,\r\n                                  value: ValueEditorValue<string>,\r\n                                  onChange: ValueEditorCallback<string>) => {\r\n            const saveDialogOptions = {\r\n                defaultPath: toAbsolutePath(toTextValue(value, undefined)),\r\n                filters: input.fileFilters,\r\n            };\r\n            dispatch(actions.showFileSaveDialog(saveDialogOptions, (result: SaveDialogResult) => {\r\n                let filePath = result.filePath;\r\n                if (!result.canceled && filePath) {\r\n                    filePath = toRelativePath(filePath);\r\n                    onChange(input, filePath);\r\n                }\r\n            }) as any);\r\n        }\r\n    } else {\r\n        showFileDialogCallback = (input: OperationInputState,\r\n                                  value: ValueEditorValue<string>,\r\n                                  onChange: ValueEditorCallback<string>) => {\r\n            let properties = input.fileProps as string[];\r\n            const propsSet = new Set(properties);\r\n            if (!propsSet.has('openFile') && !propsSet.has('openDirectory')) {\r\n                propsSet.add('openFile');\r\n                properties = Array.from(propsSet);\r\n            }\r\n            const openDialogOptions = {\r\n                defaultPath: toAbsolutePath(toTextValue(value, undefined)),\r\n                filters: input.fileFilters,\r\n                properties: properties as any,\r\n            };\r\n            dispatch(actions.showFileOpenDialog(openDialogOptions, (result: OpenDialogResult) => {\r\n                let filePaths = result.filePaths;\r\n                if (!result.canceled && filePaths.length > 0) {\r\n                    filePaths = filePaths.map(toRelativePath);\r\n                    // TODO (forman): file choosers: handle properties=[\"multiSelection\", ...]\r\n                    //   with result.filePaths.length > 0. In this case concatenate paths in a OS-compliant way,\r\n                    //   i.e. path separator on Unix is ':', on Windows ';'\r\n                    if (properties && properties.find(p => p === 'multiSelection')) {\r\n                        console.error('multi-file selection is not yet implemented, returning first entry only');\r\n                    }\r\n                    onChange(input, filePaths[0]);\r\n                }\r\n            }) as any);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <ControlGroup fill={true} style={DIV_STYLE}>\r\n            <TextField style={TEXT_FIELD_STYLE}\r\n                       value={value}\r\n                       placeholder=\"Enter file path\"\r\n                       onChange={value => onChange(input, value)}\r\n                       nullable={input.nullable}\r\n            />\r\n            <Button intent={Intent.PRIMARY} style={BUTTON_STYLE}\r\n                    onClick={() => showFileDialogCallback(input, value, onChange)}>...</Button>\r\n        </ControlGroup>\r\n    );\r\n}\r\n\r\nexport const FileValueEditor = connect(mapStateToProps)(_FileValueEditor);\r\n","import * as React from 'react';\r\nimport { ModalDialog } from './ModalDialog';\r\nimport { GeometryType, validateGeometryValue } from '../../common/geometry-util';\r\nimport { FormGroup, Label } from '@blueprintjs/core';\r\n\r\ninterface IGeometryDialogProps {\r\n    isOpen: boolean;\r\n    value: string;\r\n    onConfirm: (value: string) => void;\r\n    onCancel: () => void;\r\n    geometryType: GeometryType;\r\n}\r\n\r\ninterface IGeometryDialogState {\r\n    value?: string;\r\n    error?: Error;\r\n}\r\n\r\nconst WKT_LINK = (\r\n    <a href=\"https://en.wikipedia.org/wiki/Well-known_text\" target=\"_blank\" rel=\"noopener noreferrer\">Well-Known Text\r\n        (WKT)</a>);\r\n\r\nexport class GeometryDialog extends React.Component<IGeometryDialogProps, IGeometryDialogState> {\r\n    static readonly NOMINAL_CLASS = 'bp3-input bp3-fill';\r\n    static readonly ERROR_CLASS = 'bp3-input bp3-fill bp3-intent-danger';\r\n\r\n    constructor(props: IGeometryDialogProps) {\r\n        super(props);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.onChange = this.onChange.bind(this);\r\n        this.state = this.toState(this.props.value);\r\n    }\r\n\r\n    componentWillReceiveProps(props: IGeometryDialogProps) {\r\n        this.setState(this.toState(props.value));\r\n    }\r\n\r\n    onConfirm() {\r\n        this.props.onConfirm(this.state.value);\r\n    }\r\n\r\n    onChange(ev: any) {\r\n        this.setState(this.toState(ev.target.value));\r\n    }\r\n\r\n    canConfirm(): boolean {\r\n        return !this.state.error;\r\n    }\r\n\r\n    private toState(value: any) {\r\n        let error;\r\n        try {\r\n            validateGeometryValue(value, this.props.geometryType);\r\n        } catch (e) {\r\n            error = e;\r\n        }\r\n        return {value, error};\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog isOpen={this.props.isOpen}\r\n                         title=\"Geometry Editor\"\r\n                         onCancel={this.props.onCancel}\r\n                         onConfirm={this.onConfirm}\r\n                         canConfirm={this.canConfirm}\r\n                         renderBody={this.renderBody}/>\r\n        );\r\n    }\r\n\r\n    renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const value = this.state.value;\r\n        const hasError = !!this.state.error;\r\n        return (\r\n            <FormGroup>\r\n                <Label htmlFor=\"wkt\">\r\n                    {`Enter Geometry of type ${this.props.geometryType}`}\r\n                    <span className=\"bp3-text-muted\"> (WGS84 coordinates in degree)</span>\r\n                </Label>\r\n                <div className=\"bp3-form-content\" style={{width: '100%'}}>\r\n                    <textarea id=\"wkt\"\r\n                              className={hasError ? GeometryDialog.ERROR_CLASS : GeometryDialog.NOMINAL_CLASS}\r\n                              rows={10}\r\n                              dir=\"auto\"\r\n                              value={value}\r\n                              onChange={this.onChange}/>\r\n                    {this.getHelpText()}\r\n                </div>\r\n            </FormGroup>\r\n        );\r\n    }\r\n\r\n    getHelpText() {\r\n        let errorText;\r\n        if (this.state.error) {\r\n            errorText = (<p>{`Error: ${this.state.error.message}`}</p>);\r\n        }\r\n\r\n        let helpText;\r\n        if (this.props.geometryType === 'Point') {\r\n            helpText = (<p>Use <code>lon, lat</code> or use {this.props.geometryType} {WKT_LINK} syntax.</p>);\r\n        } else if (this.props.geometryType === 'Polygon') {\r\n            helpText = (\r\n                <p>Use <code>west, south, east, north</code> or use {this.props.geometryType} {WKT_LINK} syntax.</p>);\r\n        } else {\r\n            helpText = (<p>Use {this.props.geometryType} {WKT_LINK} syntax.</p>);\r\n        }\r\n\r\n        return (<div className=\"bp3-form-helper-text\">{errorText}{helpText}</div>);\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, Intent } from '@blueprintjs/core';\r\nimport { toTextValue } from './Field';\r\nimport { TextField, TextFieldValue } from './TextField';\r\nimport { GeometryDialog } from '../GeometryDialog';\r\nimport { GeometryType, validateGeometryValue } from '../../../common/geometry-util';\r\nimport { GeometryWKTGetter } from '../../containers/editor/ValueEditor';\r\n\r\n\r\ninterface IGeometryFieldProps {\r\n    value: TextFieldValue | any;\r\n    onChange: (value: TextFieldValue) => void;\r\n    geometryType: GeometryType;\r\n    placeholder?: string;\r\n    size?: number;\r\n    nullable?: boolean;\r\n    disabled?: boolean;\r\n    geometryWKTGetter?: GeometryWKTGetter;\r\n}\r\n\r\ninterface IGeometryFieldState {\r\n    isEditorOpen: boolean;\r\n}\r\n\r\nexport class GeometryField extends React.Component<IGeometryFieldProps, IGeometryFieldState> {\r\n    private static DIV_STYLE = {display: 'flex', justifySelf: 'stretch'};\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n    private static BUTTON_STYLE = {flexGrow: 0};\r\n\r\n    constructor(props: IGeometryFieldProps) {\r\n        super(props);\r\n        this.validateGeometryText = this.validateGeometryText.bind(this);\r\n        this.state = {isEditorOpen: false};\r\n        this.setGeometryWKT = this.setGeometryWKT.bind(this);\r\n    }\r\n\r\n    validateGeometryText(value: string | null) {\r\n        validateGeometryValue(value, this.props.geometryType);\r\n    }\r\n\r\n    setGeometryWKT() {\r\n        let wkt;\r\n        try {\r\n            wkt = this.props.geometryWKTGetter && this.props.geometryWKTGetter();\r\n        } catch (error) {\r\n            console.error(error);\r\n            wkt = 'Error: ' + error;\r\n        }\r\n        this.props.onChange({textValue: wkt, value: wkt});\r\n    }\r\n\r\n    render() {\r\n        let placeholder = this.props.placeholder;\r\n        if (!placeholder) {\r\n            if (this.props.geometryType === 'Point') {\r\n                placeholder = '<lon>,<lat> or Point WKT';\r\n            } else if (this.props.geometryType === 'Polygon') {\r\n                placeholder = '<lon1>,<lat1>,<lon2>,<lat2> or Polygon WKT';\r\n            } else {\r\n                placeholder = `Enter ${this.props.geometryType} WKT`;\r\n            }\r\n        }\r\n        return (\r\n            <ControlGroup style={GeometryField.DIV_STYLE} fill={true}>\r\n                <TextField\r\n                    value={this.props.value}\r\n                    onChange={this.props.onChange}\r\n                    placeholder={placeholder}\r\n                    validator={this.validateGeometryText}\r\n                    nullable={this.props.nullable}\r\n                    style={GeometryField.TEXT_FIELD_STYLE}\r\n                />\r\n\r\n                <AnchorButton icon=\"selection\" style={GeometryField.BUTTON_STYLE}\r\n                              disabled={!this.props.geometryWKTGetter}\r\n                              onClick={this.setGeometryWKT}/>\r\n\r\n                <AnchorButton intent={Intent.PRIMARY} style={GeometryField.BUTTON_STYLE}\r\n                              onClick={() => this.setState({isEditorOpen: true})}>...</AnchorButton>\r\n\r\n                <GeometryDialog isOpen={this.state.isEditorOpen}\r\n                                value={toTextValue(this.props.value)}\r\n                                onConfirm={(value: string) => {\r\n                                    this.setState({isEditorOpen: false});\r\n                                    this.props.onChange({textValue: value, value: value});\r\n                                }}\r\n                                onCancel={() => {\r\n                                    this.setState({isEditorOpen: false});\r\n                                }}\r\n                                geometryType={this.props.geometryType}/>\r\n            </ControlGroup>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { GeometryWKTGetter, IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue } from '../../components/field/Field';\r\nimport { GeometryField } from '../../components/field/GeometryField';\r\nimport { GeometryType } from '../../../common/geometry-util';\r\n\r\ninterface IGeometryValueEditorProps extends IValueEditorProps<string> {\r\n    geometryType: GeometryType;\r\n    placeholder?: string;\r\n    size?: number;\r\n    geometryWKTGetter?: GeometryWKTGetter;\r\n}\r\n\r\nexport class GeometryValueEditor extends React.Component<IGeometryValueEditorProps, null> {\r\n\r\n    constructor(props: IGeometryValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <GeometryField\r\n                value={this.props.value}\r\n                onChange={this.onChange}\r\n                placeholder={this.props.placeholder}\r\n                size={this.props.size}\r\n                geometryType={this.props.geometryType}\r\n                nullable={this.props.input.nullable}\r\n                geometryWKTGetter={this.props.geometryWKTGetter}/>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { DateRange } from '@blueprintjs/datetime';\r\nimport { FieldValue } from '../../components/field/Field';\r\nimport { DateRangeField } from '../../components/field/DateRangeField';\r\nimport { parseDate } from '../../components/field/DateField';\r\n\r\ninterface ITimeRangeValueEditorProps extends IValueEditorProps<string> {\r\n}\r\n\r\nexport class TimeRangeValueEditor extends React.PureComponent<ITimeRangeValueEditorProps, null> {\r\n\r\n    constructor(props: ITimeRangeValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<DateRange>) {\r\n        const textValue = value.textValue;\r\n        const error = value.error;\r\n        this.props.onChange(this.props.input, {textValue, value: textValue, error});\r\n    }\r\n\r\n    render() {\r\n        const valueMinMax = this.getValueMinMax();\r\n        return (\r\n            <DateRangeField\r\n                nullable={this.props.input.nullable}\r\n                min={valueMinMax[0]}\r\n                max={valueMinMax[1]}\r\n                value={this.props.value}\r\n                onChange={this.onChange}\r\n            />\r\n        );\r\n    }\r\n\r\n    private getValueMinMax(): DateRange {\r\n        let min, max;\r\n        const valueRange = this.props.input.valueRange as [string, string];\r\n        if (valueRange) {\r\n            try {\r\n                min = parseDate(valueRange[0], true);\r\n                max = parseDate(valueRange[1], true);\r\n            } catch (e) {\r\n                // ok\r\n            }\r\n        }\r\n        return [min, max];\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\n\r\ninterface IDimensionsDialogProps {\r\n    isOpen: boolean;\r\n    value: string[];\r\n    dimNames: string[];\r\n    onConfirm: (value: string[]) => void;\r\n    onCancel: () => void;\r\n    multiSelect?: boolean;\r\n}\r\n\r\ninterface IDimensionssDialogState {\r\n    value: string[] | null;\r\n}\r\n\r\nexport class DimensionsDialog extends React.Component<IDimensionsDialogProps, IDimensionssDialogState> {\r\n\r\n    constructor(props: IDimensionsDialogProps) {\r\n        super(props);\r\n        this.onSelection = this.onSelection.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.state = {value: this.props.value};\r\n    }\r\n\r\n    private onSelection(value: string[]) {\r\n        this.setState({value});\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.onConfirm(this.state.value);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog\r\n                isOpen={this.props.isOpen}\r\n                title={this.props.multiSelect ? 'Select Dimensions' : 'Select Dimension'}\r\n                icon=\"variable\"\r\n                onConfirm={this.onConfirm}\r\n                onCancel={this.props.onCancel}\r\n                renderBody={this.renderBody}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const dimensions = this.props.dimNames;\r\n        if (!dimensions) {\r\n            return (<p>{`No dimensions names found for the given source.`}</p>);\r\n        }\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <p>{this.props.multiSelect ? 'Select one or more dimensions:' : 'Select dimension:'}</p>\r\n                <ListBox items={dimensions}\r\n                         getItemKey={DimensionsDialog.getDimItemKey}\r\n                         renderItem={DimensionsDialog.renderDimItem}\r\n                         selectionMode={this.props.multiSelect ? ListBoxSelectionMode.MULTIPLE : ListBoxSelectionMode.SINGLE}\r\n                         selection={this.state.value}\r\n                         style={{height: '20em'}}\r\n                         onSelection={this.onSelection}\r\n                         onItemDoubleClick={this.state.value ? this.onConfirm : null}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private static getDimItemKey(dimension: string) {\r\n        return dimension;\r\n    }\r\n\r\n    private static renderDimItem(dimension: string) {\r\n        return (\r\n            <div>\r\n                {dimension}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, Intent } from '@blueprintjs/core';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue, toTextValue } from '../../components/field/Field';\r\nimport { TextField } from '../../components/field/TextField';\r\nimport { DimensionsDialog } from '../DimensionsDialog';\r\n\r\ninterface IDimNamesValueEditorProps extends IValueEditorProps<string> {\r\n    dimNames: string[];\r\n    multi?: boolean;\r\n}\r\n\r\ninterface IDimNamesValueEditorState {\r\n    isDetailsEditorOpen: boolean;\r\n}\r\n\r\nexport class DimNameValueEditor extends React.Component<IDimNamesValueEditorProps, IDimNamesValueEditorState> {\r\n\r\n    private static DIV_STYLE = {width: '24em', display: 'flex', flexGrow: 1};\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n    private static BUTTON_STYLE = {flex: 'none'};\r\n\r\n    constructor(props: IDimNamesValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n        this.validate = this.validate.bind(this);\r\n        this.state = {isDetailsEditorOpen: false};\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    validate(value: string) {\r\n        validateDimNamesText(value, this.props.input.nullable, this.props.multi, this.props.dimNames);\r\n    }\r\n\r\n    render() {\r\n        const textValue = toTextValue(this.props.value);\r\n        const valueDims = textValue !== '' ? textValue.split(',').map(name => name.trim()) : [];\r\n        const hasSelectableDims = this.props.dimNames && this.props.dimNames.length;\r\n        return (\r\n            <ControlGroup style={DimNameValueEditor.DIV_STYLE}>\r\n                <TextField\r\n                    value={this.props.value}\r\n                    validator={this.validate}\r\n                    size={this.props.multi ? 36 : 24}\r\n                    placeholder={this.props.multi ? 'Enter dimension names, separated by comma' : 'Enter dimension name'}\r\n                    onChange={this.onChange}\r\n                    nullable={this.props.input.nullable}\r\n                    style={DimNameValueEditor.TEXT_FIELD_STYLE}\r\n                />\r\n\r\n                <AnchorButton intent={Intent.PRIMARY}\r\n                              onClick={() => this.setState({isDetailsEditorOpen: true})}\r\n                              disabled={!hasSelectableDims}\r\n                              style={DimNameValueEditor.BUTTON_STYLE}>...</AnchorButton>\r\n\r\n                <DimensionsDialog isOpen={this.state.isDetailsEditorOpen}\r\n                                  dimNames={this.props.dimNames}\r\n                                  multiSelect={this.props.multi}\r\n                                  value={valueDims}\r\n                                  onConfirm={(value: string[]) => {\r\n                                      const textValue = value ? value.join(', ') : null;\r\n                                      this.setState({isDetailsEditorOpen: false});\r\n                                      this.onChange({textValue, value: textValue});\r\n                                  }}\r\n                                  onCancel={() => {\r\n                                      this.setState({isDetailsEditorOpen: false} as any);\r\n                                  }}/>\r\n            </ControlGroup>\r\n        );\r\n    }\r\n}\r\n\r\nexport function validateDimNamesText(value: string | null, nullable: boolean, multi: boolean, dimNames: string[]) {\r\n    if (!value || value.trim() === '') {\r\n        if (!nullable) {\r\n            throw new Error(multi ? 'One or more dimension names expected.' : 'Dimension name expected.');\r\n        }\r\n        return;\r\n    }\r\n    const valueDims = value.split(',');\r\n    if (multi) {\r\n        for (let dimName of valueDims) {\r\n            if (dimName.trim() === '') {\r\n                throw new Error('Value must be a comma-separated list of dimension names.');\r\n            }\r\n        }\r\n    } else {\r\n        if (valueDims.length !== 1) {\r\n            throw new Error('Value must be a single dimension name.');\r\n        }\r\n        if (valueDims[0].trim() === '') {\r\n            throw new Error('Value must be a dimension name.');\r\n        }\r\n    }\r\n    if (dimNames) {\r\n        for (let dimName of valueDims) {\r\n            const dimSet = new Set(dimNames);\r\n            if (!dimSet.has(dimName)) {\r\n                throw new Error(`\"${dimName}\" is not a valid dimension. Valid dimensions are: \"${dimNames}\"`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { DateRange } from '@blueprintjs/datetime';\r\nimport { FieldValue } from '../../components/field/Field';\r\nimport { DateField, DEFAULT_DATE_RANGE, parseDate } from '../../components/field/DateField';\r\n\r\ninterface ITimeValueEditorProps extends IValueEditorProps<string> {\r\n}\r\n\r\nexport class TimeValueEditor extends React.PureComponent<ITimeValueEditorProps, null> {\r\n\r\n    constructor(props: ITimeValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<Date>) {\r\n        const textValue = value.textValue;\r\n        const error = value.error;\r\n        this.props.onChange(this.props.input, {textValue, value: textValue, error});\r\n    }\r\n\r\n    render() {\r\n        const valueMinMax = this.getValueMinMax();\r\n        return (\r\n            <DateField\r\n                nullable={this.props.input.nullable}\r\n                min={valueMinMax[0]}\r\n                max={valueMinMax[1]}\r\n                value={this.props.value}\r\n                onChange={this.onChange}\r\n            />\r\n        );\r\n    }\r\n\r\n    private getValueMinMax(): DateRange {\r\n        let min, max;\r\n        const valueRange = this.props.input.valueRange as [string, string];\r\n        if (valueRange) {\r\n            try {\r\n                min = parseDate(valueRange[0], true);\r\n                max = parseDate(valueRange[1], true);\r\n            } catch (e) {\r\n                min = DEFAULT_DATE_RANGE[0];\r\n                max = DEFAULT_DATE_RANGE[1];\r\n            }\r\n        }\r\n        return [min, max];\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport AceEditor from 'react-ace';\r\nimport { ModalDialog } from './ModalDialog';\r\n\r\nimport 'brace/mode/python';\r\nimport 'brace/theme/monokai';\r\n\r\ninterface IScriptDialogProps {\r\n    isOpen: boolean;\r\n    value: string;\r\n    onConfirm: (value: string) => void;\r\n    onCancel: () => void;\r\n    scriptLang: string;\r\n}\r\n\r\ninterface IScriptDialogState {\r\n    value?: string;\r\n    error?: Error;\r\n}\r\n\r\n\r\nconst LIBS = [\r\n    {href: 'http://xarray.pydata.org/en/stable/api.html#top-level-functions', module: 'xr', name: 'xarray'},\r\n    {href: 'http://xarray.pydata.org/en/stable/api.html#universal-functions', module: 'xu', name: 'xarray u-funcs'},\r\n    {href: 'http://pandas.pydata.org/pandas-docs/stable/basics.html', module: 'pd', name: 'Pandas'},\r\n    {href: 'http://pandas.pydata.org/pandas-docs/stable/basics.html', module: 'np', name: 'numpy'},\r\n];\r\n\r\nexport class ScriptDialog extends React.Component<IScriptDialogProps, IScriptDialogState> {\r\n    private static readonly DIALOG_STYLE: React.CSSProperties = {width: '54em'};\r\n\r\n    constructor(props: IScriptDialogProps) {\r\n        super(props);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.onChange = this.onChange.bind(this);\r\n        this.state = this.toState(this.props.value);\r\n    }\r\n\r\n    componentWillReceiveProps(props: IScriptDialogProps) {\r\n        this.setState(this.toState(props.value));\r\n    }\r\n\r\n    onConfirm() {\r\n        this.props.onConfirm(this.state.value);\r\n    }\r\n\r\n    onChange(value: string) {\r\n        this.setState(this.toState(value));\r\n    }\r\n\r\n    canConfirm(): boolean {\r\n        return !this.state.error;\r\n    }\r\n\r\n    // noinspection JSMethodCanBeStatic\r\n    private toState(value: any) {\r\n        let error;\r\n        try {\r\n            // TODO (nf)\r\n            // validateScriptValue(value, this.props.scriptLang);\r\n        } catch (e) {\r\n            error = e;\r\n        }\r\n        return {value, error};\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog isOpen={this.props.isOpen}\r\n                         title=\"Script Editor\"\r\n                         onCancel={this.props.onCancel}\r\n                         onConfirm={this.onConfirm}\r\n                         canConfirm={this.canConfirm}\r\n                         renderBody={this.renderBody}\r\n                         style={ScriptDialog.DIALOG_STYLE}\r\n            />\r\n        );\r\n    }\r\n\r\n    renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const value = this.state.value;\r\n        // const hasError = !!this.state.error;\r\n        return (\r\n            <React.Fragment>\r\n                <AceEditor mode={this.props.scriptLang}\r\n                           theme=\"monokai\"\r\n                           width={'100%'}\r\n                           fontSize={14}\r\n                           showGutter={true}\r\n                           highlightActiveLine={true}\r\n                           value={value}\r\n                           onChange={this.onChange}\r\n                />\r\n                {this.getHelpText()}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    getHelpText() {\r\n\r\n        const libText = LIBS.map((item, index) => (\r\n            <span><code>{item.module}</code>&nbsp;(<a href={item.href}\r\n                                                      rel=\"noopener noreferrer\"\r\n                                                      target=\"_blank\">{item.name}</a>){index < LIBS.length - 1 ? ', ' : ''}</span>\r\n        ));\r\n\r\n        return (\r\n            <div className=\"bp3-form-helper-text\" style={{marginTop: '0.5em'}}>\r\n                Please use Python 3.6+ syntax. The following modules are imported by default: {libText}. Other\r\n                modules can be imported: <code>dask</code>, <code>gdal</code>, <code>geos</code> <code>pyshp</code>,\r\n                <code>scipy</code>, <code>shapely</code>.\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, Intent } from '@blueprintjs/core';\r\nimport { IFieldProps, toTextValue } from './Field';\r\nimport { TextField } from './TextField';\r\nimport { ScriptDialog } from '../ScriptDialog';\r\n\r\n\r\ninterface IScriptFieldProps extends IFieldProps {\r\n    scriptLang: string;\r\n    nullable?: boolean;\r\n}\r\n\r\ninterface IScriptFieldState {\r\n    isEditorOpen: boolean;\r\n}\r\n\r\nexport class ScriptField extends React.Component<IScriptFieldProps, IScriptFieldState> {\r\n    private static DIV_STYLE = {display: 'flex'};\r\n    private static TEXT_FIELD_STYLE = {flexGrow: 1};\r\n    private static BUTTON_STYLE = {flexGrow: 0};\r\n\r\n    constructor(props: IScriptFieldProps) {\r\n        super(props);\r\n        this.validateScript = this.validateScript.bind(this);\r\n        this.state = {isEditorOpen: false};\r\n    }\r\n\r\n    validateScript(value: string | null) {\r\n        // TODO (nf)\r\n    }\r\n\r\n    render() {\r\n        let placeholder = this.props.placeholder;\r\n        return (\r\n            <ControlGroup style={ScriptField.DIV_STYLE} fill={true}>\r\n                <TextField\r\n                    value={this.props.value}\r\n                    onChange={this.props.onChange}\r\n                    size={this.props.size}\r\n                    placeholder={placeholder}\r\n                    validator={this.validateScript}\r\n                    nullable={this.props.nullable}\r\n                    style={ScriptField.TEXT_FIELD_STYLE}\r\n                />\r\n\r\n                <AnchorButton intent={Intent.PRIMARY} style={ScriptField.BUTTON_STYLE}\r\n                              onClick={() => this.setState({isEditorOpen: true})}>...</AnchorButton>\r\n\r\n                <ScriptDialog isOpen={this.state.isEditorOpen}\r\n                              value={toTextValue(this.props.value)}\r\n                              onConfirm={(value: string) => {\r\n                                  this.setState({isEditorOpen: false});\r\n                                  this.props.onChange({textValue: value, value: value});\r\n                              }}\r\n                              onCancel={() => {\r\n                                  this.setState({isEditorOpen: false});\r\n                              }}\r\n                              scriptLang={this.props.scriptLang}/>\r\n            </ControlGroup>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { IValueEditorProps } from './ValueEditor';\r\nimport { FieldValue } from '../../components/field/Field';\r\nimport { ScriptField } from '../../components/field/ScriptField';\r\n\r\ninterface IScriptValueEditorProps extends IValueEditorProps<string> {\r\n    placeholder?: string;\r\n    size?: number;\r\n}\r\n\r\nexport class ScriptValueEditor extends React.Component<IScriptValueEditorProps, null> {\r\n\r\n    constructor(props: IScriptValueEditorProps) {\r\n        super(props);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n\r\n    onChange(value: FieldValue<string>) {\r\n        this.props.onChange(this.props.input, value);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ScriptField\r\n                value={this.props.value}\r\n                onChange={this.onChange}\r\n                placeholder={this.props.placeholder}\r\n                size={this.props.size}\r\n                scriptLang={this.props.input.scriptLang}\r\n                nullable={this.props.input.nullable}/>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\n","import * as React from 'react';\r\nimport * as types from '../../../common/cate-types';\r\nimport { OperationInputState, ResourceState } from '../../state';\r\nimport { FieldValue } from '../../components/field/Field';\r\nimport { BooleanValueEditor } from './BooleanValueEditor';\r\nimport { IntegerValueEditor } from './IntegerValueEditor';\r\nimport { FloatValueEditor } from './FloatValueEditor';\r\nimport { TextValueEditor } from './TextValueEditor';\r\nimport { FileValueEditor } from './FileValueEditor';\r\nimport { GeometryValueEditor } from './GeometryValueEditor';\r\nimport { TimeRangeValueEditor } from './TimeRangeValueEditor';\r\nimport { VarNameValueEditor } from './VarNameValueEditor';\r\nimport { DimNameValueEditor } from './DimNameValueEditor';\r\nimport { DictValueEditor } from './DictValueEditor';\r\nimport { LiteralValueEditor } from './LiteralValueEditor';\r\nimport { TimeValueEditor } from './TimeValueEditor';\r\nimport { ScriptValueEditor } from './ScriptValueEditor';\r\nimport { InputAssignments } from './value-editor-assign';\r\n\r\nexport type ValueEditorValue<T> = FieldValue<T> | T | null;\r\nexport type ValueEditorCallback<T> = (input: OperationInputState, value: ValueEditorValue<T>) => void;\r\n\r\nexport type GeometryWKTGetter = (() => string) | null;\r\n\r\nexport interface IValueEditorProps<T> {\r\n    input: OperationInputState;\r\n    value: ValueEditorValue<T>;\r\n    onChange: ValueEditorCallback<T>;\r\n    inputAssignments?: InputAssignments;\r\n    resources?: ResourceState[];\r\n    geometryWKTGetter?: GeometryWKTGetter;\r\n}\r\n\r\nexport type ValueEditorFactory<T> = (props: IValueEditorProps<T>) => JSX.Element | null;\r\n\r\n/**\r\n * Provides an appropriate value editor widget for the given input (OperationInputState).\r\n */\r\nexport function ValueEditor(props: IValueEditorProps<any>) {\r\n    return renderValueEditor(props);\r\n}\r\n\r\n/**\r\n * Provides an appropriate value editor widget for the given input (OperationInputState).\r\n */\r\nexport function renderValueEditor<T>(props: IValueEditorProps<T>) {\r\n    const factory = getValueEditorFactory(props.input.dataType);\r\n    return factory ? factory(props) : null;\r\n}\r\n\r\nexport function hasValueEditorFactory(dataType: string): boolean {\r\n    return !!getValueEditorFactory(dataType);\r\n}\r\n\r\nexport function getValueEditorFactory(dataType: string): ValueEditorFactory<any> {\r\n    return dataType ? VALUE_EDITOR_FACTORIES[dataType] : null;\r\n}\r\n\r\n//noinspection JSUnusedGlobalSymbols\r\nexport function registerValueEditorFactory(dataType: string, factory: ValueEditorFactory<any>) {\r\n    VALUE_EDITOR_FACTORIES[dataType] = factory;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////////////\r\n\r\nfunction renderBoolValueEditor(props: IValueEditorProps<boolean>) {\r\n    return <BooleanValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderIntValueEditor(props: IValueEditorProps<number>) {\r\n    return <IntegerValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderFloatValueEditor(props: IValueEditorProps<number>) {\r\n    return <FloatValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderStrValueEditor(props: IValueEditorProps<string>) {\r\n    if (props.input.fileOpenMode) {\r\n        return renderFileValueEditor(props);\r\n    } else if (props.input.scriptLang) {\r\n        return renderScriptValueEditor(props);\r\n    } else {\r\n        return renderTextValueEditor(props);\r\n    }\r\n}\r\n\r\nfunction renderFileValueEditor(props: IValueEditorProps<string>) {\r\n    return <FileValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderScriptValueEditor(props: IValueEditorProps<string>) {\r\n    return <ScriptValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderTextValueEditor(props: IValueEditorProps<string>) {\r\n    return <TextValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderPointLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <GeometryValueEditor input={props.input} value={props.value} onChange={props.onChange} geometryType=\"Point\"\r\n                                size={16} geometryWKTGetter={props.geometryWKTGetter}/>;\r\n}\r\n\r\nfunction renderPolygonLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <GeometryValueEditor input={props.input} value={props.value} onChange={props.onChange} geometryType=\"Polygon\"\r\n                                size={32} geometryWKTGetter={props.geometryWKTGetter}/>;\r\n}\r\n\r\nfunction renderGeometryLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <GeometryValueEditor input={props.input} value={props.value} onChange={props.onChange}\r\n                                geometryType=\"Geometry\" size={32} geometryWKTGetter={props.geometryWKTGetter}/>;\r\n}\r\n\r\nfunction renderTimeLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <TimeValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderTimeRangeLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <TimeRangeValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderVarNameLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <VarNameValueEditor input={props.input} value={props.value} onChange={props.onChange}\r\n                               resource={findResource(props)} multi={false}/>;\r\n}\r\n\r\nfunction renderVarNamesLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <VarNameValueEditor input={props.input} value={props.value} onChange={props.onChange}\r\n                               resource={findResource(props)} multi={true}/>;\r\n}\r\n\r\nfunction renderDimNameLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <DimNameValueEditor input={props.input} value={props.value} onChange={props.onChange}\r\n                               dimNames={findDims(props)} multi={false}/>;\r\n}\r\n\r\nfunction renderDimNamesLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <DimNameValueEditor input={props.input} value={props.value} onChange={props.onChange}\r\n                               dimNames={findDims(props)} multi={true}/>;\r\n}\r\n\r\nfunction renderDictLikeValueEditor(props: IValueEditorProps<string>) {\r\n    return <DictValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nfunction renderLiteralValueEditor(props: IValueEditorProps<string>) {\r\n    return <LiteralValueEditor input={props.input} value={props.value} onChange={props.onChange}/>;\r\n}\r\n\r\nconst VALUE_EDITOR_FACTORIES = {\r\n    [types.BOOL_TYPE]: renderBoolValueEditor,\r\n    [types.INT_TYPE]: renderIntValueEditor,\r\n    [types.FLOAT_TYPE]: renderFloatValueEditor,\r\n    [types.STR_TYPE]: renderStrValueEditor,\r\n    [types.POINT_LIKE_TYPE]: renderPointLikeValueEditor,\r\n    [types.POLYGON_LIKE_TYPE]: renderPolygonLikeValueEditor,\r\n    [types.GEOMETRY_LIKE_TYPE]: renderGeometryLikeValueEditor,\r\n    [types.TIME_LIKE_TYPE]: renderTimeLikeValueEditor,\r\n    [types.TIME_RANGE_LIKE_TYPE]: renderTimeRangeLikeValueEditor,\r\n    [types.VAR_NAME_LIKE_TYPE]: renderVarNameLikeValueEditor,\r\n    [types.VAR_NAMES_LIKE_TYPE]: renderVarNamesLikeValueEditor,\r\n    [types.DIM_NAME_LIKE_TYPE]: renderDimNameLikeValueEditor,\r\n    [types.DIM_NAMES_LIKE_TYPE]: renderDimNamesLikeValueEditor,\r\n    [types.DICT_LIKE_TYPE]: renderDictLikeValueEditor,\r\n    [types.FILE_LIKE_TYPE]: renderFileValueEditor,\r\n    [types.LITERAL_TYPE]: renderLiteralValueEditor,\r\n};\r\n\r\n///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\nfunction findResource(props: IValueEditorProps<any>) {\r\n    const valueSetSource = props.input.valueSetSource;\r\n    const resources = props.resources;\r\n    const inputAssignments = props.inputAssignments;\r\n    let resource;\r\n    if (valueSetSource && resources && inputAssignments) {\r\n        const inputAssignment = inputAssignments[valueSetSource];\r\n        const resourceName = inputAssignment.resourceName;\r\n        if (inputAssignment && resourceName && !inputAssignment.isValueUsed) {\r\n            resource = resources.find(r => r.name === resourceName);\r\n        }\r\n    }\r\n    return resource;\r\n}\r\n\r\n\r\nfunction findDims(props: IValueEditorProps<any>) {\r\n    const valueSetSource = props.input.valueSetSource.split('.');\r\n    const resources = props.resources;\r\n    const inputAssignments = props.inputAssignments;\r\n\r\n    let resource;\r\n    let variable;\r\n    let dimNames;\r\n\r\n    if (valueSetSource[0] && resources && inputAssignments) {\r\n        const inputAssignment = inputAssignments[valueSetSource[0]];\r\n        const resourceName = inputAssignment.resourceName;\r\n        if (inputAssignment && resourceName && !inputAssignment.isValueUsed) {\r\n            resource = resources.find(r => r.name === resourceName);\r\n        }\r\n    }\r\n\r\n    if (resource) {\r\n        const variables = resource.variables;\r\n        if (valueSetSource[1] && variables && inputAssignments) {\r\n            const inputAssignment = inputAssignments[valueSetSource[1]];\r\n            if (inputAssignment && inputAssignment.constantValue) {\r\n                const varName = inputAssignment.constantValue.textValue;\r\n                variable = variables.find(v => v.name === varName);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    if (valueSetSource[0] && valueSetSource[1] && variable) {\r\n        dimNames = variable.dimNames;\r\n    } else if (valueSetSource[0] && !valueSetSource[1] && resource) {\r\n        dimNames = resource.coordVariables.map(c => c.name);\r\n    }\r\n\r\n    return dimNames;\r\n}\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { AnchorButton, FormGroup, Icon, Tooltip } from '@blueprintjs/core';\r\nimport {\r\n    DialogState,\r\n    OperationInputState,\r\n    OperationKWArgs,\r\n    OperationState,\r\n    ResourceState,\r\n    State,\r\n    WorkflowStepState,\r\n    WorkspaceState\r\n} from '../state';\r\nimport { InputEditor } from './editor/InputEditor';\r\nimport { updatePropertyObject } from '../../common/objutil';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { isFieldValue } from '../components/field/Field';\r\nimport { GeometryWKTGetter, hasValueEditorFactory, renderValueEditor } from './editor/ValueEditor';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { isDefined, isString, isUndefined, isUndefinedOrNull } from '../../common/types';\r\nimport { InputAssignment, InputAssignments } from './editor/value-editor-assign';\r\nimport {\r\n    EDIT_OPERATION_STEP_DIALOG_ID,\r\n    NEW_CTX_OPERATION_STEP_DIALOG_ID,\r\n    NEW_OPERATION_STEP_DIALOG_ID\r\n} from './operation-step-dialog-ids';\r\n\r\ntype InputErrors = { [inputName: string]: Error };\r\n\r\ninterface IOperationStepDialogOwnProps {\r\n    id: string;\r\n    operationStep?: WorkflowStepState | null;\r\n}\r\n\r\ninterface IOperationStepDialogProps extends DialogState, IOperationStepDialogOwnProps {\r\n    operation?: OperationState;\r\n    inputAssignments?: InputAssignments;\r\n    workspace: WorkspaceState;\r\n    resName: string;\r\n    geometryWKTGetter: GeometryWKTGetter;\r\n}\r\n\r\ninterface IOperationStepDialogState {\r\n    inputAssignments: InputAssignments;\r\n    inputErrors?: InputErrors;\r\n    isValidationDialogOpen?: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IOperationStepDialogOwnProps): IOperationStepDialogProps {\r\n    const id = ownProps.id;\r\n    const dialogState = selectors.dialogStateSelector(id)(state);\r\n    const isOpen = dialogState.isOpen;\r\n\r\n    if (!isOpen) {\r\n        return {id, isOpen: false} as any;\r\n    }\r\n\r\n    let operation, inputAssignments, resName = null;\r\n    if (id === NEW_OPERATION_STEP_DIALOG_ID) {\r\n        operation = selectors.selectedOperationSelector(state);\r\n        if (!operation) {\r\n            console.error('OperationStepDialog: operation is undefined: dialog id =', id);\r\n            return {id, isOpen: false} as any;\r\n        }\r\n        // Assign inputs from restored values\r\n        const inputAssignmentsMap = (dialogState as any).inputAssignments;\r\n        inputAssignments = inputAssignmentsMap && inputAssignmentsMap[operation.qualifiedName];\r\n    } else if (id === NEW_CTX_OPERATION_STEP_DIALOG_ID) {\r\n        operation = selectors.selectedCtxOperationSelector(state);\r\n        if (!operation) {\r\n            console.error('OperationStepDialog: operation is undefined: dialog id =', id);\r\n            return {id, isOpen: false} as any;\r\n        }\r\n        // Assign inputs from context settings\r\n        inputAssignments = (dialogState as any).inputAssignments;\r\n    } else if (id === EDIT_OPERATION_STEP_DIALOG_ID) {\r\n        const operationStep = ownProps.operationStep;\r\n        operation = (selectors.operationsSelector(state) || [])\r\n            .find(op => op.name === operationStep.op || op.qualifiedName === operationStep.op);\r\n        if (!operation) {\r\n            console.error('OperationStepDialog: operation is undefined: dialog id =', id);\r\n            return {id, isOpen: false} as any;\r\n        }\r\n        inputAssignments = getInputAssignmentsFromOperationStep(operation, operationStep);\r\n        resName = operationStep.id;\r\n    } else {\r\n        console.error('OperationStepDialog: unknown dialog id =', id);\r\n        return {id, isOpen: false} as any;\r\n    }\r\n\r\n    const workspace = selectors.workspaceSelector(state);\r\n    const geometryWKTGetter = selectors.selectedGeometryWKTGetterSelector(state);\r\n\r\n    return {id, isOpen, workspace, geometryWKTGetter, resName, operation, inputAssignments};\r\n}\r\n\r\nclass OperationStepDialog extends React.Component<IOperationStepDialogProps & DispatchProp<State>, IOperationStepDialogState> {\r\n\r\n    private static readonly DIALOG_STYLE: React.CSSProperties = {width: '42em'};\r\n    private static readonly NO_STATE = {inputAssignments: {}};\r\n    private static readonly PARAMETER_PANEL_STYLE = {\r\n        display: 'grid',\r\n        gridTemplateColumns: 'auto auto 28px',\r\n        alignItems: 'center',\r\n        justifyItems: 'stretch',\r\n        rowGap: '1ex',\r\n        columnGap: '0.5em'\r\n    };\r\n\r\n    constructor(props: IOperationStepDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.onConstantValueChange = this.onConstantValueChange.bind(this);\r\n        this.onResourceNameChange = this.onResourceNameChange.bind(this);\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onValidate = this.onValidate.bind(this);\r\n        this.onDefaults = this.onDefaults.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.hideValidationDialog = this.hideValidationDialog.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.renderExtraActions = this.renderExtraActions.bind(this);\r\n        this.state = OperationStepDialog.mapPropsToState(props);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IOperationStepDialogProps) {\r\n        this.setState(OperationStepDialog.mapPropsToState(nextProps));\r\n    }\r\n\r\n    static mapPropsToState(props: IOperationStepDialogProps): IOperationStepDialogState {\r\n        if (!props.isOpen) {\r\n            return OperationStepDialog.NO_STATE;\r\n        }\r\n        const operation = props.operation;\r\n        const inputAssignments = getInitialInputAssignments(operation.inputs, props.inputAssignments, false);\r\n        return {inputAssignments};\r\n    }\r\n\r\n    private onConfirm() {\r\n        const isEditMode = this.props.id === EDIT_OPERATION_STEP_DIALOG_ID;\r\n        const isNewMode = !isEditMode;\r\n        const operation = this.props.operation;\r\n        let inputAssignmentsMap;\r\n        if (isNewMode) {\r\n            // Only store input assignments when creating new operation steps\r\n            inputAssignmentsMap = {[operation.qualifiedName]: this.state.inputAssignments};\r\n        }\r\n        this.props.dispatch(actions.hideOperationStepDialog(this.props.id, inputAssignmentsMap) as any);\r\n        this.props.dispatch(actions.setWorkspaceResource(operation.qualifiedName,\r\n                                                         this.getInputArguments(),\r\n                                                         this.props.resName,\r\n                                                         isEditMode,\r\n                                                         `Executing operation \"${operation.name}\"`) as any);\r\n    }\r\n\r\n    private canConfirm() {\r\n        return !this.getInputErrors();\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideOperationStepDialog(this.props.id) as any);\r\n    }\r\n\r\n    private onValidate() {\r\n        let inputErrors = this.getInputErrors();\r\n        this.setState({isValidationDialogOpen: true, inputErrors} as any);\r\n    }\r\n\r\n    private hideValidationDialog() {\r\n        this.setState({isValidationDialogOpen: false} as any);\r\n    }\r\n\r\n    private getInputArguments(): OperationKWArgs {\r\n        return getInputArguments(this.props.operation.inputs, this.state.inputAssignments);\r\n    }\r\n\r\n    private getInputErrors(): { [name: string]: Error } {\r\n        return getInputErrors(this.props.operation.inputs, this.state.inputAssignments);\r\n    }\r\n\r\n    private onDefaults() {\r\n        const inputAssignments = getInitialInputAssignments(this.props.operation.inputs,\r\n                                                            this.state.inputAssignments, true);\r\n        this.setState({inputAssignments} as any);\r\n    }\r\n\r\n    private setInputAssignment(input: OperationInputState, inputAssignment: InputAssignment) {\r\n        //console.log('OperationStepDialog: setInputAssignment: inputAssignment =', inputAssignment);\r\n        const inputAssignments = updatePropertyObject(this.state.inputAssignments, input.name, inputAssignment);\r\n        //console.log('OperationStepDialog: setInputAssignment: inputAssignments =', inputAssignments);\r\n        this.setState({inputAssignments} as any);\r\n    };\r\n\r\n    private onResourceNameChange(input: OperationInputState, resourceName: string, isValueUsed: boolean) {\r\n        if (resourceName === '' && input.nullable) {\r\n            resourceName = null;\r\n        }\r\n        this.setInputAssignment(input, {resourceName, isValueUsed} as InputAssignment);\r\n    }\r\n\r\n    private onConstantValueChange(input: OperationInputState, value: any) {\r\n        this.setInputAssignment(input, {constantValue: value, isValueUsed: true} as InputAssignment);\r\n    }\r\n\r\n    render() {\r\n        const isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const operation = this.props.operation;\r\n        let confirmTitle, dialogTitle, tooltipText;\r\n        if (this.props.id === EDIT_OPERATION_STEP_DIALOG_ID) {\r\n            confirmTitle = 'Edit Step';\r\n            dialogTitle = `Edit Operation Step - ${operation.name}`;\r\n            tooltipText = 'Edit operation step inputs and recompute output.';\r\n        } else {\r\n            confirmTitle = 'Add Step';\r\n            dialogTitle = `Add Operation Step - ${operation.name}`;\r\n            tooltipText = 'Add a new operation step to the workspace’s workflow.';\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={true}\r\n                icon=\"function\"\r\n                title={dialogTitle}\r\n                confirmTooltip={tooltipText}\r\n                confirmTitle={confirmTitle}\r\n                confirmIconName=\"play\"\r\n                onConfirm={this.onConfirm}\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                renderBody={this.renderBody}\r\n                renderExtraActions={this.renderExtraActions}\r\n                style={OperationStepDialog.DIALOG_STYLE}\r\n            />\r\n        );\r\n    }\r\n\r\n    renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const operation = this.props.operation;\r\n\r\n        const bodyHeaderText = (\r\n            <p key='header' style={{marginBottom: '1em'}}>\r\n                Adjustable parameter(s) for operation <code>{operation.name}</code>:\r\n            </p>\r\n        );\r\n\r\n        const bodyFooterText = (\r\n            <p key='footer' style={{marginTop: '1em'}}>\r\n                Pressing <Icon icon=\"play\"/> will add operation <code>{operation.name}</code> as a new\r\n                workflow step to the current workspace. The result of the step is a new <em>resource</em> which can\r\n                be used as input for other operations. You can remove the step or change its parameters later.\r\n            </p>\r\n        );\r\n\r\n        const parameterPanel = this.renderParameterPanel();\r\n\r\n        return (\r\n            <FormGroup>\r\n                {bodyHeaderText}\r\n                <div>\r\n                    {parameterPanel}\r\n                    <div className=\"bp3-form-helper-text\">{bodyFooterText}</div>\r\n                </div>\r\n                <ValidationDialog isOpen={this.state.isValidationDialogOpen}\r\n                                  inputErrors={this.state.inputErrors}\r\n                                  onConfirm={this.hideValidationDialog}\r\n                />\r\n            </FormGroup>\r\n        );\r\n    }\r\n\r\n    renderExtraActions() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return [\r\n            <Tooltip key='validate' content=\"Validate current input values\">\r\n                <AnchorButton onClick={this.onValidate}>Validate</AnchorButton>\r\n            </Tooltip>,\r\n            <Tooltip key='defaults' content=\"Set all inputs back to default values\">\r\n                <AnchorButton onClick={this.onDefaults}>Defaults</AnchorButton>\r\n            </Tooltip>,\r\n        ];\r\n    }\r\n\r\n    renderParameterPanel(): JSX.Element {\r\n        const operation = this.props.operation;\r\n        if (!operation.inputs || !operation.inputs.length) {\r\n            return null;\r\n        }\r\n        const inputEditors = renderInputEditors(\r\n            operation.inputs,\r\n            this.state.inputAssignments,\r\n            this.props.workspace.resources,\r\n            this.props.geometryWKTGetter,\r\n            this.onConstantValueChange,\r\n            this.onResourceNameChange\r\n        );\r\n        return (<div key='parameterPanel'\r\n                     style={OperationStepDialog.PARAMETER_PANEL_STYLE}>\r\n                    {inputEditors}\r\n                </div>);\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(OperationStepDialog);\r\n\r\nfunction getInputAssignmentsFromOperationStep(operation: OperationState, operationStep: WorkflowStepState): InputAssignments {\r\n    const inputAssignments = {};\r\n    for (let input of operation.inputs) {\r\n        const inputPort = operationStep.inputs[input.name];\r\n        if (inputPort) {\r\n            const resourceName = isString(inputPort) ? inputPort : inputPort.source;\r\n            if (resourceName) {\r\n                inputAssignments[input.name] = {resourceName, isValueUsed: false};\r\n            } else if (!isUndefined(inputPort.value)) {\r\n                let constantValue = inputPort.value;\r\n                inputAssignments[input.name] = {constantValue, isValueUsed: true};\r\n            }\r\n        }\r\n    }\r\n    return inputAssignments;\r\n}\r\n\r\nfunction getInitialInputAssignments(inputs: OperationInputState[],\r\n                                    lastInputAssignments?: InputAssignments,\r\n                                    forceDefaults?: boolean): InputAssignments {\r\n    const inputAssignments = {};\r\n    inputs.forEach((input: OperationInputState) => {\r\n        const isValueUsed = hasValueEditorFactory(input.dataType);\r\n        const hasDefaultValue = isDefined(input.defaultValue);\r\n        const constantValue = hasDefaultValue ? input.defaultValue : null;\r\n        const resourceName = null;\r\n        const defaultInputAssignment = {constantValue, isValueUsed, resourceName};\r\n        const lastInputAssignment = lastInputAssignments && lastInputAssignments[input.name];\r\n        let inputAssignment;\r\n        if (!lastInputAssignment || forceDefaults) {\r\n            inputAssignment = defaultInputAssignment;\r\n        } else {\r\n            inputAssignment = lastInputAssignment || defaultInputAssignment;\r\n        }\r\n        inputAssignments[input.name] = inputAssignment;\r\n    });\r\n    return inputAssignments;\r\n}\r\n\r\nfunction renderInputEditors(inputs: OperationInputState[],\r\n                            inputAssignments: InputAssignments,\r\n                            resources: ResourceState[],\r\n                            geometryWKTGetter: GeometryWKTGetter,\r\n                            onConstantValueChange,\r\n                            onResourceNameChange): JSX.Element[] {\r\n    return inputs\r\n        .filter(input => !input.noUI)\r\n        .map((input: OperationInputState) => {\r\n            const inputAssignment = inputAssignments[input.name];\r\n            const constantValue = inputAssignment.constantValue;\r\n            const valueEditor = renderValueEditor({\r\n                                                      input,\r\n                                                      inputAssignments,\r\n                                                      resources,\r\n                                                      geometryWKTGetter,\r\n                                                      value: constantValue,\r\n                                                      onChange: onConstantValueChange\r\n                                                  });\r\n            return (\r\n                <InputEditor key={input.name}\r\n                             resources={resources}\r\n                             name={input.name}\r\n                             dataType={input.dataType}\r\n                             units={input.units}\r\n                             tooltipText={input.description}\r\n                             onChange={(resourceName, isValueUsed) => onResourceNameChange(input, resourceName, isValueUsed)}\r\n                             isValueEditorShown={inputAssignment.isValueUsed}\r\n                             resourceName={inputAssignment.resourceName}\r\n                             valueEditor={valueEditor}/>\r\n            );\r\n        });\r\n}\r\n\r\nfunction getInputArguments(inputs: OperationInputState[],\r\n                           inputAssignments: InputAssignments): OperationKWArgs {\r\n    const inputArguments = {};\r\n    inputs.forEach((input) => {\r\n        const inputAssignment = inputAssignments[input.name];\r\n        if (inputAssignment) {\r\n            let inputArgument;\r\n            if (inputAssignment.isValueUsed) {\r\n                const constantValue = inputAssignment.constantValue;\r\n                const value = isFieldValue(constantValue) ? constantValue.value : constantValue;\r\n                inputArgument = {value};\r\n            } else {\r\n                inputArgument = {source: inputAssignment.resourceName};\r\n            }\r\n            inputArguments[input.name] = inputArgument;\r\n        }\r\n    });\r\n    return inputArguments;\r\n}\r\n\r\nfunction getInputErrors(inputs: OperationInputState[],\r\n                        inputAssignments: InputAssignments): InputErrors {\r\n    let inputErrors = {};\r\n    let hasInputErrors = false;\r\n    inputs.forEach((input) => {\r\n        const inputAssignment = inputAssignments[input.name];\r\n        if (inputAssignment) {\r\n            if (inputAssignment.isValueUsed) {\r\n                const constantValue = inputAssignment.constantValue;\r\n                const error = isFieldValue(constantValue) && constantValue.error;\r\n                if (error) {\r\n                    inputErrors[input.name] = error;\r\n                    hasInputErrors = true;\r\n                } else if (isUndefinedOrNull(constantValue) && !input.nullable) {\r\n                    inputErrors[input.name] = new Error('Value must be given.');\r\n                    hasInputErrors = true;\r\n                }\r\n            } else {\r\n                const resourceName = inputAssignment.resourceName;\r\n                if (isUndefinedOrNull(resourceName) && !input.nullable) {\r\n                    inputErrors[input.name] = new Error('Resource must be specified.');\r\n                    hasInputErrors = true;\r\n                }\r\n            }\r\n        } else {\r\n            inputErrors[input.name] = new Error('Value must be specified.');\r\n            hasInputErrors = true;\r\n        }\r\n\r\n    });\r\n    //console.log('getInputErrors: ', inputErrors);\r\n    return hasInputErrors ? inputErrors : null;\r\n}\r\n\r\ninterface IValidationDialogProps {\r\n    isOpen: boolean;\r\n    inputErrors: InputErrors;\r\n    onConfirm: () => void;\r\n}\r\n\r\nclass ValidationDialog extends React.Component<IValidationDialogProps, null> {\r\n\r\n    constructor(props: IValidationDialogProps) {\r\n        super(props);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.onConfirm();\r\n    }\r\n\r\n    private countResourceProblems(): number {\r\n        const inputErrors = this.props.inputErrors;\r\n        let count = 0;\r\n        Object.getOwnPropertyNames(inputErrors).forEach(inputName => {\r\n            const error = inputErrors[inputName];\r\n            if (error.message && (error.message.includes('resource') || error.message.includes('Resource'))) {\r\n                count++;\r\n            }\r\n        });\r\n        return count;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog isOpen={this.props.isOpen}\r\n                         title=\"Input Validation\"\r\n                         onConfirm={this.onConfirm}\r\n                         noCancelButton={true}\r\n                         onCancel={this.onConfirm}\r\n                         renderBody={this.renderBody}/>\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const inputErrors = this.props.inputErrors;\r\n        if (!inputErrors) {\r\n            return (<p>No problems encountered.</p>);\r\n        }\r\n        const resourceProblems = this.countResourceProblems();\r\n        const body = renderInputErrors(inputErrors, resourceProblems);\r\n        if (!body) {\r\n            return (<p>No problems encountered.</p>);\r\n        }\r\n        return body;\r\n    }\r\n}\r\n\r\nexport function renderInputErrors(inputErrors: InputErrors, resourceProblems?: number) {\r\n    const problems = [];\r\n    Object.getOwnPropertyNames(inputErrors).forEach(inputName => {\r\n        let error = inputErrors[inputName];\r\n        problems.push(<li key={inputName}>{inputName}: {error.message}</li>);\r\n    });\r\n\r\n    let introText;\r\n    if (problems.length === 0) {\r\n        return null;\r\n    } else if (problems.length === 1) {\r\n        introText = 'The following problem has been encountered:';\r\n    } else {\r\n        introText = `The following ${problems.length} problems have been encountered:`;\r\n    }\r\n\r\n    const footerText = resourceProblems && resourceProblems > 0 ? (<p>This operation has\r\n        parameter(s) which require specifying a <em>resource</em>. When there are no compatible resources yet,\r\n        you may consider opening a data source or use one of the <code>read_...</code> operations first.\r\n    </p>) : null;\r\n\r\n    return (\r\n        <FormGroup>\r\n            {introText}\r\n            <div className=\"bp3-form-content\">\r\n                {problems}\r\n                <div className=\"bp3-form-helper-text\">{footerText}</div>\r\n            </div>\r\n        </FormGroup>\r\n    );\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { DataSourceState, DataStoreState, DialogState, State } from '../state';\r\nimport { isLocalDataStore, isRemoteDataStore } from '../state-util';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { DataAccessComponent, IDataAccessComponentOptions } from './DataAccessComponent';\r\nimport { renderInputErrors } from './OperationStepDialog';\r\n\r\ntype TimeRangeValue = [string, string];\r\n\r\n\r\ninterface IOpenDatasetDialogProps {\r\n    isOpen: boolean;\r\n    dataStore: DataStoreState | null;\r\n    dataSource: DataSourceState | null;\r\n    temporalCoverage: TimeRangeValue | null;\r\n    canConstrainTime: boolean;\r\n    canConstrainRegion: boolean;\r\n    canConstrainVariables: boolean;\r\n    canCache: boolean;\r\n    options: IDataAccessComponentOptions;\r\n}\r\n\r\ninterface IOpenDatasetDialogState extends DialogState {\r\n    options: IDataAccessComponentOptions;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IOpenDatasetDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(OpenDatasetDialog.DIALOG_ID)(state);\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n        dataStore: selectors.selectedDataStoreSelector(state),\r\n        dataSource: selectors.selectedDataSourceSelector(state),\r\n        temporalCoverage: selectors.selectedDataSourceTemporalCoverageSelector(state),\r\n        canConstrainTime: selectors.canConstrainDataSourceTimeSelector(state),\r\n        canConstrainRegion: selectors.canConstrainDataSourceRegionSelector(state),\r\n        canConstrainVariables: selectors.canConstrainDataSourceVariablesSelector(state),\r\n        canCache: selectors.canCacheDataSourceSelector(state),\r\n        options: (dialogState as any).options as IDataAccessComponentOptions,\r\n    };\r\n}\r\n\r\nclass OpenDatasetDialog extends React.Component<IOpenDatasetDialogProps & DispatchProp<State>, IOpenDatasetDialogState> {\r\n    static readonly DIALOG_ID = 'openDatasetDialog';\r\n\r\n    constructor(props: IOpenDatasetDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onOptionsChange = this.onOptionsChange.bind(this);\r\n        this.state = OpenDatasetDialog.mapPropsToState(props);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IOpenDatasetDialogProps): void {\r\n        this.setState(OpenDatasetDialog.mapPropsToState(nextProps));\r\n    }\r\n\r\n    static mapPropsToState(nextProps: IOpenDatasetDialogProps): IOpenDatasetDialogState {\r\n        let options: IDataAccessComponentOptions = nextProps.options\r\n                                                   || DataAccessComponent.defaultOptions(isLocalDataStore(nextProps.dataStore),\r\n                                                                                         nextProps.temporalCoverage);\r\n        const isCacheDataSourceSelected = nextProps.canCache && options.isCacheDataSourceSelected;\r\n        options = DataAccessComponent.ensureDateRangeIsValidated(options, nextProps.temporalCoverage);\r\n        options = {...options, isCacheDataSourceSelected}\r\n        return {options};\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(OpenDatasetDialog.DIALOG_ID));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        return DataAccessComponent.validateOptions(this.isLocalDataStore, this.state.options);\r\n    }\r\n\r\n    private onConfirm() {\r\n        const isCacheDataSourceSelected = this.props.canCache && this.state.options.isCacheDataSourceSelected;\r\n        const options: IDataAccessComponentOptions = {...this.state.options, isCacheDataSourceSelected};\r\n        // Clear cachedDataSourceId, so on next props, we can create a new default from selected data source\r\n        // clear cachedDataSourceTitle, hasVariablesConstraint, variableNames, too\r\n        // keep time and geo constraint\r\n        const dsDefault = this.isRemoteDataStore ? '' : undefined;\r\n        const dialogState = {\r\n            options:\r\n                {\r\n                    ...options,\r\n                    makeLocalDataSourceId: dsDefault,\r\n                    makeLocalDataSourceTitle: dsDefault,\r\n                    hasVariablesConstraint: false,\r\n                    variableNames: null,\r\n                }\r\n        };\r\n        this.props.dispatch(actions.hideDialog(OpenDatasetDialog.DIALOG_ID, dialogState));\r\n        this.props.dispatch(actions.openDataset(\r\n            this.props.dataStore.id,\r\n            this.props.dataSource.id,\r\n            DataAccessComponent.optionsToOperationArguments(this.state.options),\r\n            this.isRemoteDataStore && isCacheDataSourceSelected\r\n        ) as any);\r\n        // Save modified state\r\n        this.setState(dialogState);\r\n    }\r\n\r\n    private onOptionsChange(options: IDataAccessComponentOptions) {\r\n        this.setState({options});\r\n    }\r\n\r\n    private get isRemoteDataStore() {\r\n        return isRemoteDataStore(this.props.dataStore);\r\n    }\r\n\r\n    private get isLocalDataStore() {\r\n        return isLocalDataStore(this.props.dataStore);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        const cacheSelected = this.isRemoteDataStore && this.state.options.isCacheDataSourceSelected;\r\n        const inputErrors = DataAccessComponent.optionsToErrors(this.state.options);\r\n        const confirmTooltip = renderInputErrors(inputErrors);\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title={'Open Dataset'}\r\n                icon=\"database\"\r\n                confirmTitle={cacheSelected ? 'Cache and Open' : 'Open'}\r\n                confirmIconName={\"folder-shared-open\"}\r\n                confirmTooltip={confirmTooltip}\r\n                onCancel={this.onCancel}\r\n                onConfirm={this.onConfirm}\r\n                canConfirm={this.canConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        return (\r\n            <DataAccessComponent\r\n                options={this.state.options}\r\n                onChange={this.onOptionsChange}\r\n                dataSource={this.props.dataSource}\r\n                isLocalDataSource={this.isLocalDataStore}\r\n                temporalCoverage={this.props.temporalCoverage}\r\n                canConstrainTime={this.props.canConstrainTime}\r\n                canConstrainRegion={this.props.canConstrainRegion}\r\n                canConstrainVariables={this.props.canConstrainVariables}\r\n                canCache={this.props.canCache}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(OpenDatasetDialog);\r\n\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { Checkbox } from '@blueprintjs/core';\r\n\r\nimport * as actions from '../actions';\r\nimport LongIdLabel from '../components/LongIdLabel';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as selectors from '../selectors';\r\nimport { DataSourceState, DialogState, State } from '../state';\r\n\r\n\r\ninterface IRemoveDatasetDialogProps {\r\n    isOpen: boolean;\r\n    dataSource: DataSourceState | null;\r\n}\r\n\r\ninterface IRemoveDatasetDialogState extends DialogState {\r\n    removeFiles: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IRemoveDatasetDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(RemoveDatasetDialog.DIALOG_ID)(state);\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n        dataSource: selectors.selectedDataSourceSelector(state),\r\n    };\r\n}\r\n\r\nclass RemoveDatasetDialog extends React.Component<IRemoveDatasetDialogProps & DispatchProp<State>, IRemoveDatasetDialogState> {\r\n    static readonly DIALOG_ID = 'removeDatasetDialog';\r\n\r\n    constructor(props: IRemoveDatasetDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {removeFiles: false};\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onRemoveFilesChange = this.onRemoveFilesChange.bind(this);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IRemoveDatasetDialogProps) {\r\n        this.setState({removeFiles: false});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(RemoveDatasetDialog.DIALOG_ID));\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(RemoveDatasetDialog.DIALOG_ID, this.state));\r\n        this.props.dispatch(actions.removeLocalDataset(this.props.dataSource.id, this.state.removeFiles) as any);\r\n    }\r\n\r\n    private onRemoveFilesChange(ev: any) {\r\n        this.setState({removeFiles: ev.target.checked} as IRemoveDatasetDialogState);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen || !this.props.dataSource) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title=\"Remove Data Source\"\r\n                icon=\"trash\"\r\n                confirmTitle=\"Remove\"\r\n                confirmIconName=\"delete\"\r\n                confirmTooltip=\"Remove the file data source.\"\r\n                onCancel={this.onCancel}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        return (\r\n            <div>\r\n                <LongIdLabel\r\n                    label='You are about to remove the definition for the file data source'\r\n                    longId={this.props.dataSource.id}\r\n                />\r\n\r\n                <Checkbox\r\n                    style={{marginTop: '1em'}} checked={this.state.removeFiles}\r\n                    label=\"Remove data files from disk too\"\r\n                    onChange={this.onRemoveFilesChange}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(RemoveDatasetDialog);\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport {\r\n    ButtonGroup,\r\n    Callout,\r\n    Card,\r\n    Checkbox,\r\n    Classes,\r\n    Collapse,\r\n    HTMLSelect,\r\n    IconName,\r\n    InputGroup,\r\n    Intent,\r\n    Label,\r\n    Popover,\r\n    PopoverInteractionKind,\r\n    Position,\r\n    Tag,\r\n    Tooltip\r\n} from '@blueprintjs/core';\r\n\r\nimport * as actions from '../actions';\r\nimport { ContentWithDetailsPanel } from '../components/ContentWithDetailsPanel';\r\nimport DataSourceDetails from '../components/DataSourceDetails';\r\nimport DataSourcesList from '../components/DataSourcesList';\r\nimport DataSourceOpenHint from '../components/DataSourceOpenHint';\r\nimport Markdown from '../components/Markdown';\r\nimport { ToolButton } from '../components/ToolButton';\r\nimport { DATA_SOURCES_LOADING, NO_DATA_SOURCES_FOUND, NO_DATA_STORES_FOUND, NO_LOCAL_DATA_SOURCES } from '../messages';\r\n\r\nimport * as selectors from '../selectors';\r\nimport { DataSourceState, DataStoreNotice, DataStoreState, State } from '../state';\r\nimport { canOpenDataSource, isLocalDataStore } from '../state-util';\r\nimport AddDatasetDialog from './AddDatasetDialog';\r\nimport OpenDatasetDialog from './OpenDatasetDialog';\r\nimport RemoveDatasetDialog from './RemoveDatasetDialog';\r\n\r\n\r\nconst INTENTS = {\r\n    'default': Intent.NONE,\r\n    'primary': Intent.PRIMARY,\r\n    'success': Intent.SUCCESS,\r\n    'warning': Intent.WARNING,\r\n    'danger': Intent.DANGER,\r\n};\r\n\r\ninterface IDataSourcesPanelProps {\r\n    hasWorkspace: boolean;\r\n    dataStores: Array<DataStoreState>;\r\n    dataSourceFilterExpr: string;\r\n    selectedDataStore: DataStoreState | null;\r\n    selectedDataSource: DataSourceState | null;\r\n    selectedDataSources: DataSourceState[] | null;\r\n    filteredDataSources: DataSourceState[] | null;\r\n    dataSourceListHeight: number;\r\n    showAllDataSources: boolean;\r\n    showDataSourceIDs: boolean;\r\n    showDataSourceDetails: boolean;\r\n    showDataStoreDescription: boolean;\r\n    showDataStoreNotices: boolean;\r\n    offlineMode: boolean;\r\n    isSandboxedMode: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IDataSourcesPanelProps {\r\n    return {\r\n        hasWorkspace: !!selectors.workspaceSelector(state),\r\n        dataStores: selectors.dataStoresSelector(state),\r\n        dataSourceFilterExpr: selectors.dataSourceFilterExprSelector(state),\r\n        selectedDataStore: selectors.selectedDataStoreSelector(state),\r\n        selectedDataSource: selectors.selectedDataSourceSelector(state),\r\n        selectedDataSources: selectors.selectedDataSourcesSelector(state),\r\n        filteredDataSources: selectors.filteredDataSourcesSelector(state),\r\n        dataSourceListHeight: selectors.dataSourceListHeightSelector(state),\r\n        showDataSourceDetails: selectors.showDataSourceDetailsSelector(state),\r\n        showAllDataSources: selectors.showAllDataSourcesSelector(state),\r\n        showDataSourceIDs: selectors.showDataSourceIDsSelector(state),\r\n        showDataStoreDescription: selectors.showDataStoreDescriptionSelector(state),\r\n        showDataStoreNotices: selectors.showDataStoreNoticesSelector(state),\r\n        offlineMode: selectors.offlineModeSelector(state),\r\n        isSandboxedMode: !selectors.isLocalFSAccessAllowedSelector(state),\r\n    };\r\n}\r\n\r\ninterface IDataSourcesPanelDispatch {\r\n    setSelectedDataStoreId(selectedDataStoreId: string): void;\r\n\r\n    setSelectedDataSourceId(selectedDataSourceId: string): void;\r\n\r\n    setDataSourceFilterExpr(dataSourceFilterExpr: string): void;\r\n\r\n    setControlState(propertyName: string, value: any): void;\r\n\r\n    setSessionState(propertyName: string, value: any): void;\r\n\r\n    updateSessionState(sessionState: any): void;\r\n\r\n    loadDataSourceMetaInfo(dataStoreId: string, dataSourceId: string): void;\r\n\r\n    showDialog(dialogId: string): void;\r\n\r\n    hideDialog(dialogId: string): void;\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    setSelectedDataStoreId: actions.setSelectedDataStoreId,\r\n    setSelectedDataSourceId: actions.setSelectedDataSourceId,\r\n    setDataSourceFilterExpr: actions.setDataSourceFilterExpr,\r\n    setSessionState: actions.setSessionProperty,\r\n    setControlState: actions.setControlProperty,\r\n    updateSessionState: actions.updateSessionState,\r\n    showDialog: actions.showDialog,\r\n    hideDialog: actions.hideDialog,\r\n};\r\n\r\n/**\r\n * The DataSourcesPanel is used browse and open data data sources originating from a selected data store.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass DataSourcesPanel extends React.Component<IDataSourcesPanelProps & IDataSourcesPanelDispatch, null> {\r\n\r\n    private static readonly FLEX_ROW_STYLE: CSSProperties = {display: 'flex', alignItems: 'center', marginBottom: 1};\r\n    private static readonly SPACER_STYLE: CSSProperties = {flex: 1};\r\n    private static readonly LABEL_STYLE: CSSProperties = {margin: '0 0.5em 0 0', display: 'flex', flexGrow: 1};\r\n    private static readonly LABEL_TEXT_STYLE: CSSProperties =\r\n        {minWidth: '5em', overflow: 'hidden', whiteSpace: 'nowrap'};\r\n    private static readonly SELECT_STYLE: CSSProperties = {flexGrow: 1};\r\n\r\n    constructor(props: IDataSourcesPanelProps & IDataSourcesPanelDispatch) {\r\n        super(props);\r\n        this.handleAddDatasetDialog = this.handleAddDatasetDialog.bind(this);\r\n        this.handleRemoveDatasetDialog = this.handleRemoveDatasetDialog.bind(this);\r\n        this.handleShowOpenDatasetDialog = this.handleShowOpenDatasetDialog.bind(this);\r\n        this.handleListHeightChanged = this.handleListHeightChanged.bind(this);\r\n        this.handleShowDetailsChanged = this.handleShowDetailsChanged.bind(this);\r\n        this.handleDataStoreSelected = this.handleDataStoreSelected.bind(this);\r\n        this.handleShowDataStoreDescriptionChanged = this.handleShowDataStoreDescriptionChanged.bind(this);\r\n        this.handleShowDataStoreNoticesChanged = this.handleShowDataStoreNoticesChanged.bind(this);\r\n        this.handleShowAllDataSourcesChanged = this.handleShowAllDataSourcesChanged.bind(this);\r\n        this.handleShowDataSourceIDsChanged = this.handleShowDataSourceIDsChanged.bind(this);\r\n    }\r\n\r\n    render() {\r\n        const hasDataStores = this.props.dataStores && this.props.dataStores.length;\r\n        if (!hasDataStores) {\r\n            return this.renderNoDataStoreMessage();\r\n        }\r\n        const hasDataSources = this.props.selectedDataSources && this.props.selectedDataSources.length;\r\n        const selectedDataSource = this.props.selectedDataSource;\r\n        const isLocalStore = isLocalDataStore(this.props.selectedDataStore);\r\n        const canAdd = isLocalStore;\r\n        const canRemove = selectedDataSource && isLocalStore;\r\n        const isNotVerified = selectedDataSource ? !canOpenDataSource(selectedDataSource) : false;\r\n        const canOpen = selectedDataSource && this.props.hasWorkspace && !isNotVerified;\r\n        const actionComponent = (\r\n            <ButtonGroup>\r\n                {isLocalStore && <ToolButton\r\n                    tooltipContent=\"Add data source\"\r\n                    onClick={this.handleAddDatasetDialog}\r\n                    disabled={!canAdd}\r\n                    icon=\"add\"\r\n                    tooltipPosition={'top'}\r\n                />}\r\n                {isLocalStore && <ToolButton\r\n                    tooltipContent=\"Remove data source\"\r\n                    onClick={this.handleRemoveDatasetDialog}\r\n                    disabled={!canRemove}\r\n                    icon=\"trash\"\r\n                    tooltipPosition={'top'}\r\n                />}\r\n                {isNotVerified && (\r\n                    <Popover\r\n                        popoverClassName={Classes.POPOVER_CONTENT_SIZING}\r\n                        enforceFocus={false}\r\n                        interactionKind={PopoverInteractionKind.HOVER}\r\n                        position={Position.TOP}\r\n                    >\r\n                        <ToolButton icon={\"warning-sign\"} intent={Intent.WARNING}/>\r\n                        <DataSourceOpenHint\r\n                            isSandboxedMode={this.props.isSandboxedMode}\r\n                            dataSource={selectedDataSource!}\r\n                        />\r\n                    </Popover>\r\n                )}\r\n                <ToolButton\r\n                    tooltipContent=\"Open data source\"\r\n                    intent={Intent.PRIMARY}\r\n                    onClick={this.handleShowOpenDatasetDialog}\r\n                    disabled={!canOpen}\r\n                    icon={\"folder-shared-open\"}\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <AddDatasetDialog/>\r\n                <RemoveDatasetDialog/>\r\n                <OpenDatasetDialog/>\r\n            </ButtonGroup>\r\n        );\r\n        return (\r\n            <div>\r\n                {this.renderDataStoreSelector()}\r\n                <div style={DataSourcesPanel.FLEX_ROW_STYLE}>\r\n                    <span style={DataSourcesPanel.SPACER_STYLE}/>\r\n                    <Tooltip content={\r\n                        <div>\r\n                            List also datasets that cannot be opened directly.<br/>\r\n                            Usually they can be downloaded manually, then<br/>\r\n                            opened by one of the <code>read_xxx()</code> operations.\r\n                        </div>}>\r\n                        <Checkbox\r\n                            label=\"All data sources\"\r\n                            checked={this.props.showAllDataSources}\r\n                            onChange={this.handleShowAllDataSourcesChanged}\r\n                            style={{marginBottom: 2, marginTop: 6, marginRight: 6}}\r\n                        />\r\n                    </Tooltip>\r\n                    <Checkbox\r\n                        label=\"Show identifiers\"\r\n                        checked={this.props.showDataSourceIDs}\r\n                        onChange={this.handleShowDataSourceIDsChanged}\r\n                        style={{marginBottom: 2, marginTop: 6}}\r\n                    />\r\n                </div>\r\n                {this.renderDataSourceFilterExprInput()}\r\n                <ContentWithDetailsPanel\r\n                    showDetails={this.props.showDataSourceDetails}\r\n                    onShowDetailsChange={this.handleShowDetailsChanged}\r\n                    isSplitPanel={true}\r\n                    contentHeight={this.props.dataSourceListHeight}\r\n                    onContentHeightChange={this.handleListHeightChanged}\r\n                    actionComponent={actionComponent}\r\n                >\r\n                    {hasDataSources\r\n                     ? (<DataSourcesList\r\n                            dataSources={this.props.filteredDataSources}\r\n                            selectedDataSourceId={this.props.selectedDataSource\r\n                                                  ? this.props.selectedDataSource.id\r\n                                                  : null}\r\n                            setSelectedDataSourceId={this.props.setSelectedDataSourceId}\r\n                            showDataSourceIDs={this.props.showDataSourceIDs}\r\n                            doubleClickAction={canOpen ? this.handleShowOpenDatasetDialog : undefined}\r\n                        />)\r\n                     : this.renderNoDataSourcesMessage()\r\n                    }\r\n                    <DataSourceDetails dataSource={this.props.selectedDataSource}/>\r\n                </ContentWithDetailsPanel>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private handleAddDatasetDialog() {\r\n        this.props.showDialog('addDatasetDialog');\r\n    }\r\n\r\n    private handleRemoveDatasetDialog() {\r\n        this.props.showDialog('removeDatasetDialog');\r\n    }\r\n\r\n    private handleShowOpenDatasetDialog() {\r\n        this.props.showDialog('openDatasetDialog');\r\n    }\r\n\r\n    private handleDataStoreSelected(event) {\r\n        const dataStoreId = event.target.value;\r\n        this.props.setSelectedDataStoreId(dataStoreId);\r\n    }\r\n\r\n    private handleListHeightChanged(value: number) {\r\n        this.props.setSessionState('dataSourceListHeight', value);\r\n    }\r\n\r\n    private handleShowDetailsChanged(value: boolean) {\r\n        this.props.setSessionState('showDataSourceDetails', value);\r\n    }\r\n\r\n    private handleShowDataStoreDescriptionChanged() {\r\n        this.props.updateSessionState({showDataStoreDescription: !this.props.showDataStoreDescription});\r\n    }\r\n\r\n    private handleShowDataStoreNoticesChanged() {\r\n        this.props.updateSessionState({showDataStoreNotices: !this.props.showDataStoreNotices});\r\n    }\r\n\r\n    private handleShowAllDataSourcesChanged(ev: any) {\r\n        this.props.updateSessionState({showAllDataSources: ev.target.checked});\r\n    }\r\n\r\n    private handleShowDataSourceIDsChanged(ev: any) {\r\n        this.props.updateSessionState({showDataSourceIDs: ev.target.checked});\r\n    }\r\n\r\n    private renderDataSourceFilterExprInput() {\r\n        const resultsTag = (\r\n            <Tag className={Classes.MINIMAL} onRemove={() => this.props.setDataSourceFilterExpr('')}>\r\n                {this.props.filteredDataSources && this.props.filteredDataSources.length}\r\n            </Tag>\r\n        );\r\n\r\n        return (\r\n            <div style={{paddingBottom: 2}}>\r\n                <InputGroup\r\n                    disabled={false}\r\n                    leftIcon=\"filter\"\r\n                    onChange={(event) => this.props.setDataSourceFilterExpr(event.target.value)}\r\n                    placeholder=\"Find data source\"\r\n                    rightElement={resultsTag}\r\n                    value={this.props.dataSourceFilterExpr}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderDataStoreSelector() {\r\n        if (!this.props.dataStores || !this.props.dataStores.length) {\r\n            return null;\r\n        }\r\n\r\n        const dataStoreOptions = [];\r\n        for (let dataStore of this.props.dataStores) {\r\n            dataStoreOptions.push(\r\n                <option key={dataStore.id} value={dataStore.id}>{dataStore.title || dataStore.id}</option>\r\n            );\r\n        }\r\n\r\n        const {selectedDataStore, showDataStoreDescription, /*showDataStoreNotices*/} = this.props;\r\n\r\n        const hasDataStoreDescription = selectedDataStore && selectedDataStore.description;\r\n        const hasDataStoreNotices = selectedDataStore && selectedDataStore.notices && selectedDataStore.notices.length;\r\n\r\n        let dataStoreDescriptionElement;\r\n        if (hasDataStoreDescription) {\r\n            dataStoreDescriptionElement = (\r\n                <Collapse isOpen={showDataStoreDescription}>\r\n                    <Card>\r\n                        <Markdown source={selectedDataStore.description}/>\r\n                    </Card>\r\n                </Collapse>\r\n            );\r\n        }\r\n\r\n        // let dataStoreNoticesElement;\r\n        if (hasDataStoreNotices) {\r\n            const callouts = [];\r\n            selectedDataStore.notices.forEach((notice: DataStoreNotice) => {\r\n                callouts.push(\r\n                    <div key={notice.id} style={{margin: '0 4px 4px 4px'}}>\r\n                        <Callout\r\n                            title={notice.title}\r\n                            icon={notice.icon as IconName}\r\n                            intent={notice.intent in INTENTS ? INTENTS[notice.intent] : Intent.NONE}\r\n                        >\r\n                            <Markdown source={notice.content}/>\r\n                        </Callout>\r\n                    </div>\r\n                );\r\n            });\r\n            // dataStoreNoticesElement = (<Collapse isOpen={showDataStoreNotices}>{callouts}</Collapse>);\r\n        }\r\n\r\n        // TODO (forman): BP3: use new Select component\r\n\r\n        //  a label has by default a 15px margin at the bottom\r\n        return (\r\n            <React.Fragment>\r\n                <div style={DataSourcesPanel.FLEX_ROW_STYLE}>\r\n                    <Label className=\"bp3-inline\"\r\n                           style={DataSourcesPanel.LABEL_STYLE}>\r\n                        <span style={DataSourcesPanel.LABEL_TEXT_STYLE}>Data store:</span>\r\n                        <HTMLSelect\r\n                            fill={true}\r\n                            style={DataSourcesPanel.SELECT_STYLE}\r\n                            value={selectedDataStore ? selectedDataStore.id : ''}\r\n                            onChange={this.handleDataStoreSelected}\r\n                        >\r\n                            {dataStoreOptions}\r\n                        </HTMLSelect>\r\n                    </Label>\r\n                    <ButtonGroup>\r\n                        <ToolButton\r\n                            tooltipContent=\"Show/hide data store description\"\r\n                            onClick={this.handleShowDataStoreDescriptionChanged}\r\n                            disabled={!hasDataStoreDescription}\r\n                            active={showDataStoreDescription}\r\n                            icon=\"help\"\r\n                            tooltipPosition={'top'}\r\n                        />\r\n                        {/*This was an ESA requirement long time ago. It may no longer apply.*/}\r\n                        {/*<ToolButton*/}\r\n                        {/*    tooltipContent=\"Show/hide data store notices\"*/}\r\n                        {/*    onClick={this.handleShowDataStoreNoticesChanged}*/}\r\n                        {/*    disabled={!hasDataStoreNotices}*/}\r\n                        {/*    active={showDataStoreNotices}*/}\r\n                        {/*    icon=\"notifications\"*/}\r\n                        {/*    tooltipPosition={'top'}*/}\r\n                        {/*/>*/}\r\n                    </ButtonGroup>\r\n                </div>\r\n\r\n                {dataStoreDescriptionElement}\r\n\r\n                {/*This was an ESA requirement long time ago. It may no longer apply.*/}\r\n                {/*{dataStoreNoticesElement}*/}\r\n\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderNoDataStoreMessage() {\r\n        return NO_DATA_STORES_FOUND;\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderNoDataSourcesMessage() {\r\n        const selectedDataStore = this.props.selectedDataStore;\r\n        if (isLocalDataStore(selectedDataStore)) {\r\n            return NO_LOCAL_DATA_SOURCES;\r\n        } else {\r\n            const selectedDataSources = this.props.selectedDataSources;\r\n            if (selectedDataSources === null) {\r\n                return DATA_SOURCES_LOADING;\r\n            } else {\r\n                return NO_DATA_SOURCES_FOUND;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DataSourcesPanel as any);\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport {\r\n    ButtonGroup,\r\n    Classes,\r\n    InputGroup,\r\n    Intent,\r\n    Menu,\r\n    MenuItem,\r\n    Popover,\r\n    PopoverInteractionKind,\r\n    Tag\r\n} from '@blueprintjs/core';\r\nimport { ContentWithDetailsPanel } from '../components/ContentWithDetailsPanel';\r\nimport { LabelWithType } from '../components/LabelWithType';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { Card } from '@blueprintjs/core';\r\nimport Markdown from '../components/Markdown';\r\nimport OperationStepDialog from './OperationStepDialog';\r\nimport { OperationInputState, OperationOutputState, OperationState, State, WorkspaceState } from '../state';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\nimport { NO_OPERATIONS_FOUND } from '../messages';\r\nimport { ToolButton } from '../components/ToolButton';\r\nimport { NEW_OPERATION_STEP_DIALOG_ID } from './operation-step-dialog-ids';\r\n\r\n\r\ninterface IOperationsPanelProps {\r\n    workspace: WorkspaceState;\r\n    operations: OperationState[] | null;\r\n    selectedOperationName: string | null;\r\n    selectedOperation: OperationState | null;\r\n    filteredOperations: OperationState[];\r\n    operationFilterTags: string[];\r\n    operationFilterExpr: string | null;\r\n    operationsTagCounts: Map<string, number>,\r\n    operationListHeight: number;\r\n    showOperationDetails: boolean;\r\n}\r\n\r\n\r\nfunction mapStateToProps(state: State): IOperationsPanelProps {\r\n    return {\r\n        workspace: state.data.workspace,\r\n        operations: selectors.operationsSelector(state),\r\n        selectedOperation: selectors.selectedOperationSelector(state),\r\n        filteredOperations: selectors.filteredOperationsSelector(state),\r\n        selectedOperationName: selectors.selectedOperationNameSelector(state),\r\n        operationFilterTags: selectors.operationFilterTagsSelector(state) || selectors.EMPTY_ARRAY,\r\n        operationFilterExpr: selectors.operationFilterExprSelector(state),\r\n        operationsTagCounts: selectors.operationsTagCountsSelector(state),\r\n        operationListHeight: state.session.operationListHeight,\r\n        showOperationDetails: state.session.showOperationDetails,\r\n    };\r\n}\r\n\r\nconst OP_CARD_STYLE = {margin: 6, padding: 10};\r\n\r\n/**\r\n * The OperationsPanel is used to select and browse available operations.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass OperationsPanel extends React.Component<IOperationsPanelProps & DispatchProp<State>, any> {\r\n\r\n    constructor(props: IOperationsPanelProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.handleOperationSelection = this.handleOperationSelection.bind(this);\r\n        this.handleOperationFilterExprCleared = this.handleOperationFilterExprCleared.bind(this);\r\n        this.handleOperationFilterExprChange = this.handleOperationFilterExprChange.bind(this);\r\n        this.handleListHeightChanged = this.handleListHeightChanged.bind(this);\r\n        this.handleShowDetailsChanged = this.handleShowDetailsChanged.bind(this);\r\n        this.handleAddOperationStepButtonClicked = this.handleAddOperationStepButtonClicked.bind(this);\r\n    }\r\n\r\n    private static getItemKey(operation: OperationState) {\r\n        return operation.name;\r\n    }\r\n\r\n    private static renderItem(operation: OperationState) {\r\n        const name = operation.name;\r\n        let dataType;\r\n        if (!operation.outputs.length) {\r\n            dataType = '';\r\n        } else if (operation.outputs.length === 1) {\r\n            dataType = operation.outputs[0].dataType;\r\n        } else {\r\n            dataType = `${operation.outputs.length} types`;\r\n        }\r\n        return (<LabelWithType label={name} dataType={dataType}/>);\r\n    }\r\n\r\n    private static formatPortDescriptionText(description) {\r\n        if (!description || description === '') {\r\n            return description;\r\n        }\r\n        description = description.trim();\r\n        if (!description.endsWith('.')) {\r\n            description += '.';\r\n        }\r\n        return ' - ' + description;\r\n    }\r\n\r\n    private static getInputDescriptionText(input: OperationInputState) {\r\n        let description = OperationsPanel.formatPortDescriptionText(input.description);\r\n        if (typeof (input.defaultValue) === 'undefined') {\r\n            description += ' Mandatory value.';\r\n        } else {\r\n            description += ` Default value is \"${input.defaultValue}\".`\r\n        }\r\n        return description;\r\n    }\r\n\r\n    private static getOutputDescriptionText(output: OperationOutputState) {\r\n        return OperationsPanel.formatPortDescriptionText(output.description);\r\n    }\r\n\r\n    private static getMultiplicityText(n: number, singularText: string, pluralText?: string): string {\r\n        return n === 1 ? singularText : (pluralText || singularText + 's');\r\n    }\r\n\r\n    render() {\r\n        const operations = this.props.operations;\r\n        let body;\r\n        if (operations && operations.length) {\r\n            const operationFilterExpr = this.props.operationFilterExpr;\r\n            const operationTagFilterPanel = this.renderOperationTagFilterPanel();\r\n            const operationsList = this.renderOperationsList();\r\n            const operationDetailsCard = this.renderOperationDetailsCard();\r\n\r\n            const resultsTag = (\r\n                <Tag className={Classes.MINIMAL} onRemove={this.handleOperationFilterExprCleared}>\r\n                    {this.props.filteredOperations.length}\r\n                </Tag>\r\n            );\r\n\r\n            const operationFilterExprInput = (\r\n                <InputGroup\r\n                    disabled={false}\r\n                    leftIcon=\"filter\"\r\n                    onChange={this.handleOperationFilterExprChange}\r\n                    placeholder=\"Find operation\"\r\n                    rightElement={resultsTag}\r\n                    value={operationFilterExpr}\r\n                />\r\n            );\r\n\r\n            const canAddStepOperation = this.props.selectedOperation && this.props.workspace;\r\n            const actionComponent = (\r\n                <ButtonGroup>\r\n                    <ToolButton\r\n                        tooltipContent={<span>Add a new operation step to<br/>the workspace's workflow</span>}\r\n                        intent={Intent.PRIMARY}\r\n                        onClick={this.handleAddOperationStepButtonClicked}\r\n                        disabled={!canAddStepOperation}\r\n                        text=\"Add Step...\"\r\n                        icon=\"play\"\r\n                        tooltipPosition={'top'}\r\n                    />\r\n                    {canAddStepOperation ? <OperationStepDialog id={NEW_OPERATION_STEP_DIALOG_ID}/> : null}\r\n                </ButtonGroup>\r\n            );\r\n\r\n            body = (<div>\r\n                {operationFilterExprInput}\r\n                {operationTagFilterPanel}\r\n                <ContentWithDetailsPanel showDetails={this.props.showOperationDetails}\r\n                                         onShowDetailsChange={this.handleShowDetailsChanged}\r\n                                         isSplitPanel={true}\r\n                                         contentHeight={this.props.operationListHeight}\r\n                                         onContentHeightChange={this.handleListHeightChanged}\r\n                                         actionComponent={actionComponent}>\r\n                    {operationsList}\r\n                    {operationDetailsCard}\r\n                </ContentWithDetailsPanel>\r\n            </div>);\r\n        } else {\r\n            body = this.renderNoOperationsMessage();\r\n        }\r\n        return body;\r\n    }\r\n\r\n    private handleListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.setSessionProperty('operationListHeight', value));\r\n    }\r\n\r\n    private handleShowDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.setSessionProperty('showOperationDetails', value));\r\n    }\r\n\r\n    private handleOperationSelection(newSelection: Array<React.Key>) {\r\n        if (newSelection.length > 0) {\r\n            this.props.dispatch(actions.setSelectedOperationName(newSelection[0] as string));\r\n        } else {\r\n            this.props.dispatch(actions.setSelectedOperationName(null));\r\n        }\r\n    }\r\n\r\n    private handleOperationFilterExprCleared() {\r\n        this.props.dispatch(actions.setOperationFilterExpr(''));\r\n    }\r\n\r\n    private handleOperationFilterExprChange(event) {\r\n        this.props.dispatch(actions.setOperationFilterExpr(event.target.value));\r\n    }\r\n\r\n    private handleAddOperationStepButtonClicked() {\r\n        this.props.dispatch(actions.showOperationStepDialog('newOperationStepDialog'));\r\n    }\r\n\r\n    private renderOperationsList() {\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox items={this.props.filteredOperations}\r\n                         getItemKey={OperationsPanel.getItemKey}\r\n                         renderItem={OperationsPanel.renderItem}\r\n                         selectionMode={ListBoxSelectionMode.SINGLE}\r\n                         selection={this.props.selectedOperationName}\r\n                         onSelection={this.handleOperationSelection}\r\n                         onItemDoubleClick={this.handleAddOperationStepButtonClicked}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderOperationTagFilterPanel() {\r\n        const selectedOperationTags = new Set(this.props.operationFilterTags);\r\n        const tagCounts = this.props.operationsTagCounts;\r\n\r\n        const tagContainerStyle = {padding: '0.2em', display: 'flex', alignItems: 'center'};\r\n        const tagStyle = {\r\n            marginRight: '0.2em', marginTop: '0',\r\n            marginBottom: '0', paddingTop: '0', paddingBottom: '0',\r\n            height: '4ex'\r\n        };\r\n\r\n        let selectedTagItems = [];\r\n        selectedOperationTags.forEach(tagName => {\r\n            selectedTagItems.push(\r\n                <Tag intent={Intent.PRIMARY}\r\n                     minimal={true}\r\n                     style={tagStyle}\r\n                     onRemove={() => this.removeTagName(tagName)}>\r\n                    {`${tagName}`}\r\n                </Tag>);\r\n        });\r\n\r\n        let tagMenuItems = [];\r\n        tagCounts.forEach((tagCount, tagName) => {\r\n            if (!selectedOperationTags.has(tagName)) {\r\n                tagMenuItems.push(\r\n                    <MenuItem key={tagName} text={`${tagName} (${tagCount})`}\r\n                              onClick={() => this.addTagName(tagName)}/>);\r\n            }\r\n        });\r\n\r\n        let addTagButton = null;\r\n        if (tagMenuItems.length) {\r\n            const tagMenu = (<Menu>{tagMenuItems}</Menu>);\r\n            addTagButton = (\r\n                <Popover content={tagMenu}\r\n                         interactionKind={PopoverInteractionKind.CLICK}>\r\n                    <Tag intent={Intent.SUCCESS} minimal={true} icon=\"small-plus\" style={tagStyle}/>\r\n                </Popover>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div style={tagContainerStyle}>\r\n                {addTagButton}{selectedTagItems}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private addTagName(tagName: string) {\r\n        const tags = new Set<string>(this.props.operationFilterTags);\r\n        tags.add(tagName);\r\n        this.props.dispatch(actions.setOperationFilterTags(Array.from(tags)));\r\n    }\r\n\r\n    private removeTagName(tagName: string) {\r\n        const tags = new Set<string>(this.props.operationFilterTags);\r\n        tags.delete(tagName);\r\n        this.props.dispatch(actions.setOperationFilterTags(Array.from(tags)));\r\n    }\r\n\r\n    private renderOperationDetailsCard() {\r\n        const operation = this.props.selectedOperation;\r\n        let title = 'No selection';\r\n        let description = null;\r\n        let tags = null;\r\n        let inputs = null;\r\n        let outputs = null;\r\n        if (operation) {\r\n            title = operation.name;\r\n\r\n            if (operation.description) {\r\n                description = (\r\n                    <p className=\"user-selectable\">\r\n                        <Markdown source={operation.description}/>\r\n                    </p>);\r\n            }\r\n\r\n            if (operation.tags) {\r\n                tags = (<p><strong>Tags:</strong> {operation.tags.join(', ')}</p>);\r\n            }\r\n\r\n            if (operation.outputs && operation.outputs.length) {\r\n                const outputElems = operation.outputs.map(output => (\r\n                    <li key={output.name}>\r\n                        <LabelWithType label={output.name} em dataType={output.dataType} units={output.units}/>\r\n                        <Markdown source={OperationsPanel.getOutputDescriptionText(output)}/>\r\n                    </li>\r\n                ));\r\n                outputs = (\r\n                    <div>\r\n                        <p>\r\n                            <strong>{OperationsPanel.getMultiplicityText(operation.outputs.length, 'Output') + ':'}</strong>\r\n                        </p>\r\n                        <ul>{outputElems}</ul>\r\n                    </div>\r\n                );\r\n            }\r\n\r\n\r\n            if (operation.inputs && operation.inputs.length) {\r\n                const inputElems = operation.inputs.map(input => (\r\n                    <li key={input.name}>\r\n                        <LabelWithType label={input.name} em dataType={input.dataType} units={input.units}/>\r\n                        <Markdown source={OperationsPanel.getInputDescriptionText(input)}/>\r\n                    </li>\r\n                ));\r\n                inputs = (\r\n                    <div>\r\n                        <p>\r\n                            <strong>{OperationsPanel.getMultiplicityText(operation.outputs.length, 'Input') + ':'}</strong>\r\n                        </p>\r\n                        <ul>{inputElems}</ul>\r\n                    </div>\r\n                );\r\n            }\r\n        }\r\n\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <Card elevation={2} style={OP_CARD_STYLE}>\r\n                    <h3 className=\"user-selectable\">{title}</h3>\r\n                    {description}\r\n                    {tags}\r\n                    {outputs}\r\n                    {inputs}\r\n                </Card>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderNoOperationsMessage() {\r\n        return NO_OPERATIONS_FOUND;\r\n    }\r\n\r\n}\r\n\r\nexport default connect(mapStateToProps)(OperationsPanel);\r\n","import * as React from 'react';\nimport { connect, Dispatch } from 'react-redux';\nimport { Button, Classes, Dialog, Icon, IconName, Intent, ProgressBar } from '@blueprintjs/core';\n\nimport { State, WebAPIServiceInfo, WebAPIStatus } from '../state';\n\n\ninterface IDispatch {\n    dispatch: Dispatch<State>;\n}\n\ninterface IWebAPIStatusBoxProps {\n    webAPIStatus: WebAPIStatus | null;\n    webAPIServiceInfo: WebAPIServiceInfo | null;\n    username?: string | null;\n}\n\nfunction mapStateToProps(state: State): IWebAPIStatusBoxProps {\n    return {\n        webAPIStatus: state.communication.webAPIStatus,\n        webAPIServiceInfo: state.communication.webAPIServiceInfo,\n    };\n}\n\nconst _WebAPIStatusBox: React.FC<IWebAPIStatusBoxProps & IDispatch> = (\n    {\n        webAPIStatus,\n        webAPIServiceInfo,\n    }) => {\n\n    const reload = () => {\n        window.location.reload();\n    };\n\n    switch (webAPIStatus) {\n        case 'open':\n            return null;\n        case 'login':\n            return (<StatusBox\n                message={'Logging in...'}\n                icon=\"log-in\"\n                isWaiting={true}\n            />);\n        case 'launching':\n            return (<StatusBox\n                message={'Launching Cate service...'}\n                icon=\"log-in\"\n                isWaiting={true}\n            />);\n        case 'connecting':\n            return (<StatusBox\n                message={'Connecting to Cate service...'}\n                icon=\"log-in\"\n                isWaiting={true}\n            />);\n        case 'shuttingDown':\n            return (<StatusBox\n                message={'Shutting down Cate service...'}\n                icon=\"log-out\"\n                isWaiting={true}\n            />);\n        case 'loggingOut':\n            return (<StatusBox\n                message={'Logging out...'}\n                icon=\"log-out\"\n                isWaiting={true}\n            />);\n        case 'closed':\n            const autoStopInfo = webAPIServiceInfo.autoStopInfo;\n            let message: string;\n            if (autoStopInfo\n                && autoStopInfo.inactivityTime >= autoStopInfo.availableTime - 5) {\n                message = 'Cate service has been shut down due to inactivity. ' +\n                          'Press \"Retry\" to try reconnecting.';\n                return (<StatusBox\n                    message={message}\n                    icon=\"offline\"\n                    isWaiting={false}\n                    onRetry={reload}\n                />);\n            } else {\n                message = 'The connection to the Cate service has been closed unexpectedly.';\n                return (<ErrorBox\n                    message={message}\n                    icon=\"offline\"\n                    onRetry={reload}\n                />);\n            }\n        case 'error':\n            return (<ErrorBox\n                message={'Oops! An error occurred while launching or connecting the Cate service.'}\n                icon=\"offline\"\n                onRetry={reload}\n            />);\n        default:\n            return (<ErrorBox\n                message={'Oops! No service available.'}\n                icon=\"offline\"\n            />);\n    }\n};\n\nconst WebAPIStatusBox = connect(mapStateToProps)(_WebAPIStatusBox);\nexport default WebAPIStatusBox;\n\n\n//////////////////////////////////////////////////////////////////////////////\n\ninterface IStatusBoxProps {\n    message: React.ReactNode;\n    icon: IconName;\n    isWaiting?: boolean;\n    onRetry?: () => void;\n    onCancel?: () => void;\n}\n\nconst DIALOG_P_STYLE: React.CSSProperties = {marginTop: 12};\nconst DIALOG_ICON_STYLE: React.CSSProperties = {marginTop: 6, textAlign: 'center', width: '100%'};\n\nconst StatusBox: React.FC<IStatusBoxProps> = ({\n                                                  message,\n                                                  icon,\n                                                  isWaiting,\n                                                  onRetry,\n                                                  onCancel,\n                                              }) => {\n\n    let progress;\n    if (isWaiting) {\n        progress = (<div style={DIALOG_P_STYLE}><ProgressBar intent={Intent.SUCCESS}/></div>);\n    }\n    let footer;\n    if (onRetry || onCancel) {\n        let cancelButton = onCancel ? (<Button onClick={onCancel} intent={Intent.PRIMARY}>Cancel</Button>) : null;\n        let retryButton = onRetry ? (<Button onClick={onRetry}>Retry</Button>) : null;\n        footer = (\n            <div className={Classes.DIALOG_FOOTER}>\n                <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n                    {cancelButton}\n                    {retryButton}\n                </div>\n            </div>\n        );\n    }\n    return (\n        <Dialog\n            isOpen={true}\n            canEscapeKeyClose={false}\n            canOutsideClickClose={false}\n        >\n            <div className={Classes.DIALOG_BODY}>\n                <div style={DIALOG_ICON_STYLE}><Icon icon={icon} iconSize={32}/></div>\n                <div style={DIALOG_P_STYLE}>{message}</div>\n                {progress}\n            </div>\n            {footer}\n        </Dialog>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////\n\ninterface IErrorBoxProps extends IStatusBoxProps {\n    username?: string;\n}\n\nconst ErrorBox: React.FC<IErrorBoxProps> = (\n    {\n        message,\n        icon,\n        isWaiting,\n        onRetry,\n        onCancel,\n    }\n) => {\n    return (<StatusBox\n        message={message}\n        icon={icon}\n        isWaiting={isWaiting}\n        onRetry={onRetry}\n        onCancel={onCancel}\n    />);\n};\n","import * as React from 'react';\r\nimport { DialogState, ResourceState, State, WorkflowStepState } from '../state';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport * as assert from '../../common/assert';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { Checkbox, InputGroup, Label } from '@blueprintjs/core';\r\n\r\nconst DIALOG_ID = 'workflowStepPropertiesDialog';\r\nconst DIALOG_TITLE = 'Workflow Step & Resource Properties';\r\n\r\ninterface IResourcePropertiesDialogOwnProps {\r\n    selectedWorkflowStep: WorkflowStepState;\r\n}\r\n\r\ninterface IWorkflowStepPropertiesDialogProps extends IResourcePropertiesDialogOwnProps, DialogState {\r\n    resources: ResourceState[];\r\n}\r\n\r\ninterface IWorkflowStepPropertiesDialogState {\r\n    stepId: string;\r\n    stepPersistent: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IResourcePropertiesDialogOwnProps): IWorkflowStepPropertiesDialogProps {\r\n    return {\r\n        selectedWorkflowStep: ownProps.selectedWorkflowStep,\r\n        isOpen: selectors.dialogStateSelector(DIALOG_ID)(state).isOpen,\r\n        resources: selectors.resourcesSelector(state),\r\n    };\r\n}\r\n\r\nclass WorkflowStepPropertiesDialog extends React.Component<IWorkflowStepPropertiesDialogProps & DispatchProp<State>, IWorkflowStepPropertiesDialogState> {\r\n\r\n    constructor(props: IWorkflowStepPropertiesDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.state = WorkflowStepPropertiesDialog.mapPropsToState(props);\r\n    }\r\n\r\n    private static mapPropsToState(props: IWorkflowStepPropertiesDialogProps) {\r\n        const step = props.selectedWorkflowStep;\r\n        assert.ok(step);\r\n        return {\r\n            stepId: step.id || '',\r\n            stepPersistent: step.persistent || false,\r\n        };\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IWorkflowStepPropertiesDialogProps): void {\r\n        this.setState(WorkflowStepPropertiesDialog.mapPropsToState(nextProps));\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(DIALOG_ID));\r\n\r\n        const oldStepId = this.props.selectedWorkflowStep.id || '';\r\n        const newStepId = this.state.stepId ? this.state.stepId.trim() : '';\r\n        const oldStepPersistent = this.props.selectedWorkflowStep.persistent || false;\r\n        const newStepPersistent = this.state.stepPersistent || false;\r\n\r\n        if (oldStepPersistent !== newStepPersistent) {\r\n            this.props.dispatch(actions.setWorkspaceResourcePersistence(oldStepId, newStepPersistent) as any);\r\n        }\r\n        if (oldStepId !== newStepId) {\r\n            this.props.dispatch(actions.renameWorkspaceResource(oldStepId, newStepId) as any);\r\n        }\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(DIALOG_ID));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        const oldStepId = this.props.selectedWorkflowStep.id || '';\r\n        const newStepId = this.state.stepId ? this.state.stepId.trim() : '';\r\n        const oldStepPersistent = this.props.selectedWorkflowStep.persistent || false;\r\n        const newStepPersistent = this.state.stepPersistent || false;\r\n        const newStepIdIsValid = /^[a-zA-z_][a-zA-z0-9_]*$/.test(newStepId);\r\n        return newStepId !== '' && (newStepId !== oldStepId || newStepPersistent !== oldStepPersistent) && newStepIdIsValid;\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        return (\r\n            <ModalDialog\r\n                isOpen={this.props.isOpen}\r\n                title={DIALOG_TITLE}\r\n                icon=\"edit\"\r\n                onCancel={this.onCancel}\r\n                onConfirm={this.onConfirm}\r\n                canConfirm={this.canConfirm}\r\n                renderBody={this.renderBody}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <div style={{width: '100%', padding: 6}}>\r\n                <Label>\r\n                    Resource name\r\n                    <span className=\"bp3-text-muted\"> (must be unique within the workspace)</span>\r\n                    <InputGroup\r\n                        style={{width: '100%'}}\r\n                        type=\"text\"\r\n                        value={this.state.stepId}\r\n                        onChange={(ev: any) => this.setState({stepId: ev.target.value})}\r\n                    />\r\n                    <span className=\"bp3-text-muted\">The Resource name must only contain the uppercase and lowercase letters A through Z,\r\n                        the underscore _ and, except for the first character, the digits 0 through 9.</span>\r\n                </Label>\r\n\r\n                <div style={{paddingTop: 10}}>\r\n                    <Checkbox checked={this.state.stepPersistent}\r\n                              onChange={(ev: any) => this.setState({stepPersistent: ev.target.checked})}\r\n                              label=\"Persist resulting resource\"\r\n                    />\r\n                    <span className=\"bp3-text-muted\">If checked, the resource will be read from a file in the workspac next time the workspace is opened.\r\n                        This usually speeds up the loading of workspace, but requires extra disk space.</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(WorkflowStepPropertiesDialog);\r\n\r\n","import * as React from 'react';\r\nimport {CSSProperties} from 'react';\r\nimport {connect, DispatchProp} from 'react-redux';\r\nimport {\r\n    ButtonGroup,\r\n    Icon,\r\n    Intent,\r\n    Menu,\r\n    MenuItem,\r\n    Popover,\r\n    PopoverPosition,\r\n    Tab,\r\n    Tabs,\r\n    Tooltip\r\n} from '@blueprintjs/core';\r\nimport {Cell, Column, Table, TruncatedFormat, TruncatedPopoverMode} from '@blueprintjs/table';\r\n\r\nimport {ListBox} from '../components/ListBox';\r\nimport {LabelWithType} from '../components/LabelWithType';\r\nimport WorkflowStepPropertiesDialog from './WorkflowStepPropertiesDialog';\r\nimport OperationStepDialog from './OperationStepDialog';\r\nimport {ContentWithDetailsPanel} from '../components/ContentWithDetailsPanel';\r\nimport * as assert from '../../common/assert';\r\nimport * as actions from '../actions'\r\nimport * as selectors from '../selectors'\r\nimport {\r\n    OperationInputState,\r\n    OperationIOBaseState,\r\n    OperationState,\r\n    ResourceState,\r\n    State,\r\n    WorkflowPortState,\r\n    WorkflowStepState,\r\n    WorkspacePanelMode,\r\n    WorkspaceState\r\n} from '../state';\r\nimport {ScrollablePanelContent} from '../components/ScrollableContent';\r\nimport {NO_WORKFLOW_STEPS, NO_WORKSPACE, NO_WORKSPACE_RESOURCES} from '../messages';\r\nimport {findOperation, isDataFrameResource, isFigureResource} from '../state-util';\r\nimport {isBoolean, isDefined, isString, isUndefined, isUndefinedOrNull} from '../../common/types';\r\nimport {ToolButton} from '../components/ToolButton';\r\nimport {EDIT_OPERATION_STEP_DIALOG_ID} from './operation-step-dialog-ids';\r\n\r\n\r\ninterface IWorkspacePanelProps {\r\n    workspace: WorkspaceState;\r\n    resourcesMap: { [name: string]: ResourceState };\r\n    resourceListHeight: number;\r\n    showResourceDetails: boolean;\r\n    selectedResource: ResourceState | null;\r\n    selectedResourceAttributes: string[][];\r\n    selectedResourceName: string | null;\r\n    selectedResourceWorkflowStep: WorkflowStepState | null;\r\n    workflowStepListHeight: number;\r\n    showWorkflowStepDetails: boolean;\r\n    selectedWorkflowStep: WorkflowStepState | null;\r\n    selectedWorkflowStepId: string | null;\r\n    selectedWorkflowStepOp: OperationState | null;\r\n    selectedWorkflowStepResource: ResourceState | null;\r\n    activeViewId: string | null;\r\n    workspacePanelMode: 'resources' | 'steps';\r\n    operations: OperationState[];\r\n}\r\n\r\nfunction mapStateToProps(state: State): IWorkspacePanelProps {\r\n    return {\r\n        workspace: selectors.workspaceSelector(state),\r\n        resourcesMap: selectors.resourceMapSelector(state),\r\n        resourceListHeight: selectors.resourceListHeightSelector(state),\r\n        showResourceDetails: selectors.showResourceDetailsSelector(state),\r\n        selectedResource: selectors.selectedResourceSelector(state),\r\n        selectedResourceAttributes: selectors.selectedResourceAttributesSelector(state),\r\n        selectedResourceName: selectors.selectedResourceNameSelector(state),\r\n        selectedResourceWorkflowStep: selectors.selectedResourceWorkflowStepSelector(state),\r\n        workflowStepListHeight: selectors.workflowStepListHeightSelector(state),\r\n        showWorkflowStepDetails: selectors.showWorkflowStepDetailsSelector(state),\r\n        selectedWorkflowStep: selectors.selectedWorkflowStepSelector(state),\r\n        selectedWorkflowStepId: selectors.selectedWorkflowStepIdSelector(state),\r\n        selectedWorkflowStepOp: selectors.selectedWorkflowStepOpSelector(state),\r\n        selectedWorkflowStepResource: selectors.selectedWorkflowStepResourceSelector(state),\r\n        activeViewId: selectors.activeViewIdSelector(state),\r\n        workspacePanelMode: state.session.workspacePanelMode,\r\n        operations: selectors.operationsSelector(state),\r\n    };\r\n}\r\n\r\n/**\r\n * The WorkspacePanel lets user browse the currently opened workspace.\r\n * It comprises the workspace files, and the workflow which is subdivided into\r\n * workspace resources and workspace steps (operations).\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass WorkspacePanel extends React.PureComponent<IWorkspacePanelProps & DispatchProp<State>, any> {\r\n\r\n    private static readonly STATE_TAG_STYLE: CSSProperties = {margin: 2};\r\n    private static readonly FLEX_ROW_STYLE: CSSProperties = {display: 'flex', alignItems: 'center'};\r\n    private static readonly SPACER_STYLE: CSSProperties = {flex: 1};\r\n\r\n    constructor(props: IWorkspacePanelProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.handleResourceListHeightChanged = this.handleResourceListHeightChanged.bind(this);\r\n        this.handleShowResourceDetailsChanged = this.handleShowResourceDetailsChanged.bind(this);\r\n        this.handleResourceNameSelected = this.handleResourceNameSelected.bind(this);\r\n        this.handleStepListHeightChanged = this.handleStepListHeightChanged.bind(this);\r\n        this.handleShowWorkflowStepDetailsChanged = this.handleShowWorkflowStepDetailsChanged.bind(this);\r\n        this.handleWorkflowStepIdSelected = this.handleWorkflowStepIdSelected.bind(this);\r\n        this.handleShowFigureButtonClicked = this.handleShowFigureButtonClicked.bind(this);\r\n        this.handleWorkflowStepPropertiesButtonClicked = this.handleWorkflowStepPropertiesButtonClicked.bind(this);\r\n        this.handleOpenWorkspaceDirectoryClicked = this.handleOpenWorkspaceDirectoryClicked.bind(this);\r\n        this.handleEditOperationStepButtonClicked = this.handleEditOperationStepButtonClicked.bind(this);\r\n        this.renderStepItem = this.renderStepItem.bind(this);\r\n        this.renderResourceAttrName = this.renderResourceAttrName.bind(this);\r\n        this.renderResourceAttrValue = this.renderResourceAttrValue.bind(this);\r\n        this.renderOperationStepInputName = this.renderOperationStepInputName.bind(this);\r\n        this.renderOperationStepInputValue = this.renderOperationStepInputValue.bind(this);\r\n        this.renderOperationStepOutputName = this.renderOperationStepOutputName.bind(this);\r\n        this.renderOperationStepOutputValue = this.renderOperationStepOutputValue.bind(this);\r\n        this.handleWorkspacePanelModeChanged = this.handleWorkspacePanelModeChanged.bind(this);\r\n        this.handleRemoveOperationStepButtonClicked = this.handleRemoveOperationStepButtonClicked.bind(this);\r\n        this.handleCleanWorkflowButtonClicked = this.handleCleanWorkflowButtonClicked.bind(this);\r\n        this.handleShowResourceTableView = this.handleShowResourceTableView.bind(this);\r\n        this.handleCopyWorkflowAsPythonScript = this.handleCopyWorkflowAsPythonScript.bind(this);\r\n        this.handleCopyWorkflowAsShellScript = this.handleCopyWorkflowAsShellScript.bind(this);\r\n        this.handleCopyWorkflowAsJSON = this.handleCopyWorkflowAsJSON.bind(this);\r\n    }\r\n\r\n    private handleResourceNameSelected(newSelection: Array<React.Key>) {\r\n        if (newSelection && newSelection.length) {\r\n            this.props.dispatch(actions.setSelectedWorkspaceResourceName(newSelection[0] as string) as any);\r\n        } else {\r\n            this.props.dispatch(actions.setSelectedWorkspaceResourceName(null) as any);\r\n        }\r\n    }\r\n\r\n    private handleWorkflowStepIdSelected(newSelection: Array<React.Key>) {\r\n        if (newSelection && newSelection.length) {\r\n            this.props.dispatch(actions.setSelectedWorkflowStepId(newSelection[0] as string) as any);\r\n        } else {\r\n            this.props.dispatch(actions.setSelectedWorkflowStepId(null) as any);\r\n        }\r\n    }\r\n\r\n    private handleResourceListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.setSessionProperty('resourceListHeight', value));\r\n    }\r\n\r\n    private handleShowResourceDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.setSessionProperty('showResourceDetails', value));\r\n    }\r\n\r\n    private handleStepListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.setSessionProperty('workflowStepListHeight', value));\r\n    }\r\n\r\n    private handleShowWorkflowStepDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.setSessionProperty('showWorkflowStepDetails', value));\r\n    }\r\n\r\n    private handleShowFigureButtonClicked() {\r\n        this.props.dispatch(actions.showFigureView(this.getEffectiveResource(), this.props.activeViewId));\r\n    }\r\n\r\n    private handleShowResourceTableView() {\r\n        this.props.dispatch(actions.showTableView(this.getEffectiveResource().name, null, this.props.activeViewId));\r\n    }\r\n\r\n    private handleWorkflowStepPropertiesButtonClicked() {\r\n        this.props.dispatch(actions.showDialog('workflowStepPropertiesDialog'));\r\n    }\r\n\r\n    private handleOpenWorkspaceDirectoryClicked() {\r\n        this.props.dispatch(actions.showItemInFolder(this.props.workspace.baseDir) as any);\r\n    }\r\n\r\n    private handleCopyWorkflowAsPythonScript() {\r\n        const text = convertSteps(this.props.operations, this.props.workspace.workflow.steps, 'python');\r\n        actions.copyTextToClipboard(text);\r\n    }\r\n\r\n    private handleCopyWorkflowAsShellScript() {\r\n        const text = convertSteps(this.props.operations, this.props.workspace.workflow.steps, 'shell');\r\n        actions.copyTextToClipboard(text);\r\n    }\r\n\r\n    private handleCopyWorkflowAsJSON() {\r\n        actions.copyTextToClipboard(JSON.stringify(this.props.workspace.workflow, null, 4));\r\n    }\r\n\r\n    private handleEditOperationStepButtonClicked() {\r\n        this.props.dispatch(actions.showOperationStepDialog('editOperationStepDialog'));\r\n    }\r\n\r\n    private handleRemoveOperationStepButtonClicked() {\r\n        const resName = this.getEffectiveResourceName();\r\n        if (resName) {\r\n            this.props.dispatch(actions.deleteResourceInteractive(resName) as any);\r\n        }\r\n    }\r\n\r\n    private handleCleanWorkflowButtonClicked() {\r\n        this.props.dispatch(actions.cleanWorkspaceInteractive() as any);\r\n    }\r\n\r\n    private handleWorkspacePanelModeChanged(workspacePanelMode: WorkspacePanelMode) {\r\n        this.props.dispatch(actions.updateSessionState({workspacePanelMode}) as any);\r\n    }\r\n\r\n    private getEffectiveWorkflowStep() {\r\n        return this.props.workspacePanelMode === 'steps'\r\n            ? this.props.selectedWorkflowStep : this.props.selectedResourceWorkflowStep;\r\n    }\r\n\r\n    private getEffectiveResource() {\r\n        return this.props.workspacePanelMode === 'resources'\r\n            ? this.props.selectedResource : this.props.selectedWorkflowStepResource;\r\n    }\r\n\r\n    private getEffectiveResourceName() {\r\n        let resource = this.getEffectiveResource();\r\n        let workflowStep = this.getEffectiveWorkflowStep();\r\n        return resource ? resource.name : workflowStep ? workflowStep.id : null;\r\n    }\r\n\r\n    private static getResourceItemKey(resource: ResourceState) {\r\n        return resource.name;\r\n    }\r\n\r\n    private static renderResourceItem(resource: ResourceState) {\r\n        return (<LabelWithType label={resource.name}\r\n                               dataType={resource.dataType}/>);\r\n    }\r\n\r\n    private static getStepItemKey(step: WorkflowStepState) {\r\n        return step.id;\r\n    }\r\n\r\n    private renderStepItem(step: WorkflowStepState) {\r\n        return (<span>{this.getWorkflowStepLabel(step)}</span>);\r\n    }\r\n\r\n    render() {\r\n        const workspace = this.props.workspace;\r\n        if (!workspace) {\r\n            return NO_WORKSPACE;\r\n        }\r\n\r\n        assert.ok(workspace.workflow);\r\n        const steps = workspace.workflow.steps;\r\n        assert.ok(steps);\r\n        const resources = workspace.resources;\r\n        assert.ok(resources);\r\n\r\n        const workspaceName = (workspace.isScratch || !workspace.baseDir)\r\n            ? '<unnamed>'\r\n            : workspace.baseDir.split(/[\\\\/]/).pop();\r\n        const workspaceLabel = (\r\n            <Tooltip content={workspace.baseDir} position={PopoverPosition.AUTO_START}>\r\n                <strong>{workspaceName}</strong>\r\n            </Tooltip>\r\n        );\r\n        let workspaceState = null;\r\n        if (workspace.isModified) {\r\n            workspaceState = (\r\n                <span key={0} style={WorkspacePanel.STATE_TAG_STYLE}\r\n                      className=\"bp3-tag bp3-intent-warning bp3-minimal\">Modified</span>\r\n            );\r\n        } else if (!workspace.isSaved) {\r\n            workspaceState = (\r\n                <span key={1} style={WorkspacePanel.STATE_TAG_STYLE}\r\n                      className=\"bp3-tag bp3-intent-success bp3-minimal\">Not saved</span>\r\n            );\r\n        }\r\n        const openItemButton = (\r\n            <ToolButton\r\n                tooltipContent=\"Show workspace directory in file system\"\r\n                onClick={this.handleOpenWorkspaceDirectoryClicked}\r\n                icon=\"folder-open\"\r\n                tooltipPosition={'top'}\r\n            />\r\n        );\r\n        const copyItemButton = (\r\n            <Popover position={PopoverPosition.LEFT}>\r\n                <ToolButton\r\n                    tooltipContent=\"Copy workflow\"\r\n                    disabled={!steps.length}\r\n                    icon=\"clipboard\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <Menu>\r\n                    <MenuItem onClick={this.handleCopyWorkflowAsPythonScript} text=\"Copy workflow as Python Script\"/>\r\n                    <MenuItem onClick={this.handleCopyWorkflowAsShellScript} text=\"Copy workflow as Shell Script\"/>\r\n                    <MenuItem onClick={this.handleCopyWorkflowAsJSON} text=\"Copy workflow as JSON\"/>\r\n                </Menu>\r\n            </Popover>\r\n        );\r\n\r\n        //const resourcesTooltip = \"Workspace resources that result from workflow steps\";\r\n        //const workflowTooltip = \"Workflow steps that generate workspace resources\";\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <div style={WorkspacePanel.FLEX_ROW_STYLE}>\r\n                    {workspaceLabel}\r\n                    <span style={WorkspacePanel.SPACER_STYLE}/>\r\n                    {workspaceState}\r\n                    <ButtonGroup>\r\n                        {openItemButton}\r\n                        {copyItemButton}\r\n                    </ButtonGroup>\r\n                </div>\r\n                <Tabs id=\"workflow\"\r\n                      renderActiveTabPanelOnly={true}\r\n                      selectedTabId={this.props.workspacePanelMode}\r\n                      onChange={this.handleWorkspacePanelModeChanged}>\r\n                    <Tab id=\"steps\" title={`Workflow (${steps.length})`} panel={this.renderWorkflowStepsPanel()}/>\r\n                    <Tab id=\"resources\" title={`Resources (${resources.length})`} panel={this.renderResourcesPanel()}/>\r\n                </Tabs>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    private renderWorkspaceActions() {\r\n        const resource = this.getEffectiveResource();\r\n        const workflowStep = this.getEffectiveWorkflowStep();\r\n        const canShowFigure = isFigureResource(resource);\r\n        const isOperationStepSelected = workflowStep && workflowStep.op;\r\n        const hasSteps = this.props.workspace && this.props.workspace.workflow.steps.length;\r\n        const canShowTableView = isDataFrameResource(resource);\r\n        return (\r\n            <ButtonGroup>\r\n                <ToolButton\r\n                    tooltipContent=\"Show figure\"\r\n                    disabled={!canShowFigure}\r\n                    icon=\"eye-open\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleShowFigureButtonClicked}/>\r\n                <ToolButton\r\n                    tooltipContent=\"Show data in table\"\r\n                    disabled={!canShowTableView}\r\n                    icon=\"th\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleShowResourceTableView}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Resource/step properties\"\r\n                    disabled={!resource}\r\n                    icon=\"label\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleWorkflowStepPropertiesButtonClicked}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Edit workflow step\"\r\n                    intent={Intent.PRIMARY}\r\n                    disabled={!workflowStep}\r\n                    icon=\"edit\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleEditOperationStepButtonClicked}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Remove workflow step and its resource\"\r\n                    disabled={!workflowStep}\r\n                    icon=\"remove\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleRemoveOperationStepButtonClicked}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Clean workspace, remove all steps and resources\"\r\n                    disabled={!hasSteps}\r\n                    icon=\"delete\"\r\n                    tooltipPosition={'top'}\r\n                    onClick={this.handleCleanWorkflowButtonClicked}\r\n                />\r\n                {workflowStep ? <WorkflowStepPropertiesDialog selectedWorkflowStep={workflowStep}/> : null}\r\n                {isOperationStepSelected\r\n                    ? <OperationStepDialog id={EDIT_OPERATION_STEP_DIALOG_ID} operationStep={workflowStep}/>\r\n                    : null}\r\n            </ButtonGroup>\r\n        );\r\n    }\r\n\r\n    private renderResourcesPanel() {\r\n        const resources = this.props.workspace.resources;\r\n        if (!resources || !resources.length) {\r\n            return NO_WORKSPACE_RESOURCES;\r\n        }\r\n        return (\r\n            <ContentWithDetailsPanel showDetails={this.props.showResourceDetails}\r\n                                     onShowDetailsChange={this.handleShowResourceDetailsChanged}\r\n                                     isSplitPanel={true}\r\n                                     contentHeight={this.props.resourceListHeight}\r\n                                     onContentHeightChange={this.handleResourceListHeightChanged}\r\n                                     actionComponent={this.renderWorkspaceActions()}>\r\n                {this.renderResourcesList()}\r\n                {this.renderResourceDetails()}\r\n            </ContentWithDetailsPanel>\r\n        );\r\n    }\r\n\r\n    private renderResourcesList() {\r\n        const resources = this.props.workspace.resources;\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox items={resources}\r\n                         getItemKey={WorkspacePanel.getResourceItemKey}\r\n                         renderItem={WorkspacePanel.renderResourceItem}\r\n                         selection={this.props.selectedResourceName}\r\n                         onSelection={this.handleResourceNameSelected}\r\n                         onItemDoubleClick={this.handleEditOperationStepButtonClicked}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    private renderResourceDetails() {\r\n        const selectedResourceAttributes = this.props.selectedResourceAttributes;\r\n        if (!selectedResourceAttributes || !selectedResourceAttributes.length) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <span>Attributes:</span>\r\n                <Table numRows={selectedResourceAttributes.length} enableRowHeader={false}>\r\n                    <Column name=\"Name\" cellRenderer={this.renderResourceAttrName}/>\r\n                    <Column name=\"Value\" cellRenderer={this.renderResourceAttrValue}/>\r\n                </Table>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    private renderWorkflowStepsPanel() {\r\n        const workflowSteps = this.props.workspace.workflow.steps;\r\n        if (!workflowSteps || !workflowSteps.length) {\r\n            return NO_WORKFLOW_STEPS;\r\n        }\r\n        return (\r\n            <ContentWithDetailsPanel showDetails={this.props.showWorkflowStepDetails}\r\n                                     onShowDetailsChange={this.handleShowWorkflowStepDetailsChanged}\r\n                                     isSplitPanel={true}\r\n                                     contentHeight={this.props.workflowStepListHeight}\r\n                                     onContentHeightChange={this.handleStepListHeightChanged}\r\n                                     actionComponent={this.renderWorkspaceActions()}>\r\n                {this.renderWorkflowStepsList()}\r\n                {this.renderWorkflowStepDetails()}\r\n            </ContentWithDetailsPanel>\r\n        );\r\n    }\r\n\r\n    private renderWorkflowStepsList() {\r\n        const workflowSteps = this.props.workspace.workflow.steps;\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox items={workflowSteps}\r\n                         getItemKey={WorkspacePanel.getStepItemKey}\r\n                         renderItem={this.renderStepItem}\r\n                         selection={this.props.selectedWorkflowStepId}\r\n                         onSelection={this.handleWorkflowStepIdSelected}\r\n                         onItemDoubleClick={this.handleEditOperationStepButtonClicked}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderWorkflowStepDetails() {\r\n\r\n        const selectedWorkflowStepOp = this.props.selectedWorkflowStepOp;\r\n        if (!selectedWorkflowStepOp) {\r\n            return null;\r\n        }\r\n\r\n        let stepInputPanel = WorkspacePanel.renderWorkflowStepPorts(\r\n            selectedWorkflowStepOp.inputs,\r\n            'Step inputs:', 'No step inputs.',\r\n            this.renderOperationStepInputName,\r\n            this.renderOperationStepInputValue\r\n        );\r\n\r\n        let stepOutputPanel = null;\r\n        // let stepOutputPanel = WorkspacePanel.renderWorkflowStepPorts(selectedWorkflowStepOp.outputs,\r\n        //     \"Step outputs:\", \"No step outputs.\",\r\n        //     this.renderOperationStepOutputName,\r\n        //     this.renderOperationStepOutputValue);\r\n\r\n        return (\r\n            <ScrollablePanelContent>\r\n                {stepInputPanel}\r\n                {stepOutputPanel}\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    static renderWorkflowStepPorts(ports: OperationIOBaseState[], itemsTitle: string, noItemsTitle: string, renderName, renderValue) {\r\n        if (ports && ports.length) {\r\n            return (\r\n                <div>\r\n                    <p>{itemsTitle}</p>\r\n                    <Table numRows={ports.length} enableRowHeader={false}>\r\n                        <Column name=\"Name\" cellRenderer={renderName}/>\r\n                        <Column name=\"Value\" cellRenderer={renderValue}/>\r\n                    </Table>\r\n                </div>\r\n            );\r\n        } else {\r\n            return (\r\n                <div>\r\n                    <p>{noItemsTitle}</p>\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    renderResourceAttrName(row: number) {\r\n        return <Cell><TruncatedFormat>{this.props.selectedResourceAttributes[row][0]}</TruncatedFormat></Cell>\r\n    }\r\n\r\n    renderResourceAttrValue(row: number): any {\r\n        return (\r\n            <Cell>\r\n                <TruncatedFormat\r\n                    showPopover={TruncatedPopoverMode.WHEN_TRUNCATED}\r\n                    detectTruncation={true}\r\n                >\r\n                    {`${this.props.selectedResourceAttributes[row][1]}`}\r\n                </TruncatedFormat>\r\n            </Cell>\r\n        );\r\n    }\r\n\r\n    renderOperationStepInputName(row: number) {\r\n        const inputProps = this.props.selectedWorkflowStepOp.inputs[row];\r\n        const inputPort = this.props.selectedWorkflowStep.inputs[inputProps.name];\r\n        return WorkspacePanel.renderWorkflowPortName(inputProps, inputPort);\r\n    }\r\n\r\n    renderOperationStepInputValue(row: number): any {\r\n        const inputProps = this.props.selectedWorkflowStepOp.inputs[row];\r\n        const inputPort = this.props.selectedWorkflowStep.inputs[inputProps.name];\r\n        return WorkspacePanel.renderWorkflowPortValue(inputProps, inputPort);\r\n    }\r\n\r\n    renderOperationStepOutputName(row: number) {\r\n        const outputProps = this.props.selectedWorkflowStepOp.outputs[row];\r\n        const outputPort = this.props.selectedWorkflowStep.outputs[outputProps.name];\r\n        return WorkspacePanel.renderWorkflowPortName(outputProps, outputPort);\r\n    }\r\n\r\n    renderOperationStepOutputValue(row: number): any {\r\n        const outputProps = this.props.selectedWorkflowStepOp.outputs[row];\r\n        const outputPort = this.props.selectedWorkflowStep.outputs[outputProps.name];\r\n        return WorkspacePanel.renderWorkflowPortValue(outputProps, outputPort);\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    static renderWorkflowPortName(portProps: OperationIOBaseState, port: WorkflowPortState) {\r\n        return (\r\n            <Cell><TruncatedFormat showPopover={TruncatedPopoverMode.ALWAYS}>{portProps.name}</TruncatedFormat></Cell>);\r\n    }\r\n\r\n    static renderWorkflowPortValue(portProps: OperationIOBaseState, port: WorkflowPortState) {\r\n        let cellValue;\r\n        if (port) {\r\n            let units;\r\n            if (portProps.units) {\r\n                units = (<span className=\"bp3-text-muted\">{` (${portProps.units})`}</span>);\r\n            }\r\n            const source = isString(port) ? port : port.source;\r\n            if (source) {\r\n                cellValue = (<span>&#8599; <em>{source}</em></span>);\r\n            } else {\r\n                let value = port.value;\r\n                const maxTextLen = 128;\r\n                if (isString(value) && value.length > maxTextLen) {\r\n                    // Note we do this for performance reasons. BlueprintJS renders very slowly\r\n                    // e.g. for large Geometry WKT values.\r\n                    value = value.substr(0, maxTextLen) + '...';\r\n                }\r\n                cellValue = (<span>{value}{units}</span>);\r\n            }\r\n        } else {\r\n            let defaultValue = (portProps as OperationInputState).defaultValue;\r\n            if (isDefined(defaultValue)) {\r\n                cellValue = (<span>{`${defaultValue}`} <span className=\"bp3-text-muted\">(default value)</span></span>);\r\n            } else {\r\n                cellValue = (<span className=\"bp3-text-muted\">Not given.</span>);\r\n            }\r\n        }\r\n        return (<Cell>{cellValue}</Cell>);\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private getWorkflowStepLabel(step: WorkflowStepState) {\r\n\r\n        const items = [];\r\n\r\n        if (step && step.op) {\r\n            let opName = step.op;\r\n            const index = opName.lastIndexOf('.');\r\n            if (index > 0) {\r\n                opName = opName.slice(index + 1);\r\n            }\r\n            items.push(<code key={0}>{opName}()</code>);\r\n        } else {\r\n            items.push(<code key={0}>?()</code>);\r\n        }\r\n\r\n        const resource = this.props.resourcesMap[step.id];\r\n        if (resource) {\r\n            items.push(<span key={1}> &rarr; </span>);\r\n            items.push(<LabelWithType key={2} label={resource.name}\r\n                                      dataType={resource.dataType}/>);\r\n        }\r\n\r\n        if (step && step.persistent) {\r\n            items.push(<span key={3}> </span>);\r\n            items.push(<Icon key={4} icon=\"database\"/>);\r\n        }\r\n\r\n        return <span>{items}</span>;\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(WorkspacePanel);\r\n\r\n\r\nfunction convertSteps(operations: OperationState[], steps: WorkflowStepState[], target: 'python' | 'shell'): string {\r\n    // TODO (forman): move this to backend, as this is best done in Python\r\n    let lines = [];\r\n    if (target === 'python') {\r\n        lines.push('import cate.ops');\r\n    } else {\r\n        lines.push('cate ws new');\r\n    }\r\n    for (let i = 0; i < steps.length; i++) {\r\n        const step = steps[i];\r\n        const op = findOperation(operations, step.op);\r\n        if (op && op.inputs) {\r\n            if (target === 'python') {\r\n                lines.push('');\r\n                lines.push(`# Step ${i + 1}`);\r\n            }\r\n            const args = [];\r\n            for (let input of op.inputs) {\r\n                const inputPort = step.inputs[input.name];\r\n                if (!inputPort) {\r\n                    // No value provided, which should be ok (default value applies)\r\n                    continue;\r\n                }\r\n                const source = isString(inputPort) ? inputPort : inputPort.source;\r\n                if (inputPort && source) {\r\n                    if (target === 'python') {\r\n                        args.push(`${input.name}=${source}`);\r\n                    } else {\r\n                        args.push(`${input.name}=@${source}`);\r\n                    }\r\n                } else if (inputPort) {\r\n                    let value = inputPort.value;\r\n                    if (isUndefined(value)) {\r\n                        value = null;\r\n                    }\r\n                    let defaultValue = input.defaultValue;\r\n                    if (isUndefined(defaultValue)) {\r\n                        defaultValue = null;\r\n                    }\r\n                    if (value !== defaultValue) {\r\n                        if (isUndefinedOrNull(value)) {\r\n                            args.push(`${input.name}=None`);\r\n                        } else if (isString(value)) {\r\n                            args.push(`${input.name}=\"${value}\"`);\r\n                        } else if (isBoolean(value)) {\r\n                            args.push(`${input.name}=${value ? 'True' : 'False'}`);\r\n                        } else if (isBoolean(value)) {\r\n                            args.push(`${input.name}=${value}`);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            let resName = step.id;\r\n            const opName = op.name;\r\n            if (target === 'python') {\r\n                lines.push(`${resName} = cate.ops.${opName}(${args.join(', ')})`);\r\n            } else {\r\n                lines.push(`cate res set ${resName} ${opName} ${args.join(' ')}`);\r\n            }\r\n        }\r\n    }\r\n    if (target === 'shell') {\r\n        lines.push('cate ws exit');\r\n    }\r\n    lines.push('');\r\n    return lines.join('\\n');\r\n}\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { GeographicPosition, Placemark, ResourceState, SavedLayers, State, VariableState } from '../state';\r\nimport * as assert from '../../common/assert';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { ContentWithDetailsPanel } from '../components/ContentWithDetailsPanel';\r\nimport { LabelWithType } from '../components/LabelWithType';\r\nimport { ButtonGroup, Colors } from '@blueprintjs/core';\r\nimport { Cell, Column, Table, TruncatedFormat } from '@blueprintjs/table';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\nimport { NO_VARIABLES, NO_VARIABLES_EMPTY_RESOURCE } from '../messages';\r\nimport * as Cesium from 'cesium';\r\nimport { ToolButton } from '../components/ToolButton';\r\nimport { isSpatialImageVariable, isSpatialVectorVariable } from '../state-util';\r\nimport { isDefined, isDefinedAndNotNull } from '../../common/types';\r\n\r\ninterface IVariablesPanelProps {\r\n    variables: VariableState[];\r\n    selectedResource: ResourceState | null;\r\n    selectedVariableName: string | null;\r\n    selectedVariable: VariableState | null;\r\n    selectedVariableAttributesTableData: [string, any][];\r\n    variableListHeight: number;\r\n    showVariableDetails: boolean;\r\n    showSelectedVariableLayer: boolean;\r\n    activeViewId: string;\r\n    activeViewType: string;\r\n    savedLayers: SavedLayers;\r\n    selectedPlacemark: Placemark | null;\r\n    selectedEntity: Cesium.Entity | null;\r\n    globeViewPosition: GeographicPosition | null;\r\n    positionData: { [varName: string]: number } | null\r\n}\r\n\r\nfunction mapStateToProps(state: State): IVariablesPanelProps {\r\n    return {\r\n        variables: selectors.variablesSelector(state) || selectors.EMPTY_ARRAY,\r\n        selectedResource: selectors.selectedResourceSelector(state),\r\n        selectedVariableName: selectors.selectedVariableNameSelector(state),\r\n        selectedVariable: selectors.selectedVariableSelector(state),\r\n        selectedVariableAttributesTableData: selectors.selectedVariableAttributesTableDataSelector(state),\r\n        variableListHeight: state.session.variableListHeight,\r\n        showVariableDetails: state.session.showVariableDetails,\r\n        showSelectedVariableLayer: state.session.showSelectedVariableLayer,\r\n        activeViewId: selectors.activeViewIdSelector(state),\r\n        activeViewType: selectors.activeViewTypeSelector(state),\r\n        savedLayers: selectors.savedLayersSelector(state),\r\n        selectedPlacemark: selectors.selectedPlacemarkSelector(state),\r\n        selectedEntity: selectors.selectedEntitySelector(state),\r\n        globeViewPosition: state.location.globeViewPosition,\r\n        positionData: state.location.positionData,\r\n    }\r\n}\r\n\r\n/**\r\n * The VariablesPanel list all variables of the selected workspace resource.\r\n *\r\n * @author Marco Zuehlke, Norman Fomferra\r\n */\r\nclass VariablesPanel extends React.Component<IVariablesPanelProps & DispatchProp<State>, null> {\r\n    static readonly VALUE_STYLE: CSSProperties = {float: 'right', color: Colors.BLUE5};\r\n\r\n\r\n    constructor(props: IVariablesPanelProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.handleSelectedVariableNameChanged = this.handleSelectedVariableNameChanged.bind(this);\r\n        this.handleListHeightChanged = this.handleListHeightChanged.bind(this);\r\n        this.handleShowDetailsChanged = this.handleShowDetailsChanged.bind(this);\r\n        this.handleShowSelectedVariableLayer = this.handleShowSelectedVariableLayer.bind(this);\r\n        this.handleAddVariableLayer = this.handleAddVariableLayer.bind(this);\r\n        this.handleAddVariableTimeSeriesPlot = this.handleAddVariableTimeSeriesPlot.bind(this);\r\n        this.handleAddVariableHistogramPlot = this.handleAddVariableHistogramPlot.bind(this);\r\n        this.handleShowVariableTableView = this.handleShowVariableTableView.bind(this);\r\n    }\r\n\r\n    private handleSelectedVariableNameChanged(newSelection: Array<React.Key>) {\r\n        const resource = this.props.selectedResource;\r\n        assert.ok(resource);\r\n        if (newSelection && newSelection.length) {\r\n            const selectedVariableName = newSelection[0] as string;\r\n            const selectedVariable = this.props.variables.find(v => v.name === selectedVariableName);\r\n            assert.ok(selectedVariable);\r\n            this.props.dispatch(actions.setSelectedVariable(resource, selectedVariable, this.props.savedLayers));\r\n        } else {\r\n            this.props.dispatch(actions.setSelectedVariable(resource, null));\r\n        }\r\n    }\r\n\r\n    private handleListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.setSessionProperty('variableListHeight', value));\r\n    }\r\n\r\n    private handleShowDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.setSessionProperty('showVariableDetails', value));\r\n    }\r\n\r\n    private handleShowSelectedVariableLayer() {\r\n        const showSelectedVariableLayer = this.props.showSelectedVariableLayer;\r\n        this.props.dispatch(actions.setShowSelectedVariableLayer(!showSelectedVariableLayer));\r\n    }\r\n\r\n    private handleAddVariableLayer() {\r\n        const resource = this.props.selectedResource;\r\n        const variable = this.props.selectedVariable;\r\n        const activeViewId = this.props.activeViewId;\r\n        const savedLayers = this.props.savedLayers;\r\n        assert.ok(resource);\r\n        assert.ok(variable && variable.imageLayout);\r\n        assert.ok(activeViewId);\r\n        this.props.dispatch(actions.addVariableLayer(activeViewId, resource, variable, true, savedLayers));\r\n    }\r\n\r\n    private handleAddVariableTimeSeriesPlot() {\r\n        const resource = this.props.selectedResource;\r\n        const variable = this.props.selectedVariable;\r\n        const placemark = this.props.selectedPlacemark;\r\n        const placemarkName = placemark.properties['name'] || 'placemark';\r\n        const placemarkPosition = placemark.geometry.coordinates;\r\n        const opArgs = {\r\n            ds: {source: resource.name},\r\n            'var': {value: variable.name},\r\n            indexers: {value: `lon=${placemarkPosition[0]}, lat=${placemarkPosition[1]}`},\r\n            properties: {value: null},\r\n            file: {value: null},\r\n        };\r\n        this.props.dispatch(actions.setWorkspaceResource('cate.ops.plot.plot', opArgs,\r\n                                                         null, false,\r\n                                                         `Creating time series plot for placemark ${placemarkName}`) as any);\r\n    }\r\n\r\n    private handleAddVariableHistogramPlot() {\r\n        const resource = this.props.selectedResource;\r\n        const variable = this.props.selectedVariable;\r\n        const opArgs = {\r\n            ds: {source: resource.name},\r\n            'var': {value: variable.name},\r\n            indexers: {value: null},\r\n            properties: {value: 'bins=250'},\r\n            file: {value: null},\r\n        };\r\n        this.props.dispatch(actions.setWorkspaceResource('cate.ops.plot.plot_hist', opArgs,\r\n                                                         null, false,\r\n                                                         'Creating histogram plot') as any);\r\n    }\r\n\r\n    private handleShowVariableTableView() {\r\n        const resource = this.props.selectedResource;\r\n        const variable = this.props.selectedVariable;\r\n        assert.ok(resource);\r\n        assert.ok(variable);\r\n        this.props.dispatch(actions.showTableView(resource.name, variable.name, this.props.activeViewId));\r\n    }\r\n\r\n    render() {\r\n        const resource = this.props.selectedResource;\r\n        const variables = this.props.variables;\r\n        if (variables && variables.length) {\r\n            return (\r\n                <ContentWithDetailsPanel showDetails={this.props.showVariableDetails}\r\n                                         onShowDetailsChange={this.handleShowDetailsChanged}\r\n                                         isSplitPanel={true}\r\n                                         contentHeight={this.props.variableListHeight}\r\n                                         onContentHeightChange={this.handleListHeightChanged}\r\n                                         actionComponent={this.renderVariableActionRow()}>\r\n                    <VariablesListPanel\r\n                        selectedEntity={this.props.selectedEntity}\r\n                        globeViewPosition={this.props.globeViewPosition}\r\n                        positionData={this.props.positionData}\r\n                        selectedVariableName={this.props.selectedVariableName}\r\n                        onSelectedVariableNameChanged={this.handleSelectedVariableNameChanged}\r\n                        variables={this.props.variables}\r\n                    />\r\n                    <VariableDetailsPanel\r\n                        tableData={this.props.selectedVariableAttributesTableData}\r\n                    />\r\n                </ContentWithDetailsPanel>\r\n            );\r\n        } else if (resource) {\r\n            return NO_VARIABLES_EMPTY_RESOURCE(resource.name);\r\n        } else {\r\n            return NO_VARIABLES;\r\n        }\r\n    }\r\n\r\n    private renderVariableActionRow() {\r\n        const selectedVariable = this.props.selectedVariable;\r\n        const isSpatialVariable = selectedVariable && selectedVariable.numDims >= 2 && selectedVariable.imageLayout;\r\n        const placemark = this.props.selectedPlacemark;\r\n        const hasWorldView = this.props.activeViewType && this.props.activeViewType === 'world';\r\n        const canAddLayer = isSpatialVariable && hasWorldView;\r\n        const canAddTimeSeriesPlot = isSpatialVariable && placemark;\r\n        const canAddHistogramPlot = selectedVariable && selectedVariable.numDims > 0;\r\n        const maxSize = 10000;\r\n        return (\r\n            <ButtonGroup>\r\n                <ToolButton tooltipContent=\"Toggle image layer visibility\"\r\n                            icon={this.props.showSelectedVariableLayer ? 'eye-open' : 'eye-off'}\r\n                            tooltipPosition={'top'}\r\n                            onClick={this.handleShowSelectedVariableLayer}/>\r\n                <ToolButton tooltipContent=\"Add a new image layer\"\r\n                            disabled={!canAddLayer}\r\n                            icon=\"layer\"\r\n                            tooltipPosition={'top'}\r\n                            onClick={this.handleAddVariableLayer}/>\r\n                <ToolButton tooltipContent=\"Create a time series plot from selected placemark\"\r\n                            disabled={!canAddTimeSeriesPlot}\r\n                            icon=\"timeline-line-chart\"\r\n                            tooltipPosition={'top'}\r\n                            onClick={this.handleAddVariableTimeSeriesPlot}/>\r\n                <ToolButton tooltipContent=\"Create a histogram plot\"\r\n                            disabled={!canAddHistogramPlot}\r\n                            icon=\"timeline-bar-chart\"\r\n                            tooltipPosition={'top'}\r\n                            onClick={this.handleAddVariableHistogramPlot}/>\r\n                <ToolButton tooltipContent={`Show data in table (only first ${maxSize} values)`}\r\n                            icon=\"th\"\r\n                            tooltipPosition={'top'}\r\n                            onClick={this.handleShowVariableTableView}/>\r\n            </ButtonGroup>\r\n        );\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default connect(mapStateToProps)(VariablesPanel);\r\n\r\n\r\ninterface VariablesListPanelProps {\r\n    variables: VariableState[];\r\n    selectedVariableName: string | null;\r\n    onSelectedVariableNameChanged: (selectedVariableName: Array<React.Key>) => void;\r\n    selectedEntity: Cesium.Entity | null;\r\n    globeViewPosition: GeographicPosition | null;\r\n    positionData: { [varName: string]: number } | null\r\n}\r\n\r\nclass VariablesListPanel extends React.PureComponent<VariablesListPanelProps> {\r\n    private getItemKey = (variable: VariableState) => {\r\n        return variable.name;\r\n    };\r\n\r\n    private getItemValue = (variable: VariableState) => {\r\n\r\n        let value;\r\n\r\n        if (isSpatialVectorVariable(variable)) {\r\n            const selectedEntity = this.props.selectedEntity;\r\n            if (selectedEntity && selectedEntity.properties) {\r\n                const property = selectedEntity.properties[variable.name];\r\n                if (isDefinedAndNotNull(property)) {\r\n                    value = property.getValue();\r\n                }\r\n            }\r\n        } else if (isSpatialImageVariable(variable)) {\r\n            const positionData = this.props.positionData;\r\n            if (positionData) {\r\n                value = positionData[variable.name];\r\n            }\r\n        }\r\n\r\n        return isDefined(value) ? value : variable.value;\r\n    };\r\n\r\n    private renderItem = (variable: VariableState) => {\r\n\r\n        const label = (\r\n            <LabelWithType\r\n                label={variable.name}\r\n                dataType={variable.dataType}\r\n                tooltipText={variable.attributes && variable.attributes.long_name}\r\n            />\r\n        );\r\n\r\n        const value = this.getItemValue(variable);\r\n        if (!isDefined(value)) {\r\n            return label;\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                {label}\r\n                <span style={VariablesPanel.VALUE_STYLE}>{`${value}`}</span>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    private handleVariableNameSelection = (selectedVariableName: Array<React.Key>) => {\r\n        this.props.onSelectedVariableNameChanged(selectedVariableName);\r\n    };\r\n\r\n    render() {\r\n        // We compute a new key here to force updates of the list box items either when the selected entity\r\n        // changes or new position data may be available.\r\n        let key = 'vlb';\r\n        const selectedEntityId = this.props.selectedEntity && this.props.selectedEntity.id;\r\n        if (selectedEntityId) {\r\n            key += `_${selectedEntityId}`;\r\n        }\r\n        const geoPos = this.props.globeViewPosition;\r\n        if (geoPos) {\r\n            key += `_${geoPos.longitude},${geoPos.latitude}`;\r\n        }\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox key={key}\r\n                         items={this.props.variables}\r\n                         getItemKey={this.getItemKey}\r\n                         renderItem={this.renderItem}\r\n                         selection={this.props.selectedVariableName}\r\n                         selectionMode={ListBoxSelectionMode.SINGLE}\r\n                         onSelection={this.handleVariableNameSelection}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n}\r\n\r\ninterface VariableDetailsPanelProps {\r\n    tableData: [string, any][] | null;\r\n}\r\n\r\nclass VariableDetailsPanel extends React.PureComponent<VariableDetailsPanelProps> {\r\n    static readonly DIV_STYLE: CSSProperties = {paddingTop: 4, width: '100%'};\r\n\r\n    private renderAttributeName = (index: number): any => {\r\n        return <Cell>{this.props.tableData[index][0]}</Cell>;\r\n    };\r\n\r\n    private renderAttributeValue = (index: number): any => {\r\n        return <Cell><TruncatedFormat>{this.props.tableData[index][1]}</TruncatedFormat></Cell>;\r\n    };\r\n\r\n    render() {\r\n        const tableData = this.props.tableData;\r\n        if (!tableData || !tableData.length) {\r\n            return null;\r\n        }\r\n        return (\r\n            <div style={VariableDetailsPanel.DIV_STYLE}>\r\n                <Table numRows={tableData.length} enableRowHeader={false}>\r\n                    <Column name=\"Name\" cellRenderer={this.renderAttributeName}/>\r\n                    <Column name=\"Value\" cellRenderer={this.renderAttributeValue}/>\r\n                </Table>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DialogState, LayerState, LayerVariableState, ResourceState, State } from '../state';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { LabelWithType } from '../components/LabelWithType';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\n\r\ninterface ILayerSourcesDialogProps extends DialogState {\r\n    resources: ResourceState[];\r\n    layers: LayerState[];\r\n    savedLayers: { [name: string]: LayerState };\r\n    activeViewId: string;\r\n    layerVariables: LayerVariableState[];\r\n}\r\n\r\ninterface ILayerSourcesDialogState {\r\n    selectedIndices: number[] | null;\r\n}\r\n\r\nfunction mapStateToProps(state: State): ILayerSourcesDialogProps {\r\n    return {\r\n        isOpen: selectors.dialogStateSelector(LayerSourcesDialog.DIALOG_ID)(state).isOpen,\r\n        layers: selectors.layersSelector(state),\r\n        savedLayers: selectors.savedLayersSelector(state),\r\n        activeViewId: selectors.activeViewIdSelector(state),\r\n        resources: selectors.resourcesSelector(state),\r\n        layerVariables: selectors.selectedLayerVariablesSelector(state),\r\n    };\r\n}\r\n\r\nclass LayerSourcesDialog extends React.Component<DispatchProp<State> & ILayerSourcesDialogProps, ILayerSourcesDialogState> {\r\n    static readonly DIALOG_ID = 'layerSourcesDialog';\r\n    static readonly DIALOG_TITLE = 'Add Layer';\r\n\r\n    constructor(props: DispatchProp<State> & ILayerSourcesDialogProps) {\r\n        super(props);\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.handleChangedVariableSelection = this.handleChangedVariableSelection.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.state = {selectedIndices: null};\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(LayerSourcesDialog.DIALOG_ID));\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(LayerSourcesDialog.DIALOG_ID));\r\n        let selectLayer = true;\r\n        for (let index of this.state.selectedIndices) {\r\n            const layerVariable = this.props.layerVariables[index];\r\n            this.props.dispatch(\r\n                actions.addVariableLayer(this.props.activeViewId,\r\n                                         layerVariable.resource,\r\n                                         layerVariable.variable,\r\n                                         selectLayer,\r\n                                         this.props.savedLayers\r\n                ));\r\n            selectLayer = false;\r\n        }\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        return !!this.state.selectedIndices && this.state.selectedIndices.length > 0;\r\n    }\r\n\r\n    private handleChangedVariableSelection(newSelection: number[]) {\r\n        this.setState({selectedIndices: newSelection.slice()});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog\r\n                isOpen={this.props.isOpen}\r\n                title={LayerSourcesDialog.DIALOG_TITLE}\r\n                icon=\"layers\"\r\n                onCancel={this.onCancel}\r\n                onConfirm={this.onConfirm}\r\n                canConfirm={this.canConfirm}\r\n                renderBody={this.renderBody}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n        if (!this.props.layerVariables.length) {\r\n            return (<p>There are currently no resource or variables that could be added as layers.</p>);\r\n        }\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <p>Select the variables you wish to add as a layer:</p>\r\n                <ListBox items={this.props.layerVariables}\r\n                         getItemKey={LayerSourcesDialog.getVariableItemKey}\r\n                         renderItem={LayerSourcesDialog.renderVariableItem}\r\n                         selectionMode={ListBoxSelectionMode.MULTIPLE}\r\n                         selection={this.state.selectedIndices}\r\n                         onSelection={this.handleChangedVariableSelection}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    //noinspection JSUnusedLocalSymbols\r\n    private static getVariableItemKey(variable: LayerVariableState, index: number) {\r\n        return index;\r\n    }\r\n\r\n    private static renderVariableItem(layerVariable: LayerVariableState) {\r\n        const variable = layerVariable.variable;\r\n        return (\r\n            <div>\r\n                <span>{layerVariable.resource.name}</span>\r\n                <span> / </span>\r\n                <LabelWithType label={variable.name}\r\n                               dataType={`${variable.dataType}[${variable.dimNames}]`}\r\n                               units={variable.units}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(LayerSourcesDialog);\r\n","import * as React from 'react';\r\nimport {createRef, CSSProperties} from 'react';\r\nimport {\r\n    ButtonGroup,\r\n    Checkbox,\r\n    Colors, ContextMenu,\r\n    Icon,\r\n    IconName,\r\n    Label,\r\n    Menu,\r\n    MenuItem,\r\n    Popover,\r\n    Position\r\n} from '@blueprintjs/core';\r\nimport {connect, Dispatch} from 'react-redux';\r\nimport {Placemark, PlacemarkCollection, State} from '../state';\r\nimport {ListBox, ListBoxSelectionMode} from '../components/ListBox';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport {ContentWithDetailsPanel} from '../components/ContentWithDetailsPanel';\r\nimport LayerSourcesDialog from './LayerSourcesDialog';\r\nimport {ScrollablePanelContent} from '../components/ScrollableContent';\r\nimport {ViewState} from '../components/ViewState';\r\nimport {NO_PLACE_SELECTED, NO_PLACES} from '../messages';\r\nimport {FieldValue} from '../components/field/Field';\r\nimport {TextField} from '../components/field/TextField';\r\nimport {geoJsonToText, geometryGeoJsonToCsv, geometryGeoJsonToGeometryWkt, isBox} from '../../common/geometry-util';\r\nimport {GeometryToolType} from '../components/cesium/geometry-tool';\r\nimport {isBoolean} from '../../common/types';\r\nimport {NumericField, NumericFieldValue} from '../components/field/NumericField';\r\nimport {ToolButton} from '../components/ToolButton';\r\n\r\n\r\ninterface IPlacemarksPanelDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IPlacemarksPanelProps {\r\n    placemarkCollection: PlacemarkCollection;\r\n    selectedPlacemarkId: string | null,\r\n    selectedPlacemark: Placemark | null,\r\n    activeView: ViewState<any> | null;\r\n    placemarkListHeight: number,\r\n    showPlacemarkDetails: boolean,\r\n    geometryToolType: GeometryToolType;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IPlacemarksPanelProps {\r\n    return {\r\n        placemarkCollection: selectors.placemarkCollectionSelector(state),\r\n        selectedPlacemarkId: selectors.selectedPlacemarkIdSelector(state),\r\n        selectedPlacemark: selectors.selectedPlacemarkSelector(state),\r\n        placemarkListHeight: state.session.placemarkListHeight,\r\n        showPlacemarkDetails: selectors.showPlacemarkDetailsSelector(state),\r\n        activeView: selectors.activeViewSelector(state),\r\n        geometryToolType: selectors.newPlacemarkToolTypeSelector(state),\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * The PlacemarksPanel is used to display, select, and manage user geometries.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass PlacemarksPanel extends React.Component<IPlacemarksPanelProps & IPlacemarksPanelDispatch, null> {\r\n\r\n    constructor(props: IPlacemarksPanelProps & IPlacemarksPanelDispatch) {\r\n        super(props);\r\n        this.handleListHeightChanged = this.handleListHeightChanged.bind(this);\r\n        this.handleShowDetailsChanged = this.handleShowDetailsChanged.bind(this);\r\n        this.handleNewPointToolButtonClicked = this.handleNewPointToolButtonClicked.bind(this);\r\n        this.handleNewPolygonToolButtonClicked = this.handleNewPolygonToolButtonClicked.bind(this);\r\n        this.handleNewPolylineToolButtonClicked = this.handleNewPolylineToolButtonClicked.bind(this);\r\n        this.handleNewBoxToolButtonClicked = this.handleNewBoxToolButtonClicked.bind(this);\r\n        this.handleRemovePlacemarkButtonClicked = this.handleRemovePlacemarkButtonClicked.bind(this);\r\n        this.handleLocatePlacemarkButtonClicked = this.handleLocatePlacemarkButtonClicked.bind(this);\r\n        this.handleChangedPlacemarkVisibility = this.handleChangedPlacemarkVisibility.bind(this);\r\n        this.handleChangedPlacemarkSelection = this.handleChangedPlacemarkSelection.bind(this);\r\n        this.handleChangedPlacemarkName = this.handleChangedPlacemarkName.bind(this);\r\n        this.handleChangedPointLongitude = this.handleChangedPointLongitude.bind(this);\r\n        this.handleChangedPointLatitude = this.handleChangedPointLatitude.bind(this);\r\n        this.handleCopySelectedPlacemarkAsCsv = this.handleCopySelectedPlacemarkAsCsv.bind(this);\r\n        this.handleCopySelectedPlacemarkAsWkt = this.handleCopySelectedPlacemarkAsWkt.bind(this);\r\n        this.handleCopySelectedPlacemarkAsGeoJSON = this.handleCopySelectedPlacemarkAsGeoJSON.bind(this);\r\n        this.handlePlacemarkDoubleClick = this.handlePlacemarkDoubleClick.bind(this);\r\n        this.renderPlacemarkItem = this.renderPlacemarkItem.bind(this);\r\n    }\r\n\r\n    private handleListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.updateSessionState({placemarkListHeight: value}));\r\n    }\r\n\r\n    private handleNewPointToolButtonClicked() {\r\n        this.props.dispatch(actions.activateNewPlacemarkTool('PointTool'));\r\n    }\r\n\r\n    private handleNewPolygonToolButtonClicked() {\r\n        this.props.dispatch(actions.activateNewPlacemarkTool('PolygonTool'));\r\n    }\r\n\r\n    private handleNewPolylineToolButtonClicked() {\r\n        this.props.dispatch(actions.activateNewPlacemarkTool('PolylineTool'));\r\n    }\r\n\r\n    private handleNewBoxToolButtonClicked() {\r\n        this.props.dispatch(actions.activateNewPlacemarkTool('BoxTool'));\r\n    }\r\n\r\n    private handleShowDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.updateSessionState({showPlacemarkDetails: value}));\r\n    }\r\n\r\n    private handleRemovePlacemarkButtonClicked() {\r\n        this.props.dispatch(actions.removePlacemark(this.props.selectedPlacemarkId));\r\n    }\r\n\r\n    private handleLocatePlacemarkButtonClicked() {\r\n        this.props.dispatch(actions.locatePlacemark(this.props.selectedPlacemarkId) as any);\r\n    }\r\n\r\n    private handlePlacemarkDoubleClick(placemark: Placemark) {\r\n        this.props.dispatch(actions.locatePlacemark(placemark.id) as any);\r\n    }\r\n\r\n    private handleChangedPlacemarkVisibility(placemark: Placemark, visible: boolean) {\r\n        this.props.dispatch(actions.updatePlacemarkProperties(placemark.id, {visible}));\r\n    }\r\n\r\n    private handleChangedPlacemarkName(nameField: FieldValue<string>) {\r\n        const placemark = this.props.selectedPlacemark;\r\n        const name = nameField.value;\r\n        this.props.dispatch(actions.updatePlacemarkStyle(placemark.id, {title: name}));\r\n    }\r\n\r\n    private handleChangedPointLongitude(longitude: NumericFieldValue) {\r\n        const placemark = this.props.selectedPlacemark;\r\n        let geometry = placemark.geometry;\r\n        geometry = {...geometry, coordinates: [longitude.value, geometry.coordinates[1]]};\r\n        this.props.dispatch(actions.updatePlacemarkGeometry(placemark.id, geometry));\r\n    }\r\n\r\n    private handleChangedPointLatitude(latitude: NumericFieldValue) {\r\n        const placemark = this.props.selectedPlacemark;\r\n        let geometry = placemark.geometry;\r\n        geometry = {...geometry, coordinates: [geometry.coordinates[0], latitude.value]};\r\n        this.props.dispatch(actions.updatePlacemarkGeometry(placemark.id, geometry));\r\n    }\r\n\r\n    private handleChangedPlacemarkSelection(newSelection: string[]) {\r\n        const selectedPlacemarkId = newSelection.length ? newSelection[0] : null;\r\n        this.props.dispatch(actions.setSelectedPlacemarkId(selectedPlacemarkId));\r\n    }\r\n\r\n    private handleCopySelectedPlacemarkAsCsv() {\r\n        this.handleCopyGeometryAsCsv(this.props.selectedPlacemark);\r\n    }\r\n\r\n    private handleCopySelectedPlacemarkAsWkt() {\r\n        this.handleCopyGeometryAsWkt(this.props.selectedPlacemark);\r\n    }\r\n\r\n    private handleCopySelectedPlacemarkAsGeoJSON() {\r\n        this.handleCopyGeometryAsGeoJson(this.props.selectedPlacemark);\r\n    }\r\n\r\n    private handleCopyGeometryAsCsv = (placemark: Placemark)  => {\r\n        actions.copyTextToClipboard(geometryGeoJsonToCsv(placemark.geometry));\r\n    };\r\n\r\n    private handleCopyGeometryAsWkt = (placemark: Placemark) => {\r\n        actions.copyTextToClipboard(geometryGeoJsonToGeometryWkt(placemark.geometry));\r\n    };\r\n\r\n    private handleCopyGeometryAsGeoJson = (placemark: Placemark) => {\r\n        actions.copyTextToClipboard(geoJsonToText(placemark));\r\n    };\r\n\r\n    private static getPlacemarkItemKey(placemark: Placemark) {\r\n        return placemark.id;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div style={{width: '100%'}}>\r\n                <ContentWithDetailsPanel showDetails={this.props.showPlacemarkDetails}\r\n                                         onShowDetailsChange={this.handleShowDetailsChanged}\r\n                                         isSplitPanel={true}\r\n                                         contentHeight={this.props.placemarkListHeight}\r\n                                         onContentHeightChange={this.handleListHeightChanged}\r\n                                         actionComponent={this.renderActionButtonRow()}>\r\n                    {this.renderPlacemarksList()}\r\n                    {this.renderPlacemarkDetails()}\r\n                </ContentWithDetailsPanel>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderActionButtonRow() {\r\n        const isPointToolActive = this.props.geometryToolType === 'PointTool';\r\n        const isPolylineToolActive = this.props.geometryToolType === 'PolylineTool';\r\n        const isPolygonToolActive = this.props.geometryToolType === 'PolygonTool';\r\n        const isBoxToolActive = this.props.geometryToolType === 'BoxTool';\r\n        return (\r\n            <ButtonGroup>\r\n                <ToolButton\r\n                    tooltipContent=\"New marker\"\r\n                    onClick={this.handleNewPointToolButtonClicked}\r\n                    icon=\"dot\"\r\n                    tooltipPosition={'top'}\r\n                    active={isPointToolActive}\r\n                    disabled={false}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"New polyline\"\r\n                    onClick={this.handleNewPolylineToolButtonClicked}\r\n                    icon=\"slash\"\r\n                    tooltipPosition={'top'}\r\n                    active={isPolylineToolActive}\r\n                    disabled={false}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"New polygon\"\r\n                    onClick={this.handleNewPolygonToolButtonClicked}\r\n                    icon=\"polygon-filter\"\r\n                    tooltipPosition={'top'}\r\n                    active={isPolygonToolActive}\r\n                    disabled={false}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"New box\"\r\n                    onClick={this.handleNewBoxToolButtonClicked}\r\n                    icon=\"widget\"\r\n                    tooltipPosition={'top'}\r\n                    active={isBoxToolActive}\r\n                    disabled={false}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Remove selected place\"\r\n                    disabled={!this.props.selectedPlacemarkId}\r\n                    onClick={this.handleRemovePlacemarkButtonClicked}\r\n                    icon=\"remove\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Locate selected place in view\"\r\n                    disabled={!this.props.selectedPlacemarkId}\r\n                    onClick={this.handleLocatePlacemarkButtonClicked}\r\n                    icon=\"locate\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <Popover disabled={!this.props.selectedPlacemark} position={Position.LEFT}>\r\n                    <ToolButton\r\n                        tooltipContent={!this.props.selectedPlacemark ?\r\n                                        \"Copy selected place: Please select a place first.\" : \"Copy selected place.\"}\r\n                        disabled={!this.props.selectedPlacemark}\r\n                        icon=\"clipboard\"\r\n                        tooltipPosition={'top'}\r\n                    />\r\n                    <Menu>\r\n                        <MenuItem onClick={this.handleCopySelectedPlacemarkAsCsv} text=\"Copy as CSV\"/>\r\n                        <MenuItem onClick={this.handleCopySelectedPlacemarkAsWkt} text=\"Copy as WKT\"/>\r\n                        <MenuItem onClick={this.handleCopySelectedPlacemarkAsGeoJSON} text=\"Copy as GeoJSON\"/>\r\n                    </Menu>\r\n                </Popover>\r\n                <LayerSourcesDialog/>\r\n            </ButtonGroup>\r\n        );\r\n    }\r\n\r\n    private renderPlacemarksList() {\r\n        const placemarks = this.props.placemarkCollection.features;\r\n        if (!placemarks || !placemarks.length) {\r\n            return NO_PLACES;\r\n        }\r\n\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox items={placemarks}\r\n                         getItemKey={PlacemarksPanel.getPlacemarkItemKey}\r\n                         renderItem={this.renderPlacemarkItem}\r\n                         selectionMode={ListBoxSelectionMode.SINGLE}\r\n                         selection={this.props.selectedPlacemarkId}\r\n                         onSelection={this.handleChangedPlacemarkSelection}/>\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    private renderPlacemarkItem(placemark: Placemark) {\r\n        return <PlacemarkItem placemark={placemark}\r\n                              onDoubleClick={this.handlePlacemarkDoubleClick}\r\n                              onVisibilityChange={this.handleChangedPlacemarkVisibility}\r\n                              onCopyPlacemarkCsv={this.handleCopyGeometryAsCsv}\r\n                              onCopyPlacemarkWkt={this.handleCopyGeometryAsWkt}\r\n                              onCopyPlacemarkGeoJSON={this.handleCopyGeometryAsGeoJson}\r\n        />;\r\n    }\r\n\r\n    private renderPlacemarkDetails() {\r\n        const placemarks = this.props.placemarkCollection.features;\r\n        if (!placemarks || !placemarks.length) {\r\n            return null;\r\n        }\r\n        const placemark = this.props.selectedPlacemark;\r\n        if (!placemark) {\r\n            return NO_PLACE_SELECTED;\r\n        }\r\n        return (\r\n            <div style={{width: '100%'}}>\r\n                <Label key=\"spacer\"> </Label>\r\n                {this.renderPlacemarkTitle()}\r\n                {this.renderPlacemarkGeometry()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderPlacemarkTitle() {\r\n        const placemark = this.props.selectedPlacemark;\r\n        const name = placemark.properties['title'];\r\n        return (\r\n            <Label className=\"bp3-inline\">\r\n                Name\r\n                <span className=\"bp3-text-muted\"> (optional)</span>\r\n                <TextField value={{textValue: name, value: name}}\r\n                           onChange={this.handleChangedPlacemarkName}\r\n                           size={16}\r\n                           uncontrolled={true}\r\n                           placeholder=\"Placemark name\"\r\n                />\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderPlacemarkGeometry() {\r\n        const placemark = this.props.selectedPlacemark;\r\n        const geometry = placemark.geometry;\r\n        if (geometry.type === 'Point') {\r\n            const position = geometry.coordinates;\r\n            return (\r\n                <div>\r\n                    <Label className=\"bp3-inline\">\r\n                        Longitude\r\n                        <span className=\"bp3-text-muted\"> (in degrees)</span>\r\n                        <NumericField value={position[0]}\r\n                                      onChange={this.handleChangedPointLongitude}\r\n                                      size={12}\r\n                                      uncontrolled={true}\r\n                                      min={-180}\r\n                                      max={+180}\r\n                                      placeholder=\"Longitude in degrees\"/>\r\n                    </Label>\r\n                    <Label className=\"bp3-inline\">\r\n                        Latitude\r\n                        <span className=\"bp3-text-muted\"> (in degrees)</span>\r\n                        <NumericField value={position[1]}\r\n                                      onChange={this.handleChangedPointLatitude}\r\n                                      size={12}\r\n                                      uncontrolled={true}\r\n                                      min={-90}\r\n                                      max={+90}\r\n                                      placeholder=\"Latitude in degrees\"/>\r\n                    </Label>\r\n                </div>\r\n            );\r\n        } else if (isBox(geometry)) {\r\n            // TODO (nf): allow editing box coordinates\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(PlacemarksPanel);\r\n\r\n\r\ninterface IPlacemarkItemProps {\r\n    placemark: Placemark;\r\n    onVisibilityChange: (placemark: Placemark, visible?) => void;\r\n    onCopyPlacemarkCsv: (placemark: Placemark) => void;\r\n    onCopyPlacemarkWkt: (placemark: Placemark) => void;\r\n    onCopyPlacemarkGeoJSON: (placemark: Placemark) => void;\r\n    onDoubleClick: (placemark: Placemark) => void;\r\n}\r\n\r\n\r\nclass PlacemarkItem extends React.PureComponent<IPlacemarkItemProps, {}> {\r\n\r\n    static readonly DIV_STYLE: CSSProperties = {display: 'flex', alignItems: 'center'};\r\n    static readonly CHECK_STYLE: CSSProperties = {flexGrow: 0, margin: 0};\r\n    static readonly LABEL_STYLE: CSSProperties = {flexGrow: 1};\r\n    static readonly ICON_STYLE: CSSProperties = {marginLeft: '0.5em'};\r\n    static readonly NAME_STYLE: CSSProperties = {marginLeft: '0.5em'};\r\n    static readonly INFO_STYLE: CSSProperties = {float: 'right', color: Colors.BLUE5};\r\n\r\n    placemarkItemRef = createRef<HTMLDivElement>();\r\n\r\n    constructor(props: IPlacemarkItemProps) {\r\n        super(props);\r\n        this.handleVisibilityChanged = this.handleVisibilityChanged.bind(this);\r\n        this.handleCopyPlacemarkCsv = this.handleCopyPlacemarkCsv.bind(this);\r\n        this.handleCopyPlacemarkWkt = this.handleCopyPlacemarkWkt.bind(this);\r\n        this.handleCopyPlacemarksGeoJSON = this.handleCopyPlacemarksGeoJSON.bind(this);\r\n        this.handleDoubleClick = this.handleDoubleClick.bind(this);\r\n    }\r\n\r\n    handleDoubleClick() {\r\n        this.props.onDoubleClick(this.props.placemark);\r\n    }\r\n\r\n    handleCopyPlacemarkCsv() {\r\n        this.props.onCopyPlacemarkCsv(this.props.placemark);\r\n    }\r\n\r\n    handleCopyPlacemarkWkt() {\r\n        this.props.onCopyPlacemarkWkt(this.props.placemark);\r\n    }\r\n\r\n    handleCopyPlacemarksGeoJSON() {\r\n        this.props.onCopyPlacemarkGeoJSON(this.props.placemark);\r\n    }\r\n\r\n    handleVisibilityChanged(event) {\r\n        this.props.onVisibilityChange(this.props.placemark, event.target.checked)\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        const rightClickMe = this.placemarkItemRef.current;\r\n\r\n        if (rightClickMe) {\r\n            rightClickMe.oncontextmenu = (e: MouseEvent) => {\r\n                // prevent the browser's native context menu\r\n                e.preventDefault();\r\n\r\n                // render a Menu without JSX...\r\n                const menu = React.createElement(\r\n                    Menu,\r\n                    {}, // empty props\r\n                    React.createElement(MenuItem, {onClick: this.handleCopyPlacemarkCsv, text: \"Copy as CSV\"}),\r\n                    React.createElement(MenuItem, {onClick: this.handleCopyPlacemarkWkt, text: \"Copy as WKT\"}),\r\n                    React.createElement(MenuItem, {\r\n                        onClick: this.handleCopyPlacemarksGeoJSON,\r\n                        text: \"Copy as GeoJSON\"\r\n                    }),\r\n                );\r\n\r\n                // mouse position is available on event\r\n                ContextMenu.show(menu, {left: e.clientX, top: e.clientY}, () => {\r\n                    // menu was closed; callback optional\r\n                });\r\n            };\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        const placemark = this.props.placemark;\r\n        const visible = placemark.properties['visible'];\r\n        const title = placemark.properties['title'];\r\n        const geometry = placemark.geometry;\r\n        let icon: IconName;\r\n        let info;\r\n        if (geometry.type === 'Point') {\r\n            const position = geometry.coordinates;\r\n            info = ` ${position[0].toFixed(3)}, ${position[1].toFixed(3)}`;\r\n            icon = 'dot';\r\n        } else if (geometry.type === 'LineString') {\r\n            const coordinates = geometry.coordinates;\r\n            info = ` ${coordinates.length} positions`;\r\n            icon = 'slash';\r\n        } else if (geometry.type === 'Polygon') {\r\n            const ring = geometry.coordinates[0] as any;\r\n            info = ` ${ring.length - 1} positions`;\r\n            icon = isBox(geometry) ? 'widget' : 'polygon-filter';\r\n        }\r\n\r\n\r\n        return (\r\n            <div ref={this.placemarkItemRef} style={PlacemarkItem.DIV_STYLE}>\r\n                <Icon style={{marginRight: '4px'}} icon={visible ? 'eye-open': 'eye-off'} />\r\n                <Checkbox\r\n                    style={PlacemarkItem.CHECK_STYLE}\r\n                    checked={isBoolean(visible) ? visible : true}\r\n                    onChange={this.handleVisibilityChanged} />\r\n                <div onDoubleClick={this.handleDoubleClick} style={PlacemarkItem.LABEL_STYLE}>\r\n                    <span style={PlacemarkItem.ICON_STYLE}><Icon icon={icon}/></span>\r\n                    <span style={PlacemarkItem.NAME_STYLE}>{title}</span>\r\n                    <span style={PlacemarkItem.INFO_STYLE}>{info}</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport { AnchorButton, Checkbox, ControlGroup, Icon, InputGroup, Label } from '@blueprintjs/core';\r\n\r\nimport { State } from '../state';\r\nimport * as selectors from '../selectors';\r\nimport * as actions from '../actions';\r\nimport { ViewState } from '../components/ViewState';\r\nimport { NO_ACTIVE_VIEW } from '../messages';\r\n\r\n\r\ninterface IViewPanelDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IViewPanelProps {\r\n    activeView: ViewState<any> | null;\r\n    activeViewId: string | null;\r\n    lastBaseMapId: string;\r\n    showLayerTextOverlay: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IViewPanelProps {\r\n    return {\r\n        activeView: selectors.activeViewSelector(state),\r\n        activeViewId: selectors.activeViewIdSelector(state),\r\n        lastBaseMapId: state.session.lastBaseMapId,\r\n        showLayerTextOverlay: state.session.showLayerTextOverlay,\r\n    };\r\n}\r\n\r\n/**\r\n * The LayersPanel is used to select and browse available layers.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass ViewPanel extends React.Component<IViewPanelProps & IViewPanelDispatch, null> {\r\n\r\n    private static ACTION_ITEM_STYLE = {margin: '0.1em 0em 2em 0em'};\r\n    private static PROPERTY_ITEM_STYLE = {margin: '0.1em 0em 0.6em 0em'};\r\n    private static PROPERTY_ITEM_CONTROL_GROUP_STYLE = {display: 'flex', alignItems: 'center'};\r\n    private static PROPERTY_ITEM_CONTROL_GROUP_MEMBER_STYLE = {marginBlock: 0};\r\n\r\n    constructor(props: IViewPanelProps & IViewPanelDispatch) {\r\n        super(props);\r\n        this.onViewModeChange = this.onViewModeChange.bind(this);\r\n        this.onAddWorldView = this.onAddWorldView.bind(this);\r\n        this.onShowLayerTextOverlayChange = this.onShowLayerTextOverlayChange.bind(this);\r\n    }\r\n\r\n    onViewModeChange(ev: any) {\r\n        this.props.dispatch(actions.setViewMode(this.props.activeViewId, ev.target.value));\r\n    }\r\n\r\n    onShowLayerTextOverlayChange(ev) {\r\n        const showLayerTextOverlay = ev.target.checked;\r\n        this.props.dispatch(actions.updateSessionState({showLayerTextOverlay}));\r\n    }\r\n\r\n    onAddWorldView() {\r\n        this.props.dispatch(actions.addWorldView(this.props.activeViewId, this.props.lastBaseMapId));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div style={{margin: '0.2em 0.2em 0.2em 0.2em'}}>\r\n                <AnchorButton icon=\"globe\"\r\n                              style={ViewPanel.ACTION_ITEM_STYLE}\r\n                              onClick={this.onAddWorldView}>New World View</AnchorButton>\r\n                {this.renderActiveViewPanel()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderActiveViewPanel() {\r\n\r\n        const activeView = this.props.activeView;\r\n        if (!activeView) {\r\n            return NO_ACTIVE_VIEW;\r\n        }\r\n\r\n        // TODO (forman): make title field editable\r\n        const titleField = (\r\n            <Label style={ViewPanel.PROPERTY_ITEM_STYLE}>\r\n                Active view:\r\n                <ControlGroup style={ViewPanel.PROPERTY_ITEM_CONTROL_GROUP_STYLE}>\r\n                    <Icon icon={activeView.icon}\r\n                          style={ViewPanel.PROPERTY_ITEM_CONTROL_GROUP_MEMBER_STYLE}/>\r\n                    <InputGroup\r\n                        style={ViewPanel.PROPERTY_ITEM_CONTROL_GROUP_MEMBER_STYLE}\r\n                        type=\"text\"\r\n                        value={activeView.title}\r\n                        dir=\"auto\"\r\n                        disabled={true}\r\n                    />\r\n                </ControlGroup>\r\n            </Label>\r\n        );\r\n\r\n        if (activeView.type === 'world') {\r\n\r\n            return (\r\n                <div>\r\n                    {titleField}\r\n\r\n                    <Checkbox label=\"Show layer text overlay\"\r\n                              style={ViewPanel.PROPERTY_ITEM_STYLE}\r\n                              checked={this.props.showLayerTextOverlay}\r\n                              onChange={this.onShowLayerTextOverlayChange}/>\r\n                </div>\r\n            );\r\n        } else {\r\n            return titleField;\r\n        }\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(ViewPanel);\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { AnchorButton, ButtonGroup, Icon, Intent, ProgressBar, Card } from '@blueprintjs/core';\r\nimport { State, TaskState } from '../state';\r\nimport * as actions from '../actions';\r\nimport {\r\n    getJobFailureIconName,\r\n    getJobFailureIntentName,\r\n    getJobFailureTitle,\r\n    JobFailure,\r\n    JobStatusEnum\r\n} from '../webapi';\r\n\r\ninterface ITaskComponentProps {\r\n    task: TaskState;\r\n    jobId: string;\r\n\r\n    onCancelJob(number): void;\r\n\r\n    onRemoveJob(number): void;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: ITaskComponentProps): ITaskComponentProps {\r\n    return ownProps;\r\n}\r\n\r\nclass TaskComponent extends React.Component<DispatchProp<State> & ITaskComponentProps, null> {\r\n    static readonly FLEX_ROW_STYLE: CSSProperties = {display: 'flex', flexFlow: 'row nowrap', width: '100%'};\r\n    static readonly PROGRESS_STYLE: CSSProperties = {\r\n        flex: '3 1 auto',\r\n        display: 'flex',\r\n        flexFlow: 'column',\r\n        justifyContent: 'center',\r\n        paddingRight: 10\r\n    };\r\n\r\n    constructor(props: ITaskComponentProps) {\r\n        super(props);\r\n        this.handleShowDetails = this.handleShowDetails.bind(this);\r\n    }\r\n\r\n    handleShowDetails() {\r\n        this.props.dispatch(actions.showJobFailureDetails(this.props.task.title, this.props.task.failure));\r\n    }\r\n\r\n    private static isRunning(taskState: TaskState): boolean {\r\n        return taskState.status === JobStatusEnum.NEW ||\r\n               taskState.status === JobStatusEnum.SUBMITTED ||\r\n               taskState.status === JobStatusEnum.IN_PROGRESS;\r\n    }\r\n\r\n    private static isMakingProgress(taskState: TaskState): boolean {\r\n        return taskState.status === JobStatusEnum.IN_PROGRESS && !!taskState.progress;\r\n    }\r\n\r\n    private static renderIcon(jobFailure: JobFailure) {\r\n        const icon = getJobFailureIconName(jobFailure);\r\n        const intent = getJobFailureIntentName(jobFailure);\r\n        return (\r\n            <Icon icon={icon} intent={intent} style={{paddingRight: '0.4em'}}/>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        const taskState = this.props.task;\r\n        const jobId = this.props.jobId;\r\n\r\n        let title = (<p>{taskState.title || `Task #${jobId}`}:</p>);\r\n        let body = null;\r\n\r\n        if (TaskComponent.isRunning(taskState)) {\r\n            if (TaskComponent.isMakingProgress(taskState)) {\r\n                // cancel is only possible, if we have a progress monitor\r\n                let progressValue = 0;\r\n                if (taskState.progress.total > 0 && taskState.progress.worked > 0) {\r\n                    progressValue = taskState.progress.worked / taskState.progress.total;\r\n                }\r\n                const progressBar = (<ProgressBar intent={Intent.SUCCESS} value={progressValue}/>);\r\n                const cancelJob = () => this.props.onCancelJob(jobId);\r\n                const cancelButton = (<AnchorButton type=\"button\" onClick={cancelJob} text=\"Cancel\"/>);\r\n\r\n                const cancelableProgress = (\r\n                    <div style={TaskComponent.FLEX_ROW_STYLE}>\r\n                        <div style={TaskComponent.PROGRESS_STYLE}>{progressBar}</div>\r\n                        <div style={{flex: '0 1 auto'}}>{cancelButton}</div>\r\n                    </div>\r\n                );\r\n\r\n                let progressMag = null;\r\n                if (taskState.progress && taskState.progress.message) {\r\n                    progressMag = (<div className=\"bp3-text-muted\">{taskState.progress.message}</div>);\r\n                }\r\n                body = (<div>{cancelableProgress}{progressMag}</div>);\r\n            } else {\r\n                body = (<ProgressBar/>);\r\n            }\r\n        } else if (taskState.status === JobStatusEnum.CANCELLED || taskState.status === JobStatusEnum.FAILED) {\r\n            const removeJob = () => this.props.onRemoveJob(jobId);\r\n            let detailsButton;\r\n            let message;\r\n            if (taskState.status === JobStatusEnum.CANCELLED) {\r\n                message = <div>{TaskComponent.renderIcon(taskState.failure)}Task has been cancelled.</div>\r\n            } else {\r\n                detailsButton = (<AnchorButton onClick={this.handleShowDetails}>Details</AnchorButton>);\r\n                message = (\r\n                    <div>{TaskComponent.renderIcon(taskState.failure)}{getJobFailureTitle(taskState.failure)}<br/>\r\n                        <div className=\"bp3-text-muted\" style={{paddingTop: '0.4em'}}>{taskState.failure.message}</div>\r\n                    </div>\r\n                );\r\n            }\r\n            body = (\r\n                <div>\r\n                    <ButtonGroup className=\"bp3-minimal\" style={{float: 'right'}}>\r\n                        {detailsButton}\r\n                        <AnchorButton icon=\"cross\" onClick={removeJob}/>\r\n                    </ButtonGroup>\r\n                    {message}\r\n                </div>\r\n            );\r\n        }\r\n        return (<Card>{title}{body}</Card>);\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps)(TaskComponent);\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { State, TaskState } from '../state';\r\nimport { JobStatusEnum } from '../webapi';\r\nimport * as actions from '../actions';\r\nimport { Card } from '@blueprintjs/core';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\nimport TaskComponent from './TaskComponent';\r\n\r\ninterface ITaskPanelProps {\r\n    tasks: { [jobId: number]: TaskState };\r\n}\r\n\r\ninterface ITaskPanelDispatch {\r\n    cancelJob(number): void;\r\n\r\n    removeJob(number): void;\r\n}\r\n\r\nfunction mapStateToProps(state: State): ITaskPanelProps {\r\n    return {\r\n        tasks: state.communication.tasks\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    cancelJob: actions.cancelJob,\r\n    removeJob: actions.removeTaskState\r\n};\r\n\r\n/**\r\n * The TasksPanel is used display all tasks originating from cate desktop,\r\n * this includes progress and error messages.\r\n *\r\n * @author Marco Zuehlke\r\n */\r\nclass TasksPanel extends React.Component<ITaskPanelProps & ITaskPanelDispatch & DispatchProp<State>, null> {\r\n\r\n    render() {\r\n        const tasks: { [jobId: number]: TaskState } = this.props.tasks;\r\n\r\n        const taskComponents = [];\r\n        for (let jobId in tasks) {\r\n            if (tasks[jobId].status !== JobStatusEnum.DONE) {\r\n                taskComponents.push(<TaskComponent\r\n                    key={jobId}\r\n                    jobId={jobId}\r\n                    task={tasks[jobId]}\r\n                    onRemoveJob={this.props.removeJob}\r\n                    onCancelJob={this.props.cancelJob}\r\n                />);\r\n            }\r\n        }\r\n        if (taskComponents.length) {\r\n            return <ScrollablePanelContent>\r\n                {taskComponents}\r\n            </ScrollablePanelContent>;\r\n        } else {\r\n            return <Card>\r\n                <p><strong>There are currently no active tasks.</strong></p>\r\n            </Card>;\r\n        }\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TasksPanel as any);\r\n","import * as React from 'react';\r\n\r\nexport interface TermsAndConditionsProps {\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n}\r\n\r\nexport function TermsAndConditions({className, style}: TermsAndConditionsProps) {\r\n    return (\r\n        <a\r\n            className={className}\r\n            style={style}\r\n            href=\"https://climate.esa.int/en/terms-and-conditions/\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n        >\r\n            Terms & Conditions\r\n        </a>\r\n    );\r\n}\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { Intent, Tag } from '@blueprintjs/core';\r\nimport { CATE_APP_VERSION } from '../../version';\r\nimport { State } from '../state';\r\n\r\n\r\ninterface IVersionTagsOwnProps {\r\n    minimal?: boolean;\r\n}\r\n\r\ninterface IVersionTagsProps extends IVersionTagsOwnProps {\r\n    uiVersion: string;\r\n    apiVersion: string | null;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: IVersionTagsOwnProps): IVersionTagsProps {\r\n    let serviceInfo = state.communication.webAPIServiceInfo;\r\n    return {\r\n        uiVersion: CATE_APP_VERSION,\r\n        apiVersion: serviceInfo ? serviceInfo.version : null,\r\n        minimal: ownProps.minimal,\r\n    };\r\n}\r\n\r\nconst VersionTags: React.FC<IVersionTagsProps> = ({\r\n                                                      uiVersion,\r\n                                                      apiVersion,\r\n                                                      minimal,\r\n                                                  }) => {\r\n    return (\r\n        <div>\r\n            <VersionTag\r\n                label=\"Cate UI\"\r\n                version={uiVersion}\r\n                minimal={minimal}\r\n            />\r\n            {apiVersion &&\r\n             <>\r\n                 &nbsp;\r\n                 <VersionTag\r\n                     label=\"Cate API\"\r\n                     version={apiVersion}\r\n                     minimal={minimal}\r\n                 />\r\n             </>}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default connect(mapStateToProps)(VersionTags);\r\n\r\n\r\ninterface IVersionTagProps {\r\n    label: string;\r\n    version: string;\r\n    minimal?: boolean;\r\n}\r\n\r\n\r\nconst VersionTag: React.FC<IVersionTagProps> = (\r\n    {\r\n        label,\r\n        version,\r\n        minimal\r\n    }\r\n) => {\r\n    const isDevVersion = version.includes('dev');\r\n    const intent = isDevVersion ? Intent.WARNING : Intent.NONE;\r\n    return (\r\n        <Tag\r\n            intent={intent}\r\n            round={true}\r\n            minimal={minimal}\r\n        >\r\n            {label}&nbsp;{version}\r\n        </Tag>\r\n    );\r\n}\r\n\r\n","// IMPORTANT: Any changes of CATE_APP_VERSION must be synchronized\n// with the version field in \"../package.json\".\n//\nexport const CATE_APP_VERSION = \"3.1.5-dev.0\";\n\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport {\r\n    Icon,\r\n    IconName,\r\n    Intent,\r\n    Popover,\r\n    PopoverInteractionKind,\r\n    Position,\r\n    ProgressBar,\r\n    Tooltip\r\n} from '@blueprintjs/core';\r\n\r\nimport { TermsAndConditions } from '../components/TermsAndConditions';\r\nimport { GeographicPosition, State, TaskState, WebAPIStatus } from '../state';\r\nimport * as selectors from '../selectors';\r\nimport * as actions from '../actions';\r\nimport { JobStatusEnum } from '../webapi';\r\nimport TaskComponent from './TaskComponent';\r\nimport VersionTags from './VersionTags';\r\n\r\n\r\ninterface IStatusBarProps {\r\n    webAPIStatus: WebAPIStatus | null;\r\n    webAPIServiceURL: string;\r\n    tasks: { [jobId: number]: TaskState };\r\n    globePosition: GeographicPosition | null;\r\n}\r\n\r\ninterface IStatusBarDispatch {\r\n    cancelJob(number): void;\r\n\r\n    removeJob(number): void;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IStatusBarProps {\r\n    return {\r\n        webAPIStatus: state.communication.webAPIStatus,\r\n        webAPIServiceURL: state.communication.webAPIServiceURL,\r\n        tasks: state.communication.tasks,\r\n        globePosition: selectors.globeMousePositionSelector(state) || selectors.globeViewPositionSelector(state),\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    cancelJob: actions.cancelJob,\r\n    removeJob: actions.removeTaskState\r\n};\r\n\r\n/**\r\n * The TasksPanel is used display all tasks originating from cate desktop,\r\n * this includes progress and error messages.\r\n */\r\nclass StatusBar extends React.Component<IStatusBarProps & IStatusBarDispatch & DispatchProp<State>, null> {\r\n\r\n    static readonly DIV_STYLE: CSSProperties = {\r\n        flex: 'none',\r\n        display: 'flex',\r\n        flexFlow: 'row nowrap',\r\n        height: '1.5em',\r\n        fontSize: 'small',\r\n        backgroundColor: '#2B95D6',\r\n        overflow: 'hidden',\r\n    };\r\n\r\n    static readonly DIV_MARGIN: CSSProperties = {margin: \"2px 4px 2px 4px\"};\r\n    static readonly DIV_MESSAGE_STYLE: CSSProperties = {flex: '60 1 auto', ...StatusBar.DIV_MARGIN};\r\n    static readonly DIV_TAC_STYLE: CSSProperties = {flex: '0 1 auto', ...StatusBar.DIV_MARGIN};\r\n    static readonly DIV_TASKS_STYLE: CSSProperties = {flex: '20 1 auto', ...StatusBar.DIV_MARGIN};\r\n    static readonly DIV_CURSOR_STYLE: CSSProperties = {flex: '20 1 auto', ...StatusBar.DIV_MARGIN};\r\n    static readonly DIV_STATUS_STYLE: CSSProperties = {flex: '0 1 auto', margin: \"0px 4px 0px 4px\"};\r\n\r\n    render() {\r\n        // TODO dummy\r\n        const message = 'Ready.';\r\n\r\n        let cursor;\r\n        let position = this.props.globePosition;\r\n        if (position) {\r\n            cursor = `lon=${position.longitude.toFixed(2)}, lat=${position.latitude.toFixed(2)}`\r\n        } else {\r\n            cursor = '';\r\n        }\r\n\r\n        return (\r\n            <div style={StatusBar.DIV_STYLE}>\r\n                <div style={StatusBar.DIV_MESSAGE_STYLE}>{message}</div>\r\n                <div style={StatusBar.DIV_TASKS_STYLE}>{this.renderTasks()}</div>\r\n                <div style={StatusBar.DIV_CURSOR_STYLE}>{cursor}</div>\r\n                <div style={StatusBar.DIV_TAC_STYLE}>{<TermsAndConditions/>}</div>\r\n                <VersionTags minimal={true}/>\r\n                <div style={StatusBar.DIV_STATUS_STYLE}>{this.renderBackendStatus()}</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderTasks() {\r\n        const tasks: { [jobId: number]: TaskState } = this.props.tasks;\r\n\r\n        let numRunningTasks = 0;\r\n        let numFailedTasks = 0;\r\n        const taskComponents = [];\r\n        for (let jobId in tasks) {\r\n            const task = tasks[jobId];\r\n            let render = false;\r\n            if (task.status === JobStatusEnum.SUBMITTED || task.status === JobStatusEnum.IN_PROGRESS) {\r\n                numRunningTasks++;\r\n                render = true;\r\n            } else if (task.status === JobStatusEnum.CANCELLED || task.status === JobStatusEnum.FAILED) {\r\n                numFailedTasks++;\r\n                render = true;\r\n            }\r\n            if (render) {\r\n                taskComponents.push(\r\n                    <TaskComponent\r\n                        key={jobId}\r\n                        jobId={jobId}\r\n                        task={this.props.tasks[jobId]}\r\n                        onRemoveJob={this.props.removeJob}\r\n                        onCancelJob={this.props.cancelJob}\r\n                    />);\r\n            }\r\n        }\r\n\r\n        if (taskComponents.length > 0) {\r\n            let msg;\r\n            let spinner = null;\r\n            if (numRunningTasks > 0 && numFailedTasks > 0) {\r\n                msg = `${numRunningTasks} running / ${numFailedTasks} failed task(s)`;\r\n            } else if (numRunningTasks > 0) {\r\n                msg = `${numRunningTasks} running task(s)`;\r\n            } else if (numFailedTasks > 0) {\r\n                msg = `${numFailedTasks} failed task(s)`;\r\n            }\r\n            if (numRunningTasks > 0) {\r\n                spinner = (\r\n                    <div style={{\r\n                        display: 'flex',\r\n                        flexFlow: 'column',\r\n                        justifyContent: 'center',\r\n                        width: '12em',\r\n                        height: '1.5em'\r\n                    }}>\r\n                        <ProgressBar intent={Intent.SUCCESS}/>\r\n                    </div>);\r\n            }\r\n            const tasksInPopover = <div style={{width: '300px'}}>{taskComponents}</div>;\r\n            return (\r\n                <Popover\r\n                    content={tasksInPopover}\r\n                    position={Position.TOP}\r\n                    interactionKind={PopoverInteractionKind.HOVER}>\r\n                    <div style={{display: 'flex', flexFlow: 'row nowrap'}}>\r\n                        {spinner}\r\n                        <div\r\n                            style={{display: 'flex', flexFlow: 'column', justifyContent: 'center', paddingLeft: '5px'}}>\r\n                            {msg}\r\n                        </div>\r\n                    </div>\r\n                </Popover>\r\n            );\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private renderBackendStatus() {\r\n        let icon: IconName;\r\n        let tooltipText;\r\n        const mode = ` (${this.props.webAPIServiceURL})`;\r\n        if (this.props.webAPIStatus === 'connecting') {\r\n            icon = 'link';\r\n            tooltipText = 'Connecting' + mode;\r\n        } else if (this.props.webAPIStatus === 'open') {\r\n            icon = 'link';\r\n            tooltipText = 'Connected' + mode;\r\n        } else if (this.props.webAPIStatus === 'error') {\r\n            icon = 'offline';\r\n            tooltipText = 'Error' + mode;\r\n        } else if (this.props.webAPIStatus === 'closed') {\r\n            icon = 'offline';\r\n            tooltipText = 'Closed' + mode;\r\n        } else {\r\n            icon = 'help';\r\n            tooltipText = 'Unknown' + mode;\r\n        }\r\n        return (\r\n            <Tooltip content={tooltipText} hoverOpenDelay={1500} position={Position.LEFT_TOP}>\r\n                <Icon icon={icon} iconSize={12}/>\r\n            </Tooltip>\r\n        );\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(StatusBar as any);\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\n\r\nexport interface ISubPanelHeaderProps {\r\n    title: string;\r\n    divStyle?: React.CSSProperties;\r\n    titleStyle?: React.CSSProperties;\r\n}\r\n\r\n/**\r\n * A header for a sub-panel component.\r\n *\r\n * @author Hans Permana\r\n */\r\nexport class SubPanelHeader extends React.PureComponent<ISubPanelHeaderProps, any> {\r\n    static readonly DIV_STYLE: CSSProperties = {\r\n        margin: '12px 0 6px 0', padding: '2px 6px', backgroundColor: '#3c5161'\r\n    };\r\n\r\n    static readonly SPAN_STYLE: CSSProperties = {\r\n        color: '#aaafaf', fontSize: '0.9em', fontWeight: 100\r\n    };\r\n\r\n    render() {\r\n        const divStyle = this.props.divStyle ? {...SubPanelHeader.DIV_STYLE, ...this.props.divStyle} : SubPanelHeader.DIV_STYLE;\r\n        const titleStyle = this.props.titleStyle ? {...SubPanelHeader.SPAN_STYLE, ...this.props.titleStyle} : SubPanelHeader.SPAN_STYLE;\r\n        return (\r\n            <div style={divStyle}>\r\n                <span style={titleStyle}>{this.props.title}</span>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { ButtonGroup, Checkbox, HTMLSelect, Icon, Intent, Label, Radio, RadioGroup, Slider } from '@blueprintjs/core';\r\n\r\nimport {\r\n    BaseMapState,\r\n    ColorMapCategoryState,\r\n    ImageLayerState,\r\n    LayerState,\r\n    SPLIT_MODE_LEFT,\r\n    SPLIT_MODE_OFF,\r\n    SPLIT_MODE_RIGHT,\r\n    State,\r\n    VariableImageLayerState,\r\n    VariableState\r\n} from '../state';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ContentWithDetailsPanel } from '../components/ContentWithDetailsPanel';\r\nimport LayerSourcesDialog from './LayerSourcesDialog';\r\nimport { AUTO_LAYER_ID, getLayerDisplayName, getLayerTypeIconName } from '../state-util';\r\nimport { ScrollablePanelContent } from '../components/ScrollableContent';\r\nimport { ViewState } from '../components/ViewState';\r\nimport { NO_LAYER_SELECTED, NO_LAYERS_EMPTY_VIEW, NO_LAYERS_NO_VIEW } from '../messages';\r\nimport { SubPanelHeader } from '../components/SubPanelHeader';\r\nimport { ToolButton } from '../components/ToolButton';\r\n\r\n\r\ninterface ILayersPanelProps {\r\n    offlineMode: boolean;\r\n    selectedVariable: VariableState | null;\r\n    activeView: ViewState<any> | null;\r\n    layers: Array<LayerState>;\r\n    selectedLayerId: string | null;\r\n    selectedLayerIndex: number;\r\n    selectedLayer: LayerState | null;\r\n    selectedImageLayer: ImageLayerState | null;\r\n    selectedVariableImageLayer: VariableImageLayerState | null;\r\n    baseMaps: BaseMapState[];\r\n    baseMapId: string;\r\n    layerListHeight: number;\r\n    showLayerDetails: boolean;\r\n    colorMapCategories: Array<ColorMapCategoryState>;\r\n}\r\n\r\nfunction mapStateToProps(state: State): ILayersPanelProps {\r\n    return {\r\n        offlineMode: selectors.offlineModeSelector(state),\r\n        selectedVariable: selectors.selectedVariableSelector(state),\r\n        activeView: selectors.activeViewSelector(state),\r\n        layers: selectors.layersSelector(state),\r\n        selectedLayerId: selectors.selectedLayerIdSelector(state),\r\n        selectedLayerIndex: selectors.selectedLayerIndexSelector(state),\r\n        selectedLayer: selectors.selectedLayerSelector(state),\r\n        selectedImageLayer: selectors.selectedImageLayerSelector(state),\r\n        selectedVariableImageLayer: selectors.selectedVariableImageLayerSelector(state),\r\n        baseMaps: selectors.baseMapsSelector(state),\r\n        baseMapId: selectors.baseMapIdSelector(state),\r\n        layerListHeight: state.session.layerListHeight,\r\n        showLayerDetails: state.session.showLayerDetails,\r\n        colorMapCategories: selectors.colorMapCategoriesSelector(state)\r\n    };\r\n}\r\n\r\n/**\r\n * The LayersPanel is used to select and browse available layers.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nclass LayersPanel extends React.Component<ILayersPanelProps & DispatchProp<State>, null> {\r\n\r\n    static readonly SLIDER_DIV_STYLE_10 = {width: '100%', paddingLeft: '1em', paddingRight: '1em'};\r\n    static readonly LABEL_SPAN_STYLE_100 = {flexBasis: '100px', paddingLeft: '5px'};\r\n    static readonly LAYER_DIV_STYLE = {\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'flex-start',\r\n        height: '100%'\r\n    };\r\n    static readonly LAYER_LABEL_ELEMENT_STYLE = {marginLeft: '0.5em'};\r\n    static readonly LAYER_CHECKBOX_STYLE = {flexGrow: 0, margin: 0};\r\n    static readonly BG_MAP_CONTAINER_STYLE = {display: 'flex', alignItems: 'center', marginTop: 3, marginBottom: 3};\r\n    static readonly BG_MAP_LABEL_STYLE = {flexGrow: 0, marginRight: 3};\r\n    static readonly BG_MAP_VALUE_STYLE = {flexGrow: 1, marginRight: 1, display: 'flex', justifyContent: 'flex-end'};\r\n\r\n    constructor(props: ILayersPanelProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.handleShowDetailsChanged = this.handleShowDetailsChanged.bind(this);\r\n        this.handleListHeightChanged = this.handleListHeightChanged.bind(this);\r\n        this.handleAddLayerButtonClicked = this.handleAddLayerButtonClicked.bind(this);\r\n        this.handleRemoveLayerButtonClicked = this.handleRemoveLayerButtonClicked.bind(this);\r\n        this.handleMoveLayerUpButtonClicked = this.handleMoveLayerUpButtonClicked.bind(this);\r\n        this.handleMoveLayerDownButtonClicked = this.handleMoveLayerDownButtonClicked.bind(this);\r\n        this.handleChangedLayerSelection = this.handleChangedLayerSelection.bind(this);\r\n        this.handleChangedLayerVisibility = this.handleChangedLayerVisibility.bind(this);\r\n        this.handleChangedLayerSplitMode = this.handleChangedLayerSplitMode.bind(this);\r\n        this.handleChangedBaseMap = this.handleChangedBaseMap.bind(this);\r\n        this.renderLayerItem = this.renderLayerItem.bind(this);\r\n    }\r\n\r\n    private static getLayerItemKey(layer: LayerState) {\r\n        return layer.id;\r\n    }\r\n\r\n    private static stopPropagation(event) {\r\n        event.stopPropagation();\r\n    }\r\n\r\n    private static capitalizeFirstLetter(string: string) {\r\n        return string.charAt(0).toUpperCase() + string.slice(1);\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        if (!this.props.colorMapCategories) {\r\n            this.props.dispatch(actions.loadColorMaps() as any);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        let activeView = this.props.activeView;\r\n        if (!activeView || activeView.type !== 'world') {\r\n            return NO_LAYERS_NO_VIEW;\r\n        }\r\n\r\n        return (\r\n            <div style={{width: '100%'}}>\r\n                <ContentWithDetailsPanel showDetails={this.props.showLayerDetails}\r\n                                         onShowDetailsChange={this.handleShowDetailsChanged}\r\n                                         isSplitPanel={true}\r\n                                         contentHeight={this.props.layerListHeight}\r\n                                         onContentHeightChange={this.handleListHeightChanged}\r\n                                         actionComponent={this.renderActionButtonRow()}>\r\n                    <div>\r\n                        {this.renderBackgroundMapSelector()}\r\n                        {this.renderLayersList()}\r\n                    </div>\r\n                    {this.renderLayerDetails()}\r\n                </ContentWithDetailsPanel>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private handleShowDetailsChanged(value: boolean) {\r\n        this.props.dispatch(actions.setSessionProperty('showLayerDetails', value));\r\n    }\r\n\r\n    private handleListHeightChanged(value: number) {\r\n        this.props.dispatch(actions.setSessionProperty('layerListHeight', value));\r\n    }\r\n\r\n    private handleAddLayerButtonClicked() {\r\n        this.props.dispatch(actions.showDialog('layerSourcesDialog'));\r\n    }\r\n\r\n    private handleRemoveLayerButtonClicked() {\r\n        this.props.dispatch(actions.removeLayer(this.props.activeView.id, this.props.selectedLayerId));\r\n    }\r\n\r\n    private handleMoveLayerUpButtonClicked() {\r\n        this.props.dispatch(actions.moveLayerUp(this.props.activeView.id, this.props.selectedLayerId));\r\n    }\r\n\r\n    private handleMoveLayerDownButtonClicked() {\r\n        this.props.dispatch(actions.moveLayerDown(this.props.activeView.id, this.props.selectedLayerId));\r\n    }\r\n\r\n    private handleChangedLayerVisibility(layer: LayerState, visible: boolean) {\r\n        this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {visible}) as any);\r\n    }\r\n\r\n    private handleChangedLayerSplitMode(event) {\r\n        this.props.dispatch(actions.setLayerSplitMode(this.props.activeView.id,\r\n                                                      this.props.selectedLayerId,\r\n                                                      event.target.value));\r\n    }\r\n\r\n    private handleChangedLayerSelection(newSelection: string[]) {\r\n        const selectedLayerId = newSelection.length ? newSelection[0] : null;\r\n        this.props.dispatch(actions.setSelectedLayerId(this.props.activeView.id, selectedLayerId));\r\n    }\r\n\r\n    private handleChangedBaseMap(event: React.ChangeEvent<HTMLSelectElement>) {\r\n        this.props.dispatch(actions.setBaseMap(this.props.activeView.id, event.target.value) as any);\r\n    }\r\n\r\n    private renderLayerItem(layer: LayerState) {\r\n        return (\r\n            <div style={LayersPanel.LAYER_DIV_STYLE}>\r\n                <Icon style={{marginRight: '4px'}} icon={layer.visible ? 'eye-open': 'eye-off'} />\r\n                <Checkbox\r\n                    style={LayersPanel.LAYER_CHECKBOX_STYLE}\r\n                    checked={layer.visible}\r\n                    onClick={LayersPanel.stopPropagation}\r\n                    onChange={(event: any) => {\r\n                        this.handleChangedLayerVisibility(layer, event.target.checked)\r\n                    }}/>\r\n                <Icon style={LayersPanel.LAYER_LABEL_ELEMENT_STYLE} icon={getLayerTypeIconName(layer)} iconSize={12}/>\r\n                <span style={LayersPanel.LAYER_LABEL_ELEMENT_STYLE}>{getLayerDisplayName(layer)}</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderActionButtonRow() {\r\n        const layerCount = this.props.layers ? this.props.layers.length : 0;\r\n        const selectedLayerIndex = this.props.selectedLayerIndex;\r\n        const selectedLayer = this.props.selectedLayer;\r\n        const canRemoveLayer = selectedLayer && selectedLayer.id !== AUTO_LAYER_ID;\r\n        const canMoveLayerUp = selectedLayerIndex > 0;\r\n        const canMoveLayerDown = selectedLayerIndex >= 0 && selectedLayerIndex < layerCount - 1;\r\n        return (\r\n            <ButtonGroup>\r\n                <ToolButton\r\n                    tooltipContent=\"Add a new layer\"\r\n                    intent={Intent.PRIMARY}\r\n                    onClick={this.handleAddLayerButtonClicked}\r\n                    icon=\"add\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Remove selected layer\"\r\n                    disabled={!canRemoveLayer}\r\n                    onClick={this.handleRemoveLayerButtonClicked}\r\n                    icon=\"remove\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Move layer up\"\r\n                    disabled={!canMoveLayerUp}\r\n                    onClick={this.handleMoveLayerUpButtonClicked}\r\n                    icon=\"arrow-up\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <ToolButton\r\n                    tooltipContent=\"Move layer down\"\r\n                    disabled={!canMoveLayerDown}\r\n                    onClick={this.handleMoveLayerDownButtonClicked}\r\n                    icon=\"arrow-down\"\r\n                    tooltipPosition={'top'}\r\n                />\r\n                <LayerSourcesDialog/>\r\n            </ButtonGroup>\r\n        );\r\n    }\r\n\r\n    private renderBackgroundMapSelector() {\r\n        return (\r\n            <div style={LayersPanel.BG_MAP_CONTAINER_STYLE}>\r\n                <div style={LayersPanel.BG_MAP_LABEL_STYLE}>Base map:</div>\r\n                <div style={LayersPanel.BG_MAP_VALUE_STYLE}>\r\n                    <HTMLSelect\r\n                        disabled={this.props.offlineMode}\r\n                        value={this.props.offlineMode ? 'natural_offline' : this.props.baseMapId}\r\n                        onChange={this.handleChangedBaseMap}\r\n                    >\r\n                        {this.props.baseMaps.map(bgMap => (\r\n                            <option key={bgMap.id} value={bgMap.id}>\r\n                                {bgMap.title}\r\n                            </option>)\r\n                        )}\r\n                    </HTMLSelect>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderLayersList() {\r\n        const layers = this.props.layers;\r\n        if (!layers || !layers.length) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ScrollablePanelContent>\r\n                <ListBox\r\n                    items={layers}\r\n                    getItemKey={LayersPanel.getLayerItemKey}\r\n                    renderItem={this.renderLayerItem}\r\n                    selectionMode={ListBoxSelectionMode.SINGLE}\r\n                    selection={this.props.selectedLayerId}\r\n                    onSelection={this.handleChangedLayerSelection}\r\n                />\r\n            </ScrollablePanelContent>\r\n        );\r\n    }\r\n\r\n    private renderLayerDetails() {\r\n        const layers = this.props.layers;\r\n        if (!layers || !layers.length) {\r\n            return NO_LAYERS_EMPTY_VIEW;\r\n        }\r\n\r\n        if (!this.props.selectedLayer) {\r\n            return (\r\n                <React.Fragment>\r\n                    <Label style={{height: '20px'}}> </Label>\r\n                    {NO_LAYER_SELECTED}\r\n                </React.Fragment>\r\n            )\r\n        }\r\n\r\n        if (this.props.selectedImageLayer) {\r\n            return (\r\n                <div>\r\n                    {this.renderDataSelectionSection()}\r\n                    {this.renderSplitModeSection()}\r\n                </div>\r\n            )\r\n        }\r\n    }\r\n\r\n    private renderDataSelectionSection() {\r\n        const layer = this.props.selectedVariableImageLayer;\r\n        const variable = this.props.selectedVariable;\r\n        if (!layer || !variable || variable.numDims <= 2) {\r\n            return null;\r\n        }\r\n\r\n        const handleChangedLayerVarIndex = (i: number, value: number) => {\r\n            const varIndex = layer.varIndex.slice();\r\n            varIndex[i] = value;\r\n            this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {varIndex}) as any);\r\n        };\r\n\r\n        const n = variable.numDims - 2;\r\n        const dimensionRows = [];\r\n        for (let i = 0; i < n; i++) {\r\n            const dimension = variable.dimNames[i];\r\n            const max = variable.shape[i] - 1;\r\n            if (max > 0) {\r\n                const value = layer.varIndex[i];\r\n                dimensionRows.push(\r\n                    <Label key={dimension + '_index'} className=\"bp3-inline\" style={{display: 'flex'}}>\r\n                        <span\r\n                            style={LayersPanel.LABEL_SPAN_STYLE_100}>{LayersPanel.capitalizeFirstLetter(dimension) + ' index'}</span>\r\n                        <div style={{\r\n                            ...LayersPanel.SLIDER_DIV_STYLE_10,\r\n                            width: undefined,\r\n                            flex: 'auto 1',\r\n                            margin: 'auto 0'\r\n                        }}>\r\n                            <Slider min={0}\r\n                                    max={max}\r\n                                    stepSize={1}\r\n                                    labelStepSize={max}\r\n                                    value={value}\r\n                                    onChange={(value: number) => handleChangedLayerVarIndex(i, value)}\r\n                            />\r\n                        </div>\r\n                    </Label>\r\n                );\r\n            }\r\n        }\r\n\r\n        if (dimensionRows.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <React.Fragment>\r\n                <SubPanelHeader title=\"DATA SELECTION\"/>\r\n                {dimensionRows}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderSplitModeSection() {\r\n        const splitMode = this.props.selectedImageLayer.splitMode || SPLIT_MODE_OFF;\r\n        return (\r\n            <React.Fragment>\r\n                <SubPanelHeader title=\"LAYER SPLIT\"/>\r\n                <RadioGroup\r\n                    key=\"layerSplit\"\r\n                    inline={true}\r\n                    onChange={this.handleChangedLayerSplitMode}\r\n                    selectedValue={splitMode}\r\n                >\r\n                    <Radio label=\"Show left\" value={SPLIT_MODE_LEFT}/>\r\n                    <Radio label=\"Show right\" value={SPLIT_MODE_RIGHT}/>\r\n                    <Radio label=\"Off\" value={SPLIT_MODE_OFF}/>\r\n                </RadioGroup>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(LayersPanel);\r\n\r\n","import { Field, FieldType } from './Field';\r\nimport { INumericFieldProps, validateNumber } from './NumericField';\r\nimport { isUndefinedOrNull } from '../../../common/types';\r\n\r\nexport type NumericRange = [number, number];\r\nexport type NumericRangeFieldType = FieldType<NumericRange>;\r\n\r\nexport interface INumericRangeFieldProps extends INumericFieldProps {\r\n}\r\n\r\n/**\r\n * A NumericRangeField is an input field that provides a numeric range of two number values (x1 and x2 properties).\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class NumericRangeField extends Field<INumericRangeFieldProps> {\r\n\r\n    parseValue(textValue: string): NumericRangeFieldType {\r\n        const pair = parseNumericPair(textValue);\r\n        if (!pair) {\r\n            return null;\r\n        }\r\n        const x1 = pair[0];\r\n        const x2 = pair[1];\r\n        if (x2 < x1) {\r\n            return [x2, x1];\r\n        }\r\n        return pair;\r\n    }\r\n\r\n    validateValue(value: NumericRangeFieldType): void {\r\n        super.validateValue(value);\r\n        if (isUndefinedOrNull(value)) {\r\n            if (!this.props.nullable) {\r\n                throw new Error('Numeric range value expected.');\r\n            }\r\n            return;\r\n        }\r\n        validateNumber(value[0], this.props.nullable, this.props.min, this.props.max, this.props.isInt);\r\n        validateNumber(value[1], this.props.nullable, this.props.min, this.props.max, this.props.isInt);\r\n    }\r\n\r\n    formatValue(value: NumericRangeFieldType | null): string {\r\n        if (!value || value.length < 2) {\r\n            return '';\r\n        }\r\n        return `${value[0]}, ${value[1]}`;\r\n    }\r\n}\r\n\r\nexport function parseNumericPair(textValue: string): [number, number] {\r\n    if (!textValue || textValue.trim() === '') {\r\n        return null;\r\n    }\r\n    const pair = textValue.split(',');\r\n    if (pair.length === 2) {\r\n        let x1 = parseFloat(pair[0]);\r\n        let x2 = parseFloat(pair[1]);\r\n        return [x1, x2];\r\n    } else {\r\n        throw new Error('Value must be a pair of numbers.');\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport { ColorState } from 'react-color';\r\nimport SketchPicker from 'react-color/lib/components/sketch/Sketch';\r\nimport {\r\n    AnchorButton,\r\n    Button,\r\n    Colors,\r\n    ControlGroup,\r\n    HTMLSelect,\r\n    Intent,\r\n    Label,\r\n    NumberRange,\r\n    Popover,\r\n    PopoverInteractionKind,\r\n    PopoverPosition,\r\n    Radio,\r\n    RadioGroup,\r\n    RangeSlider,\r\n    Slider,\r\n    Switch,\r\n    Tooltip\r\n} from '@blueprintjs/core';\r\nimport * as Cesium from 'cesium';\r\n\r\nimport { SimpleStyle } from '../../common/geojson-simple-style';\r\nimport * as actions from '../actions';\r\nimport { FieldValue } from '../components/field/Field';\r\nimport { NumericField } from '../components/field/NumericField';\r\nimport { NumericRangeField } from '../components/field/NumericRangeField';\r\nimport { TextField } from '../components/field/TextField';\r\nimport { ListBox, ListBoxSelectionMode } from '../components/ListBox';\r\nimport { SubPanelHeader } from '../components/SubPanelHeader';\r\nimport { ToolButton } from '../components/ToolButton';\r\nimport { ViewState } from '../components/ViewState';\r\nimport { NO_ENTITY_FOR_STYLE, NO_LAYER_FOR_STYLE } from '../messages';\r\nimport * as selectors from '../selectors';\r\nimport {\r\n    ColorMapCategoryState,\r\n    ColorMapState,\r\n    ImageLayerState,\r\n    LayerState,\r\n    Placemark,\r\n    ResourceState,\r\n    ResourceVectorLayerState,\r\n    State,\r\n    STYLE_CONTEXT_ENTITY,\r\n    STYLE_CONTEXT_LAYER,\r\n    VariableImageLayerState,\r\n    VariableState,\r\n    VectorLayerState\r\n} from '../state';\r\nimport { getLayerDisplayName } from '../state-util';\r\n\r\n\r\nfunction getDisplayFractionDigits(min: number, max: number) {\r\n    const n = Math.round(Math.log10(max - min));\r\n    if (n < 0) {\r\n        return 1 - n;\r\n    } else if (n <= 2) {\r\n        return 2;\r\n    } else if (n <= 3) {\r\n        return 1;\r\n    } else {\r\n        return 0;\r\n    }\r\n}\r\n\r\nfunction formatNumber(x: number, fractionDigits: number) {\r\n    return fractionDigits < 3 ? x.toFixed(fractionDigits) : x.toExponential(1);\r\n}\r\n\r\ninterface IStylesPanelProps {\r\n    selectedResource: ResourceState | null;\r\n    selectedVariable: VariableState | null,\r\n    activeView: ViewState<any> | null;\r\n    layers: Array<LayerState>;\r\n    selectedLayer: LayerState | null;\r\n    selectedImageLayer: ImageLayerState | null;\r\n    selectedVariableImageLayer: VariableImageLayerState | null;\r\n    selectedVectorLayer: VectorLayerState | null;\r\n    selectedResourceVectorLayer: ResourceVectorLayerState | null;\r\n    selectedEntity: Cesium.Entity | null;\r\n    selectedPlacemark: Placemark | null;\r\n    styleContext: 'entity' | 'layer';\r\n    showLayerDetails: boolean;\r\n    colorMapCategories: Array<ColorMapCategoryState>;\r\n    selectedColorMap: ColorMapState | null;\r\n    displayMinMax: [number, number];\r\n    isComputingVariableStatistics: boolean;\r\n    vectorStyle: SimpleStyle;\r\n}\r\n\r\nfunction mapStateToProps(state: State) {\r\n    return {\r\n        selectedResource: selectors.selectedResourceSelector(state),\r\n        selectedVariable: selectors.selectedVariableSelector(state),\r\n        activeView: selectors.activeViewSelector(state),\r\n        layers: selectors.layersSelector(state),\r\n        selectedLayer: selectors.selectedLayerSelector(state),\r\n        selectedImageLayer: selectors.selectedImageLayerSelector(state),\r\n        selectedVariableImageLayer: selectors.selectedVariableImageLayerSelector(state),\r\n        selectedVectorLayer: selectors.selectedVectorLayerSelector(state),\r\n        selectedResourceVectorLayer: selectors.selectedResourceVectorLayerSelector(state),\r\n        selectedEntity: selectors.selectedEntitySelector(state),\r\n        selectedPlacemark: selectors.selectedPlacemarkSelector(state),\r\n        styleContext: selectors.styleContextSelector(state),\r\n        showLayerDetails: state.session.showLayerDetails,\r\n        colorMapCategories: selectors.colorMapCategoriesSelector(state),\r\n        selectedColorMap: selectors.selectedColorMapSelector(state),\r\n        displayMinMax: selectors.selectedVariableImageLayerDisplayMinMaxSelector(state),\r\n        isComputingVariableStatistics: selectors.isComputingVariableStatistics(state),\r\n        vectorStyle: selectors.vectorStyleSelector(state),\r\n    };\r\n}\r\n\r\nconst DISPLAY_RANGE_STYLE = {\r\n    display: 'grid',\r\n    gridTemplateColumns: 'auto auto auto',\r\n    justifyItems: 'stretch',\r\n    alignItems: 'center',\r\n    columnGap: '0.7em'};\r\n\r\nclass StylesPanel extends React.Component<IStylesPanelProps & DispatchProp<State>, null> {\r\n    static readonly SLIDER_DIV_STYLE_05 = {width: '100%', paddingLeft: '0.5em', paddingRight: '0.5em'};\r\n    static readonly SLIDER_DIV_STYLE_10 = {width: '100%', paddingLeft: '1em', paddingRight: '1em'};\r\n    static readonly SLIDER_DIV_STYLE_15 = {width: '100%', paddingLeft: '1.5em', paddingRight: '1.5em'};\r\n\r\n    static readonly LABEL_SPAN_STYLE_100 = {flexBasis: '100px', paddingLeft: '5px'};\r\n\r\n    static readonly LABEL_BOTTOM_MARGIN = {display: 'flex', margin: '0 0 5px'};\r\n\r\n    constructor(props: IStylesPanelProps) {\r\n        super(props);\r\n        this.handleUpdateDisplayStatistics = this.handleUpdateDisplayStatistics.bind(this);\r\n        this.handleChangedDisplayMinMax = this.handleChangedDisplayMinMax.bind(this);\r\n        this.handleChangedDisplayRange = this.handleChangedDisplayRange.bind(this);\r\n        this.handleChangedDisplayAlphaBlend = this.handleChangedDisplayAlphaBlend.bind(this);\r\n        this.handleChangedColorMapName = this.handleChangedColorMapName.bind(this);\r\n        this.handleChangedStyleContext = this.handleChangedStyleContext.bind(this);\r\n        this.handleChangedFillColor = this.handleChangedFillColor.bind(this);\r\n        this.handleChangedFillColorFromPicker = this.handleChangedFillColorFromPicker.bind(this);\r\n        this.handleChangedFillOpacity = this.handleChangedFillOpacity.bind(this);\r\n        this.handleChangedStrokeWidth = this.handleChangedStrokeWidth.bind(this);\r\n        this.handleChangedStrokeColor = this.handleChangedStrokeColor.bind(this);\r\n        this.handleChangedStrokeColorFromPicker = this.handleChangedStrokeColorFromPicker.bind(this);\r\n        this.handleChangedStrokeOpacity = this.handleChangedStrokeOpacity.bind(this);\r\n        this.handleChangedMarkerColor = this.handleChangedMarkerColor.bind(this);\r\n        this.handleChangedMarkerColorFromPicker = this.handleChangedMarkerColorFromPicker.bind(this);\r\n        this.handleChangedMarkerSize = this.handleChangedMarkerSize.bind(this);\r\n        this.handleChangedMarkerSymbol = this.handleChangedMarkerSymbol.bind(this);\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        if (!this.props.colorMapCategories) {\r\n            this.props.dispatch(actions.loadColorMaps() as any);\r\n        }\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <React.Fragment>\r\n                {this.renderLayerDetails()}\r\n            </React.Fragment>\r\n        )\r\n    }\r\n\r\n    private renderLayerDetails() {\r\n        let detailsPanel;\r\n        if (this.props.styleContext === STYLE_CONTEXT_ENTITY) {\r\n            if (this.props.selectedEntity) {\r\n                detailsPanel = this.renderVectorLayerDetails();\r\n            } else {\r\n                detailsPanel = NO_ENTITY_FOR_STYLE;\r\n            }\r\n        } else /*if (this.props.styleContext === STYLE_CONTEXT_LAYER)*/ {\r\n            if (this.props.selectedVectorLayer) {\r\n                detailsPanel = this.renderVectorLayerDetails();\r\n            } else if (this.props.selectedImageLayer) {\r\n                detailsPanel = this.renderImageLayerDetails();\r\n            } else {\r\n                detailsPanel = NO_LAYER_FOR_STYLE;\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div style={{width: '100%'}}>\r\n                {this.renderStyleContext()}\r\n                {detailsPanel}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderImageLayerDetails() {\r\n        return (\r\n            <React.Fragment>\r\n                <SubPanelHeader title=\"COLOUR MAPPING\"/>\r\n                {this.renderFormAlphaBlending()}\r\n                {this.renderFormDisplayMinMax()}\r\n                {this.renderFormDisplayColorBar()}\r\n                <SubPanelHeader title=\"IMAGE ENHANCEMENTS\"/>\r\n                {this.renderFormImageEnhancement('opacity', 'Opacity', 0., 1.)}\r\n                {this.renderFormImageEnhancement('brightness', 'Brightness', 0., 2.)}\r\n                {this.renderFormImageEnhancement('contrast', 'Contrast', 0., 2.)}\r\n                {this.renderFormImageEnhancement('hue', 'Hue', 0., 1.)}\r\n                {this.renderFormImageEnhancement('saturation', 'Saturation', 0., 2.)}\r\n                {this.renderFormImageEnhancement('gamma', 'Gamma', 1., 2.)}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderFormAlphaBlending() {\r\n        const layer = this.props.selectedVariableImageLayer;\r\n        if (!layer) {\r\n            return null;\r\n        }\r\n        return (\r\n            <Switch key=\"alpha\"\r\n                    checked={layer.alphaBlending}\r\n                    label=\"Alpha blending\"\r\n                    onChange={this.handleChangedDisplayAlphaBlend}/>\r\n        );\r\n    }\r\n\r\n    private renderFormDisplayMinMax() {\r\n        const layer = this.props.selectedVariableImageLayer || this.props.selectedResourceVectorLayer;\r\n        if (!layer) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <div style={{width: '100%', marginBottom: '20px'}}>\r\n                <Label key=\"drange\" style={{display: 'flex'}}>\r\n                    <span style={{...StylesPanel.LABEL_SPAN_STYLE_100, margin: 'auto 0'}}>Display range</span>\r\n                    <div style={DISPLAY_RANGE_STYLE}>\r\n                        <NumericRangeField value={this.props.displayMinMax}\r\n                                           style={{flex: 'auto'}}\r\n                                           onChange={this.handleChangedDisplayMinMax}\r\n                                           uncontrolled={true}\r\n                        />\r\n                        <ToolButton\r\n                            tooltipContent=\"Compute valid min/max\"\r\n                            intent={Intent.PRIMARY}\r\n                            icon=\"arrows-horizontal\"\r\n                            tooltipPosition={'top'}\r\n                            style={{flexGrow: 0, margin: 0}}\r\n                            disabled={this.props.isComputingVariableStatistics}\r\n                            onClick={this.handleUpdateDisplayStatistics}\r\n                        />\r\n                    </div>\r\n                </Label>\r\n                <div style={StylesPanel.SLIDER_DIV_STYLE_15}>\r\n                    {this.renderDisplayRangeSlider()}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderFormDisplayColorBar() {\r\n        const layer = this.props.selectedVariableImageLayer;\r\n        if (!layer) {\r\n            return null;\r\n        }\r\n\r\n        let colorBarButton;\r\n        if (this.props.colorMapCategories) {\r\n            const popoverContent = this.renderColorBarBox(layer);\r\n            colorBarButton = (\r\n                <Popover content={popoverContent}\r\n                         interactionKind={PopoverInteractionKind.CLICK}\r\n                         popoverClassName=\"bp3-popover-content-sizing cate-color-bars-popover\"\r\n                         position={PopoverPosition.LEFT}>\r\n                    {this.renderColorBarButton(layer, false)}\r\n                </Popover>\r\n            );\r\n        } else {\r\n            colorBarButton = this.renderColorBarButton(layer, true);\r\n        }\r\n\r\n        return (\r\n            <Label key=\"cmap\" className=\"bp3-inline\" style={{display: 'flex'}}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Colour bar</span>\r\n                {colorBarButton}\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderFormImageEnhancement(key: string, label: string, min: number, max: number) {\r\n        const layer = this.props.selectedVariableImageLayer || this.props.selectedResourceVectorLayer;\r\n        if (!layer || (layer === this.props.selectedResourceVectorLayer && key !== 'opacity')) {\r\n            return null;\r\n        }\r\n\r\n        const handleChangedImageEnhancement = (name: string, value: number) => {\r\n            this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {[name]: value}) as any);\r\n        };\r\n\r\n        return (\r\n            <Label key={key} style={{display: 'flex'}}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>{label}</span>\r\n                <div style={{...StylesPanel.SLIDER_DIV_STYLE_10, width: undefined, flex: 'auto 1', margin: 'auto 0'}}>\r\n                    <Slider min={min}\r\n                            max={max}\r\n                            stepSize={(max - min) / 10.}\r\n                            labelRenderer={false}\r\n                            value={layer[key]}\r\n                            onChange={(value: number) => handleChangedImageEnhancement(key, value)}/>\r\n                </div>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderVectorLayerDetails() {\r\n        return (\r\n            <React.Fragment>\r\n                <SubPanelHeader title=\"FILL\"/>\r\n                {this.renderFillColor()}\r\n                {this.renderFillOpacity()}\r\n                <SubPanelHeader title=\"STROKE\"/>\r\n                {this.renderStrokeWidth()}\r\n                {this.renderStrokeColor()}\r\n                {this.renderStrokeOpacity()}\r\n                <SubPanelHeader title=\"MARKER\"/>\r\n                {this.renderMarkerColor()}\r\n                {this.renderMarkerSize()}\r\n                {this.renderMarkerSymbol()}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n\r\n    private renderStyleContext() {\r\n        const selectedEntity = this.props.selectedEntity;\r\n        const selectedPlacemark = this.props.selectedPlacemark;\r\n        const selectedLayer = this.props.selectedLayer;\r\n\r\n        let entityDisplayName;\r\n        let layerDisplayName;\r\n\r\n        if (selectedPlacemark) {\r\n            const title = selectedPlacemark.properties && selectedPlacemark.properties.title;\r\n            if (title && title !== '') {\r\n                entityDisplayName = `My place ${title}`;\r\n            } else {\r\n                entityDisplayName = 'Selected place';\r\n            }\r\n        } else if (selectedEntity) {\r\n            entityDisplayName = 'Selected entity';\r\n        } else {\r\n            entityDisplayName = 'Selected entity (none)';\r\n        }\r\n\r\n        if (selectedLayer) {\r\n            layerDisplayName = `Layer ${getLayerDisplayName(selectedLayer)}`;\r\n        } else {\r\n            layerDisplayName = 'Selected layer';\r\n        }\r\n\r\n        return (\r\n            <RadioGroup\r\n                key=\"styleContext\"\r\n                label=\"Style context\"\r\n                onChange={this.handleChangedStyleContext}\r\n                selectedValue={this.props.styleContext}\r\n            >\r\n                <Radio label={entityDisplayName} value={STYLE_CONTEXT_ENTITY}/>\r\n                <Radio label={layerDisplayName} value={STYLE_CONTEXT_LAYER}/>\r\n            </RadioGroup>\r\n        );\r\n    }\r\n\r\n    private renderFillColor() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Colour</span>\r\n                <ControlGroup style={{lineHeight: '0', flex: 'auto 1'}}>\r\n                    <TextField value={this.props.vectorStyle.fill}\r\n                               style={{flex: 'auto', fontFamily: 'courier', textAlign: 'right', paddingRight: '40px'}}\r\n                               size={8}\r\n                               uncontrolled={true}\r\n                               onChange={this.handleChangedFillColor}\r\n                    />\r\n                    <Popover\r\n                        interactionKind={PopoverInteractionKind.CLICK}\r\n                        popoverClassName=\"bp3-minimal\"\r\n                        position={PopoverPosition.LEFT}\r\n                        className=\"bp3-input-action\"\r\n                    >\r\n                        <Button style={{backgroundColor: this.props.vectorStyle.fill}}/>\r\n                        <SketchPicker\r\n                            color={this.props.vectorStyle.fill}\r\n                            onChange={this.handleChangedFillColorFromPicker}\r\n                            disableAlpha={true}\r\n                        />\r\n                    </Popover>\r\n                </ControlGroup>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderFillOpacity() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Opacity</span>\r\n                <div style={{...StylesPanel.SLIDER_DIV_STYLE_05, width: undefined, flex: 'auto 1', margin: 'auto 0'}}>\r\n                    <Slider min={0.0}\r\n                            max={1.0}\r\n                            stepSize={0.05}\r\n                            labelRenderer={false}\r\n                            value={this.props.vectorStyle.fillOpacity}\r\n                            onChange={this.handleChangedFillOpacity}\r\n                    />\r\n                </div>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderStrokeWidth() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Width</span>\r\n                <NumericField value={this.props.vectorStyle.strokeWidth}\r\n                              style={{flex: 'auto 1', fontFamily: 'courier'}}\r\n                              size={8}\r\n                              min={0}\r\n                              uncontrolled={true}\r\n                              onChange={this.handleChangedStrokeWidth}\r\n                />\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderStrokeColor() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Colour</span>\r\n                <ControlGroup style={{lineHeight: '0', flex: 'auto 1'}}>\r\n                    <TextField value={this.props.vectorStyle.stroke}\r\n                               style={{flex: 'auto', fontFamily: 'courier', textAlign: 'right', paddingRight: '40px'}}\r\n                               size={8}\r\n                               uncontrolled={true}\r\n                               onChange={this.handleChangedStrokeColor}\r\n                    />\r\n                    <Popover\r\n                        interactionKind={PopoverInteractionKind.CLICK}\r\n                        popoverClassName=\"bp3-minimal\"\r\n                        position={PopoverPosition.LEFT}\r\n                        className=\"bp3-input-action\"\r\n                    >\r\n                        <Button style={{backgroundColor: this.props.vectorStyle.stroke}}/>\r\n                        <SketchPicker\r\n                            color={this.props.vectorStyle.stroke}\r\n                            onChange={this.handleChangedStrokeColorFromPicker}\r\n                            disableAlpha={true}\r\n                        />\r\n                    </Popover>\r\n                </ControlGroup>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderStrokeOpacity() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Opacity</span>\r\n                <div style={{...StylesPanel.SLIDER_DIV_STYLE_05, width: undefined, flex: 'auto 1', margin: 'auto 0'}}>\r\n                    <Slider min={0.0}\r\n                            max={1.0}\r\n                            stepSize={0.05}\r\n                            labelRenderer={false}\r\n                            value={this.props.vectorStyle.strokeOpacity}\r\n                            onChange={this.handleChangedStrokeOpacity}\r\n                    />\r\n                </div>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderMarkerColor() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Colour</span>\r\n                <ControlGroup style={{lineHeight: '0', flex: 'auto 1'}}>\r\n                    <TextField value={this.props.vectorStyle.markerColor}\r\n                               style={{flex: 'auto', fontFamily: 'courier', textAlign: 'right', paddingRight: '40px'}}\r\n                               size={8}\r\n                               uncontrolled={true}\r\n                               onChange={this.handleChangedMarkerColor}\r\n                    />\r\n                    <Popover\r\n                        interactionKind={PopoverInteractionKind.CLICK}\r\n                        popoverClassName=\"bp3-minimal\"\r\n                        position={PopoverPosition.LEFT}\r\n                        className=\"bp3-input-action\"\r\n                    >\r\n                        <Button style={{backgroundColor: this.props.vectorStyle.markerColor}}/>\r\n                        <SketchPicker\r\n                            color={this.props.vectorStyle.markerColor}\r\n                            onChange={this.handleChangedMarkerColorFromPicker}\r\n                            disableAlpha={true}\r\n                        />\r\n                    </Popover>\r\n                </ControlGroup>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderMarkerSize() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Size</span>\r\n                <HTMLSelect\r\n                    style={{flex: 'auto 1'}}\r\n                    value={this.props.vectorStyle.markerSize}\r\n                    onChange={this.handleChangedMarkerSize}\r\n                >\r\n                    <option value=\"small\">Small</option>\r\n                    <option value=\"medium\">Medium</option>\r\n                    <option value=\"large\">Large</option>\r\n                </HTMLSelect>\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderMarkerSymbol() {\r\n        return (\r\n            <Label className=\"bp3-inline\" style={StylesPanel.LABEL_BOTTOM_MARGIN}>\r\n                <span style={StylesPanel.LABEL_SPAN_STYLE_100}>Symbol</span>\r\n                <TextField value={this.props.vectorStyle.markerSymbol}\r\n                           style={{flex: 'auto', fontFamily: 'courier', textAlign: 'right'}}\r\n                           size={8}\r\n                           uncontrolled={true}\r\n                           onChange={this.handleChangedMarkerSymbol}\r\n                />\r\n            </Label>\r\n        );\r\n    }\r\n\r\n    private renderDisplayRangeSlider() {\r\n        const layer = this.props.selectedVariableImageLayer;\r\n        if (!layer) {\r\n            return null;\r\n        }\r\n\r\n        const statistics = layer.statistics;\r\n        if (!statistics) {\r\n            return <span style={{color: Colors.ORANGE3}}>Missing data min/max</span>;\r\n        }\r\n\r\n        let min = statistics.min;\r\n        let max = statistics.max;\r\n\r\n        if (isNaN(min) || isNaN(max)) {\r\n            return <span style={{color: Colors.ORANGE3}}>All values are NaN</span>;\r\n        }\r\n\r\n        if (min === max) {\r\n            return <span style={{color: Colors.ORANGE3}}>All values are {min}</span>;\r\n        }\r\n\r\n        const fractionDigits = getDisplayFractionDigits(min, max);\r\n\r\n        return (\r\n            <RangeSlider\r\n                min={min}\r\n                max={max}\r\n                stepSize={(max - min) / 100.}\r\n                labelStepSize={max - min}\r\n                labelRenderer={(x: number) => formatNumber(x, fractionDigits)}\r\n                onChange={this.handleChangedDisplayRange}\r\n                value={[layer.displayMin, layer.displayMax]}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderColorBarButton(layer: VariableImageLayerState, disabled: boolean) {\r\n        const selectedColorMapName = layer.colorMapName;\r\n        const selectedColorMapImage = this.renderColorMapImage(this.props.selectedColorMap);\r\n        const buttonContent = (selectedColorMapImage || (selectedColorMapName || 'Select Color Bar'));\r\n        return (<AnchorButton className=\"bp3-minimal\" style={{width: '100%'}}\r\n                              disabled={disabled}>{buttonContent}</AnchorButton>);\r\n    }\r\n\r\n    private renderColorBarBox(layer: VariableImageLayerState) {\r\n        const children = [];\r\n        for (let cat of this.props.colorMapCategories) {\r\n            const colorMaps = cat.colorMaps;\r\n            children.push(\r\n                <p key={cat.name + '_head'} style={{marginTop: 2, marginBottom: 2}}>\r\n                    <Tooltip content={<div style={{width: \"19em\"}}>{cat.description}</div>}\r\n                             position='top'>\r\n                        {cat.name}\r\n                    </Tooltip>\r\n                </p>\r\n            );\r\n            children.push(\r\n                <ListBox key={cat.name + '_list'}\r\n                         items={colorMaps}\r\n                         getItemKey={(item: ColorMapState) => item.name}\r\n                         renderItem={(item: ColorMapState) => this.renderColorMapImage(item)}\r\n                         selectionMode={ListBoxSelectionMode.SINGLE}\r\n                         selection={layer.colorMapName ? [layer.colorMapName] : []}\r\n                         onSelection={this.handleChangedColorMapName}\r\n                />\r\n            );\r\n        }\r\n\r\n        return <div style={{padding: 5, overflowY: 'auto', height: '87vh'}}>{children}</div>;\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private renderColorMapImage(colorMap: ColorMapState) {\r\n        if (colorMap) {\r\n            return (\r\n                <Tooltip content={colorMap.name}>\r\n                    <img src={`data:image/png;base64,${colorMap.imageData}`}\r\n                         alt={colorMap.name}\r\n                         style={{width: '100%', height: '1em'}}/>\r\n                </Tooltip>\r\n            );\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private handleChangedDisplayAlphaBlend(event: any) {\r\n        const alphaBlending = event.target.checked;\r\n        const layer = this.props.selectedVariableImageLayer;\r\n        this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {alphaBlending}) as any);\r\n    }\r\n\r\n    private handleChangedDisplayMinMax(displayMinMax: FieldValue<NumberRange>) {\r\n        const layer = this.props.selectedVariableImageLayer || this.props.selectedResourceVectorLayer;\r\n        if (!displayMinMax.error) {\r\n            const displayMin = displayMinMax.value[0];\r\n            const displayMax = displayMinMax.value[1];\r\n            this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {displayMin, displayMax}) as any);\r\n        }\r\n    }\r\n\r\n    private handleUpdateDisplayStatistics() {\r\n        const resource = this.props.selectedResource;\r\n        const variable = this.props.selectedVariable;\r\n        const imageLayer = this.props.selectedVariableImageLayer;\r\n        if (!resource || !variable || !imageLayer) {\r\n            return;\r\n        }\r\n        this.props.dispatch(actions.getWorkspaceVariableStatistics(resource.name, variable.name, imageLayer.varIndex,\r\n                                                                   (statistics) => {\r\n                                                                       return actions.updateLayer(this.props.activeView.id, imageLayer, {\r\n                                                                           displayMin: statistics.min,\r\n                                                                           displayMax: statistics.max,\r\n                                                                           statistics\r\n                                                                       });\r\n                                                                   }\r\n        ) as any);\r\n    }\r\n\r\n    private handleChangedDisplayRange(displayRange: NumberRange) {\r\n        const layer = this.props.selectedVariableImageLayer || this.props.selectedResourceVectorLayer;\r\n        this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {\r\n            displayMin: displayRange[0],\r\n            displayMax: displayRange[1]\r\n        }) as any);\r\n    }\r\n\r\n    private handleChangedColorMapName(newSelection: string[]) {\r\n        const layer = this.props.selectedVariableImageLayer || this.props.selectedResourceVectorLayer;\r\n        const colorMapName = newSelection && newSelection.length && newSelection[0];\r\n        if (colorMapName) {\r\n            this.props.dispatch(actions.updateLayer(this.props.activeView.id, layer, {colorMapName}) as any);\r\n        }\r\n    }\r\n\r\n    private handleChangedStyleContext(event: any) {\r\n        this.props.dispatch(actions.setStyleContext(event.target.value));\r\n    }\r\n\r\n    private handleChangedFillColor(value: FieldValue<string>) {\r\n        this.handleChangedVectorStyle({fill: value.value});\r\n    }\r\n\r\n    private handleChangedFillColorFromPicker(color: ColorState) {\r\n        this.handleChangedVectorStyle({fill: color.hex});\r\n    }\r\n\r\n    private handleChangedFillOpacity(fillOpacity: number) {\r\n        this.handleChangedVectorStyle({fillOpacity});\r\n    }\r\n\r\n    private handleChangedStrokeWidth(value: FieldValue<number>) {\r\n        this.handleChangedVectorStyle({strokeWidth: value.value});\r\n    }\r\n\r\n    private handleChangedStrokeColor(value: FieldValue<string>) {\r\n        this.handleChangedVectorStyle({stroke: value.value});\r\n    }\r\n\r\n    private handleChangedStrokeColorFromPicker(color: ColorState) {\r\n        this.handleChangedVectorStyle({stroke: color.hex});\r\n    }\r\n\r\n    private handleChangedStrokeOpacity(strokeOpacity: number) {\r\n        this.handleChangedVectorStyle({strokeOpacity});\r\n    }\r\n\r\n    private handleChangedMarkerSize(event) {\r\n        this.handleChangedVectorStyle({markerSize: event.target.value});\r\n    }\r\n\r\n    private handleChangedMarkerColor(value: FieldValue<string>) {\r\n        this.handleChangedVectorStyle({markerColor: value.value});\r\n    }\r\n\r\n    private handleChangedMarkerColorFromPicker(color: ColorState) {\r\n        this.handleChangedVectorStyle({markerColor: color.hex});\r\n    }\r\n\r\n    private handleChangedMarkerSymbol(value: FieldValue<string>) {\r\n        this.handleChangedVectorStyle({markerSymbol: value.value});\r\n    }\r\n\r\n    private handleChangedVectorStyle(style: SimpleStyle) {\r\n        //style = {...this.props.vectorStyle, ...style};\r\n        if (this.props.styleContext === STYLE_CONTEXT_ENTITY) {\r\n            this.props.dispatch(actions.updateEntityStyle(this.props.activeView,\r\n                                                          this.props.selectedEntity,\r\n                                                          style) as any);\r\n        } else {\r\n            this.props.dispatch(actions.updateLayerStyle(this.props.activeView.id,\r\n                                                         this.props.selectedVectorLayer.id,\r\n                                                         style));\r\n        }\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(StylesPanel);\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, InputGroup, Intent } from '@blueprintjs/core';\r\nimport { DialogState, State } from '../state';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\n\r\n\r\ninterface ISelectWorkspaceDialogState extends DialogState {\r\n    workspaceDir: string | null;\r\n    workspaceName: string;\r\n}\r\n\r\ninterface ISelectWorkspaceDialogOwnProps {\r\n    dialogId: string;\r\n}\r\n\r\ninterface ISelectWorkspaceDialogProps extends ISelectWorkspaceDialogState, ISelectWorkspaceDialogOwnProps {\r\n    isOpen: boolean;\r\n    isNewDialog: boolean;\r\n    isLocalFSAllowed: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State, ownProps: ISelectWorkspaceDialogOwnProps): ISelectWorkspaceDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(ownProps.dialogId)(state) as any;\r\n    const isOpen = dialogState.isOpen;\r\n    const dialogId = ownProps.dialogId;\r\n    const isNewDialog = ownProps.dialogId === 'newWorkspaceDialog';\r\n    const isLocalFSAllowed = selectors.isLocalFSAccessAllowedSelector(state);\r\n    let workspaceDir = dialogState.workspaceDir;\r\n    let workspaceName = dialogState.workspaceName;\r\n    // TODO (forman): Fix code duplication with ChooseWorkspaceDialog\r\n    if (isOpen) {\r\n        if (!selectors.isScratchWorkspaceSelector(state)) {\r\n            workspaceDir = workspaceDir || selectors.workspaceDirSelector(state);\r\n            workspaceName = workspaceName || selectors.workspaceNameSelector(state);\r\n        }\r\n        workspaceDir = workspaceDir || selectors.lastWorkspaceDirSelector(state);\r\n    }\r\n    workspaceDir = isLocalFSAllowed ? workspaceDir || '' : null;\r\n    workspaceName = workspaceName || '';\r\n    return {\r\n        workspaceDir,\r\n        workspaceName,\r\n        dialogId,\r\n        isNewDialog,\r\n        isOpen,\r\n        isLocalFSAllowed,\r\n    };\r\n}\r\n\r\n// TODO (forman): Rename to (Get)WorkspaceNameDialog\r\nclass SelectWorkspaceDialog extends React.Component<ISelectWorkspaceDialogProps & ISelectWorkspaceDialogOwnProps & DispatchProp<State>, ISelectWorkspaceDialogState> {\r\n\r\n    // TODO (forman): Remove member\r\n    private localWebAPI: boolean;\r\n\r\n    constructor(props: ISelectWorkspaceDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {workspaceDir: '', workspaceName: ''};\r\n        // TODO (forman): Fix code duplication with ChooseWorkspaceDialog\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.onWorkspaceNameChange = this.onWorkspaceNameChange.bind(this);\r\n        this.onWorkspaceDirChange = this.onWorkspaceDirChange.bind(this);\r\n        this.showDirectorySelectDialog = this.showDirectorySelectDialog.bind(this);\r\n        this.localWebAPI = props.isLocalFSAllowed;\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: ISelectWorkspaceDialogProps) {\r\n        this.setState({workspaceDir: nextProps.workspaceDir, workspaceName: nextProps.workspaceName});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(this.props.dialogId));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        // TODO (SabineEmbacher) validate against existing workspace names\r\n        if ((this.localWebAPI && !this.state.workspaceDir) || !this.state.workspaceName) {\r\n            return false;\r\n        }\r\n        return /^([A-Za-z_\\-\\s0-9.]+)$/.test(this.state.workspaceName);\r\n    }\r\n\r\n    private composeWorkspacePath(): string {\r\n        let workspaceDir = this.state.workspaceDir;\r\n        let workspaceName = this.state.workspaceName;\r\n        if (workspaceDir === null) {\r\n            return workspaceName;\r\n        }\r\n        return workspaceDir + '/' + workspaceName;\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(this.props.dialogId, this.state));\r\n        if (this.props.isNewDialog) {\r\n            this.props.dispatch(actions.newWorkspace(this.composeWorkspacePath()) as any);\r\n        } else {\r\n            this.props.dispatch(actions.saveWorkspaceAs(this.composeWorkspacePath()) as any);\r\n        }\r\n    }\r\n\r\n    private onWorkspaceDirChange(ev: any) {\r\n        this.setState({workspaceDir: ev.target.value} as ISelectWorkspaceDialogState);\r\n    }\r\n\r\n    private onWorkspaceNameChange(ev: any) {\r\n        this.setState({workspaceName: ev.target.value} as ISelectWorkspaceDialogState);\r\n    }\r\n\r\n    private showDirectorySelectDialog() {\r\n        let handleClose = (dirPath: string | null) => {\r\n            if (dirPath) {\r\n                this.setState({workspaceDir: dirPath} as ISelectWorkspaceDialogState);\r\n            }\r\n        };\r\n        this.props.dispatch(actions.showDirectorySelectDialog({defaultPath: this.state.workspaceDir},\r\n                                                              handleClose) as any);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title={this.props.isNewDialog ? 'New Workspace' : 'Save Workspace As'}\r\n                confirmTitle={this.props.isNewDialog ? 'New' : 'Save As'}\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        let directoryChooser = null;\r\n        if (this.props.isLocalFSAllowed) {\r\n            directoryChooser = (\r\n                <React.Fragment>\r\n                    <p style={{marginTop: '1em'}}>Workspace parent directory:</p>\r\n                    <ControlGroup style={{flexGrow: 1, display: 'flex', marginLeft: '1em', width: '100%'}}>\r\n                        <InputGroup\r\n                            type=\"text\"\r\n                            style={{flex: 'auto'}}\r\n                            value={this.state.workspaceDir}\r\n                            onChange={this.onWorkspaceDirChange}\r\n                        />\r\n                        <AnchorButton intent={Intent.PRIMARY} style={{flex: 'none'}}\r\n                                      onClick={this.showDirectorySelectDialog}>...</AnchorButton>\r\n                    </ControlGroup>\r\n                </React.Fragment>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                {directoryChooser}\r\n                <p style={{marginTop: '1em'}}>Workspace name:</p>\r\n                <InputGroup\r\n                    type=\"text\"\r\n                    style={{width: '100%'}}\r\n                    value={this.state.workspaceName}\r\n                    onChange={this.onWorkspaceNameChange}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(SelectWorkspaceDialog);\r\n","import * as React from 'react';\r\nimport SelectWorkspaceDialog from './SelectWorkspaceDialog';\r\n\r\n\r\nexport default function NewWorkspaceDialog() {\r\n    return <SelectWorkspaceDialog dialogId='newWorkspaceDialog'/>\r\n}\r\n\r\n","import * as React from 'react';\r\nimport SelectWorkspaceDialog from './SelectWorkspaceDialog';\r\n\r\n\r\nexport default function SaveWorkspaceAsDialog() {\r\n    return <SelectWorkspaceDialog dialogId='saveWorkspaceAsDialog'/>\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {\r\n    AnchorButton,\r\n    Button,\r\n    Card,\r\n    Collapse,\r\n    ControlGroup,\r\n    HTMLTable,\r\n    Intent,\r\n    Switch,\r\n    Tab,\r\n    Tabs\r\n} from '@blueprintjs/core';\r\nimport { connect, DispatchProp } from 'react-redux';\r\n\r\nimport { SessionState, State, WebAPIServiceInfo } from '../state';\r\nimport * as actions from '../actions';\r\nimport { showMessageBox } from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { TextField } from '../components/field/TextField';\r\nimport deepEqual from 'deep-equal';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport { showToast } from '../toast';\r\nimport { isDefined } from '../../common/types';\r\nimport { CATE_APP_VERSION } from '../../version';\r\n\r\n\r\ninterface IPreferencesDialogProps {\r\n    isOpen: boolean;\r\n    preferences: SessionState;\r\n    serviceInfo: WebAPIServiceInfo;\r\n    serviceURL: string;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IPreferencesDialogProps {\r\n    return {\r\n        isOpen: selectors.dialogStateSelector(PreferencesDialog.DIALOG_ID)(state).isOpen,\r\n        preferences: state.session,\r\n        serviceURL: state.communication.webAPIServiceURL,\r\n        serviceInfo: state.communication.webAPIServiceInfo,\r\n    };\r\n}\r\n\r\n\r\nconst SYSTEM_LABEL_STYLE = {width: '40%'};\r\nconst SYSTEM_CONTROL_GROUP_STYLE = {width: '100%', marginBottom: '1em'};\r\nconst SYSTEM_DIV_STYLE = {width: '100%', marginTop: '1em'};\r\nconst SYSTEM_ITEM_STYLE: React.CSSProperties = {width: '60%', wordWrap: 'break-word'};\r\n\r\nclass PreferencesDialog extends React.Component<IPreferencesDialogProps & DispatchProp<State>, SessionState> {\r\n    static readonly DIALOG_ID = 'preferencesDialog';\r\n    static readonly DIALOG_TITLE = 'Preferences';\r\n\r\n    constructor(props: IPreferencesDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.state = props.preferences;\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IPreferencesDialogProps) {\r\n        this.setState(nextProps.preferences);\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hidePreferencesDialog());\r\n        if (!deepEqual(this.props.preferences, this.state)) {\r\n            const backendConfig = this.state.backendConfig;\r\n            const autoUpdateSoftwareChangeDetected = this.props.preferences.autoUpdateSoftware !== this.state.autoUpdateSoftware;\r\n            const backendChangesDetected = !deepEqual(this.props.preferences.backendConfig, backendConfig);\r\n            this.props.dispatch(actions.updateSessionState(this.state));\r\n            this.props.dispatch(actions.updatePreferences(this.state) as any);\r\n            if (autoUpdateSoftwareChangeDetected || backendChangesDetected) {\r\n                this.props.dispatch(actions.storeBackendConfig(backendConfig) as any);\r\n                this.props.dispatch(showMessageBox({\r\n                                                       type: 'info',\r\n                                                       title: PreferencesDialog.DIALOG_TITLE,\r\n                                                       message: 'Some changes will be effective only after restart.'\r\n                                                   }) as any);\r\n            }\r\n        } else {\r\n            showToast({\r\n                          type: 'info',\r\n                          text: 'No changes detected.'\r\n                      });\r\n        }\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hidePreferencesDialog());\r\n    }\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    private canConfirm() {\r\n        // TODO (forman): add validation of preferences changes\r\n        return true;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <ModalDialog\r\n                isOpen={this.props.isOpen}\r\n                title={PreferencesDialog.DIALOG_TITLE}\r\n                style={{minWidth: '30em'}}\r\n                icon=\"confirm\"\r\n                onCancel={this.onCancel}\r\n                onConfirm={this.onConfirm}\r\n                canConfirm={this.canConfirm}\r\n                renderBody={this.renderBody}\r\n            />\r\n        );\r\n    }\r\n\r\n    private renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <Tabs id=\"preferences\">\r\n                <Tab id=\"g\" title=\"General\" panel={this.renderGeneralPanel()}/>\r\n                <Tab id=\"dm\" title=\"Data Management\" panel={this.renderDataManagementPanel()}/>\r\n                <Tab id=\"pc\" title=\"Proxy Configuration\" panel={this.renderProxyConfigurationPanel()}/>\r\n                <Tab id=\"a\" title=\"System\" panel={this.renderSystemPanel()}/>\r\n            </Tabs>\r\n        );\r\n    }\r\n\r\n    private renderGeneralPanel() {\r\n        // const userRootMode = this.props.serviceInfo.userRootMode;\r\n        return (\r\n            <div style={{width: '100%', marginTop: '1em'}}>\r\n                {this.renderReopenLastWorkspace()}\r\n                {this.renderAutoShowNewFigures()}\r\n                {/*Does not work with blueprintjs 3+*//*{this.renderPanelContainerUndockedMode()}*/}\r\n                {/*For Electron only*/ /*{!userRootMode && this.renderAutoUpdates()}*/}\r\n                {/*For Electron only*/ /*{!userRootMode && this.renderOfflineMode()}*/}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderDataManagementPanel() {\r\n        const userRootMode = this.props.serviceInfo.userRootMode;\r\n        return (\r\n            <div style={{width: '100%', marginTop: '1em'}}>\r\n                {!userRootMode && this.renderDataStoresPath()}\r\n                {!userRootMode && this.renderCacheWorkspaceImagery()}\r\n                {this.renderResourceNamePrefix()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderProxyConfigurationPanel() {\r\n        return (\r\n            <div style={{width: '100%', marginTop: '1em'}}>\r\n                {this.renderProxyUrlInput()}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderSystemPanel() {\r\n        const showProperties = this.getStateValue('showProperties', false);\r\n        const onShowPropertiesChange = this.getChangeHandler('showProperties', false);\r\n\r\n        return (\r\n            <div style={SYSTEM_DIV_STYLE}>\r\n                <ControlGroup style={SYSTEM_CONTROL_GROUP_STYLE}>\r\n                    <span style={SYSTEM_LABEL_STYLE}>Cate UI version:</span>\r\n                    <span style={SYSTEM_ITEM_STYLE}><code>{CATE_APP_VERSION}</code></span>\r\n                </ControlGroup>\r\n                <ControlGroup style={SYSTEM_CONTROL_GROUP_STYLE}>\r\n                    <span style={SYSTEM_LABEL_STYLE}>Cate API URL:</span>\r\n                    <span style={SYSTEM_ITEM_STYLE}><code>{this.props.serviceURL}</code></span>\r\n                </ControlGroup>\r\n                <ControlGroup style={SYSTEM_CONTROL_GROUP_STYLE}>\r\n                    <span style={SYSTEM_LABEL_STYLE}>Cate API version:</span>\r\n                    <span style={SYSTEM_ITEM_STYLE}><code>{this.props.serviceInfo.version}</code></span>\r\n                </ControlGroup>\r\n                {this.props.serviceInfo.dependencies && (\r\n                    <ControlGroup style={SYSTEM_CONTROL_GROUP_STYLE}>\r\n                        <span style={SYSTEM_LABEL_STYLE}>Cate dependencies:</span>\r\n                        <div>\r\n                            <Button\r\n                                onClick={() => onShowPropertiesChange(!showProperties)}\r\n                                small={true}\r\n                                style={{marginBottom: 2}}\r\n                            >\r\n                                {\"Click to \" + (showProperties ? \"collapse\" : \"expand\")}\r\n                            </Button>\r\n                            <Collapse isOpen={showProperties}>\r\n                                <Card>\r\n                                    <HTMLTable condensed={true} small={true} bordered={true}>\r\n                                        <thead>\r\n                                        <tr>\r\n                                            <th>Package</th>\r\n                                            <th>Version</th>\r\n                                        </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                        {\r\n                                            Object.getOwnPropertyNames(this.props.serviceInfo.dependencies!).map(\r\n                                                packageName => {\r\n                                                    const packageVersion = this.props.serviceInfo.dependencies[packageName];\r\n                                                    return (\r\n                                                        <tr>\r\n                                                            <td>{packageName}</td>\r\n                                                            <td>{packageVersion}</td>\r\n                                                        </tr>\r\n                                                    );\r\n                                                }\r\n                                            )\r\n                                        }\r\n                                        </tbody>\r\n                                    </HTMLTable>\r\n                                </Card>\r\n                            </Collapse>\r\n                        </div>\r\n                    </ControlGroup>\r\n                )}\r\n                <ControlGroup style={SYSTEM_CONTROL_GROUP_STYLE}>\r\n                    <span style={SYSTEM_LABEL_STYLE}>File access mode:</span>\r\n                    <span style={SYSTEM_ITEM_STYLE}>\r\n                        {this.props.serviceInfo.userRootMode ? 'sandboxed file system' : 'full access to file system'}\r\n                    </span>\r\n                </ControlGroup>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderReopenLastWorkspace() {\r\n        return this.renderBooleanValue(\r\n            'reopenLastWorkspace',\r\n            false,\r\n            'Reopen last workspace on startup'\r\n        );\r\n    }\r\n\r\n    // private renderAutoUpdates() {\r\n    //     return this.renderBooleanValue(\r\n    //         'autoUpdateSoftware',\r\n    //         false,\r\n    //         'Automatic software updates'\r\n    //     );\r\n    // }\r\n\r\n    private renderAutoShowNewFigures() {\r\n        return this.renderBooleanValue(\r\n            'autoShowNewFigures',\r\n            false,\r\n            'Open plot view for new Figure resources'\r\n        );\r\n    }\r\n\r\n    // private renderOfflineMode() {\r\n    //     return this.renderBooleanValue(\r\n    //         'offlineMode',\r\n    //         false,\r\n    //         'Force offline mode (requires restart)'\r\n    //     );\r\n    // }\r\n\r\n    // private renderPanelContainerUndockedMode() {\r\n    //     return this.renderBooleanValue(\r\n    //         'panelContainerUndockedMode',\r\n    //         false,\r\n    //         'Undocked tool panels (experimental)'\r\n    //     );\r\n    // }\r\n\r\n    private renderDataStoresPath() {\r\n        return this.renderDirectoryPath(\r\n            'dataStoresPath',\r\n            true,\r\n            'Synchronisation directory for remote data store files'\r\n        );\r\n    }\r\n\r\n    private renderCacheWorkspaceImagery() {\r\n        return this.renderBooleanValue(\r\n            'useWorkspaceImageryCache',\r\n            true,\r\n            'Use per-workspace imagery cache (may accelerate image display)'\r\n        );\r\n    }\r\n\r\n    private renderResourceNamePrefix() {\r\n        return this.renderStringValue(\r\n            'resourceNamePattern',\r\n            true,\r\n            'Default resource name pattern'\r\n        );\r\n    }\r\n\r\n    private renderProxyUrlInput() {\r\n        const initialValue = this.getStateValue('proxyUrl', true);\r\n        const onChange = this.getChangeHandler('proxyUrl', true);\r\n        return (\r\n            <ControlGroup style={{width: '100%', marginBottom: '1em', display: 'flex', alignItems: 'center'}}>\r\n                <span style={{flexGrow: 0.8}}>Proxy URL:</span>\r\n                <TextField className=\"bp3-input bp3-fill\"\r\n                           style={{flexGrow: 0.2}}\r\n                           value={initialValue}\r\n                           onChange={onChange}\r\n                           placeholder={'http://user:password@host:port'}\r\n                           nullable={true}\r\n                />\r\n            </ControlGroup>\r\n        );\r\n    }\r\n\r\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Components\r\n    // Note (forman): could make this React component later\r\n\r\n    private renderDirectoryPath(propertyName, isBackend: boolean, label: string) {\r\n        const initialValue = this.getStateValue(propertyName, isBackend);\r\n        const onChange = this.getChangeHandler(propertyName, isBackend);\r\n        return (\r\n            <div style={{width: '100%', marginBottom: '1em'}}>\r\n                <p>{label}:</p>\r\n                <ControlGroup style={{display: 'flex', alignItems: 'center'}}>\r\n                    <TextField style={{flexGrow: 1}}\r\n                               value={initialValue}\r\n                               placeholder=\"Enter directory path\"\r\n                               onChange={onChange}\r\n                    />\r\n                    <AnchorButton\r\n                        intent={Intent.PRIMARY} style={{flex: 'none'}}\r\n                        onClick={() => this.showOpenDirectoryDialog(initialValue, onChange)}>\r\n                        ...\r\n                    </AnchorButton>\r\n                </ControlGroup>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderStringValue(propertyName: string, isBackend: boolean, label: string) {\r\n        const value = this.getStateValue(propertyName, isBackend);\r\n        const onChange = this.getChangeHandler(propertyName, isBackend);\r\n        return (\r\n            <ControlGroup style={{width: '100%', marginBottom: '1em', display: 'flex', alignItems: 'center'}}>\r\n                <span style={{flexGrow: 0.8}}>{label}:</span>\r\n                <TextField style={{flexGrow: 0.2}}\r\n                           value={value}\r\n                           onChange={onChange}\r\n                />\r\n            </ControlGroup>\r\n        );\r\n    }\r\n\r\n    private renderBooleanValue(propertyName: string, isBackend: boolean, label: string) {\r\n        const value = this.getStateValue(propertyName, isBackend);\r\n        const onChange = this.getChangeHandler(propertyName, isBackend);\r\n        return (\r\n            <div style={{width: '100%', marginBottom: '1em'}}>\r\n                <Switch checked={value}\r\n                        label={label}\r\n                        onChange={(event: any) => onChange(event.target.checked)}/>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private getChangeHandler(propertyName: string, isBackend: boolean) {\r\n        return (value: any) => {\r\n            const change = {};\r\n            change[propertyName] = isDefined(value) ? (isDefined(value.value) ? value.value : value) : null;\r\n            if (isBackend) {\r\n                this.setBackendConfig(change);\r\n            } else {\r\n                this.setState(change as SessionState);\r\n            }\r\n        };\r\n    }\r\n\r\n    private getStateValue(propertyName: string, isBackend: boolean) {\r\n        return isBackend ? this.state.backendConfig[propertyName] : this.state[propertyName];\r\n    }\r\n\r\n    private setBackendConfig(backendConfigDelta: any) {\r\n        const backendConfig = Object.assign({}, this.state.backendConfig, backendConfigDelta);\r\n        this.setState({backendConfig} as SessionState);\r\n    }\r\n\r\n    private showOpenDirectoryDialog(defaultPath: string, onChange: (value) => void) {\r\n        this.props.dispatch(actions.showDirectorySelectDialog({defaultPath},\r\n                                                              (dirPath: string | null) => {\r\n                                                                  if (dirPath) {\r\n                                                                      onChange(dirPath);\r\n                                                                  }\r\n                                                              }) as any);\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(PreferencesDialog);\r\n\r\n\r\n\r\n","import * as React from \"react\";\r\nimport { Colors, HTMLTable, Icon } from '@blueprintjs/core';\r\n\r\nimport { FileFilter } from '../types';\r\nimport { applyFileFilter, compareFileNames, FileNode, getFileNodeIcon, getFileNodePath } from './FileNode';\r\n\r\nconst NAME_CELL_STYLE: React.CSSProperties = {\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    alignItems: 'center',\r\n};\r\nconst NAME_ICON_STYLE = {\r\n    marginRight: 5,\r\n};\r\nconst SIZE_CELL_STYLE: React.CSSProperties = {\r\n    width: '100%', textAlign: 'right'\r\n};\r\nconst ROW_DEFAULT_STYLE: React.CSSProperties = {};\r\nconst ROW_SELECTED_STYLE: React.CSSProperties = {\r\n    ...ROW_DEFAULT_STYLE, backgroundColor: Colors.BLUE3\r\n};\r\nconst TABLE_CONTAINER_STYLE: React.CSSProperties = {\r\n    width: '100%',\r\n    height: '100%',\r\n    overflow: 'auto',\r\n    borderColor: Colors.DARK_GRAY2,\r\n    borderStyle: 'solid',\r\n    borderWidth: 1\r\n};\r\nconst TABLE_STYLE: React.CSSProperties = {width: '100%'};\r\n\r\ninterface IFileListProps {\r\n    rootNode: FileNode;\r\n\r\n    fileFilter?: FileFilter | null;\r\n    multiSelections?: boolean;\r\n    openDirectory?: boolean;\r\n\r\n    currentDirPath?: string | null;\r\n    onCurrentDirPathChange?: (selectedDirPath: string) => any;\r\n    selectedPaths?: string[];\r\n    onSelectedPathsChange?: (selectedPaths: string[]) => any;\r\n}\r\n\r\nconst FileList: React.FC<IFileListProps> = (\r\n    {\r\n        rootNode,\r\n        fileFilter,\r\n        multiSelections,\r\n        openDirectory,\r\n        currentDirPath,\r\n        onCurrentDirPathChange,\r\n        selectedPaths,\r\n        onSelectedPathsChange,\r\n    }\r\n) => {\r\n    // const [sortedIndexMap, setSortedIndexMap] = React.useState<number[]>([]);\r\n    const currentFileNodes = getCurrentFileNodes(rootNode, currentDirPath, fileFilter);\r\n    const selectedPathSet = new Set(selectedPaths);\r\n\r\n    const getRowFileNode = (rowIndex: number): FileNode => {\r\n        // TODO (forman): implement sorting\r\n        /*\r\n        const sortedRowIndex = sortedIndexMap[rowIndex];\r\n        if (typeof sortedRowIndex === 'number') {\r\n            rowIndex = sortedRowIndex;\r\n        }\r\n        */\r\n        return currentFileNodes![rowIndex];\r\n    };\r\n\r\n    const getRowPath = (rowIndex: number): string => {\r\n        let node = getRowFileNode(rowIndex);\r\n        let path = node.name;\r\n        if (currentDirPath) {\r\n            path = currentDirPath + '/' + node.name;\r\n        }\r\n        return path;\r\n    };\r\n\r\n    const isRowSelected = (rowIndex: number): boolean => {\r\n        return selectedPathSet.has(getRowPath(rowIndex));\r\n    };\r\n\r\n    const renderFileNodeName = (rowIndex: number) => {\r\n        const node = getRowFileNode(rowIndex);\r\n        return <div style={NAME_CELL_STYLE}><Icon style={NAME_ICON_STYLE} icon={getFileNodeIcon(node)}/><span>{node.name}</span></div>;\r\n    };\r\n\r\n    const renderFileNodeLastModified = (rowIndex: number) => {\r\n        const node = getRowFileNode(rowIndex);\r\n        return node.lastModified;\r\n    };\r\n\r\n    const renderFileNodeSize = (rowIndex: number) => {\r\n        const node = getRowFileNode(rowIndex);\r\n        return <div style={SIZE_CELL_STYLE}>{node.size}</div>;\r\n    };\r\n\r\n    const handleRowClick = (fileNode: FileNode, rowIndex: number, event: React.MouseEvent<HTMLTableRowElement>) => {\r\n        // Disallow directory selection\r\n        const node = getRowFileNode(rowIndex);\r\n        if ((!openDirectory && node.isDir) || (openDirectory && !node.isDir)) {\r\n            return;\r\n        }\r\n        const path = getRowPath(rowIndex);\r\n        const newSelectedPathSet = new Set<string>(selectedPathSet);\r\n        if (newSelectedPathSet.has(path)) {\r\n            newSelectedPathSet.delete(path);\r\n        } else {\r\n            if (multiSelections && event.ctrlKey) {\r\n                newSelectedPathSet.add(path);\r\n            } else {\r\n                newSelectedPathSet.clear();\r\n                newSelectedPathSet.add(path);\r\n            }\r\n        }\r\n        if (onSelectedPathsChange) {\r\n            onSelectedPathsChange(Array.from(newSelectedPathSet));\r\n        }\r\n    };\r\n\r\n    const handleRowDoubleClick = (fileNode: FileNode, rowIndex: number) => {\r\n        if (onCurrentDirPathChange) {\r\n            const node = getRowFileNode(rowIndex);\r\n            if (node.isDir) {\r\n                onCurrentDirPathChange(getRowPath(rowIndex));\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={TABLE_CONTAINER_STYLE}>\r\n            <HTMLTable className=\"bp3-html-table-condensed bp3-interactive\" style={TABLE_STYLE}>\r\n                <thead>\r\n                <tr>\r\n                    <th>Name</th>\r\n                    <th>Last modified</th>\r\n                    <th>Size</th>\r\n                </tr>\r\n                </thead>\r\n                <tbody>\r\n                {\r\n                    currentFileNodes && currentFileNodes.map((node, rowIndex) => {\r\n                        return (\r\n                            <tr\r\n                                key={rowIndex}\r\n                                style={isRowSelected(rowIndex) ? ROW_SELECTED_STYLE : ROW_DEFAULT_STYLE}\r\n                                onClick={(e) => handleRowClick(node, rowIndex, e)}\r\n                                onDoubleClick={() => handleRowDoubleClick(node, rowIndex)}\r\n                            >\r\n                                <td>{renderFileNodeName(rowIndex)}</td>\r\n                                <td>{renderFileNodeLastModified(rowIndex)}</td>\r\n                                <td>{renderFileNodeSize(rowIndex)}</td>\r\n                            </tr>\r\n                        );\r\n                    })\r\n                }\r\n                </tbody>\r\n            </HTMLTable>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FileList;\r\n\r\n\r\nfunction getCurrentFileNodes(rootNode: FileNode,\r\n                             currentDirPath?: string | null,\r\n                             fileFilter?: FileFilter | null): FileNode[] | undefined {\r\n    let currentFileNodes = rootNode.childNodes;\r\n    if (currentDirPath) {\r\n        const currentFileNodesPath = getFileNodePath(rootNode, currentDirPath);\r\n        if (currentFileNodesPath) {\r\n            if (currentFileNodesPath.length > 0) {\r\n                currentFileNodes = currentFileNodesPath[currentFileNodesPath.length - 1].childNodes;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (currentFileNodes) {\r\n        if (fileFilter) {\r\n            currentFileNodes = applyFileFilter(currentFileNodes, fileFilter);\r\n        }\r\n        currentFileNodes = currentFileNodes.sort(compareFileNames);\r\n    }\r\n\r\n    return currentFileNodes;\r\n}\r\n","import * as React from 'react';\r\nimport { Spinner } from \"@blueprintjs/core\";\r\n\r\nimport { FileNode } from './FileNode';\r\n\r\n\r\nexport interface IRootNodeLoadingProps {\r\n    rootNode: FileNode;\r\n}\r\n\r\nconst RootNodeLoading: React.FC<IRootNodeLoadingProps> = ({rootNode}) => {\r\n    if (!rootNode.childNodes) {\r\n        return (\r\n            <div style={{width: '100%', height: '100%'}}><Spinner size={32}/></div>\r\n        );\r\n    }\r\n    return null;\r\n}\r\n\r\nexport default RootNodeLoading;\r\n\r\n\r\n\r\n","import * as React from 'react';\r\nimport { Colors, Icon, ITreeNode, Spinner, Tree } from \"@blueprintjs/core\";\r\n\r\nimport {\r\n    addExpandedDirPath,\r\n    FileNode,\r\n    getFileNodeIcon,\r\n    isPathValidAtIndex,\r\n    removeExpandedDirPath\r\n} from './FileNode';\r\nimport RootNodeLoading from './RootNodeLoading';\r\n\r\nconst TREE_CONTAINER_STYLE: React.CSSProperties = {\r\n    width: '100%',\r\n    height: '100%',\r\n    overflow: 'auto',\r\n    borderColor: Colors.DARK_GRAY2,\r\n    borderStyle: 'solid',\r\n    borderWidth: 1\r\n};\r\n\r\ntype IFileTreeNode = ITreeNode<FileNode>;\r\n\r\nexport interface IFileTreeProps {\r\n    rootNode: FileNode;\r\n\r\n    selectedPath?: string | null;\r\n    onSelectedPathChange?: (selectedPath: string | null) => void;\r\n\r\n    expandedPaths?: string[];\r\n    onExpandedPathsChange?: (expandedPaths: string[]) => void;\r\n\r\n    showFiles?: boolean;\r\n}\r\n\r\nconst FileTree: React.FC<IFileTreeProps> = (\r\n    {\r\n        rootNode,\r\n        selectedPath,\r\n        onSelectedPathChange,\r\n        expandedPaths,\r\n        onExpandedPathsChange,\r\n        showFiles\r\n    }\r\n) => {\r\n    if (!rootNode.childNodes) {\r\n        return <RootNodeLoading rootNode={rootNode}/>;\r\n    }\r\n\r\n    const treeNodes = getTreeNodes(rootNode,\r\n                                   selectedPath || null,\r\n                                   expandedPaths && expandedPaths.length > 0 ? expandedPaths : null,\r\n                                   Boolean(showFiles));\r\n\r\n    const handleNodeClick = (treeNode: IFileTreeNode, nodePath: number[]) => {\r\n        if (onSelectedPathChange) {\r\n            if (treeNode.nodeData!.isDir) {\r\n                const path = getFileNodePath(treeNodes, nodePath);\r\n                onSelectedPathChange(path !== selectedPath ? path : null);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleNodeExpand = (treeNode: IFileTreeNode, nodePath: number[]) => {\r\n        if (onExpandedPathsChange) {\r\n            if (treeNode.nodeData!.isDir) {\r\n                const path = getFileNodePath(treeNodes, nodePath);\r\n                onExpandedPathsChange(addExpandedDirPath(expandedPaths || [], path));\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleNodeCollapse = (treeNode: IFileTreeNode, nodePath: number[]) => {\r\n        if (onExpandedPathsChange) {\r\n            if (treeNode.nodeData!.isDir) {\r\n                const path = getFileNodePath(treeNodes, nodePath);\r\n                onExpandedPathsChange(removeExpandedDirPath(expandedPaths || [], path));\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={TREE_CONTAINER_STYLE}>\r\n            <Tree\r\n                contents={treeNodes}\r\n                onNodeClick={handleNodeClick}\r\n                onNodeExpand={handleNodeExpand}\r\n                onNodeCollapse={handleNodeCollapse}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default FileTree;\r\n\r\n\r\nfunction getTreeNodes(rootNode: FileNode,\r\n                      selectedPath: string | null,\r\n                      expandedPaths: string[] | null,\r\n                      includeFiles: boolean): IFileTreeNode[] {\r\n    if (!rootNode.childNodes) {\r\n        return [];\r\n    }\r\n    const idGen: [number] = [0];\r\n    return _getTreeNodes(rootNode.childNodes,\r\n                         selectedPath ? selectedPath.split('/') : [],\r\n                         expandedPaths ? expandedPaths.map(p => p.split('/')) : [],\r\n                         includeFiles,\r\n                         0,\r\n                         idGen);\r\n}\r\n\r\nfunction _getTreeNodes(fileNodes: FileNode[],\r\n                       selectedPath: string[] | null,\r\n                       expandedPaths: string[][] | null,\r\n                       includeFiles: boolean,\r\n                       depth: number,\r\n                       idGen: [number]): IFileTreeNode[] {\r\n    if (!includeFiles) {\r\n        fileNodes = fileNodes.filter(node => node.isDir);\r\n    }\r\n    return fileNodes.map(node => {\r\n\r\n        let _selectedPath = selectedPath;\r\n        let isSelected = false;\r\n        if (_selectedPath && isPathValidAtIndex(_selectedPath, depth, node.name)) {\r\n            isSelected = depth === _selectedPath.length - 1;\r\n        } else {\r\n            _selectedPath = null;\r\n        }\r\n\r\n        let _expandedPaths = expandedPaths;\r\n        let isExpanded = false;\r\n        if (_expandedPaths) {\r\n            _expandedPaths = _expandedPaths.filter(p => isPathValidAtIndex(p, depth, node.name));\r\n            _expandedPaths = _expandedPaths.length > 0 ? _expandedPaths : null;\r\n            isExpanded = _expandedPaths !== null;\r\n        } else {\r\n            _expandedPaths = null;\r\n        }\r\n\r\n        const id = idGen[0];\r\n        idGen[0] = id + 1;\r\n        let childTreeNodes;\r\n        if (node.childNodes) {\r\n            childTreeNodes = _getTreeNodes(node.childNodes,\r\n                                           _selectedPath,\r\n                                           _expandedPaths,\r\n                                           includeFiles,\r\n                                           depth + 1,\r\n                                           idGen);\r\n        }\r\n        let hasCaret: boolean;\r\n        if (includeFiles) {\r\n            hasCaret = node.isDir\r\n                       && (!childTreeNodes || Boolean(childTreeNodes.find(treeNode => treeNode.nodeData!.isDir)));\r\n        } else {\r\n            hasCaret = node.isDir\r\n                       && (!childTreeNodes || childTreeNodes.length > 0);\r\n        }\r\n        let secondaryLabel;\r\n        if (node.status === 'updating') {\r\n            secondaryLabel = <Spinner size={16}/>;\r\n        } else if (node.status === 'error') {\r\n            secondaryLabel = <Icon icon='error' iconSize={16}/>;\r\n        }\r\n        return {\r\n            id,\r\n            icon: getFileNodeIcon(node),\r\n            label: node.name,\r\n            secondaryLabel,\r\n            hasCaret,\r\n            isSelected,\r\n            isExpanded,\r\n            childNodes: childTreeNodes,\r\n            nodeData: node,\r\n        };\r\n    });\r\n}\r\n\r\nfunction getFileNodePath(rootNodes: IFileTreeNode[],\r\n                         nodePath: number[]): string {\r\n    let fileNodePath = null;\r\n    let childNodes = rootNodes;\r\n    for (let depth = 0; depth < nodePath.length; depth++) {\r\n        if (!childNodes) {\r\n            // Weird!\r\n            throw new Error(`internal error: missing childNodes at index ${depth} in node path ${nodePath.join()}`);\r\n        }\r\n        let childIndex = nodePath[depth];\r\n        let childNode = childNodes[childIndex];\r\n\r\n        if (fileNodePath === null) {\r\n            fileNodePath = childNode.nodeData!.name;\r\n        } else {\r\n            fileNodePath += '/' + childNode.nodeData!.name;\r\n        }\r\n\r\n        childNodes = childNode.childNodes;\r\n    }\r\n    return fileNodePath;\r\n}\r\n","import * as React from 'react';\r\nimport {\r\n    Breadcrumbs,\r\n    Button,\r\n    ButtonGroup,\r\n    Classes,\r\n    Colors,\r\n    IBreadcrumbProps,\r\n    MenuItem,\r\n    Tooltip\r\n} from '@blueprintjs/core';\r\nimport { IItemRendererProps, ItemRenderer, Select } from '@blueprintjs/select';\r\n\r\nimport { getBasename, getParentPath, HostOS } from '../../../../common/paths';\r\nimport { ModalDialog } from '../../ModalDialog';\r\nimport { SplitPane } from '../../SplitPane';\r\nimport { FileDialogOptions, FileDialogResult, FileFilter } from '../types';\r\nimport FileList from './FileList';\r\nimport {\r\n    addExpandedDirPath,\r\n    ALL_FILES_FILTER, denormalizePath,\r\n    FileNode,\r\n    fromPathInputValue,\r\n    getFileNode,\r\n    toPathInputValue,\r\n} from './FileNode';\r\nimport FileTree from './FileTree';\r\n\r\n\r\nconst FILE_DIALOG_STYLE: React.CSSProperties = {\r\n    width: '52vw'\r\n};\r\nconst FILE_CONTAINER_STYLE: React.CSSProperties = {\r\n    width: '100%', display: 'flex', flexFlow: 'column nowrap'\r\n};\r\nconst FILE_MGT_ROW_STYLE: React.CSSProperties = {\r\n    flexGrow: 0, display: 'flex', flexFlow: 'row nowrap', marginBottom: 6\r\n};\r\nconst FILE_LIST_ROW_STYLE: React.CSSProperties = {\r\n    height: '40vh', flexGrow: 0\r\n};\r\nconst FILE_INPUT_ROW_STYLE: React.CSSProperties = {\r\n    flexGrow: 0,\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    alignItems: 'center',\r\n    marginTop: 10\r\n};\r\nconst FILE_INPUT_STYLE: React.CSSProperties = {\r\n    flexGrow: 1, marginLeft: 10, overflow: 'hidden'\r\n};\r\nconst INVALID_FILE_INPUT_STYLE: React.CSSProperties = {\r\n    ...FILE_INPUT_STYLE,\r\n    color: '#ffaaaa',\r\n};\r\nconst FILE_NAV_ROW_STYLE: React.CSSProperties = {\r\n    flexGrow: 0, display: 'flex', flexFlow: 'row nowrap', marginBottom: 6\r\n};\r\nconst FILE_NAV_BC_STYLE: React.CSSProperties = {\r\n    flexGrow: 1,\r\n    backgroundColor: Colors.DARK_GRAY5,\r\n    paddingLeft: 10,\r\n    paddingRight: 10\r\n};\r\n\r\n/**\r\n * Various paths used in the UI. All paths have normalized from,\r\n * that is, backslashes on Windows host OS replaced by '/',\r\n * leading and trailing '/' removed, '//' replaced by single '/'.\r\n * All paths are meant absolute with respect to the fle system root `fsRootNode`,\r\n * even if the trailing '/' is removed.\r\n */\r\ninterface PathState {\r\n    /**\r\n     * The actually selected file or directory paths.\r\n     */\r\n    selectedPaths: string[];\r\n    /**\r\n     * Expanded directory paths in the FileTree component.\r\n     */\r\n    expandedPaths: string[];\r\n    /**\r\n     * Selected directory in the FileTree component.\r\n     */\r\n    selectedDirPath: string | null;\r\n    /**\r\n     * Current directory for children shown in FileList component.\r\n     */\r\n    currentDirPath: string;\r\n\r\n}\r\n\r\n/**\r\n * State of the file path input field.\r\n */\r\ninterface InputState {\r\n    /**\r\n     * Current value of the path input field. May not (yet) refer to any valid path at all.\r\n     */\r\n    value: string;\r\n    /**\r\n     * Whether current value is valid.\r\n     */\r\n    isValid: boolean;\r\n}\r\n\r\n\r\nconst FileFilterSelect = Select.ofType<FileFilter>();\r\n\r\n\r\nexport interface IFileDialogProps extends Omit<FileDialogOptions, 'properties'> {\r\n    isOpen?: boolean;\r\n    onClose?: (result: FileDialogResult) => any;\r\n    rootNode: FileNode;\r\n    updateFileNode: (path: string, force: boolean) => any;\r\n    createFileNode?: (path: string, name: string) => any;\r\n    renameFileNode?: (path: string, name: string) => any;\r\n    deleteFileNodes?: (paths: string[]) => any;\r\n    // dialog type\r\n    saveFile?: boolean;\r\n    // from properties\r\n    openFile?: boolean;\r\n    openDirectory?: boolean;\r\n    multiSelections?: boolean;\r\n    showHiddenFiles?: boolean;\r\n    hostOS?: HostOS;\r\n}\r\n\r\nconst FileDialog: React.FC<IFileDialogProps> = (\r\n    {\r\n        isOpen,\r\n        onClose,\r\n        rootNode,\r\n        updateFileNode,\r\n        createFileNode,\r\n        renameFileNode,\r\n        deleteFileNodes,\r\n        title,\r\n        defaultPath,\r\n        buttonLabel,\r\n        filters,\r\n        saveFile,\r\n        openFile,\r\n        openDirectory,\r\n        multiSelections,\r\n        showHiddenFiles,\r\n        hostOS,\r\n    }) => {\r\n\r\n    if ((saveFile && openFile) || (saveFile && openDirectory) || (saveFile && multiSelections)) {\r\n        throw new Error('saveFile flag cannot be used with openFile, openDirectory, multiSelections flags');\r\n    }\r\n    if (showHiddenFiles) {\r\n        // TODO (forman): recognize showHiddenFiles\r\n        console.warn('showHiddenFiles flag ignored (not implemented yet))');\r\n    }\r\n\r\n    // TODO (forman): avoid expensive computation of values, they are only needed initially\r\n    const initSelectedPaths = (defaultPath && fromPathInputValue(defaultPath, '', multiSelections, hostOS)) || [];\r\n    let initExpandedPaths = [];\r\n    initSelectedPaths.forEach(p => {\r\n        initExpandedPaths = addExpandedDirPath(initExpandedPaths, getParentPath(p, hostOS));\r\n    });\r\n    const initSelectedDirPath = initExpandedPaths.length > 0 ? initExpandedPaths[0] : null;\r\n    const initCurrentDirPath = initSelectedDirPath || '';\r\n\r\n    const [pathState, dispatchPathState] = React.useReducer(\r\n        (state: PathState, stateUpdate: Partial<PathState>) => {\r\n            return {...state, ...stateUpdate}\r\n        },\r\n        {\r\n            selectedPaths: initSelectedPaths,\r\n            expandedPaths: initExpandedPaths,\r\n            selectedDirPath: initSelectedDirPath,\r\n            currentDirPath: initCurrentDirPath,\r\n        });\r\n    const [inputState, dispatchInputState] = React.useReducer(\r\n        (state: InputState, stateUpdate: Partial<InputState>) => {\r\n            return {...state, ...stateUpdate}\r\n        },\r\n        {\r\n            value: defaultPath || '',\r\n            isValid: true\r\n        });\r\n\r\n    const [fileTreeWidth, setFileTreeWidth] = React.useState(300);\r\n    const [selectedFileFilter, setSelectedFileFilter] = React.useState(\r\n        filters && filters.length ? filters[0] : null\r\n    );\r\n\r\n    const updateCallback = React.useMemo(() => {\r\n        return (path: string) => {\r\n            updateFileNode(path, false);\r\n        };\r\n    }, [updateFileNode]);\r\n\r\n    React.useEffect(() => {\r\n        if (defaultPath) {\r\n            updateCallback(defaultPath);\r\n        }\r\n    }, [defaultPath, updateCallback]);\r\n\r\n    React.useEffect(() => {\r\n        pathState.expandedPaths.forEach(p => updateCallback(p));\r\n    }, [pathState.expandedPaths, updateCallback]);\r\n\r\n    React.useEffect(() => {\r\n        updateCallback(pathState.currentDirPath);\r\n    }, [pathState.currentDirPath, updateCallback]);\r\n\r\n    if (!isOpen) {\r\n        return null;\r\n    }\r\n\r\n    // console.log(\"FileDialog: pathState=\", pathState);\r\n\r\n    const canConfirm = () => {\r\n        return pathState.selectedPaths.length > 0 && inputState.isValid;\r\n    }\r\n\r\n    const handleConfirm = () => {\r\n        if (onClose) {\r\n            onClose({\r\n                        // Make returned path absolute. Note that pathState.selectedPaths are always normalized.\r\n                        filePaths: pathState.selectedPaths.map(p => denormalizePath(p, hostOS)),\r\n                        canceled: false\r\n                    });\r\n        }\r\n    }\r\n\r\n    const handleCancel = () => {\r\n        if (onClose) {\r\n            onClose({\r\n                        filePaths: [],\r\n                        canceled: true\r\n                    });\r\n        }\r\n    }\r\n\r\n    const handleFileTreeWidthChange = (fileTreeWidth: number) => {\r\n        setFileTreeWidth(fileTreeWidth);\r\n    };\r\n\r\n    const canNavigateBack = () => {\r\n        // TODO (forman): implement me!\r\n        return false;\r\n    };\r\n\r\n    const handleNavigateBack = () => {\r\n        if (canNavigateBack()) {\r\n            // TODO (forman): implement me!\r\n        }\r\n    };\r\n\r\n    const canNavigateForward = () => {\r\n        return false;\r\n    };\r\n\r\n    const handleNavigateForward = () => {\r\n        if (canNavigateForward()) {\r\n            // TODO (forman): implement me!\r\n        }\r\n    };\r\n\r\n    const canNavigateUp = () => {\r\n        return pathState.currentDirPath !== '';\r\n    };\r\n\r\n    const handleNavigateUp = () => {\r\n        if (canNavigateUp()) {\r\n            const parentDir = getParentPath(pathState.currentDirPath);\r\n            dispatchPathState({\r\n                                  selectedDirPath: parentDir !== '' ? parentDir : null,\r\n                                  currentDirPath: parentDir,\r\n                              });\r\n        }\r\n    };\r\n\r\n    const canShowRecentDirs = () => {\r\n        // TODO (forman): implement me!\r\n        return false;\r\n    };\r\n\r\n    const handleShowRecentDirs = () => {\r\n        if (canShowRecentDirs()) {\r\n            // TODO (forman): implement me!\r\n        }\r\n    };\r\n\r\n    const canShowRecentPaths = () => {\r\n        // TODO (forman): implement me!\r\n        return false;\r\n    };\r\n\r\n    const handleShowRecentPaths = () => {\r\n        if (canShowRecentPaths()) {\r\n            // TODO (forman): implement me!\r\n        }\r\n    };\r\n\r\n    const canCreateDirectory = () => {\r\n        return Boolean(createFileNode);\r\n    };\r\n\r\n    const handleCreateDirectoryClick = () => {\r\n        if (canCreateDirectory()) {\r\n            // TODO (forman): enter create mode\r\n            // createFileNode!(pathState.selectedDirPath!, name);\r\n        }\r\n    };\r\n\r\n    const canRename = () => {\r\n        return Boolean(renameFileNode) && pathState.selectedPaths.length === 1;\r\n    };\r\n\r\n    const handleRenameClick = () => {\r\n        if (canRename()) {\r\n            // TODO (forman): enter rename mode\r\n            // renameFileNode!(pathState.selectedPaths[0], name);\r\n        }\r\n    };\r\n\r\n    const canDelete = () => {\r\n        return Boolean(deleteFileNodes) && pathState.selectedPaths.length > 0;\r\n    };\r\n\r\n    const handleDeleteClick = () => {\r\n        if (canDelete()) {\r\n            deleteFileNodes!(pathState.selectedPaths);\r\n        }\r\n    };\r\n\r\n    const handleSyncCurrentDir = () => {\r\n        updateFileNode(pathState.currentDirPath, true);\r\n    };\r\n\r\n    const handleSelectedDirChangeInBreadcrumb = (path: string) => {\r\n        handleSelectedDirChangeInTree(path);\r\n    };\r\n\r\n    const handleSelectedDirChangeInTree = (path: string | null) => {\r\n        if (openDirectory) {\r\n            // change selectedPaths/inputValue too\r\n            if (path !== null) {\r\n                const selectedPaths = [path];\r\n                const inputValue = toPathInputValue([getBasename(path)], multiSelections);\r\n                dispatchPathState({\r\n                                      selectedDirPath: path,\r\n                                      currentDirPath: path,\r\n                                      selectedPaths,\r\n                                  });\r\n                dispatchInputState({value: inputValue, isValid: true})\r\n            } else {\r\n                dispatchPathState({\r\n                                      selectedDirPath: null,\r\n                                      selectedPaths: [],\r\n                                  });\r\n                dispatchInputState({value: '', isValid: true})\r\n            }\r\n        } else {\r\n            // do not change selectedPaths/inputValue\r\n            if (path !== null) {\r\n                dispatchPathState({\r\n                                      selectedDirPath: path,\r\n                                      currentDirPath: path\r\n                                  });\r\n            } else {\r\n                dispatchPathState({selectedDirPath: null});\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleExpandedPathsChangeInTree = (paths: string[]) => {\r\n        dispatchPathState({expandedPaths: paths});\r\n    };\r\n\r\n    const handleSelectedPathsChangeInList = (paths: string[]) => {\r\n        dispatchPathState({\r\n                              selectedPaths: paths,\r\n                          });\r\n        dispatchInputState({\r\n                               value: toPathInputValue(paths.map(p => getBasename(p)), multiSelections),\r\n                               isValid: true\r\n                           })\r\n    };\r\n\r\n    const handleCurrentDirPathChangeInList = (path: string) => {\r\n        if (openDirectory && !openFile && !multiSelections) {\r\n            // change selectedPaths/inputValue too\r\n            dispatchPathState({\r\n                                  expandedPaths: addExpandedDirPath(pathState.expandedPaths, path),\r\n                                  selectedDirPath: path,\r\n                                  currentDirPath: path,\r\n                                  selectedPaths: [path],\r\n                              });\r\n            dispatchInputState({\r\n                                   value: toPathInputValue([getBasename(path)], multiSelections),\r\n                                   isValid: true\r\n                               })\r\n        } else {\r\n            dispatchPathState({\r\n                                  expandedPaths: addExpandedDirPath(pathState.expandedPaths, path),\r\n                                  selectedDirPath: path,\r\n                                  currentDirPath: path,\r\n                              });\r\n        }\r\n    };\r\n\r\n    const handleSelectedPathsChangeInTextField = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const inputValue = event.target.value || '';\r\n        let isInputValid = true;\r\n        const selectedPaths = fromPathInputValue(inputValue, pathState.currentDirPath, multiSelections, hostOS);\r\n        if (selectedPaths.length) {\r\n            // User entered files / directories\r\n\r\n            // Add parents of selected files to expanded paths\r\n            let expandedPaths = pathState.expandedPaths;\r\n            selectedPaths.forEach(p => {\r\n                const expandedPath = getParentPath(p);\r\n                expandedPaths = addExpandedDirPath(expandedPaths, expandedPath);\r\n            });\r\n            // Check if we have a new current dir\r\n            let currentDirPath = selectedPaths.length > 0 ? getParentPath(selectedPaths[0]) : null;\r\n            if (currentDirPath !== null && getFileNode(rootNode, currentDirPath) === null) {\r\n                currentDirPath = null;\r\n            }\r\n            if (currentDirPath !== null) {\r\n                // New current directory exists\r\n\r\n                dispatchPathState({\r\n                                      selectedDirPath: currentDirPath,\r\n                                      currentDirPath,\r\n                                      expandedPaths,\r\n                                      selectedPaths,\r\n                                  });\r\n\r\n                // Check if selected files / directories exist (yet)\r\n                if (openFile || openDirectory) {\r\n                    isInputValid = !selectedPaths.find(p => getFileNode(rootNode, p) === null);\r\n                }\r\n\r\n            } else {\r\n                // New current directory doe yet exist (yet). But we'll need to update expanded paths.\r\n                dispatchPathState({selectedPaths, expandedPaths});\r\n                isInputValid = false;\r\n            }\r\n        } else {\r\n            // User entered nothing so far\r\n            dispatchPathState({selectedPaths});\r\n        }\r\n        dispatchInputState({value: inputValue, isValid: isInputValid});\r\n    }\r\n\r\n    const getBreadcrumbs = (): IBreadcrumbProps[] => {\r\n        if (pathState.currentDirPath === '') {\r\n            return [];\r\n        }\r\n        let pathComponents = pathState.currentDirPath.split('/');\r\n        return pathComponents.map((dirName, index) => {\r\n            let onClick;\r\n            if (index < pathComponents.length - 1) {\r\n                const path = pathComponents.slice(0, index + 1).join('/');\r\n                onClick = () => handleSelectedDirChangeInBreadcrumb(path);\r\n            }\r\n            return {text: dirName, onClick};\r\n        });\r\n    };\r\n\r\n    let renderActions;\r\n    if (!openFile && !openDirectory && !saveFile) {\r\n        renderActions = () => null;\r\n    }\r\n\r\n    return (\r\n        <ModalDialog\r\n            isOpen={isOpen}\r\n            title={title || getDefaultFileActionText(saveFile, openDirectory, openFile)}\r\n            confirmTitle={buttonLabel || getDefaultFileActionText(saveFile, openDirectory, openFile)}\r\n            onConfirm={handleConfirm}\r\n            onCancel={handleCancel}\r\n            canConfirm={canConfirm}\r\n            style={FILE_DIALOG_STYLE}\r\n            renderActions={renderActions}\r\n        >\r\n            <div style={FILE_CONTAINER_STYLE}>\r\n                <div style={FILE_NAV_ROW_STYLE}>\r\n                    <ButtonGroup minimal={true}>\r\n                        <Button\r\n                            disabled={!canNavigateBack()}\r\n                            onClick={handleNavigateBack}\r\n                            icon=\"arrow-left\"\r\n                        />\r\n                        <Button\r\n                            disabled={!canNavigateForward()}\r\n                            onClick={handleNavigateForward}\r\n                            icon=\"arrow-right\"\r\n                        />\r\n                        <Button\r\n                            disabled={!canNavigateUp()}\r\n                            onClick={handleNavigateUp}\r\n                            icon=\"arrow-up\"\r\n                        />\r\n                    </ButtonGroup>\r\n                    <div style={FILE_NAV_BC_STYLE}>\r\n                        <Breadcrumbs className=\"bp3-small\" items={getBreadcrumbs()}/>\r\n                    </div>\r\n                    <ButtonGroup minimal={true}>\r\n                        <Button\r\n                            disabled={!canShowRecentDirs()}\r\n                            onClick={handleShowRecentDirs}\r\n                            icon=\"caret-down\"\r\n                        />\r\n                        <Button\r\n                            onClick={handleSyncCurrentDir}\r\n                            icon=\"refresh\"\r\n                        />\r\n                    </ButtonGroup>\r\n                </div>\r\n                {(Boolean(createFileNode) || Boolean(renameFileNode) || Boolean(deleteFileNodes)) && (\r\n                    <div style={FILE_MGT_ROW_STYLE}>\r\n                        <ButtonGroup minimal={true}>\r\n                            {Boolean(createFileNode) && (\r\n                                <Tooltip\r\n                                    content={canCreateDirectory()\r\n                                             ? `Create new directory in ${pathState.currentDirPath}` : null}>\r\n                                    <Button\r\n                                        disabled={!canCreateDirectory()}\r\n                                        onClick={handleCreateDirectoryClick}\r\n                                        icon=\"folder-new\"\r\n                                        text=\"Create Directory\"\r\n                                    />\r\n                                </Tooltip>\r\n                            )}\r\n                            {Boolean(renameFileNode) && (\r\n                                <Tooltip content={canRename() ? `Rename ${pathState.selectedPaths[0]}` : null}>\r\n                                    <Button\r\n                                        disabled={!canRename()}\r\n                                        onClick={handleRenameClick}\r\n                                        icon=\"edit\"\r\n                                        text=\"Rename\"\r\n                                    />\r\n                                </Tooltip>\r\n                            )}\r\n                            {Boolean(deleteFileNodes) && (\r\n                                <Tooltip content={canDelete()\r\n                                                  ? `Delete ${pathState.selectedPaths[0]}`\r\n                                                    + (pathState.selectedPaths.length > 0 ? ', ...' : '') : null}>\r\n                                    <Button\r\n                                        disabled={!canDelete()}\r\n                                        onClick={handleDeleteClick}\r\n                                        icon=\"trash\"\r\n                                        text=\"Delete Directory\"\r\n                                    />\r\n                                </Tooltip>\r\n                            )}\r\n                        </ButtonGroup>\r\n                    </div>)}\r\n                <div style={FILE_LIST_ROW_STYLE}>\r\n                    <SplitPane dir=\"hor\" initialSize={fileTreeWidth} onChange={handleFileTreeWidthChange}>\r\n                        <FileTree\r\n                            rootNode={rootNode}\r\n                            selectedPath={pathState.selectedDirPath}\r\n                            onSelectedPathChange={handleSelectedDirChangeInTree}\r\n                            expandedPaths={pathState.expandedPaths}\r\n                            onExpandedPathsChange={handleExpandedPathsChangeInTree}\r\n                        />\r\n                        <FileList\r\n                            rootNode={rootNode}\r\n                            currentDirPath={pathState.currentDirPath}\r\n                            onCurrentDirPathChange={handleCurrentDirPathChangeInList}\r\n                            selectedPaths={pathState.selectedPaths}\r\n                            onSelectedPathsChange={handleSelectedPathsChangeInList}\r\n                            fileFilter={selectedFileFilter}\r\n                            multiSelections={multiSelections}\r\n                            openDirectory={openDirectory}\r\n                        />\r\n                    </SplitPane>\r\n                </div>\r\n                <div style={FILE_INPUT_ROW_STYLE}>\r\n                    <span>{openDirectory && !openFile ? 'Directory:' : 'Filename:'}</span>\r\n                    <input\r\n                        className={Classes.INPUT}\r\n                        style={inputState.isValid ? FILE_INPUT_STYLE : INVALID_FILE_INPUT_STYLE}\r\n                        type=\"text\"\r\n                        value={inputState.value}\r\n                        onChange={handleSelectedPathsChangeInTextField}\r\n                    />\r\n                    <ButtonGroup>\r\n                        <Button\r\n                            disabled={!canShowRecentPaths()}\r\n                            onClick={handleShowRecentPaths}\r\n                            icon=\"caret-down\"\r\n                            minimal={true}\r\n                        />\r\n                        {filters &&\r\n                         <FileFilterSelect\r\n                             popoverProps={{minimal: true}}\r\n                             items={filters}\r\n                             filterable={false}\r\n                             itemRenderer={fileFilterItemRenderer}\r\n                             onItemSelect={filter => setSelectedFileFilter(filter)}\r\n                         >\r\n                             <Button\r\n                                 text={getFileFilterText(selectedFileFilter)}\r\n                                 rightIcon=\"caret-down\"\r\n                             />\r\n                         </FileFilterSelect>\r\n                        }\r\n                    </ButtonGroup>\r\n                </div>\r\n            </div>\r\n        </ModalDialog>\r\n    );\r\n};\r\n\r\nexport default FileDialog;\r\n\r\nconst fileFilterItemRenderer: ItemRenderer<FileFilter> = (fileFilter: FileFilter, itemProps: IItemRendererProps) => {\r\n    const {modifiers, handleClick} = itemProps;\r\n    return (\r\n        <MenuItem\r\n            active={modifiers.active}\r\n            disabled={modifiers.disabled}\r\n            key={fileFilter.name}\r\n            text={fileFilter.name}\r\n            label={`(${fileFilter.extensions.map(e => \"*.\" + e).join(\", \")})`}\r\n            onClick={handleClick}\r\n        />\r\n    );\r\n};\r\n\r\nfunction getFileFilterText(fileFilter: FileFilter | null): string {\r\n    fileFilter = fileFilter || ALL_FILES_FILTER;\r\n    return `${fileFilter.name} (${fileFilter.extensions.map(e => \"*.\" + e).join(\", \")})`;\r\n}\r\n\r\nfunction getDefaultFileActionText(saveFile?: boolean, openDirectory?: boolean, openFile?: boolean): string {\r\n    if (saveFile) {\r\n        return 'Save File';\r\n    }\r\n    if (openDirectory && !openFile) {\r\n        return 'Select Directory';\r\n    }\r\n    return 'Open File';\r\n}\r\n","import * as React from 'react';\r\nimport { OpenDialogOptions, OpenDialogResult } from '../types';\r\n\r\nimport FileDialog from './FileDialog';\r\nimport { FileNode } from './FileNode';\r\n\r\n\r\nexport interface IOpenDialogProps extends OpenDialogOptions {\r\n    isOpen?: boolean;\r\n    onClose?: (result: OpenDialogResult) => any;\r\n    rootNode: FileNode;\r\n    updateFileNode: (path: string, force: boolean) => any;\r\n}\r\n\r\nconst OpenDialog: React.FC<IOpenDialogProps> = (props) => {\r\n    const properties = new Set(props.properties);\r\n    return (\r\n        <FileDialog\r\n            {...props}\r\n            saveFile={false}\r\n            // openFile={properties.has('openFile') || !properties.has('openDirectory')}\r\n            openFile={properties.has('openFile')}\r\n            openDirectory={properties.has('openDirectory')}\r\n            multiSelections={properties.has('multiSelections')}\r\n            showHiddenFiles={properties.has('showHiddenFiles')}\r\n        />\r\n    );\r\n};\r\n\r\nexport default OpenDialog;\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { State } from '../state';\r\nimport OpenDialog, { IOpenDialogProps } from \"../components/desktop/fs/OpenDialog\";\r\nimport * as actions from \"../actions\";\r\n\r\n\r\nfunction mapStateToProps(state: State) {\r\n    return {\r\n        ...state.control.directorySelectDialog.options,\r\n        isOpen: state.control.directorySelectDialog.isOpen,\r\n        onClose: state.control.directorySelectDialog.onClose,\r\n        rootNode: state.data.fsRootNode,\r\n        hostOS: state.communication.webAPIServiceInfo.hostOS,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateFileNode: actions.updateFileNode,\r\n};\r\n\r\nconst DirectorySelectDialog: React.FC<IOpenDialogProps> = (props) => {\r\n    return (props.isOpen) ? (<OpenDialog {...props}/>) : null;\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DirectorySelectDialog);\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { State } from '../state';\r\nimport OpenDialog, { IOpenDialogProps } from \"../components/desktop/fs/OpenDialog\";\r\nimport * as actions from \"../actions\";\r\n\r\n\r\nfunction mapStateToProps(state: State) {\r\n    return {\r\n        ...state.control.fileOpenDialog.options,\r\n        isOpen: state.control.fileOpenDialog.isOpen,\r\n        onClose: state.control.fileOpenDialog.onClose,\r\n        rootNode: state.data.fsRootNode,\r\n        hostOS: state.communication.webAPIServiceInfo.hostOS,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateFileNode: actions.updateFileNode,\r\n};\r\n\r\nconst FileOpenDialog: React.FC<IOpenDialogProps> = (props) => {\r\n    return (props.isOpen) ? (<OpenDialog {...props}/>) : null;\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(FileOpenDialog);\r\n","import * as React from 'react';\r\nimport { FileNode } from './FileNode';\r\n\r\nimport FileDialog from './FileDialog';\r\nimport { FileDialogResult, SaveDialogOptions, SaveDialogResult } from '../types';\r\n\r\n\r\nexport interface ISaveDialogProps extends SaveDialogOptions {\r\n    isOpen?: boolean;\r\n    onClose?: (result: SaveDialogResult) => any;\r\n    rootNode: FileNode;\r\n    updateFileNode: (path: string, force: boolean) => any;\r\n}\r\n\r\nconst SaveDialog: React.FC<ISaveDialogProps> = ({onClose, ...props}) => {\r\n    const properties = new Set(props.properties);\r\n    const handleClose = (result: FileDialogResult) => {\r\n        onClose({\r\n                    canceled: result.canceled,\r\n                    filePath: !result.canceled && result.filePaths.length > 0 ? result.filePaths[0] : null\r\n                });\r\n    };\r\n    return (\r\n        <FileDialog\r\n            {...props}\r\n            onClose={handleClose}\r\n            saveFile={true}\r\n            openFile={false}\r\n            openDirectory={false}\r\n            multiSelections={false}\r\n            showHiddenFiles={properties.has(\"showHiddenFiles\")}\r\n        />\r\n    );\r\n};\r\n\r\nexport default SaveDialog;\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { State } from '../state';\r\nimport SaveDialog, { ISaveDialogProps } from \"../components/desktop/fs/SaveDialog\";\r\nimport * as actions from \"../actions\";\r\n\r\n\r\nfunction mapStateToProps(state: State) {\r\n    return {\r\n        ...state.control.fileSaveDialog.options,\r\n        isOpen: state.control.fileSaveDialog.isOpen,\r\n        onClose: state.control.fileSaveDialog.onClose,\r\n        rootNode: state.data.fsRootNode,\r\n        hostOS: state.communication.webAPIServiceInfo.hostOS,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateFileNode: actions.updateFileNode,\r\n};\r\n\r\nconst FileSaveDialog: React.FC<ISaveDialogProps> = (props) => {\r\n    return (props.isOpen) ? (<SaveDialog {...props}/>) : null;\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(FileSaveDialog);\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { State } from '../state';\r\nimport OpenDialog, { IOpenDialogProps } from \"../components/desktop/fs/OpenDialog\";\r\nimport * as actions from \"../actions\";\r\n\r\n\r\nfunction mapStateToProps(state: State) {\r\n    return {\r\n        ...state.control.fileBrowseDialog.options,\r\n        isOpen: state.control.fileBrowseDialog.isOpen,\r\n        onClose: state.control.fileBrowseDialog.onClose,\r\n        rootNode: state.data.fsRootNode,\r\n        hostOS: state.communication.webAPIServiceInfo.hostOS,\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n    updateFileNode: actions.updateFileNode,\r\n};\r\n\r\nconst FileBrowseDialog: React.FC<IOpenDialogProps> = (props) => {\r\n    let properties = props.properties;\r\n    if (properties) {\r\n        const propSet = new Set(properties);\r\n        propSet.delete(\"openFile\");\r\n        propSet.delete(\"openDirectory\");\r\n        properties = Array.from(propSet);\r\n    } else {\r\n        properties = [];\r\n    }\r\n    return (props.isOpen) ? (<OpenDialog title=\"Browse Files\" {...props} properties={properties}/>) : null;\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(FileBrowseDialog);\r\n","import * as React from 'react';\r\nimport { Button, Checkbox, Intent } from '@blueprintjs/core';\r\nimport { IconNames } from '@blueprintjs/icons';\r\n\r\nimport { isDefined } from '../../../common/types';\r\nimport { ModalDialog } from '../ModalDialog';\r\nimport { MessageBoxOptions, MessageBoxResult } from './types';\r\n\r\n\r\nexport interface IMessageBoxProps extends MessageBoxOptions {\r\n    isOpen?: boolean;\r\n    onClose?: (result: MessageBoxResult | null) => any;\r\n}\r\n\r\nconst icons = {\r\n    none: undefined,\r\n    info: IconNames.INFO_SIGN,\r\n    error: IconNames.ERROR,\r\n    question: IconNames.CONFIRM,\r\n    warning: IconNames.WARNING_SIGN,\r\n}\r\n\r\nexport const MessageBox: React.FC<IMessageBoxProps> = (\r\n    {\r\n        isOpen,\r\n        onClose,\r\n        type,\r\n        title,\r\n        message,\r\n        detail,\r\n        buttons,\r\n        checkboxLabel,\r\n        checkboxChecked,\r\n        defaultId,\r\n        cancelId,\r\n    }) => {\r\n    const [_checkboxChecked, setCheckboxChecked] = React.useState<boolean>((isDefined(checkboxChecked) && checkboxChecked));\r\n    const hasCheckbox = Boolean(checkboxLabel);\r\n    if (!isOpen) {\r\n        return null;\r\n    }\r\n    const handleButtonClick = (buttonIndex: number) => {\r\n        if (onClose) {\r\n            onClose({buttonIndex, checkboxChecked: _checkboxChecked});\r\n        }\r\n    }\r\n    const handleCancel = () => {\r\n        if (onClose) {\r\n            onClose(null);\r\n        }\r\n    }\r\n\r\n    const renderActions = () => {\r\n        const actions = (buttons || [\"OK\"]).map(\r\n            (buttonText, buttonIndex) => {\r\n                const intent = buttonIndex === defaultId ? Intent.PRIMARY : Intent.NONE;\r\n                if (buttonIndex === cancelId) {\r\n                    return <Button intent={intent} onClick={handleCancel}>{buttonText}</Button>;\r\n                } else {\r\n                    return <Button intent={intent} onClick={() => handleButtonClick(buttonIndex)}>{buttonText}</Button>;\r\n                }\r\n            }\r\n        );\r\n        return actions;\r\n    }\r\n\r\n    const handleCheckboxChange = (event) => {\r\n        setCheckboxChecked(event.target.checked);\r\n    }\r\n    return (\r\n        <ModalDialog\r\n            isOpen={isOpen}\r\n            title={title}\r\n            icon={icons[type]}\r\n            onCancel={handleCancel}\r\n            renderActions={renderActions}\r\n        >\r\n            <p>{message}</p>\r\n            <p className=\"bp3-text-muted\">{detail}</p>\r\n            {hasCheckbox && <p><Checkbox label={checkboxLabel} onChange={handleCheckboxChange}/></p>}\r\n        </ModalDialog>\r\n    );\r\n};\r\n","import * as React from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\n\r\nimport { State } from '../state';\r\nimport { IMessageBoxProps, MessageBox } from '../components/desktop/MessageBox';\r\n\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IMessageBoxProps {\r\n    if (state.control.messageBox) {\r\n        return {\r\n            isOpen: state.control.messageBox.isOpen,\r\n            onClose: state.control.messageBox.onClose,\r\n            ...state.control.messageBox.options,\r\n        };\r\n    } else {\r\n        return {\r\n            isOpen: false,\r\n            message: '',\r\n        };\r\n    }\r\n}\r\n\r\nconst _MessageBox: React.FC<IMessageBoxProps & IDispatch> = (props) => {\r\n    return (<MessageBox {...props}/>);\r\n};\r\n\r\nexport default connect(mapStateToProps)(_MessageBox);\r\n","import { IconName } from '@blueprintjs/icons';\r\nimport * as React from 'react'\r\nimport { CSSProperties } from 'react'\r\nimport { Colors, Icon, PopoverPosition, Tooltip, } from '@blueprintjs/core';\r\nimport { Splitter } from './Splitter';\r\n\r\n\r\nexport interface PanelContainerLayout {\r\n    horPos: number;\r\n    verPos: number;\r\n}\r\n\r\nexport interface IPanelContainerProps {\r\n    position?: 'left' | 'right';\r\n    selectedTopPanelId?: string | null;\r\n    selectedBottomPanelId?: string | null;\r\n    onSelectedTopPanelChange?: (panelId: string | null) => void;\r\n    onSelectedBottomPanelChange?: (panelId: string | null) => void;\r\n    layout: PanelContainerLayout;\r\n    onLayoutChange?: (layout: PanelContainerLayout) => void;\r\n    undockedMode?: boolean;\r\n}\r\n\r\nexport interface IPanelContainerState {\r\n    selectedTopPanelId: string | null;\r\n    selectedBottomPanelId: string | null;\r\n    layout: PanelContainerLayout;\r\n}\r\n\r\n/**\r\n * A PanelContainer comprises Panels.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class PanelContainer extends React.PureComponent<IPanelContainerProps, IPanelContainerState> {\r\n\r\n    static readonly PANEL_ICON_SIZE = 20; // ==> because bp3-icon-large = 20px\r\n    static readonly PANEL_ICON_PADDING = 8;\r\n    static readonly PANEL_BAR_SIZE = 2 * PanelContainer.PANEL_ICON_PADDING + PanelContainer.PANEL_ICON_SIZE;\r\n    static readonly PANEL_BAR_PADDING = 8;\r\n    static readonly PANEL_PANE_PADDING = 4;\r\n    static readonly PANEL_BODY_PADDING = 2;\r\n\r\n\r\n    constructor(props: IPanelContainerProps) {\r\n        super(props);\r\n        this.onTopPanelSelected = this.onTopPanelSelected.bind(this);\r\n        this.onBottomPanelSelected = this.onBottomPanelSelected.bind(this);\r\n        this.onTopPanelClose = this.onTopPanelClose.bind(this);\r\n        this.onBottomPanelClose = this.onBottomPanelClose.bind(this);\r\n        this.onVerSplitterPosChange = this.onVerSplitterPosChange.bind(this);\r\n        this.onHorSplitterPosChange = this.onHorSplitterPosChange.bind(this);\r\n        this.state = PanelContainer.mapPropsToState(props);\r\n    }\r\n\r\n    componentWillReceiveProps(props: IPanelContainerProps) {\r\n        this.setState(PanelContainer.mapPropsToState(props));\r\n    }\r\n\r\n    static mapPropsToState(props: IPanelContainerProps): IPanelContainerState {\r\n        return {\r\n            selectedTopPanelId: props.selectedTopPanelId,\r\n            selectedBottomPanelId: props.selectedBottomPanelId,\r\n            layout: props.layout,\r\n        };\r\n    }\r\n\r\n    private onTopPanelSelected(panelId: string) {\r\n        const isCurrent = this.state.selectedTopPanelId === panelId;\r\n        this.setState({selectedTopPanelId: isCurrent ? null : panelId} as any, () => {\r\n            if (this.props.onSelectedTopPanelChange) {\r\n                this.props.onSelectedTopPanelChange(this.state.selectedTopPanelId);\r\n            }\r\n        });\r\n    }\r\n\r\n    private onBottomPanelSelected(panelId: string) {\r\n        const isCurrent = this.state.selectedBottomPanelId === panelId;\r\n        this.setState({selectedBottomPanelId: isCurrent ? null : panelId} as any, () => {\r\n            if (this.props.onSelectedBottomPanelChange) {\r\n                this.props.onSelectedBottomPanelChange(this.state.selectedBottomPanelId);\r\n            }\r\n        });\r\n    }\r\n\r\n    private onTopPanelClose() {\r\n        this.onTopPanelSelected(null);\r\n    }\r\n\r\n    private onBottomPanelClose() {\r\n        this.onBottomPanelSelected(null);\r\n    }\r\n\r\n    private onVerSplitterPosChange(delta: number) {\r\n        let verPos = this.state.layout.verPos + delta;\r\n        this.setLayout({...this.state.layout, verPos});\r\n    }\r\n\r\n    private onHorSplitterPosChange(delta: number) {\r\n        let horPos = this.state.layout.horPos;\r\n        if ((this.props.position || 'left') === 'left') {\r\n            horPos += delta;\r\n        } else {\r\n            horPos -= delta;\r\n        }\r\n        this.setLayout({...this.state.layout, horPos});\r\n    }\r\n\r\n    private setLayout(layout: PanelContainerLayout) {\r\n        this.setState({layout} as any, () => {\r\n            if (this.props.onLayoutChange) {\r\n                this.props.onLayoutChange(layout);\r\n            }\r\n        });\r\n    }\r\n\r\n    private getSelectedTopPanel(): JSX.Element | null {\r\n        return this.findPanel(this.state.selectedTopPanelId);\r\n    }\r\n\r\n    private getSelectedBottomPanel(): JSX.Element | null {\r\n        return this.findPanel(this.state.selectedBottomPanelId);\r\n    }\r\n\r\n    private findPanel(id: string): JSX.Element | null {\r\n        if (!id) {\r\n            return null;\r\n        }\r\n        let selectedPanel: JSX.Element | null = null;\r\n        React.Children.forEach(this.props.children, (child: React.ReactChild) => {\r\n            const panel = child as JSX.Element;\r\n            if (panel.props && panel.props.id === id) {\r\n                selectedPanel = panel;\r\n            }\r\n        });\r\n        return selectedPanel;\r\n    }\r\n\r\n    render() {\r\n        const panelBar = <PanelBar panels={React.Children.toArray(this.props.children) as JSX.Element[]}\r\n                                   position={this.props.position}\r\n                                   selectedTopPanelId={this.state.selectedTopPanelId}\r\n                                   selectedBottomPanelId={this.state.selectedBottomPanelId}\r\n                                   onTopPanelSelected={this.onTopPanelSelected}\r\n                                   onBottomPanelSelected={this.onBottomPanelSelected}/>;\r\n\r\n        const selectedTopPanel = this.getSelectedTopPanel();\r\n        const selectedBottomPanel = this.getSelectedBottomPanel();\r\n\r\n        const panelPaneWidth = this.state.layout.horPos;\r\n        let panelPaneHeight: string | number = '100%';\r\n\r\n        let topPanelPane;\r\n        if (selectedTopPanel) {\r\n            if (selectedTopPanel && selectedBottomPanel) {\r\n                panelPaneHeight = this.state.layout.verPos;\r\n            }\r\n            const topPanelPaneStyle = {\r\n                width: panelPaneWidth,\r\n                //maxWidth: panelPaneWidth,\r\n                height: panelPaneHeight,\r\n                //maxHeight: panelPaneHeight,\r\n            };\r\n            topPanelPane = this.renderPanelPane(selectedTopPanel, topPanelPaneStyle, this.onTopPanelClose);\r\n        }\r\n\r\n        let bottomPanelPane;\r\n        if (selectedBottomPanel) {\r\n            if (selectedTopPanel && selectedBottomPanel) {\r\n                panelPaneHeight = `calc(100% - ${this.state.layout.verPos + 4}px)`;\r\n            }\r\n            const bottomPanelPaneStyle = {\r\n                width: panelPaneWidth,\r\n                //maxWidth: panelPaneWidth,\r\n                height: panelPaneHeight,\r\n                //maxHeight: panelPaneHeight,\r\n            };\r\n            bottomPanelPane = this.renderPanelPane(selectedBottomPanel, bottomPanelPaneStyle, this.onBottomPanelClose);\r\n        }\r\n\r\n        let panelPane;\r\n        if (topPanelPane && bottomPanelPane) {\r\n            panelPane = this.renderTwoPanelsPane(topPanelPane, bottomPanelPane);\r\n        } else if (topPanelPane) {\r\n            panelPane = topPanelPane;\r\n        } else if (bottomPanelPane) {\r\n            panelPane = bottomPanelPane;\r\n        }\r\n\r\n        let resizablePanelPane;\r\n        if (panelPane) {\r\n            resizablePanelPane = this.renderResizablePanelPane(panelPane);\r\n        }\r\n\r\n        // Important: panelContainerStyle must have flex=\"none\"\r\n        const panelContainerStyle = {\r\n            display: 'flex',\r\n            flexFlow: 'row nowrap',\r\n            flex: 'none',\r\n            maxHeight: '100%',\r\n            //opacity: .5,\r\n        };\r\n\r\n        const position = this.props.position || 'left';\r\n        if (position === 'left') {\r\n            return (\r\n                <div style={panelContainerStyle}>\r\n                    {panelBar}\r\n                    {resizablePanelPane}\r\n                </div>\r\n            );\r\n        } else {\r\n            return (\r\n                <div style={panelContainerStyle}>\r\n                    {resizablePanelPane}\r\n                    {panelBar}\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    private renderPanelPane(panel: JSX.Element, style: any, onClose: (panelId: string) => void) {\r\n        return (<PanelPane panel={panel}\r\n                           onClose={onClose}\r\n                           position={this.props.position}\r\n                           style={style}/>);\r\n    }\r\n\r\n    private renderTwoPanelsPane(topPanelPane, bottomPanelPane) {\r\n        const verSplitter = <Splitter dir=\"ver\" onChange={this.onVerSplitterPosChange}/>;\r\n        return (\r\n            <div style={{display: 'flex', flexDirection: 'column'}}>\r\n                {topPanelPane}\r\n                {verSplitter}\r\n                {bottomPanelPane}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    private renderResizablePanelPane(panelPane) {\r\n        const undockedMode = this.props.undockedMode || false;\r\n        const position = this.props.position || 'left';\r\n\r\n        let undockedModeStyle;\r\n        if (undockedMode) {\r\n            if (position === 'left') {\r\n                undockedModeStyle = {\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: PanelContainer.PANEL_BAR_SIZE,\r\n                    backgroundColor: PANEL_UNDOCKED_BACKGROUND_COLOR,\r\n                    zIndex: 5,\r\n                };\r\n            } else {\r\n                undockedModeStyle = {\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    right: PanelContainer.PANEL_BAR_SIZE,\r\n                    backgroundColor: PANEL_UNDOCKED_BACKGROUND_COLOR,\r\n                    zIndex: 5,\r\n                };\r\n            }\r\n        }\r\n\r\n        const resizablePanelPaneStyle = {\r\n            paddingTop: PanelContainer.PANEL_PANE_PADDING,\r\n            paddingLeft: position === 'left' ? PanelContainer.PANEL_PANE_PADDING : 0,\r\n            paddingRight: position === 'left' ? 0 : PanelContainer.PANEL_PANE_PADDING,\r\n            flex: 'auto',\r\n            display: 'flex',\r\n            flexFlow: 'row nowrap',\r\n            maxHeight: '100%',\r\n            ...undockedModeStyle\r\n        };\r\n\r\n        const horSplitter = <Splitter dir=\"hor\" onChange={this.onHorSplitterPosChange}/>;\r\n\r\n        if (position === 'left') {\r\n            return (\r\n                <div style={resizablePanelPaneStyle}>\r\n                    {panelPane}\r\n                    {horSplitter}\r\n                </div>\r\n            );\r\n        } else {\r\n            return (\r\n                <div style={resizablePanelPaneStyle}>\r\n                    {horSplitter}\r\n                    {panelPane}\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n\r\ninterface IPanelHeaderProps {\r\n    id: string;\r\n    icon: IconName;\r\n    title: string;\r\n    onClose: () => void;\r\n}\r\n\r\nfunction PanelHeader(props: IPanelHeaderProps): JSX.Element | null {\r\n    const panelIcon = <Icon icon={props.icon} className={'cate-panel-header-item'}/>;\r\n    const panelTitle = <span className={'cate-panel-text cate-panel-header-item'}>{props.title.toUpperCase()}</span>;\r\n\r\n    const panelCloseIcon = (\r\n        <Icon icon={'cross'} className={'cate-icon-small cate-panel-header-item'} onClick={props.onClose}/>\r\n    );\r\n\r\n    return (\r\n        <div className=\"cate-panel-header\" style={{flex: 'none'}}>\r\n            {panelIcon}\r\n            {panelTitle}\r\n            {/*{panelMenuIcon}*/}\r\n            {panelCloseIcon}\r\n        </div>\r\n    );\r\n}\r\n\r\nconst PANEL_BAR_ITEM_BASE_STYLE = {padding: PanelContainer.PANEL_ICON_PADDING};\r\nconst PANEL_BAR_ITEM_NORMAL_STYLE = {...PANEL_BAR_ITEM_BASE_STYLE, color: Colors.GRAY4};\r\nconst PANEL_BAR_ITEM_SELECTED_STYLE = {\r\n    ...PANEL_BAR_ITEM_BASE_STYLE,\r\n    color: Colors.WHITE,\r\n    backgroundColor: Colors.DARK_GRAY5\r\n};\r\n\r\n// This is Colors.DARK_GRAY5 with 0.5 opacity\r\nconst PANEL_UNDOCKED_BACKGROUND_COLOR = 'rgba(57, 75, 89, 0.5)';\r\n\r\nconst TOP_PANEL_BAR_STYLE = {flex: 'none', listStyleType: 'none', padding: 0, margin: 0, border: 'none'};\r\nconst BOTTOM_PANEL_BAR_STYLE = {flex: 'none', listStyleType: 'none', padding: 0, margin: 0, border: 'none'};\r\nconst SPACER_STYLE = {flex: 'auto'};\r\nconst CONTAINER_STYLE: CSSProperties = {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    flex: 'none',\r\n    maxHeight: '100%',\r\n    minWidth: PanelContainer.PANEL_BAR_SIZE,\r\n    overflow: 'hidden',\r\n    backgroundColor: Colors.DARK_GRAY2,\r\n    paddingTop: PanelContainer.PANEL_BAR_PADDING,\r\n    paddingBottom: PanelContainer.PANEL_BAR_PADDING,\r\n};\r\nconst PANEL_BUTTON_STYLE: CSSProperties = {textAlign: 'center', verticalAlign: 'middle'};\r\n\r\nconst PANEL_BODY_CONTAINER_STYLE: CSSProperties = {\r\n    flex: 1,\r\n    padding: PanelContainer.PANEL_BODY_PADDING,\r\n    overflow: 'auto',\r\n};\r\n\r\n\r\ninterface IPanelBarProps {\r\n    panels: JSX.Element[];\r\n    selectedTopPanelId: string | null;\r\n    selectedBottomPanelId: string | null;\r\n    onTopPanelSelected: (panelId: string) => void;\r\n    onBottomPanelSelected: (panelId: string) => void;\r\n    position: 'left' | 'right';\r\n}\r\n\r\nfunction PanelBar(props: IPanelBarProps) {\r\n    const position = props.position || 'left';\r\n    const tooltipPos = position === 'left' ? PopoverPosition.RIGHT : PopoverPosition.LEFT;\r\n    const panels = props.panels || [];\r\n\r\n    function renderPanelButton(panel, selectedPanelId: string) {\r\n        const panelId: string = panel.props.id;\r\n        const panelTitle: string = panel.props.title;\r\n        const panelIcon: IconName = panel.props.icon as IconName;\r\n        const selected = panelId === selectedPanelId;\r\n        const style = selected ? PANEL_BAR_ITEM_SELECTED_STYLE : PANEL_BAR_ITEM_NORMAL_STYLE;\r\n        const panelPosition: string = panel.props.position || 'top';\r\n        const onClick = () => panelPosition === 'top' ? props.onTopPanelSelected(panelId) : props.onBottomPanelSelected(panelId);\r\n        return (\r\n            <li key={panelId}\r\n                onClick={onClick}\r\n                style={style}>\r\n                <Tooltip content={panelTitle} position={tooltipPos} hoverOpenDelay={1500}>\r\n                    <span style={PANEL_BUTTON_STYLE}><Icon icon={panelIcon} iconSize={PanelContainer.PANEL_ICON_SIZE}/></span>\r\n                </Tooltip>\r\n            </li>\r\n        );\r\n    }\r\n\r\n    //noinspection JSMismatchedCollectionQueryUpdate\r\n    const topPanelButtons: JSX.Element[] = [];\r\n    //noinspection JSMismatchedCollectionQueryUpdate\r\n    const bottomPanelButtons: JSX.Element[] = [];\r\n    for (let panel of panels) {\r\n        if (!panel.props || !panel.props.id) {\r\n            console.error('PanelBar children must be of type Panel');\r\n            continue;\r\n        }\r\n        const panelPosition: string = panel.props.position || 'top';\r\n        if (panelPosition === 'top') {\r\n            topPanelButtons.push(renderPanelButton(panel, props.selectedTopPanelId));\r\n        } else {\r\n            bottomPanelButtons.push(renderPanelButton(panel, props.selectedBottomPanelId));\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div style={CONTAINER_STYLE}>\r\n            <ul style={TOP_PANEL_BAR_STYLE}>\r\n                {topPanelButtons}\r\n            </ul>\r\n            <div style={SPACER_STYLE}/>\r\n            <ul style={BOTTOM_PANEL_BAR_STYLE}>\r\n                {bottomPanelButtons}\r\n            </ul>\r\n        </div>\r\n    );\r\n}\r\n\r\ninterface IPanelPaneProps {\r\n    position: 'left' | 'right';\r\n    style?: { [key: string]: any };\r\n    panel: JSX.Element | null;\r\n    onClose: (panelId: string) => void;\r\n}\r\n\r\nfunction PanelPane(props: IPanelPaneProps) {\r\n    const panel = props.panel;\r\n    if (!panel || !panel.props || !panel.props.body) {\r\n        return null;\r\n    }\r\n\r\n    const panelId = panel.props.id;\r\n    const panelBody = panel.props.body;\r\n\r\n    let panelParentStyle: CSSProperties = {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'stretch',\r\n        ...props.style,\r\n    };\r\n\r\n    return (\r\n        <div style={panelParentStyle}>\r\n            <PanelHeader\r\n                id={panelId}\r\n                title={panel.props.title}\r\n                icon={panel.props.icon}\r\n                onClose={() => props.onClose(panelId)}\r\n            />\r\n            <div style={PANEL_BODY_CONTAINER_STYLE}>\r\n                {panelBody}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import { IconName } from '@blueprintjs/icons';\r\nimport * as React from 'react'\r\n\r\nexport interface IPanelProps {\r\n    id: string;\r\n    title: string;\r\n    icon: IconName;\r\n    body?: JSX.Element | null;\r\n    position?: 'top' | 'bottom';\r\n}\r\n\r\n/**\r\n * A Panel is a child element of a PanelContainer.\r\n *\r\n * @author Norman Fomferra\r\n */\r\nexport class Panel extends React.PureComponent<IPanelProps> {\r\n\r\n    //noinspection JSMethodCanBeStatic\r\n    shouldComponentUpdate() {\r\n        return false;\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { Colors, Icon, IconName, Menu, MenuItem, NonIdealState, Popover, PopoverPosition, } from '@blueprintjs/core';\r\nimport { SplitDir, Splitter } from './Splitter';\r\nimport {\r\n    findMoveTargetViewIds,\r\n    isViewSplitState,\r\n    ViewLayoutState,\r\n    ViewPanelState,\r\n    ViewPath,\r\n    ViewRenderer,\r\n    ViewSplitState,\r\n    ViewState\r\n} from './ViewState';\r\n\r\n/**\r\n * Mapping from view type name to ViewRenderer\r\n */\r\nexport type ViewRenderMap = { [viewType: string]: ViewRenderer<any> };\r\n/**\r\n * Mapping from view id to ViewState\r\n */\r\nexport type ViewMap = { [viewId: string]: ViewState<any> };\r\n\r\ninterface IViewManagerProps {\r\n    viewRenderMap: ViewRenderMap;\r\n    viewLayout: ViewLayoutState;\r\n    views: ViewState<any>[];\r\n    activeView: ViewState<any> | null;\r\n    noViewsDescription?: string | null;\r\n    noViewsAction?: JSX.Element | null;\r\n    noViewsVisual?: IconName | JSX.Element;\r\n    onSelectView: (viewPath: ViewPath, viewId: string) => void;\r\n    onCloseView: (viewPath: ViewPath, viewId: string) => void;\r\n    onCloseAllViews: (viewPath: ViewPath) => void;\r\n    onMoveView: (sourceViewId: string, placement: 'before' | 'after', targetViewId: string) => void;\r\n    onSplitViewPanel: (viewPath: ViewPath, dir: SplitDir, pos: number) => void;\r\n    onChangeViewSplitPos: (viewPath: ViewPath, delta: number) => void;\r\n}\r\n\r\ninterface IViewManagerState {\r\n}\r\n\r\nexport class ViewManager extends React.PureComponent<IViewManagerProps, IViewManagerState> {\r\n    static readonly NO_VIEW_CONTAINER_STYLE = {\r\n        width: '100%',\r\n        height: '100%',\r\n        flex: 'auto'\r\n    };\r\n    static readonly HOR_SPLIT_CONTAINER_STYLE = {\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        flexFlow: 'row nowrap',\r\n        flex: 'auto',\r\n        boxSizing: 'border-box',\r\n    };\r\n    static readonly VER_SPLIT_CONTAINER_STYLE = {\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        flexFlow: 'column nowrap',\r\n        flex: 'auto',\r\n        boxSizing: 'border-box',\r\n    };\r\n\r\n    private viewMap: ViewMap;\r\n\r\n    constructor(props: IViewManagerProps) {\r\n        super(props);\r\n        this.viewMap = ViewManager.createViewMap(this.props.views);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IViewManagerProps): void {\r\n        this.viewMap = ViewManager.createViewMap(nextProps.views);\r\n    }\r\n\r\n    static createViewMap(views: ViewState<any>[]) {\r\n        const map = {};\r\n        views.forEach(view => {\r\n            map[view.id] = view;\r\n        });\r\n        return map;\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.views.length) {\r\n            return this.renderNoViews();\r\n        }\r\n        if (isViewSplitState(this.props.viewLayout)) {\r\n            return this.renderViewSplit(this.props.viewLayout as ViewSplitState, '');\r\n        } else {\r\n            return this.renderViewPanel(this.props.viewLayout as ViewPanelState, '');\r\n        }\r\n    }\r\n\r\n    renderNoViews() {\r\n        return (\r\n            <div style={ViewManager.NO_VIEW_CONTAINER_STYLE}>\r\n                <NonIdealState\r\n                    title=\"No views\"\r\n                    description={this.props.noViewsDescription}\r\n                    action={this.props.noViewsAction}\r\n                    icon={this.props.noViewsVisual}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderViewSplit(viewSplit: ViewSplitState, viewPath: ViewPath) {\r\n\r\n        let renderedLayout1;\r\n        let layout1 = viewSplit.layouts[0];\r\n        if (isViewSplitState(layout1)) {\r\n            renderedLayout1 = this.renderViewSplit(layout1 as ViewSplitState, viewPath + '0');\r\n        } else {\r\n            renderedLayout1 = this.renderViewPanel(layout1 as ViewPanelState, viewPath + '0');\r\n        }\r\n\r\n        let renderedLayout2;\r\n        let layout2 = viewSplit.layouts[1];\r\n        if (isViewSplitState(layout2)) {\r\n            renderedLayout2 = this.renderViewSplit(layout2 as ViewSplitState, viewPath + '1');\r\n        } else {\r\n            renderedLayout2 = this.renderViewPanel(layout2 as ViewPanelState, viewPath + '1');\r\n        }\r\n\r\n        if (renderedLayout1 && renderedLayout2) {\r\n            let containerStyle;\r\n            let childContainer1Style;\r\n            let childContainer2Style;\r\n            const splitterSize = 4; // px\r\n            if (viewSplit.dir === 'hor') {\r\n                containerStyle = ViewManager.HOR_SPLIT_CONTAINER_STYLE;\r\n                let width1 = viewSplit.pos;\r\n                let width2 = `calc(100% - ${width1 + splitterSize}px)`;\r\n                childContainer1Style = {flex: 'none', width: width1, height: '100%'};\r\n                childContainer2Style = {flex: 'auto', width: width2, height: '100%'};\r\n            } else {\r\n                containerStyle = ViewManager.VER_SPLIT_CONTAINER_STYLE;\r\n                let height1 = viewSplit.pos;\r\n                let height2 = `calc(100% - ${height1 + splitterSize}px)`;\r\n                childContainer1Style = {flex: 'none', width: '100%', height: height1};\r\n                childContainer2Style = {flex: 'auto', width: '100%', height: height2};\r\n            }\r\n\r\n            return (\r\n                <div style={containerStyle}>\r\n                    <div style={childContainer1Style}>\r\n                        {renderedLayout1}\r\n                    </div>\r\n                    <Splitter dir={viewSplit.dir}\r\n                              onChange={(delta: number) => this.props.onChangeViewSplitPos(viewPath, delta)}/>\r\n                    <div style={childContainer2Style}>\r\n                        {renderedLayout2}\r\n                    </div>\r\n                </div>\r\n            );\r\n        } else if (renderedLayout1) {\r\n            return renderedLayout1;\r\n        } else if (renderedLayout2) {\r\n            return renderedLayout2;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    renderViewPanel(viewPanel: ViewPanelState, viewPath: ViewPath) {\r\n        return (\r\n            <ViewPanel\r\n                viewLayout={this.props.viewLayout}\r\n                viewRenderMap={this.props.viewRenderMap}\r\n                viewMap={this.viewMap}\r\n                activeView={this.props.activeView}\r\n                viewPath={viewPath}\r\n                viewIds={viewPanel.viewIds}\r\n                selectedViewId={viewPanel.selectedViewId}\r\n                onSelectView={this.props.onSelectView}\r\n                onCloseView={this.props.onCloseView}\r\n                onCloseAllViews={this.props.onCloseAllViews}\r\n                onMoveView={this.props.onMoveView}\r\n                onSplitViewPanel={this.props.onSplitViewPanel}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// ViewPanel\r\n\r\ninterface IViewPanelProps {\r\n    viewLayout: ViewLayoutState;\r\n    viewRenderMap: ViewRenderMap;\r\n    viewMap: ViewMap;\r\n    activeView: ViewState<any> | null;\r\n    viewPath: ViewPath;\r\n    viewIds: string[];\r\n    selectedViewId: string | null;\r\n    onSelectView: (viewPath: ViewPath, viewId: string) => void;\r\n    onCloseView: (viewPath: ViewPath, viewId: string) => void;\r\n    onCloseAllViews: (viewPath: ViewPath) => void;\r\n    onMoveView: (sourceViewId: string, placement: 'before' | 'after', targetViewId: string) => void;\r\n    onSplitViewPanel: (viewPath: ViewPath, dir: SplitDir, pos: number) => void;\r\n}\r\n\r\nclass ViewPanel extends React.PureComponent<IViewPanelProps, null> {\r\n\r\n    static readonly SELECTED_BG_COLOR = Colors.DARK_GRAY1;\r\n    static readonly TAB_STYLE_SELECTED: CSSProperties = {\r\n        padding: 2,\r\n        flex: 'none',\r\n        color: Colors.WHITE,\r\n        backgroundColor: ViewPanel.SELECTED_BG_COLOR\r\n    };\r\n    static readonly TAB_STYLE_NORMAL: CSSProperties = {padding: 2, color: Colors.LIGHT_GRAY1};\r\n\r\n    static readonly TITLE_STYLE_BASE: CSSProperties = {paddingLeft: 4, paddingRight: 4};\r\n    static readonly TITLE_STYLE_ACTIVE: CSSProperties = {...ViewPanel.TITLE_STYLE_BASE, color: Colors.BLUE5};\r\n    static readonly TITLE_STYLE_SELECTED: CSSProperties = ViewPanel.TITLE_STYLE_BASE;\r\n    static readonly TITLE_STYLE_NORMAL: CSSProperties = ViewPanel.TITLE_STYLE_BASE;\r\n\r\n    static readonly CLOSE_ICON_STYLE_SELECTED: CSSProperties = {marginLeft: 6, fontSize: 12};\r\n    static readonly CLOSE_ICON_STYLE_NORMAL: CSSProperties = {marginLeft: 6, fontSize: 12};\r\n\r\n    static readonly MENU_ICON_STYLE: CSSProperties = {color: Colors.GRAY5, marginLeft: 5, fontSize: 12};\r\n\r\n    static readonly TABS_STYLE: CSSProperties = {flex: 'none', display: 'flex', flexDirection: 'row'};\r\n    static readonly SPACER_STYLE: CSSProperties = {flex: 'auto'};\r\n    static readonly MENU_STYLE: CSSProperties = {flex: 'none', height: '100%'};\r\n\r\n    static readonly VIEW_HEADER_STYLE: CSSProperties = {\r\n        display: 'flex',\r\n        flexDirection: 'row',\r\n        flex: 'none',\r\n        width: '100%',\r\n        marginTop: 2,\r\n        borderBottomStyle: 'solid',\r\n        borderBottomWidth: 2,\r\n        borderBottomColor: ViewPanel.SELECTED_BG_COLOR,\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden',\r\n    };\r\n\r\n    static readonly VIEW_BODY_STYLE: CSSProperties = {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        flex: 'auto',\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden',\r\n    };\r\n\r\n    static readonly CONTAINER_STYLE: CSSProperties = {\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        width: '100%',\r\n        height: '100%',\r\n        overflow: 'hidden',\r\n    };\r\n\r\n\r\n    private contentElement: HTMLDivElement;\r\n\r\n    constructor(props: IViewPanelProps) {\r\n        super(props);\r\n        this.onSplitHor = this.onSplitHor.bind(this);\r\n        this.onSplitVer = this.onSplitVer.bind(this);\r\n        this.onContentDivRef = this.onContentDivRef.bind(this);\r\n    }\r\n\r\n    onSplitHor() {\r\n        this.props.onSplitViewPanel(this.props.viewPath, 'hor', 0.5 * this.contentElement.clientWidth);\r\n    }\r\n\r\n    onSplitVer() {\r\n        this.props.onSplitViewPanel(this.props.viewPath, 'ver', 0.5 * this.contentElement.clientHeight);\r\n    }\r\n\r\n    onContentDivRef(contentElement: HTMLDivElement) {\r\n        this.contentElement = contentElement;\r\n    }\r\n\r\n    render() {\r\n        const viewIds = this.props.viewIds;\r\n        if (!viewIds || !viewIds.length) {\r\n            return null;\r\n        }\r\n\r\n        const selectedViewId = this.props.selectedViewId;\r\n        const views = [];\r\n        let selectedView = null;\r\n        viewIds.forEach(id => {\r\n            const view = this.props.viewMap[id];\r\n            if (view) {\r\n                if (selectedViewId && id === selectedViewId) {\r\n                    selectedView = view;\r\n                }\r\n                views.push(view);\r\n            }\r\n        });\r\n\r\n        let renderedViewContent;\r\n        const tabItems = [];\r\n        for (let i = 0; i < views.length; i++) {\r\n            let view = views[i];\r\n            let viewId = view.id;\r\n            let viewTitle = view.title;\r\n            let viewIconName = view.icon;\r\n            let tabStyle;\r\n            let titleStyle;\r\n            let closeIconStyle;\r\n            if (selectedView && selectedView.id === viewId) {\r\n                let viewRenderer = this.props.viewRenderMap[view.type];\r\n                renderedViewContent = viewRenderer(view);\r\n                tabStyle = ViewPanel.TAB_STYLE_SELECTED;\r\n                titleStyle = (selectedView === this.props.activeView) ? ViewPanel.TITLE_STYLE_ACTIVE : ViewPanel.TITLE_STYLE_SELECTED;\r\n                closeIconStyle = ViewPanel.CLOSE_ICON_STYLE_SELECTED;\r\n            } else {\r\n                tabStyle = ViewPanel.TAB_STYLE_NORMAL;\r\n                titleStyle = ViewPanel.TITLE_STYLE_NORMAL;\r\n                closeIconStyle = ViewPanel.CLOSE_ICON_STYLE_NORMAL;\r\n            }\r\n\r\n            const onClose = () => {\r\n                this.props.onCloseView(this.props.viewPath, viewId);\r\n            };\r\n            const onSelect = () => {\r\n                this.props.onSelectView(this.props.viewPath, viewId);\r\n            };\r\n\r\n            let iconSpan;\r\n            if (viewIconName && viewIconName !== '') {\r\n                iconSpan = <Icon icon={viewIconName} style={titleStyle} onClick={onSelect}/>;\r\n            }\r\n            tabItems.push(\r\n                <div key={viewId} style={tabStyle}>\r\n                    {iconSpan}\r\n                    <span style={titleStyle} onClick={onSelect}>{viewTitle}</span>\r\n                    <Icon style={closeIconStyle} icon=\"cross\" onClick={onClose}/>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const tabs = (<div style={ViewPanel.TABS_STYLE}>{tabItems}</div>);\r\n        const spacer = (<div key=\"spacer\" style={ViewPanel.SPACER_STYLE}/>);\r\n\r\n        const menuIconStyle = ViewPanel.MENU_ICON_STYLE;\r\n\r\n        let splitHorEntry;\r\n        let splitVerEntry;\r\n\r\n        if (views.length > 1) {\r\n            splitHorEntry = (\r\n                <Icon key=\"splitHor\" style={menuIconStyle} icon=\"add-column-right\"\r\n                      onClick={this.onSplitHor}/>\r\n            );\r\n            splitVerEntry = (\r\n                <Icon key=\"splitVer\" style={menuIconStyle} icon=\"add-row-bottom\"\r\n                      onClick={this.onSplitVer}/>\r\n            );\r\n        }\r\n\r\n        let moreMenuEntry;\r\n        if (selectedView) {\r\n            const result = findMoveTargetViewIds(this.props.viewLayout, selectedViewId);\r\n            const viewMap = this.props.viewMap;\r\n            const moveBeforeMenuItems = result.before.map(viewId => {\r\n                const view = viewMap[viewId];\r\n                const onClick = () => this.props.onMoveView(selectedViewId, 'before', view.id);\r\n                return (<MenuItem key={viewId} onClick={onClick} text={view.title}/>);\r\n            });\r\n            const moveAfterMenuItems = result.after.map(viewId => {\r\n                const view = viewMap[viewId];\r\n                const onClick = () => this.props.onMoveView(selectedViewId, 'after', view.id);\r\n                return (<MenuItem key={viewId} onClick={onClick} text={view.title}/>);\r\n            });\r\n\r\n            let moveBeforeMenuItem;\r\n            if (moveBeforeMenuItems.length) {\r\n                moveBeforeMenuItem = (\r\n                    <MenuItem key=\"before\" text=\"Move Before\">{moveBeforeMenuItems}</MenuItem>\r\n                );\r\n            }\r\n            let moveAfterMenuItem;\r\n            if (moveAfterMenuItems.length) {\r\n                moveAfterMenuItem = (\r\n                    <MenuItem key=\"after\" text=\"Move After\">{moveAfterMenuItems}</MenuItem>\r\n                );\r\n            }\r\n            if (moveBeforeMenuItem || moveAfterMenuItem) {\r\n                const moreMenu = (<Menu>{moveBeforeMenuItem}{moveAfterMenuItem}</Menu>);\r\n                moreMenuEntry = (\r\n                    <Popover content={moreMenu} position={PopoverPosition.BOTTOM}>\r\n                        <Icon key=\"more\" style={menuIconStyle} icon=\"more\"/>\r\n                    </Popover>\r\n                );\r\n            }\r\n        }\r\n\r\n        const menu = (\r\n            <div style={ViewPanel.MENU_STYLE}>\r\n                {splitHorEntry}\r\n                {splitVerEntry}\r\n                {moreMenuEntry}\r\n            </div>\r\n        );\r\n\r\n        return (\r\n            <div style={ViewPanel.CONTAINER_STYLE}>\r\n                <div style={ViewPanel.VIEW_HEADER_STYLE}>\r\n                    {tabs}\r\n                    {spacer}\r\n                    {menu}\r\n                </div>\r\n                <div style={ViewPanel.VIEW_BODY_STYLE}\r\n                     ref={this.onContentDivRef}>\r\n                    {renderedViewContent}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n","import * as React from 'react';\nimport { Button, Collapse } from '@blueprintjs/core';\n\nconst CONTAINER_STYLE: React.CSSProperties = {\n    marginTop: '0.75em',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-end'\n};\n\nconst DETAILS_STYLE: React.CSSProperties = {\n    overflow: 'auto',\n};\n\n\ninterface IMessageDetailsProps {\n    details: string;\n    onCopyDetails?: (details: string) => any;\n    width?: number | string;\n    height?: number | string;\n}\n\nconst MessageDetails: React.FC<IMessageDetailsProps> = ({\n                                                            details,\n                                                            onCopyDetails,\n                                                            width,\n                                                            height\n                                                        }) => {\n\n    const [showDetails, setShowDetails] = React.useState(false);\n    return (\n        <div style={CONTAINER_STYLE}>\n            <div>\n                {onCopyDetails && (\n                    <Button\n                        onClick={() => onCopyDetails(details)}\n                        icon={'clipboard'}\n                        small={true}\n                        style={{marginRight: 6}}\n                    />\n                )}\n                <Button\n                    onClick={() => setShowDetails(!showDetails)}\n                    rightIcon={showDetails ? 'chevron-up' : 'chevron-down'}\n                    small={true}\n                >\n                    {showDetails ? 'Hide Details' : 'Show Details'}\n                </Button>\n            </div>\n            <Collapse\n                isOpen={showDetails}\n            >\n                <pre className=\"user-selectable\"\n                     style={{\n                         ...DETAILS_STYLE,\n                         width: width || '32em',\n                         height: height || '20em'\n                     }}\n                >\n                    {details}\n                </pre>\n            </Collapse>\n        </div>\n    );\n};\n\nexport default MessageDetails;\n","import { Checkbox, Icon, IconName, Intent } from '@blueprintjs/core';\r\nimport * as React from 'react';\r\nimport { connect, DispatchProp } from 'react-redux';\r\nimport * as actions from '../actions';\r\nimport MessageDetails from '../components/MessageDetails';\r\n\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as selectors from '../selectors';\r\nimport { State } from '../state';\r\nimport { getJobFailureIconName, getJobFailureTitle, isDeveloperError, isUserError, JobFailure } from '../webapi';\r\n\r\n\r\ninterface IJobFailureDialogProps {\r\n    isOpen: boolean;\r\n    jobTitle: string;\r\n    jobFailure: JobFailure;\r\n}\r\n\r\ninterface IJobFailureDialogState {\r\n    copyReport: boolean;\r\n}\r\n\r\nfunction mapStateToProps(state: State): IJobFailureDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(JobFailureDialog.DIALOG_ID)(state) as any;\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n        jobTitle: dialogState.jobTitle,\r\n        jobFailure: dialogState.jobFailure,\r\n    };\r\n}\r\n\r\nconst ERROR_MESSAGE_STYLE: React.CSSProperties = {wordBreak: 'break-all'};\r\n\r\nclass JobFailureDialog extends React.Component<DispatchProp<State> & IJobFailureDialogProps, IJobFailureDialogState> {\r\n\r\n    static readonly DIALOG_ID = 'jobFailureDialog';\r\n    // BlueprintJS Dialog width is 500px by default\r\n    private static readonly DIALOG_STYLE: React.CSSProperties = {width: '600px'};\r\n\r\n    constructor(props: IJobFailureDialogProps) {\r\n        super(props);\r\n        this.renderBody = this.renderBody.bind(this);\r\n        this.handleConfirm = this.handleConfirm.bind(this);\r\n        this.handleCancel = this.handleCancel.bind(this);\r\n        this.handleCopyReport = this.handleCopyReport.bind(this);\r\n        this.state = {copyReport: false};\r\n    }\r\n\r\n    handleConfirm() {\r\n        if (this.state.copyReport) {\r\n            let title = this.props.jobTitle;\r\n            let failure = this.props.jobFailure;\r\n            let report = `Job: ${title}\\nMessage: ${failure.message}\\n`;\r\n            report += `Code: ${failure.code}\\n`;\r\n            if (failure.data) {\r\n                if (failure.data.method) {\r\n                    report += `Method: ${failure.data.method}\\n`;\r\n                }\r\n                if (failure.data.exception) {\r\n                    report += `Exception: ${failure.data.exception}\\n`;\r\n                }\r\n                if (failure.data.traceback) {\r\n                    report += `\\n${failure.data.traceback}\\n`;\r\n                }\r\n            }\r\n            actions.copyTextToClipboard(report);\r\n        }\r\n        this.props.dispatch(actions.hideDialog(JobFailureDialog.DIALOG_ID));\r\n    }\r\n\r\n    handleCancel() {\r\n        this.props.dispatch(actions.hideDialog(JobFailureDialog.DIALOG_ID));\r\n    }\r\n\r\n    handleCopyReport(event) {\r\n        this.setState({copyReport: event.target.checked});\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.isOpen || !this.props.jobFailure) {\r\n            return null;\r\n        }\r\n        const title = getJobFailureTitle(this.props.jobFailure);\r\n        return (\r\n            <ModalDialog isOpen={this.props.isOpen}\r\n                         icon={'error'}\r\n                         title={title}\r\n                         onConfirm={this.handleConfirm}\r\n                         onCancel={this.handleCancel}\r\n                         noCancelButton={true}\r\n                         renderBody={this.renderBody}\r\n                         style={JobFailureDialog.DIALOG_STYLE}/>\r\n        );\r\n    }\r\n\r\n    renderBody() {\r\n        if (!this.props.isOpen) {\r\n            return null;\r\n        }\r\n\r\n        let messageText = this.props.jobFailure.message;\r\n        if (!messageText) {\r\n            messageText = `An unknown error occurred (code ${this.props.jobFailure.code}).`;\r\n        }\r\n        let messageDiv = (\r\n            <div style={ERROR_MESSAGE_STYLE}>\r\n                <p>Oops, Cate couldn't carry out the request</p>\r\n                <em><p className=\"user-selectable\">{this.props.jobTitle}</p></em>\r\n                <div>Reason:</div>\r\n                <div className=\"user-selectable\">{messageText}</div>\r\n            </div>\r\n        );\r\n\r\n        let traceback;\r\n        if (!isUserError(this.props.jobFailure)\r\n            && this.props.jobFailure.data && this.props.jobFailure.data.traceback) {\r\n            traceback = <MessageDetails details={this.props.jobFailure.data.traceback} width={'36em'}/>;\r\n        }\r\n\r\n        let reporting;\r\n        if (isDeveloperError(this.props.jobFailure)) {\r\n            reporting = (\r\n                <div style={{marginTop: '1em'}}>\r\n                    <span className=\"bp3-text-muted\">Please consider reporting this issue in Cate's <a\r\n                        href=\"https://github.com/CCI-Tools/cate/issues\" target=\"_blank\" rel=\"noopener noreferrer\">issue tracker</a>.</span>\r\n                    <Checkbox label='Copy error report to clipboard'\r\n                              checked={this.state.copyReport}\r\n                              onChange={this.handleCopyReport}/>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        const icon = getJobFailureIconName(this.props.jobFailure) as IconName;\r\n        let iconIntent;\r\n        if (isUserError(this.props.jobFailure)) {\r\n            iconIntent = Intent.PRIMARY;\r\n        } else {\r\n            iconIntent = Intent.WARNING;\r\n        }\r\n\r\n        return (\r\n            <div style={{display: 'flex'}}>\r\n                <div style={{fontSize: '4em', flex: '0 1 1em'}}>\r\n                    <Icon icon={icon} intent={iconIntent} iconSize={48}/>\r\n                </div>\r\n                <div style={{flex: '1 1 90%', marginLeft: '1em'}}>\r\n                    {messageDiv}\r\n                    {traceback}\r\n                    {reporting}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(JobFailureDialog);\r\n","import * as React from 'react';\r\nimport { AnchorButton, ControlGroup, Intent } from \"@blueprintjs/core\";\r\nimport { connect, DispatchProp } from 'react-redux';\r\n\r\nimport { DialogState, State } from '../state';\r\nimport { ModalDialog } from '../components/ModalDialog';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { showFileOpenDialog } from \"../actions\";\r\nimport { OpenDialogResult } from \"../components/desktop/types\";\r\n\r\n\r\nconst DIV_STYLE = {width: '100%', marginBottom: '2em', display: 'flex', flexGrow: 1};\r\nconst BUTTON_STYLE = {flex: 'none'};\r\n\r\n\r\ninterface IFileDownloadDialogProps {\r\n    dialogId: string;\r\n    isOpen: boolean;\r\n}\r\n\r\ninterface IFileDownloadDialogState extends DialogState {\r\n    filePaths?: string[];\r\n}\r\n\r\nfunction mapStateToProps(state: State): IFileDownloadDialogProps {\r\n    const dialogState = selectors.dialogStateSelector(FileDownloadDialog.DIALOG_ID)(state);\r\n    return {\r\n        isOpen: dialogState.isOpen,\r\n        dialogId: 'fileDownloadDialog'\r\n    };\r\n}\r\n\r\nclass FileDownloadDialog extends React.Component<IFileDownloadDialogProps & DispatchProp<State>, IFileDownloadDialogState> {\r\n    static readonly DIALOG_ID = 'fileDownloadDialog';\r\n\r\n    constructor(props: IFileDownloadDialogProps & DispatchProp<State>) {\r\n        super(props);\r\n        this.state = {filePaths: []};\r\n        this.onCancel = this.onCancel.bind(this);\r\n        this.onConfirm = this.onConfirm.bind(this);\r\n        this.canConfirm = this.canConfirm.bind(this);\r\n        this.renderBody = this.renderBody.bind(this);\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: IFileDownloadDialogProps) {\r\n        this.setState({filePaths: []});\r\n    }\r\n\r\n    private onCancel() {\r\n        this.props.dispatch(actions.hideDialog(FileDownloadDialog.DIALOG_ID));\r\n    }\r\n\r\n    private canConfirm(): boolean {\r\n        return this.state.filePaths.length > 0;\r\n    }\r\n\r\n    private onConfirm() {\r\n        this.props.dispatch(actions.hideDialog(FileDownloadDialog.DIALOG_ID, this.state));\r\n        this.props.dispatch(actions.downloadFiles(this.state.filePaths) as any);\r\n    }\r\n\r\n    render() {\r\n        let isOpen = this.props.isOpen;\r\n        if (!isOpen) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <ModalDialog\r\n                isOpen={isOpen}\r\n                title=\"Download Files\"\r\n                icon=\"download\"\r\n                confirmTitle=\"Download\"\r\n                confirmIconName=\"download\"\r\n                confirmTooltip=\"Download files.\"\r\n                onCancel={this.onCancel}\r\n                canConfirm={this.canConfirm}\r\n                onConfirm={this.onConfirm}\r\n                renderBody={this.renderBody}\r\n            />);\r\n    }\r\n\r\n    handleOpenFilesOnClose = (result: OpenDialogResult) => {\r\n        if (!result.canceled) {\r\n            this.setState({...this.state, filePaths: result.filePaths});\r\n        }\r\n    };\r\n\r\n    handleOpenFilesOpen = () => {\r\n        this.props.dispatch(\r\n            showFileOpenDialog({\r\n                                   title: 'Select Files',\r\n                                   properties: ['openFile', 'multiSelections']\r\n                               },\r\n\r\n                               this.handleOpenFilesOnClose) as any);\r\n    };\r\n\r\n    private renderBody() {\r\n        if (!this.state.filePaths) {\r\n            return null;\r\n        }\r\n        const files = this.state.filePaths.map(path => (\r\n            <li key={path}>\r\n                {path}\r\n            </li>\r\n        ));\r\n\r\n        return (\r\n            <div>\r\n                File download:\r\n                <ControlGroup style={DIV_STYLE} fill={true}>\r\n                    <AnchorButton intent={Intent.PRIMARY} style={BUTTON_STYLE}\r\n                                  onClick={this.handleOpenFilesOpen}>Select Remote Files...</AnchorButton>\r\n\r\n                </ControlGroup>\r\n                <aside>\r\n                    {files.length > 0 ? (<h4>Files</h4>) : ''}\r\n                    <ul>{files}</ul>\r\n                </aside>\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(FileDownloadDialog);\r\n","import * as React from 'react';\r\nimport { CSSProperties } from 'react';\r\nimport { connect, Dispatch } from 'react-redux';\r\nimport { useMatomo } from '@datapunt/matomo-tracker-react'\r\n\r\nimport GdprBanner from './GdprBanner';\r\nimport { isElectron } from '../electron';\r\nimport { FileSystemAPI } from '../webapi/apis';\r\nimport AppBar from './AppBar';\r\nimport ChooseWorkspaceDialog, { DELETE_WORKSPACE_DIALOG_ID, OPEN_WORKSPACE_DIALOG_ID } from './ChooseWorkspaceDialog';\r\nimport GlobeView from './GlobeView'\r\nimport FigureView from './FigureView';\r\nimport ServiceAutoCloseDialog from './ServiceAutoCloseDialog';\r\nimport TableView from './TableView';\r\nimport DataSourcesPanel from './DataSourcesPanel';\r\nimport OperationsPanel from './OperationsPanel';\r\nimport WebAPIStatusBox from './WebAPIStatusBox';\r\nimport WorkspacePanel from './WorkspacePanel';\r\nimport VariablePanel from './VariablesPanel';\r\nimport PlacemarksPanel from './PlacemarksPanel';\r\nimport ViewPanel from './ViewPanel';\r\nimport TaskPanel from './TasksPanel';\r\nimport StatusBar from './StatusBar';\r\nimport LayersPanel from './LayersPanel';\r\nimport StylesPanel from './StylesPanel';\r\nimport NewWorkspaceDialog from './NewWorkspaceDialog';\r\nimport SaveWorkspaceAsDialog from './SaveWorkspaceAsDialog';\r\nimport PreferencesDialog from './PreferencesDialog';\r\nimport DirectorySelectDialog from './DirectorySelectDialog';\r\nimport FileOpenDialog from './FileOpenDialog';\r\nimport FileSaveDialog from \"./FileSaveDialog\";\r\nimport FileBrowseDialog from \"./FileBrowseDialog\";\r\nimport MessageBox from './MessageBox';\r\nimport { PanelContainer, PanelContainerLayout } from '../components/PanelContainer';\r\nimport { Panel } from '../components/Panel';\r\nimport {\r\n    AnimationViewDataState,\r\n    FigureViewDataState,\r\n    State,\r\n    TableViewDataState,\r\n    WorldViewDataState\r\n} from '../state';\r\nimport * as actions from '../actions';\r\nimport * as selectors from '../selectors';\r\nimport { ViewManager, ViewRenderMap } from '../components/ViewManager';\r\nimport { SplitDir, ViewLayoutState, ViewPath, ViewState } from '../components/ViewState';\r\nimport OperationStepDialog from './OperationStepDialog';\r\nimport { NEW_CTX_OPERATION_STEP_DIALOG_ID } from './operation-step-dialog-ids';\r\nimport AnimationView from './AnimationView';\r\nimport JobFailureDialog from './JobFailureDialog';\r\nimport desktopActions from '../components/desktop/actions';\r\nimport FileUploadDialog from \"./FileUploadDialog\";\r\nimport FileDownloadDialog from \"./FileDownloadDialog\";\r\n\r\ntype AppServiceMode = 'local' | 'cloud';\r\n\r\nfunction renderWorldView(view: ViewState<WorldViewDataState>) {\r\n    // See #390, Drop 2D map view https://github.com/CCI-Tools/cate/issues/390.\r\n    // See tag \"1.1.0.dev1-with-ol\".\r\n    // return view.data.viewMode === \"3D\" ? (<GlobeView view={view}/>) : (<MapView view={view}/>);\r\n    return <GlobeView view={view}/>;\r\n}\r\n\r\nfunction renderFigureView(view: ViewState<FigureViewDataState>) {\r\n    return <FigureView view={view}/>;\r\n}\r\n\r\nfunction renderAnimationView(view: ViewState<AnimationViewDataState>) {\r\n    return <AnimationView view={view}/>;\r\n}\r\n\r\nfunction renderTableView(view: ViewState<TableViewDataState>) {\r\n    return <TableView view={view}/>;\r\n}\r\n\r\nconst VIEW_TYPE_RENDERERS: ViewRenderMap = {\r\n    world: renderWorldView,\r\n    figure: renderFigureView,\r\n    animation: renderAnimationView,\r\n    table: renderTableView,\r\n};\r\n\r\ninterface IDispatch {\r\n    dispatch: Dispatch<State>;\r\n}\r\n\r\ninterface IApplicationPageProps {\r\n    forceAppBar?: boolean;\r\n    fileSystemAPI: FileSystemAPI | null;\r\n    appServiceMode: AppServiceMode;\r\n    appServiceURL: string;\r\n    appServiceHostOS: string;\r\n    appServiceVersion: string;\r\n}\r\n\r\nfunction mapStateToPropsApplication(state: State): IApplicationPageProps {\r\n    return {\r\n        forceAppBar: state.session.forceAppBar,\r\n        fileSystemAPI: selectors.fileSystemAPISelector(state),\r\n        appServiceMode: window.location.pathname.indexOf(\"/proxy/\") > 0 ? 'cloud' : 'local',\r\n        appServiceURL: state.communication.webAPIServiceURL,\r\n        appServiceHostOS: state.communication.webAPIServiceInfo && state.communication.webAPIServiceInfo.hostOS,\r\n        appServiceVersion: state.communication.webAPIServiceInfo && state.communication.webAPIServiceInfo.version,\r\n    };\r\n}\r\n\r\nconst ROOT_DIV_STYLE: CSSProperties = {\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    width: '100%',\r\n    height: '100%',\r\n    overflow: 'hidden'\r\n};\r\n\r\nconst MAIN_DIV_STYLE: CSSProperties = {\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    flex: 'auto',\r\n    height: '100%',\r\n    overflow: 'hidden'\r\n};\r\n\r\nconst _AppMainPage: React.FC<IApplicationPageProps & IDispatch> = (\r\n    {\r\n        forceAppBar,\r\n        fileSystemAPI,\r\n        appServiceMode,\r\n        appServiceURL,\r\n        appServiceHostOS,\r\n        appServiceVersion,\r\n        dispatch\r\n    }) => {\r\n\r\n    const {trackPageView} = useMatomo();\r\n\r\n    // Track page view\r\n    React.useEffect(() => {\r\n        const customDimensions = [\r\n            {id: 1, value: appServiceMode},\r\n            {id: 2, value: appServiceURL},\r\n            {id: 3, value: appServiceHostOS},\r\n            {id: 4, value: appServiceVersion},\r\n        ];\r\n        console.log(\"Tracking:\", customDimensions);\r\n        trackPageView({customDimensions});\r\n    }, [trackPageView, appServiceMode, appServiceURL, appServiceHostOS, appServiceVersion]);\r\n\r\n    React.useEffect(() => {\r\n        dispatch(actions.installGlobalHandlers() as any);\r\n    }, [dispatch]);\r\n\r\n    let appBar;\r\n    if (!isElectron() || !!forceAppBar) {\r\n        appBar = <AppBar/>;\r\n    }\r\n\r\n    return (\r\n        <div className={'bp3-dark'} style={ROOT_DIV_STYLE}>\r\n            <GdprBanner/>\r\n            <WebAPIStatusBox/>\r\n            {appBar}\r\n            <div style={MAIN_DIV_STYLE}>\r\n                <LeftPanel/>\r\n                <CenterPanel/>\r\n                <RightPanel/>\r\n            </div>\r\n            <StatusBar/>\r\n            <PreferencesDialog/>\r\n            <NewWorkspaceDialog/>\r\n            <FileUploadDialog/>\r\n            <FileDownloadDialog/>\r\n            <SaveWorkspaceAsDialog/>\r\n            <ServiceAutoCloseDialog/>\r\n            <ChooseWorkspaceDialog dialogId={OPEN_WORKSPACE_DIALOG_ID}/>\r\n            <ChooseWorkspaceDialog dialogId={DELETE_WORKSPACE_DIALOG_ID}/>\r\n            <OperationStepDialog id={NEW_CTX_OPERATION_STEP_DIALOG_ID}/>\r\n            <JobFailureDialog/>\r\n            {!desktopActions.isNativeUI && fileSystemAPI !== null && (<DirectorySelectDialog/>)}\r\n            {!desktopActions.isNativeUI && fileSystemAPI !== null && (<FileOpenDialog/>)}\r\n            {!desktopActions.isNativeUI && fileSystemAPI !== null && (<FileSaveDialog/>)}\r\n            {!desktopActions.isNativeUI && fileSystemAPI !== null && (<FileBrowseDialog/>)}\r\n            {!desktopActions.isNativeUI && <MessageBox/>}\r\n        </div>\r\n    );\r\n}\r\n\r\nconst AppMainPage = connect(mapStateToPropsApplication)(_AppMainPage);\r\nexport default AppMainPage;\r\n\r\ninterface ILeftPanelProps {\r\n    panelContainerUndockedMode: boolean;\r\n    leftPanelContainerLayout: PanelContainerLayout;\r\n    selectedLeftTopPanelId?: string;\r\n    selectedLeftBottomPanelId?: string;\r\n}\r\n\r\nfunction mapStateToPropsLeft(state: State): ILeftPanelProps {\r\n    return {\r\n        panelContainerUndockedMode: selectors.panelContainerUndockedModeSelector(state),\r\n        leftPanelContainerLayout: selectors.leftPanelContainerLayoutSelector(state),\r\n        selectedLeftTopPanelId: selectors.selectedLeftTopPanelIdSelector(state),\r\n        selectedLeftBottomPanelId: selectors.selectedLeftBottomPanelIdSelector(state),\r\n    };\r\n}\r\n\r\nclass _LeftPanel extends React.PureComponent<ILeftPanelProps & IDispatch, null> {\r\n\r\n    constructor(props: ILeftPanelProps & IDispatch) {\r\n        // noinspection DuplicatedCode\r\n        super(props);\r\n        this.onLeftPanelContainerLayoutChange = this.onLeftPanelContainerLayoutChange.bind(this);\r\n        this.onRightPanelContainerLayoutChange = this.onRightPanelContainerLayoutChange.bind(this);\r\n        this.onSelectedLeftTopPanelChange = this.onSelectedLeftTopPanelChange.bind(this);\r\n        this.onSelectedLeftBottomPanelChange = this.onSelectedLeftBottomPanelChange.bind(this);\r\n    }\r\n\r\n    onLeftPanelContainerLayoutChange(layout: PanelContainerLayout) {\r\n        this.props.dispatch(actions.setLeftPanelContainerLayout(layout));\r\n    }\r\n\r\n    onRightPanelContainerLayoutChange(layout: PanelContainerLayout) {\r\n        this.props.dispatch(actions.setRightPanelContainerLayout(layout));\r\n    }\r\n\r\n    onSelectedLeftTopPanelChange(id: string | null) {\r\n        this.props.dispatch(actions.setSelectedLeftTopPanelId(id));\r\n    }\r\n\r\n    onSelectedLeftBottomPanelChange(id: string | null) {\r\n        this.props.dispatch(actions.setSelectedLeftBottomPanelId(id));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <PanelContainer\r\n                position=\"left\"\r\n                undockedMode={this.props.panelContainerUndockedMode}\r\n                layout={this.props.leftPanelContainerLayout}\r\n                onLayoutChange={this.onLeftPanelContainerLayoutChange}\r\n                selectedTopPanelId={this.props.selectedLeftTopPanelId}\r\n                selectedBottomPanelId={this.props.selectedLeftBottomPanelId}\r\n                onSelectedTopPanelChange={this.onSelectedLeftTopPanelChange}\r\n                onSelectedBottomPanelChange={this.onSelectedLeftBottomPanelChange}\r\n            >\r\n                <Panel id=\"dataSources\" position=\"top\" icon=\"database\" title=\"Data Sources\"\r\n                       body={<DataSourcesPanel/>}/>\r\n                <Panel id=\"operations\" position=\"bottom\" icon=\"function\" title=\"Operations\"\r\n                       body={<OperationsPanel/>}/>\r\n            </PanelContainer>\r\n        );\r\n    }\r\n}\r\n\r\nconst LeftPanel = connect(mapStateToPropsLeft)(_LeftPanel);\r\n\r\ninterface IRightPanelProps {\r\n    panelContainerUndockedMode: boolean;\r\n    rightPanelContainerLayout: PanelContainerLayout;\r\n    selectedRightTopPanelId?: string;\r\n    selectedRightBottomPanelId?: string;\r\n}\r\n\r\nfunction mapStateToPropsRight(state: State): IRightPanelProps {\r\n    return {\r\n        panelContainerUndockedMode: selectors.panelContainerUndockedModeSelector(state),\r\n        rightPanelContainerLayout: selectors.rightPanelContainerLayoutSelector(state),\r\n        selectedRightTopPanelId: selectors.selectedRightTopPanelIdSelector(state),\r\n        selectedRightBottomPanelId: selectors.selectedRightBottomPanelIdSelector(state),\r\n    };\r\n}\r\n\r\nclass _RightPanel extends React.PureComponent<IRightPanelProps & IDispatch, null> {\r\n\r\n    constructor(props: IRightPanelProps & IDispatch) {\r\n        super(props);\r\n        this.onRightPanelContainerLayoutChange = this.onRightPanelContainerLayoutChange.bind(this);\r\n        this.onSelectedRightTopPanelChange = this.onSelectedRightTopPanelChange.bind(this);\r\n        this.onSelectedRightBottomPanelChange = this.onSelectedRightBottomPanelChange.bind(this);\r\n    }\r\n\r\n    onRightPanelContainerLayoutChange(layout: PanelContainerLayout) {\r\n        this.props.dispatch(actions.setRightPanelContainerLayout(layout));\r\n    }\r\n\r\n    onSelectedRightTopPanelChange(id: string | null) {\r\n        this.props.dispatch(actions.setSelectedRightTopPanelId(id));\r\n    }\r\n\r\n    onSelectedRightBottomPanelChange(id: string | null) {\r\n        this.props.dispatch(actions.setSelectedRightBottomPanelId(id));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <PanelContainer\r\n                position=\"right\"\r\n                undockedMode={this.props.panelContainerUndockedMode}\r\n                layout={this.props.rightPanelContainerLayout}\r\n                onLayoutChange={this.onRightPanelContainerLayoutChange}\r\n                selectedTopPanelId={this.props.selectedRightTopPanelId}\r\n                selectedBottomPanelId={this.props.selectedRightBottomPanelId}\r\n                onSelectedTopPanelChange={this.onSelectedRightTopPanelChange}\r\n                onSelectedBottomPanelChange={this.onSelectedRightBottomPanelChange}\r\n            >\r\n                <Panel id=\"workspace\" position=\"top\" icon=\"flows\" title=\"Workspace\"\r\n                       body={<WorkspacePanel/>}/>\r\n                <Panel id=\"layers\" position=\"top\" icon=\"layers\" title=\"Layers\"\r\n                       body={<LayersPanel/>}/>\r\n                <Panel id=\"placemarks\" position=\"top\" icon=\"map-marker\" title=\"Places\"\r\n                       body={<PlacemarksPanel/>}/>\r\n                <Panel id=\"variables\" position=\"bottom\" icon=\"variable\" title=\"Variables\"\r\n                       body={<VariablePanel/>}/>\r\n                <Panel id=\"style\" position=\"bottom\" icon=\"style\" title=\"Styles\"\r\n                       body={<StylesPanel/>}/>\r\n                <Panel id=\"view\" position=\"bottom\" icon=\"eye-open\" title=\"View\"\r\n                       body={<ViewPanel/>}/>\r\n                <Panel id=\"tasks\" position=\"bottom\" icon=\"play\" title=\"Tasks\"\r\n                       body={<TaskPanel/>}/>\r\n            </PanelContainer>\r\n        );\r\n    }\r\n}\r\n\r\nconst RightPanel = connect(mapStateToPropsRight)(_RightPanel);\r\n\r\ninterface IViewManagerPanelProps {\r\n    viewLayout: ViewLayoutState;\r\n    views: ViewState<any>[];\r\n    activeView: ViewState<any> | null;\r\n}\r\n\r\nfunction mapStateToPropsView(state: State): IViewManagerPanelProps {\r\n    return {\r\n        viewLayout: selectors.viewLayoutSelector(state),\r\n        views: selectors.viewsSelector(state),\r\n        activeView: selectors.activeViewSelector(state),\r\n    };\r\n}\r\n\r\nclass _CenterPanel extends React.PureComponent<IViewManagerPanelProps & IDispatch, null> {\r\n    static readonly DIV_STYLE: CSSProperties = {flex: 'auto', height: '100%', overflow: 'hidden'};\r\n\r\n    constructor(props: IViewManagerPanelProps & IDispatch) {\r\n        super(props);\r\n        this.onSelectView = this.onSelectView.bind(this);\r\n        this.onCloseView = this.onCloseView.bind(this);\r\n        this.onCloseAllViews = this.onCloseAllViews.bind(this);\r\n        this.onMoveView = this.onMoveView.bind(this);\r\n        this.onChangeViewSplitPos = this.onChangeViewSplitPos.bind(this);\r\n        this.onSplitViewPanel = this.onSplitViewPanel.bind(this);\r\n    }\r\n\r\n    onSelectView(viewPath: ViewPath, viewId: string) {\r\n        this.props.dispatch(actions.selectView(viewPath, viewId));\r\n    }\r\n\r\n    onCloseView(viewPath: ViewPath, viewId: string) {\r\n        this.props.dispatch(actions.closeView(viewPath, viewId));\r\n    }\r\n\r\n    onCloseAllViews(viewPath: ViewPath) {\r\n        this.props.dispatch(actions.closeAllViews(viewPath));\r\n    }\r\n\r\n    onMoveView(sourceViewId: string, placement: 'before' | 'after', targetViewId: string) {\r\n        this.props.dispatch(actions.moveView(sourceViewId, placement, targetViewId));\r\n    }\r\n\r\n    onSplitViewPanel(viewPath: ViewPath, dir: SplitDir, pos: number) {\r\n        this.props.dispatch(actions.splitViewPanel(viewPath, dir, pos));\r\n    }\r\n\r\n    onChangeViewSplitPos(viewPath: ViewPath, delta: number) {\r\n        this.props.dispatch(actions.changeViewSplitPos(viewPath, delta));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div style={_CenterPanel.DIV_STYLE}>\r\n                <ViewManager\r\n                    viewRenderMap={VIEW_TYPE_RENDERERS}\r\n                    viewLayout={this.props.viewLayout}\r\n                    views={this.props.views}\r\n                    activeView={this.props.activeView}\r\n                    noViewsDescription=\"You can create new views from the VIEW panel.\"\r\n                    noViewsVisual=\"eye-open\"\r\n                    onSelectView={this.onSelectView}\r\n                    onCloseView={this.onCloseView}\r\n                    onCloseAllViews={this.onCloseAllViews}\r\n                    onMoveView={this.onMoveView}\r\n                    onChangeViewSplitPos={this.onChangeViewSplitPos}\r\n                    onSplitViewPanel={this.onSplitViewPanel}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst CenterPanel = connect(mapStateToPropsView)(_CenterPanel);\r\n\r\n","import * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { MatomoProvider, createInstance } from '@datapunt/matomo-tracker-react';\r\nimport MatomoTracker from '@datapunt/matomo-tracker-js';\r\n\r\nimport { State } from '../state';\r\nimport AppMainPage from './AppMainPage';\r\n\r\n\r\ninterface IAppMainPageWrapperProps {\r\n    trackingConsentObtained: boolean;\r\n}\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nfunction mapStateToProps(state: State): IAppMainPageWrapperProps {\r\n    return {\r\n        trackingConsentObtained: state.session.trackingConsentObtained,\r\n    };\r\n}\r\n\r\nconst AppMainPageWrapper: React.FC<IAppMainPageWrapperProps> = (\r\n    {\r\n        trackingConsentObtained,\r\n    }\r\n) => {\r\n\r\n    const [matomoInstance, setMatomoInstance] = React.useState<MatomoTracker | null>(null);\r\n\r\n    React.useEffect(() => {\r\n        if (matomoInstance === null) {\r\n            const instance = createInstance(\r\n                {\r\n                    urlBase: 'https://matomo-ext.esa.int/',\r\n                    siteId: 8,\r\n                    // userId: userId, // optional, default value: `undefined`.\r\n                    // trackerUrl: 'https://LINK.TO.DOMAIN/tracking.php', // optional, default value: `${urlBase}matomo.php`\r\n                    // srcUrl: 'https://LINK.TO.DOMAIN/tracking.js', // optional, default value: `${urlBase}matomo.js`\r\n                    disabled: !trackingConsentObtained, // optional, false by default. Makes all tracking calls no-ops if set to true.\r\n                    heartBeat: { // optional, enabled by default\r\n                        active: true, // optional, default value: true\r\n                        seconds: 10 // optional, default value: `15\r\n                    },\r\n                    linkTracking: false, // optional, default value: true\r\n                    configurations: { // optional, default value: {}\r\n                        // any valid matomo configuration, all below are optional\r\n                        disableCookies: !trackingConsentObtained,\r\n                        setSecureCookie: true,\r\n                        setRequestMethod: 'POST'\r\n                    }\r\n                }\r\n            );\r\n            setMatomoInstance(instance);\r\n        }\r\n    }, [trackingConsentObtained, matomoInstance]);\r\n\r\n    return (\r\n        <MatomoProvider value={matomoInstance}>\r\n            <AppMainPage/>\r\n        </MatomoProvider>\r\n    );\r\n};\r\n\r\nexport default connect(mapStateToProps)(AppMainPageWrapper);\r\n","import { main } from './renderer/main';\n\nimport 'normalize.css/normalize.css';\nimport '@blueprintjs/core/lib/css/blueprint.css';\nimport '@blueprintjs/table/lib/css/table.css';\nimport '@blueprintjs/datetime/lib/css/blueprint-datetime.css';\nimport '@blueprintjs/icons/lib/css/blueprint-icons.css';\nimport '@blueprintjs/select/lib/css/blueprint-select.css';\nimport './renderer/resources/fonts/stylesheet.css';\nimport './index.css';\n\ndeclare global {\n    // noinspection JSUnusedGlobalSymbols\n    interface Window {\n        CESIUM_BASE_URL?: string;\n    }\n}\n\nwindow.CESIUM_BASE_URL = './cesium';\n\nmain();\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Provider as StoreProvider } from 'react-redux';\nimport { applyMiddleware, createStore, Middleware, Store } from 'redux';\nimport { createLogger } from 'redux-logger';\nimport thunkMiddleware from 'redux-thunk';\n\nimport * as actions from './actions'\nimport { stateReducer } from './reducers';\nimport { State } from './state';\nimport AppMainPageWrapper from './containers/AppMainPageWrapper';\nimport { connectWebAPIService } from './actions';\nimport { DEFAULT_SERVICE_URL } from './initial-state';\n\n\nexport function main() {\n    const middlewares: Middleware[] = [thunkMiddleware];\n\n    if (process.env.NODE_ENV === 'development') {\n        const nonLoggedActionTypes = new Set([\n                                                 // Too much noise:\n                                                 actions.SET_GLOBE_MOUSE_POSITION,\n                                                 actions.SET_GLOBE_VIEW_POSITION,\n                                                 actions.SET_GLOBE_VIEW_POSITION,\n                                                 actions.UPDATE_MOUSE_IDLE_STATE,\n                                                 actions.UPDATE_SESSION_STATE,\n                                             ]);\n        const loggerOptions = {\n            level: 'info',\n            collapsed: true,\n            diff: true,\n            predicate: (getState, action) => !nonLoggedActionTypes.has(action.type)\n        };\n        middlewares.push(createLogger(loggerOptions));\n    }\n\n    const middleware = applyMiddleware(...middlewares);\n    const store = createStore(stateReducer, middleware) as Store<State>;\n\n    const search = new URLSearchParams(window.location.search);\n    let serviceUrl = DEFAULT_SERVICE_URL;\n    if (search.has(\"serviceUrl\")) {\n        serviceUrl = search.get(\"serviceUrl\");\n    }\n    store.dispatch(connectWebAPIService(serviceUrl) as any);\n\n    ReactDOM.render(\n        (\n          <StoreProvider store={store}>\n              <AppMainPageWrapper/>\n          </StoreProvider>\n        ),\n        document.getElementById('root')\n    );\n}\n","import { FieldValue } from '../../components/field/Field';\r\n\r\n\r\nexport interface InputAssignment {\r\n    constantValue: FieldValue<any> | any;\r\n    resourceName: string;\r\n    isValueUsed: boolean;\r\n}\r\n\r\nexport type InputAssignments = { [inputName: string]: InputAssignment };\r\nexport type InputAssignmentMap = { [dialogId: string]: InputAssignments };\r\n\r\nexport function isInputAssigned(inputAssignments: InputAssignments, inputName: string): boolean {\r\n    return !!inputAssignments[inputName];\r\n}\r\n\r\nexport function assignConstantValueInput(inputAssignments: InputAssignments, inputName: string, constantValue: any): InputAssignments {\r\n    return {...inputAssignments, [inputName]: {isValueUsed: true, constantValue, resourceName: null}};\r\n}\r\n\r\nexport function assignResourceNameInput(inputAssignments: InputAssignments, inputName: string, resourceName: string): InputAssignments {\r\n    return {...inputAssignments, [inputName]: {isValueUsed: false, constantValue: null, resourceName}};\r\n}\r\n\r\n","import * as Cesium from 'cesium';\nimport copyToClipboard from 'copy-to-clipboard';\nimport * as d3 from 'd3-fetch';\nimport { DirectGeometryObject } from 'geojson';\nimport * as redux from 'redux';\n\nimport * as assert from '../common/assert';\nimport { isAssignableFrom, VAR_NAME_LIKE_TYPE, VAR_NAMES_LIKE_TYPE } from '../common/cate-types';\nimport { SimpleStyle } from '../common/geojson-simple-style';\nimport { updateObject } from '../common/objutil';\nimport { isDefined, isNumber } from '../common/types';\nimport { getEntityByEntityId } from './components/cesium/cesium-util';\nimport { GeometryToolType } from './components/cesium/geometry-tool';\nimport desktopActions from './components/desktop/actions';\nimport { FileNode, getFileNode } from './components/desktop/fs/FileNode';\nimport {\n    MessageBoxOptions,\n    MessageBoxResult,\n    OpenDialogOptions,\n    OpenDialogResult,\n    SaveDialogOptions,\n    SaveDialogResult\n} from './components/desktop/types';\nimport { PanelContainerLayout } from './components/PanelContainer';\nimport { SplitDir } from './components/Splitter';\nimport { ViewPath, ViewState } from './components/ViewState';\nimport { DELETE_WORKSPACE_DIALOG_ID, OPEN_WORKSPACE_DIALOG_ID } from './containers/ChooseWorkspaceDialog';\nimport {\n    assignConstantValueInput,\n    assignResourceNameInput,\n    InputAssignments,\n    isInputAssigned\n} from './containers/editor/value-editor-assign';\nimport { FILE_UPLOAD_DIALOG_ID } from './containers/FileUploadDialog';\nimport { reloadEntityWithOriginalGeometry } from './containers/globe-view-layers';\nimport { requireElectron } from './electron';\nimport * as selectors from './selectors';\nimport {\n    BackendConfigState,\n    ColorMapCategoryState,\n    ControlState,\n    DatasetDescriptor,\n    DataSourceState,\n    DataStoreState,\n    GeographicPosition,\n    HubStatus,\n    ImageStatisticsState,\n    LayerState,\n    MessageState,\n    OperationKWArgs,\n    OperationState,\n    Placemark,\n    ResourceState,\n    SavedLayers,\n    SessionState,\n    SplitMode,\n    State,\n    StyleContext,\n    TaskState,\n    VariableLayerBase,\n    VariableState,\n    WebAPIAutoStopInfo,\n    WebAPIServiceInfo,\n    WebAPIStatus,\n    WorkspaceState,\n    WorldViewMode\n} from './state';\nimport {\n    AUTO_LAYER_ID,\n    findDataSource,\n    findResourceByName,\n    genSimpleId,\n    getCsvUrl,\n    getFeatureUrl,\n    getHtmlUrl,\n    getLockForGetWorkspaceVariableStatistics,\n    getLockForLoadDataSources,\n    getNonSpatialIndexers,\n    getWorldViewVectorLayerForEntity,\n    isAnimationResource,\n    isFigureResource,\n    MY_PLACES_LAYER_ID,\n    newVariableLayer,\n    PLACEMARK_ID_PREFIX\n} from './state-util';\nimport { showToast } from './toast';\nimport {\n    ERROR_CODE_CANCELLED,\n    ERROR_CODE_INVALID_PARAMS,\n    JobFailure,\n    JobProgress,\n    JobProgressHandler,\n    JobPromise,\n    JobStatusEnum,\n    newWebAPIClient,\n    WebAPIClient\n} from './webapi';\nimport { ServiceInfoAPI } from './webapi/apis/ServiceInfoAPI';\nimport { HttpError } from './webapi/HttpError';\n\n\nconst electron = requireElectron();\n\n/**\n * The fundamental Action type as it is used here.\n * All actions must have a \"type\" and a \"payload\" property.\n * Basic structure (i.e. the \"type\" property) is prescribed by \"redux\" module.\n */\nexport interface Action extends redux.Action {\n    type: string;\n    payload?: any;\n}\n\n/**\n * Signature of the Action dispatcher as used here.\n * Basic call interface is prescribed by \"redux\" module.\n */\nexport type Dispatch = (action: Action | ThunkAction) => void;\n\n/**\n * Signature of a function that returns the current application state object.\n * Call interface is prescribed by \"redux\" module.\n */\nexport type GetState = () => State;\n\n/**\n * Signature of a \"thunk\" action function as used here.\n * A thunk is piece of code that is executed later.\n * Basic call interface is prescribed by \"redux-thunk\" module.\n */\nexport type ThunkAction = (dispatch: Dispatch, getState: GetState) => any;\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Application-level actions\n\nexport const UPDATE_INITIAL_STATE = 'UPDATE_INITIAL_STATE';\nexport const SET_WEBAPI_STATUS = 'SET_WEBAPI_STATUS';\nexport const SET_WEBAPI_AUTO_STOP_INFO = 'SET_WEBAPI_AUTO_STOP_INFO';\nexport const SET_WEBAPI_CLIENT = 'SET_WEBAPI_CLIENT';\nexport const SET_WEBAPI_SERVICE_URL = 'SET_WEBAPI_SERVICE_URL';\nexport const SET_WEBAPI_SERVICE_INFO = 'SET_WEBAPI_SERVICE_INFO';\nexport const UPDATE_HUB_STATUS = 'UPDATE_HUB_STATUS';\nexport const UPDATE_DIALOG_STATE = 'UPDATE_DIALOG_STATE';\nexport const UPDATE_TASK_STATE = 'UPDATE_TASK_STATE';\nexport const REMOVE_TASK_STATE = 'REMOVE_TASK_STATE';\nexport const UPDATE_CONTROL_STATE = 'UPDATE_CONTROL_STATE';\nexport const UPDATE_SESSION_STATE = 'UPDATE_SESSION_STATE';\nexport const INVOKE_CTX_OPERATION = 'INVOKE_CTX_OPERATION';\nexport const SET_USER_PROFILE = 'SET_USER_PROFILE';\n\n\nexport function setWebAPIStatus(webAPIStatus: WebAPIStatus): Action {\n    return {type: SET_WEBAPI_STATUS, payload: {webAPIStatus}};\n}\n\nexport function setWebAPIAutoStopInfo(webAPIAutoStopInfo: WebAPIAutoStopInfo): Action {\n    return {type: SET_WEBAPI_AUTO_STOP_INFO, payload: {webAPIAutoStopInfo}};\n}\n\nexport function setWebAPIClient(webAPIClient: WebAPIClient): Action {\n    return {type: SET_WEBAPI_CLIENT, payload: {webAPIClient}};\n}\n\nfunction setWebAPIServiceURL(webAPIServiceURL: string): Action {\n    return {type: SET_WEBAPI_SERVICE_URL, payload: {webAPIServiceURL}};\n}\n\nexport function setWebAPIServiceInfo(webAPIServiceInfo: WebAPIServiceInfo): Action {\n    return {type: SET_WEBAPI_SERVICE_INFO, payload: {webAPIServiceInfo}};\n}\n\nexport function connectWebAPIService(webAPIServiceURL: string): ThunkAction {\n    return async (dispatch: Dispatch, getState: GetState) => {\n        dispatch(setWebAPIServiceURL(webAPIServiceURL));\n        dispatch(setWebAPIStatus('connecting'));\n\n        let serviceInfo: WebAPIServiceInfo;\n        try {\n            serviceInfo = await new ServiceInfoAPI().getServiceInfo(webAPIServiceURL);\n        } catch (error) {\n            handleFetchError(error, 'Failed to retrieve service information');\n            dispatch(setWebAPIStatus('error'));\n            return;\n        }\n\n        // TODO: check if serviceInfo.version is in expected version range (#30), otherwise error\n        console.log(`Cate WebAPI server version ${serviceInfo.version}`);\n\n        dispatch(setWebAPIServiceInfo(serviceInfo));\n\n        const webAPIClient = newWebAPIClient(selectors.apiWebSocketsUrlSelector(getState()));\n\n        const formatMessage = (message: string, event: any): string => {\n            if (event.message) {\n                return `${message} (${event.message})`;\n            } else {\n                return message;\n            }\n        };\n\n        /**\n         * Called to inform backend we are still alive.\n         * Hopefully avoids closing WebSocket connection, see issue #150.\n         */\n        const keepAlive = () => {\n            if (webAPIClient.isOpen) {\n                webAPIClient\n                    .call('keep_alive', [])\n                    .then((result: any) => {\n                        if (result) {\n                            const info: WebAPIAutoStopInfo = {\n                                availableTime: result.available_time,\n                                inactivityTime: result.inactivity_time,\n                                remainingTime: result.remaining_time,\n                            }\n                            dispatch(setWebAPIAutoStopInfo(info));\n                        }\n                    });\n            }\n        };\n\n        let keepAliveTimer = null;\n        let keepAliveSeconds = (process.env.NODE_ENV === 'development') ? 1 : 5;\n\n        webAPIClient.onOpen = () => {\n            dispatch(setWebAPIClient(webAPIClient));\n            dispatch(loadBackendConfig());\n            dispatch(loadColorMaps());\n            dispatch(loadPreferences());\n            dispatch(loadOperations());\n            keepAliveTimer = setInterval(keepAlive, keepAliveSeconds * 1000);\n        };\n\n        webAPIClient.onClose = (event: CloseEvent) => {\n            if (keepAliveTimer !== null) {\n                clearInterval(keepAliveTimer);\n            }\n            const webAPIStatus = getState().communication.webAPIStatus;\n            if (webAPIStatus === 'shuttingDown' || webAPIStatus === 'loggingOut') {\n                // When we are logging off, the webAPIClient is expected to close.\n                return;\n            }\n            // When we end up here, the connection closed unintentionally.\n            console.error('webAPIClient.onClose:', event);\n            const closeDetails = `reason=${event.reason}, code=${event.code}, clean=${event.wasClean}`;\n            showToast(\n                {\n                    type: 'notification',\n                    text: formatMessage(`Connection to Cate service closed: ${closeDetails}`, event)\n                },\n                120 * 1000\n            );\n            dispatch(setWebAPIStatus('closed'));\n        };\n\n        webAPIClient.onError = (event: ErrorEvent) => {\n            console.error('webAPIClient.onError:', event);\n            dispatch(setWebAPIStatus('error'));\n            showToast(\n                {\n                    type: 'error',\n                    text: formatMessage('Error connecting to Cate service', event)\n                }\n            );\n        };\n\n        webAPIClient.onWarning = (event: Event) => {\n            console.warn('webAPIClient.onWarning:', event);\n            showToast(\n                {\n                    type: 'warning',\n                    text: formatMessage('Warning from Cate service', event)\n                }\n            );\n        };\n    };\n}\n\nexport function updateHubStatus(hubStatus: HubStatus): Action {\n    return {type: UPDATE_HUB_STATUS, payload: hubStatus};\n}\n\nexport function updateInitialState(initialState: Object): Action {\n    return {type: UPDATE_INITIAL_STATE, payload: initialState};\n}\n\nexport function updateDialogState(dialogId: string, ...dialogState: any): Action {\n    return {type: UPDATE_DIALOG_STATE, payload: {dialogId, dialogState: Object.assign({}, ...dialogState)}};\n}\n\nexport function showDialog(dialogId: string, dialogState?: any): Action {\n    return updateDialogState(dialogId, dialogState, {isOpen: true});\n}\n\nexport function hideDialog(dialogId: string, dialogState?: any): Action {\n    return updateDialogState(dialogId, dialogState, {isOpen: false});\n}\n\nexport function updateTaskState(jobId: number, taskState: TaskState): Action {\n    return {type: UPDATE_TASK_STATE, payload: {jobId, taskState}};\n}\n\nexport function removeTaskState(jobId: number): Action {\n    return {type: REMOVE_TASK_STATE, payload: {jobId}};\n}\n\nexport function setControlProperty(propertyName: keyof ControlState, value: any): Action {\n    return updateControlState({[propertyName]: value});\n}\n\nexport function invokeCtxOperation(operation: OperationState, inputAssignments: InputAssignments): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n\n        const resource = selectors.selectedResourceSelector(getState());\n        if (resource) {\n            for (let input of operation.inputs) {\n                if (!isInputAssigned(inputAssignments, input.name)\n                    && isAssignableFrom(input.dataType, resource.dataType)) {\n                    inputAssignments = assignResourceNameInput(inputAssignments, input.name, resource.name);\n                    break;\n                }\n            }\n        }\n\n        const variable = selectors.selectedVariableSelector(getState());\n        if (variable) {\n            for (let input of operation.inputs) {\n                if (!isInputAssigned(inputAssignments, input.name)\n                    && (input.dataType === VAR_NAME_LIKE_TYPE || input.dataType === VAR_NAMES_LIKE_TYPE)) {\n                    inputAssignments = assignConstantValueInput(inputAssignments, input.name, variable.name);\n                    break;\n                }\n            }\n        }\n\n        dispatch(invokeCtxOperationImpl(operation.name, inputAssignments));\n    };\n}\n\nexport function invokeCtxOperationImpl(selectedCtxOperationName: string, inputAssignments: InputAssignments): Action {\n    return {type: INVOKE_CTX_OPERATION, payload: {selectedCtxOperationName, inputAssignments}};\n}\n\nexport function updateControlState(controlState: Partial<ControlState>): Action {\n    return {type: UPDATE_CONTROL_STATE, payload: controlState};\n}\n\nexport function loadPreferences(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            return selectors.remoteStorageAPISelector(getState()).loadPreferences();\n        }\n\n        function action(session: Partial<SessionState>) {\n            dispatch(updateSessionState(session));\n            dispatch(loadDataStores());\n            dispatch(loadInitialWorkspace(\n                getState().session.reopenLastWorkspace,\n                getState().session.lastWorkspacePath));\n        }\n\n        function planB(jobFailure: JobFailure) {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'Loading Preferences',\n                                        message: 'Failed to load preferences.',\n                                        detail: jobFailure.message\n                                    }));\n        }\n\n        callAPI({\n                    title: `Loading Preferences`,\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n\nexport function savePreferences(postAction?: Action | ThunkAction): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        dispatch(updatePreferences(getState().session, postAction))\n    }\n}\n\nexport function updatePreferences(session: Partial<SessionState>,\n                                  postAction?: Action | ThunkAction): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            return selectors.remoteStorageAPISelector(getState()).updatePreferences(session);\n        }\n\n        function action() {\n            if (postAction) {\n                dispatch(postAction);\n            }\n        }\n\n        function planB(jobFailure: JobFailure) {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'Update Preferences',\n                                        message: 'Failed to update preferences.',\n                                        detail: jobFailure.message\n                                    }));\n            if (postAction) {\n                dispatch(postAction);\n            }\n        }\n\n        callAPI({\n                    title: `Update Preferences`,\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n\nexport function setSessionProperty(propertyName: keyof SessionState, value: any): Action {\n    return updateSessionState({[propertyName]: value});\n}\n\nexport function updateSessionState(sessionState: Partial<SessionState>): Action {\n    return {type: UPDATE_SESSION_STATE, payload: sessionState};\n}\n\nexport function loadBackendConfig(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            // Get state from the Python back-end\n            return selectors.backendConfigAPISelector(getState()).getBackendConfig();\n        }\n\n        function action(backendConfig: BackendConfigState) {\n            dispatch(updateBackendConfig(backendConfig));\n        }\n\n        callAPI({title: 'Load configuration', dispatch, call, action});\n    };\n}\n\nexport function updateBackendConfig(backendConfig: BackendConfigState): Action {\n    return updateSessionState({backendConfig});\n}\n\nexport function storeBackendConfig(backendConfig: BackendConfigState): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            // Store state changes to the Python back-end\n            return selectors.backendConfigAPISelector(getState()).setBackendConfig(backendConfig);\n        }\n\n        callAPI({title: 'Store configuration', dispatch, call});\n    };\n}\n\nexport function cancelJob(jobId: number): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const webAPIClient = selectors.webAPIClientSelector(getState());\n        webAPIClient.cancel(jobId);\n    }\n}\n\nfunction jobSubmitted(jobId: number, jobTitle: string, requestLock?: string): Action {\n    return updateTaskState(jobId, {status: JobStatusEnum.SUBMITTED, title: jobTitle, requestLock: requestLock});\n}\n\nfunction jobProgress(progress: JobProgress): Action {\n    return updateTaskState(progress.id, {status: JobStatusEnum.IN_PROGRESS, progress});\n}\n\nfunction jobDone(jobId: number): Action {\n    return updateTaskState(jobId, {status: JobStatusEnum.DONE});\n}\n\nfunction jobFailed(jobId: number,\n                   jobTitle: string,\n                   failure: JobFailure,\n                   dispatch: (action: Action) => void,\n                   notificationDisabled: boolean): void {\n    const status = failure.code === ERROR_CODE_CANCELLED ? JobStatusEnum.CANCELLED : JobStatusEnum.FAILED;\n    let type, text, action;\n    if (status === JobStatusEnum.CANCELLED) {\n        type = 'notification';\n        text = `Cancelled: ${jobTitle}`;\n    } else {\n        type = 'error';\n        text = failure.message || `Failed: ${jobTitle}`;\n        action = {\n            text: 'Details',\n            onClick: () => {\n                dispatch(showJobFailureDetails(jobTitle, failure));\n            }\n        };\n    }\n    dispatch(updateTaskState(jobId, {status, failure}));\n    if (!notificationDisabled) {\n        if (failure.code === ERROR_CODE_INVALID_PARAMS) {\n            dispatch(showJobFailureDetails(jobTitle, failure));\n        } else {\n            showToast({type, text, action} as MessageState);\n        }\n    }\n}\n\nexport function showJobFailureDetails(jobTitle: string, jobFailure: JobFailure): Action {\n    return showDialog('jobFailureDialog', {jobTitle, jobFailure});\n}\n\nexport type JobPromiseFactory<T> = (jobProgressHandler: JobProgressHandler) => JobPromise<T>;\nexport type JobPromiseAction<T> = (jobResult?: T) => void;\nexport type JobPromisePlanB = (jobFailure: JobFailure) => void;\n\ninterface CallAPIOptions<T> {\n    /** The actual API call. */\n    call: JobPromiseFactory<T>;\n    /** A human-readable title for the job that is being created. */\n    title: string;\n    /** Redux' dispatch() function. */\n    dispatch: (action: Action) => void;\n    /** The action to be performed when the API call succeeds. */\n    action?: JobPromiseAction<T>;\n    /** A lock to prevent multiple invocations. */\n    requestLock?: string;\n    /** The action to be performed when the API call fails. */\n    planB?: JobPromisePlanB;\n    /** If true, no notifications about job status will be delivered, except errors. */\n    disableNotifications?: boolean;\n    /** If true, a notification is shown when done even when no start notification was shown (due to startToastDelay). */\n    requireDoneNotification?: boolean;\n    /** Delay in milliseconds before a toast is shown. */\n    startToastDelay?: number;\n}\n\n/**\n * Call some (remote) API asynchronously.\n *\n * @param options Options that control the API call.\n */\nexport function callAPI<T>(options: CallAPIOptions<T>): void {\n    const {\n        call,\n        title,\n        dispatch,\n        action,\n        requestLock,\n        planB,\n        disableNotifications = false,\n        requireDoneNotification = false,\n        startToastDelay = 500,\n    } = options;\n\n    const onProgress = (progress: JobProgress) => {\n        if (!disableNotifications) {\n            dispatch(jobProgress(progress));\n        }\n    };\n    const jobPromise = call(onProgress);\n\n    let startToastShown = false;\n    let startToastTimeoutHandler: any;\n    if (!disableNotifications) {\n        startToastTimeoutHandler = setTimeout(() => {\n            showToast({type: 'notification', text: 'Started: ' + title});\n            startToastShown = true;\n        }, startToastDelay);\n        dispatch(jobSubmitted(jobPromise.getJobId(), title, requestLock));\n    }\n\n    const onDone = (jobResult: T) => {\n        if (!disableNotifications) {\n            clearTimeout(startToastTimeoutHandler);\n            if (startToastShown || requireDoneNotification) {\n                showToast({type: 'success', text: 'Done: ' + title});\n            }\n            dispatch(jobDone(jobPromise.getJobId()));\n        }\n        if (action) {\n            action(jobResult);\n        }\n    };\n    const onFailure = (jobFailure: JobFailure) => {\n        if (!disableNotifications) {\n            if (!startToastShown) {\n                clearTimeout(startToastTimeoutHandler);\n            }\n        }\n        // Always show errors in TASKS panel\n        jobFailed(jobPromise.getJobId(), title, jobFailure, dispatch, disableNotifications);\n        if (planB) {\n            planB(jobFailure);\n        }\n    };\n\n    jobPromise.then(onDone, onFailure);\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Globe State\n\nexport const SET_GLOBE_MOUSE_POSITION = 'SET_GLOBE_MOUSE_POSITION';\nexport const SET_GLOBE_VIEW_POSITION = 'SET_GLOBE_VIEW_POSITION';\n\nexport function setGlobeMousePosition(position: GeographicPosition): Action {\n    return {type: SET_GLOBE_MOUSE_POSITION, payload: {position}};\n}\n\n\nfunction setGlobeViewPositionImpl(position: GeographicPosition | null,\n                                  positionData: { [varName: string]: number } | null): Action {\n    return {type: SET_GLOBE_VIEW_POSITION, payload: {position, positionData}};\n}\n\nexport function setGlobeViewPosition(position: GeographicPosition): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (position) {\n            // TODO: using selectedRightBottomPanelID is no good indicator for checking VARIABLES panel visibility.\n            const selectedRightBottomPanelID = selectors.selectedRightBottomPanelIdSelector(getState());\n            if (selectedRightBottomPanelID === 'variables') {\n                const baseDir = selectors.workspaceBaseDirSelector(getState());\n                if (!baseDir) {\n                    // Workspace not yet ready, that's ok.\n                    return;\n                }\n                const resource = selectors.selectedResourceSelector(getState());\n                const layer = selectors.selectedVariableImageLayerSelector(getState());\n                if (layer && resource) {\n                    const indexers = getNonSpatialIndexers(resource, layer);\n\n                    const call = () => {\n                        return selectors.datasetAPISelector(getState()).extractPixelValues(baseDir,\n                                                                                           resource.name,\n                                                                                           [position.longitude, position.latitude],\n                                                                                           indexers);\n                    };\n\n                    const action = (positionData: { [varName: string]: number }) => {\n                        dispatch(setGlobeViewPositionImpl(position, positionData));\n                    };\n\n                    callAPI({title: 'Load cell values', dispatch, call, action, disableNotifications: true});\n                    return;\n                }\n            }\n        } else {\n            dispatch(setGlobeViewPositionImpl(null, null));\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// File-system actions\n\nexport const UPDATE_FS_ROOT_NODE = 'UPDATE_FS_ROOT_NODE';\n\nfunction updateFsRootNode(path: string, updatedFileNode: FileNode): Action {\n    return {type: UPDATE_FS_ROOT_NODE, payload: {path, updatedFileNode}};\n}\n\nexport function updateFileNode(path: string, force: boolean): ThunkAction {\n    const pathComponents = path.split('/');\n\n    return (dispatch: Dispatch, getState: GetState) => {\n        const api = selectors.fileSystemAPISelector(getState());\n        if (api === null) {\n            console.error('fileSystemAPI not ready');\n            return;\n        }\n        // Get all the subPaths of path that must be updated:\n        const subPathsToBeUpdated: string[] = [];\n        pathComponents.forEach((name, depth) => {\n            const subPath = pathComponents.slice(0, depth + 1).join('/');\n            if (subPathsToBeUpdated.length === 0) {\n                const subNode = getFileNode(getState().data.fsRootNode, subPath);\n                if (!subNode) {\n                    subPathsToBeUpdated.push('');\n                    subPathsToBeUpdated.push(subPath);\n                } else if (!subNode.status || force) {\n                    subPathsToBeUpdated.push(subPath);\n                }\n            } else {\n                // Also add all sub-paths\n                subPathsToBeUpdated.push(subPath);\n            }\n        });\n        dispatch(updateSubPathFileNode(subPathsToBeUpdated, force));\n    }\n}\n\nfunction updateSubPathFileNode(subPaths: string[], force: boolean): ThunkAction {\n\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (subPaths.length === 0) {\n            return;\n        }\n\n        const api = selectors.fileSystemAPISelector(getState());\n        if (api === null) {\n            console.error('fileSystemAPI not ready');\n            return;\n        }\n\n        const subPath = subPaths[0];\n        const subNode = getFileNode(getState().data.fsRootNode, subPath);\n        if (!subNode) {\n            console.error(`sub-path not found in file system root node: \"${subPath}\"`);\n            return;\n        }\n\n        if (subNode.status && !force) {\n            return;\n        }\n\n        dispatch(updateFsRootNode(subPath, {...subNode, status: 'updating'}));\n\n        const call = () => {\n            return api.updateFileNode(subPath);\n        };\n\n        const action = (updatedFileNode: FileNode) => {\n            dispatch(updateFsRootNode(subPath, updatedFileNode));\n            if (subPaths.length > 1) {\n                dispatch(updateSubPathFileNode(subPaths.slice(1), force));\n            }\n        };\n\n        const planB = (jobFailure: JobFailure) => {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'File System Update',\n                                        message: 'Failed updating file in file system.',\n                                        detail: jobFailure.message\n                                    }));\n        };\n\n        callAPI({\n                    title: `Updating Files`,\n                    dispatch, call, action, planB, requireDoneNotification: false\n                });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// (User) Placemark actions\n\nexport const ACTIVATE_NEW_PLACEMARK_TOOL = 'ACTIVATE_NEW_PLACEMARK_TOOL';\nexport const ADD_PLACEMARK = 'ADD_PLACEMARK';\nexport const REMOVE_PLACEMARK = 'REMOVE_PLACEMARK';\nexport const UPDATE_PLACEMARK_GEOMETRY = 'UPDATE_PLACEMARK_GEOMETRY';\nexport const UPDATE_PLACEMARK_PROPERTIES = 'UPDATE_PLACEMARK_PROPERTIES';\nexport const UPDATE_PLACEMARK_STYLE = 'UPDATE_PLACEMARK_STYLE';\n\nexport function activateNewPlacemarkTool(newPlacemarkToolType: GeometryToolType) {\n    return {type: ACTIVATE_NEW_PLACEMARK_TOOL, payload: {newPlacemarkToolType}};\n}\n\nexport function addPlacemark(placemark: Placemark): Action {\n    return {type: ADD_PLACEMARK, payload: {placemark}};\n}\n\nexport function addPointPlacemark(longitude: number, latitude: number, properties: any): Action {\n    const placemark = {\n        id: genSimpleId(PLACEMARK_ID_PREFIX),\n        type: 'Feature',\n        geometry: {\n            type: 'Point',\n            coordinates: [longitude, latitude]\n        },\n        properties,\n    };\n    return addPlacemark(placemark as any);\n}\n\nexport function removePlacemark(placemarkId: string): Action {\n    return {type: REMOVE_PLACEMARK, payload: {placemarkId}};\n}\n\nexport function updatePlacemarkGeometry(placemarkId: string, geometry: DirectGeometryObject | any): Action {\n    return {type: UPDATE_PLACEMARK_GEOMETRY, payload: {placemarkId, geometry}};\n}\n\nexport function updatePlacemarkProperties(placemarkId: string, properties: any): Action {\n    return {type: UPDATE_PLACEMARK_PROPERTIES, payload: {placemarkId, properties}};\n}\n\nexport function updatePlacemarkStyle(placemarkId: string, style: SimpleStyle): Action {\n    return {type: UPDATE_PLACEMARK_STYLE, payload: {placemarkId, style}};\n}\n\nexport function locatePlacemark(placemarkId: string): ThunkAction {\n    return async (dispatch: Dispatch, getState: GetState) => {\n        let viewer = selectors.selectedWorldViewViewerSelector(getState());\n        if (viewer) {\n            let selectedEntity = getEntityByEntityId(viewer, placemarkId);\n            if (selectedEntity) {\n                let headingPitchRange;\n                if (selectedEntity.position) {\n                    let heading = 0, pitch = -3.14159 / 2, range = 2500000;\n                    headingPitchRange = new Cesium.HeadingPitchRange(heading, pitch, range);\n                }\n                await viewer.zoomTo(selectedEntity, headingPitchRange);\n            }\n        }\n    };\n}\n\nexport function setSelectedPlacemarkId(selectedPlacemarkId: string | null): Action {\n    return updateSessionState({selectedPlacemarkId});\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Data stores / data sources actions\n\nexport const UPDATE_DATA_STORES = 'UPDATE_DATA_STORES';\nexport const UPDATE_DATA_SOURCES = 'UPDATE_DATA_SOURCES';\nexport const UPDATE_DATA_SOURCE_META_INFO = 'UPDATE_DATA_SOURCE_META_INFO';\n\n/**\n * Asynchronously load the available Cate data stores.\n * Called only a single time on app initialisation.\n *\n * @returns a Redux thunk action\n */\nexport function loadDataStores(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            return selectors.datasetAPISelector(getState()).getDataStores();\n        }\n\n        function action(dataStores: DataStoreState[]) {\n            const offlineMode = selectors.offlineModeSelector(getState());\n            if (offlineMode) {\n                dataStores = dataStores.filter(ds => ds.isLocal);\n            }\n            dispatch(updateDataStores(dataStores));\n\n            if (dataStores && dataStores.length) {\n                let selectedDataStoreId = selectors.selectedDataStoreIdSelector(getState());\n                const selectedDataStore = dataStores.find(dataStore => dataStore.id === selectedDataStoreId);\n                selectedDataStoreId = selectedDataStore ? selectedDataStore.id : dataStores[0].id;\n                dispatch(setSelectedDataStoreId(selectedDataStoreId));\n            }\n        }\n\n        callAPI({title: 'Loading data stores', dispatch, call, action});\n    }\n}\n\n\nexport function updateDataStores(dataStores: Array<DataStoreState>): Action {\n    return {type: UPDATE_DATA_STORES, payload: {dataStores}};\n}\n\n/**\n * Asynchronously load data sources for given data store ID.\n *\n * @param dataStoreId\n * @param setSelection\n * @returns a Redux thunk action\n */\nexport function loadDataSources(dataStoreId: string, setSelection: boolean): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const requestLock = getLockForLoadDataSources(dataStoreId);\n        if (selectors.activeRequestLocksSelector(getState()).has(requestLock)) {\n            return;\n        }\n\n        function call(onProgress) {\n            return selectors.datasetAPISelector(getState()).getDataSources(dataStoreId, onProgress);\n        }\n\n        function action(dataSources: DataSourceState[]) {\n            dispatch(updateDataSources(dataStoreId, dataSources));\n            if (setSelection) {\n                let selectedDataSourceId = selectors.selectedDataSourceIdSelector(getState());\n                if (dataSources && dataSources.length) {\n                    const selectedDataSource = dataSources.find(dataSource => dataSource.id === selectedDataSourceId);\n                    selectedDataSourceId = selectedDataSource ? selectedDataSource.id : selectedDataSourceId;\n                }\n                dispatch(setSelectedDataSourceId(selectedDataSourceId));\n            }\n        }\n\n        const dataStore = getState().data.dataStores.find(dataStore => dataStore.id === dataStoreId);\n        callAPI({\n                    title: `Load data sources for store \"${dataStore ? dataStore.id : '?'}\"`,\n                    dispatch,\n                    call,\n                    action,\n                    requestLock\n                });\n    }\n}\n\nexport function updateDataSources(dataStoreId: string, dataSources): Action {\n    return {type: UPDATE_DATA_SOURCES, payload: {dataStoreId, dataSources}};\n}\n\nexport function setSelectedDataStoreId(selectedDataStoreId: string | null): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (getState().session.selectedDataStoreId === selectedDataStoreId) {\n            //return;\n        }\n        dispatch(setSelectedDataStoreIdImpl(selectedDataStoreId));\n        if (selectedDataStoreId !== null) {\n            const dataStore = getState().data.dataStores.find(dataStore => dataStore.id === selectedDataStoreId);\n            if (!dataStore.dataSources) {\n                dispatch(loadDataSources(selectedDataStoreId, true));\n            }\n        }\n    }\n}\n\nexport function setSelectedDataStoreIdImpl(selectedDataStoreId: string | null) {\n    return updateSessionState({selectedDataStoreId});\n}\n\nexport function setSelectedDataSourceId(selectedDataSourceId: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        dispatch(updateSessionState({selectedDataSourceId}));\n        const dataStoreId = getState().session.selectedDataStoreId;\n        if (dataStoreId && selectedDataSourceId) {\n            dispatch(loadDataSourceMetaInfo(dataStoreId, selectedDataSourceId));\n        }\n    }\n}\n\nexport function setDataSourceFilterExpr(dataSourceFilterExpr: string) {\n    return updateSessionState({dataSourceFilterExpr});\n}\n\nexport function loadDataSourceMetaInfo(dataStoreId: string, dataSourceId: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const dataStores = getState().data.dataStores;\n        if (!dataStores) {\n            return;\n        }\n        const dataSource = findDataSource(dataStores, dataStoreId, dataSourceId);\n        if (!dataSource || dataSource.metaInfoStatus !== 'init') {\n            return;\n        }\n\n        dispatch(updateDataSourceMetaInfo(dataStoreId, dataSourceId, undefined, 'loading'));\n\n        function call(onProgress) {\n            return selectors.datasetAPISelector(getState()).getDataSourceMetaInfo(dataStoreId, dataSourceId, onProgress);\n        }\n\n        function action(metaInfo: DatasetDescriptor) {\n            dispatch(updateDataSourceMetaInfo(dataStoreId, dataSourceId, metaInfo, 'ok'));\n        }\n\n        function planB() {\n            dispatch(updateDataSourceMetaInfo(dataStoreId, dataSourceId, undefined, 'error'));\n        }\n\n        callAPI({title: `Loading metadata for ${dataSourceId}`, dispatch, call, action, planB});\n    };\n}\n\nexport function updateDataSourceMetaInfo(dataStoreId: string,\n                                         dataSourceId: string,\n                                         metaInfo: DatasetDescriptor | undefined,\n                                         metaInfoStatus: 'loading' | 'ok' | 'error' = 'ok'): Action {\n    return {type: UPDATE_DATA_SOURCE_META_INFO, payload: {dataStoreId, dataSourceId, metaInfo, metaInfoStatus}};\n}\n\nexport function openDataset(dataStoreId: string, dataSourceId: string, args: any, updateLocalDataSources: boolean): ThunkAction {\n    return (dispatch: Dispatch) => {\n\n        const opName = 'open_dataset';\n        const opArgs = {\n            ds_id: dataSourceId,\n            data_store_id: dataStoreId,\n            ...args\n        };\n\n        // Wrap the opArgs into a new OpArgs object where each value is indicated by a \"value\" key.\n        // The reason is that an opArg could also refer to a resource, the \"source\" key would be used instead.\n        //\n        const wrappedOpArgs = {};\n        Object.keys(opArgs).forEach(name => {\n            wrappedOpArgs[name] = {value: opArgs[name]};\n        });\n        let postAction;\n        if (updateLocalDataSources) {\n            postAction = (dispatch: Dispatch) => {\n                dispatch(loadDataSources('local', false));\n            }\n        }\n\n        dispatch(setWorkspaceResource(opName,\n                                      wrappedOpArgs,\n                                      null,\n                                      false,\n                                      `Opening data source \"${dataSourceId}\"`, postAction));\n    }\n}\n\nexport function addLocalDataset(dataSourceId: string, filePathPattern: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call(onProgress) {\n            return selectors.datasetAPISelector(getState()).addLocalDataSource(dataSourceId, filePathPattern, onProgress);\n        }\n\n        function action(dataSources: DataSourceState[]) {\n            dispatch(updateDataSources('local', dataSources));\n        }\n\n        callAPI({\n                    title: `Add file data source \"${dataSourceId}\"`,\n                    dispatch, call, action, requireDoneNotification: true\n                });\n    }\n}\n\nexport function removeLocalDataset(dataSourceId: string, removeFiles: boolean): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call(onProgress) {\n            return selectors.datasetAPISelector(getState()).removeLocalDataSource(dataSourceId, removeFiles, onProgress);\n        }\n\n        function action(dataSources: DataSourceState[]) {\n            dispatch(updateDataSources('local', dataSources));\n        }\n\n        callAPI({\n                    title: `Remove copy of file data source \"${dataSourceId}\"`,\n                    dispatch, call, action, requireDoneNotification: true\n                });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Operation actions\n\nexport const UPDATE_OPERATIONS = 'UPDATE_OPERATIONS';\n\nexport function loadOperations(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n\n        function call() {\n            return selectors.operationAPISelector(getState()).getOperations();\n        }\n\n        function action(operations: OperationState[]) {\n            dispatch(updateOperations(operations));\n        }\n\n        callAPI({title: 'Load operations', dispatch, call, action});\n    };\n}\n\nexport function updateOperations(operations): Action {\n    return {type: UPDATE_OPERATIONS, payload: {operations}};\n}\n\nexport function setSelectedOperationName(selectedOperationName: string | null) {\n    return updateSessionState({selectedOperationName});\n}\n\nexport function setOperationFilterTags(operationFilterTags: string[]) {\n    return updateSessionState({operationFilterTags});\n}\n\nexport function setOperationFilterExpr(operationFilterExpr: string) {\n    return updateSessionState({operationFilterExpr});\n}\n\nexport function showOperationStepDialog(dialogId: string) {\n    return showDialog(dialogId);\n}\n\nexport function hideOperationStepDialog(dialogId: string, inputAssignments?): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (inputAssignments) {\n            const dialogState = getState().control.dialogs[dialogId] as any;\n            inputAssignments = {...dialogState.inputAssignments, ...inputAssignments};\n        }\n        dispatch(hideDialog(dialogId, {inputAssignments}));\n    };\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Workspace actions\n\nexport const SET_CURRENT_WORKSPACE = 'SET_CURRENT_WORKSPACE';\nexport const UPDATE_WORKSPACE_NAMES = 'UPDATE_WORKSPACE_NAMES';\nexport const RENAME_RESOURCE = 'RENAME_RESOURCE';\nexport const SHOW_FIGURE_VIEW = 'SHOW_FIGURE_VIEW';\nexport const SHOW_ANIMATION_VIEW = 'SHOW_ANIMATION_VIEW';\nexport const SHOW_TABLE_VIEW = 'SHOW_TABLE_VIEW';\n\nexport function updateWorkspaceNames(workspaceNames: string[]): Action {\n    return {type: UPDATE_WORKSPACE_NAMES, payload: {workspaceNames}};\n}\n\n/**\n * Asynchronously load the initial workspace.\n * Called only a single time on app initialisation.\n *\n * @returns a Redux thunk action\n */\nexport function loadInitialWorkspace(reopenLastWorkspace?: boolean, lastWorkspacePath?: string): ThunkAction {\n    return (dispatch: Dispatch) => {\n        if (reopenLastWorkspace && lastWorkspacePath) {\n            dispatch(openWorkspace(lastWorkspacePath));\n        } else {\n            dispatch(newWorkspace(null));\n        }\n    }\n}\n\n/**\n * Asynchronously create a new workspace.\n *\n * @param workspacePath workspace path, if null, a new scratch workspace will be created\n * @returns a Redux thunk action\n */\nexport function newWorkspace(workspacePath: string | null): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            return selectors.workspaceAPISelector(getState()).newWorkspace(workspacePath);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n            dispatch(saveWorkspace());\n            if (workspace && workspace.workflow.steps.length > 0) {\n                dispatch(setSelectedWorkspaceResourceName(workspace.workflow.steps[0].id));\n            } else {\n                dispatch(setSelectedWorkspaceResourceName(null));\n            }\n            dispatch(savePreferences());\n        }\n\n        function planB(jobFailure: JobFailure) {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'New Workspace',\n                                        message: 'Failed to create new workspace.',\n                                        detail: jobFailure.message\n                                    }));\n        }\n\n        callAPI({\n                    title: 'New workspace' + (workspacePath ? ` \"${workspacePath}\"` : ''),\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously open a workspace.\n *\n * @param workspacePath workspace path\n * @returns a Redux thunk action\n */\nexport function openWorkspace(workspacePath?: string | null): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call(onProgress) {\n            return selectors.workspaceAPISelector(getState()).openWorkspace(workspacePath, onProgress);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n            if (workspace && workspace.workflow.steps.length > 0) {\n                dispatch(setSelectedWorkspaceResourceName(workspace.workflow.steps[0].id));\n            } else {\n                dispatch(setSelectedWorkspaceResourceName(null));\n            }\n            dispatch(savePreferences());\n        }\n\n        function planB() {\n            let workspace = getState().data.workspace;\n            if (!workspace) {\n                dispatch(newWorkspace(null));\n            }\n        }\n\n        callAPI({\n                    title: `Open workspace \"${workspacePath}\"`,\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously close the current workspace.\n *\n * @returns a Redux thunk action\n */\nexport function closeWorkspace(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).closeWorkspace(baseDir);\n        }\n\n        function action() {\n            dispatch(newWorkspace(null));\n        }\n\n        callAPI({\n                    title: 'Close workspace',\n                    dispatch, call, action, requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously close the current workspace.\n *\n * @returns a Redux thunk action\n */\nexport function saveWorkspace(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        let workspace = getState().data.workspace;\n        assert.ok(workspace);\n\n        if (workspace.isScratch) {\n            return saveWorkspaceAs;\n        }\n\n        const baseDir = workspace.baseDir;\n\n        function call(onProgress) {\n            return selectors.workspaceAPISelector(getState()).saveWorkspace(baseDir, onProgress);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n            dispatch(savePreferences());\n        }\n\n        function planB(jobFailure: JobFailure) {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'Save Workspace',\n                                        message: 'Failed to save workspace.',\n                                        detail: jobFailure.message\n                                    }));\n        }\n\n        callAPI({\n                    title: 'Save workspace',\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously save the current workspace using a new name.\n *\n * @returns a Redux thunk action\n */\nexport function saveWorkspaceAs(workspacePath: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call(onProgress) {\n            return selectors.workspaceAPISelector(getState()).saveWorkspaceAs(baseDir, workspacePath, onProgress);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n            dispatch(savePreferences());\n        }\n\n        function planB(jobFailure: JobFailure) {\n            dispatch(showMessageBox({\n                                        type: 'error',\n                                        title: 'Save Workspace As',\n                                        message: 'Failed to save workspace.',\n                                        detail: jobFailure.message\n                                    }));\n        }\n\n        callAPI({\n                    title: `Save workspace as \"${workspacePath}\"`,\n                    dispatch, call, action, planB, requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously clean the current workspace.\n *\n * @returns a Redux thunk action\n */\nexport function cleanWorkspace(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        let workspace = getState().data.workspace;\n        assert.ok(workspace);\n        const baseDir = workspace.baseDir;\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).cleanWorkspace(baseDir);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n        }\n\n        callAPI({\n                    title: `Clean workspace \"${baseDir}\"`,\n                    dispatch, call, action, requireDoneNotification: true\n                });\n    }\n}\n\n\n/**\n * Asynchronously delete the given resource.\n *\n * @returns a Redux thunk action\n */\nexport function deleteResource(resName: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        let workspace = getState().data.workspace;\n        assert.ok(workspace);\n        const baseDir = workspace.baseDir;\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).deleteWorkspaceResource(baseDir, resName);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n        }\n\n        callAPI({\n                    title: `Delete step/resource \"${resName}\"`, dispatch, call, action,\n                    requireDoneNotification: true\n                });\n    }\n}\n\n/**\n * Asynchronously delete the workspace with the given name.\n *\n * @returns a Redux thunk action\n */\nexport function deleteWorkspace(workspaceName: string, deleteEntireWorkspace = true): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).deleteWorkspace(workspaceName, deleteEntireWorkspace);\n        }\n\n        callAPI({\n                    title: `Delete step/workspace \"${workspaceName}\"`, dispatch, call,\n                    requireDoneNotification: true\n                });\n    }\n}\n\n\n/**\n * Bring up the \"New Workspace\" dialog.\n *\n * @returns a Redux action\n */\nexport function newWorkspaceInteractive() {\n    return showDialog('newWorkspaceDialog');\n}\n\nfunction openRemoteWorkspace(dispatch: (action: (Action | ThunkAction)) => void,\n                             getState: () => State) {\n    let jobPromise = selectors.workspaceAPISelector(getState()).listWorkspaces();\n    jobPromise.then(workspaceNames => {\n        dispatch(updateWorkspaceNames(workspaceNames));\n        dispatch(showDialog(OPEN_WORKSPACE_DIALOG_ID));\n    })\n}\n\nfunction deleteRemoteWorkspace(dispatch: (action: (Action | ThunkAction)) => void,\n                               getState: () => State) {\n    let jobPromise = selectors.workspaceAPISelector(getState()).listWorkspaces();\n    jobPromise.then(workspaceNames => {\n        dispatch(updateWorkspaceNames(workspaceNames));\n        dispatch(showDialog(DELETE_WORKSPACE_DIALOG_ID));\n    })\n}\n\nfunction openLocalWorkspace(dispatch: (action: (Action | ThunkAction)) => void,\n                            getState: () => State) {\n    const handleClose = (workspacePath: string | null) => {\n        if (workspacePath) {\n            const workspace = getState().data.workspace;\n            let ok = true;\n            if (workspace) {\n                if (workspace.baseDir === workspacePath) {\n                    // showMessageBox({\n                    //     title: 'Open Workspace',\n                    //     message: 'Workspace is already open.'\n                    // }, MESSAGE_BOX_NO_REPLY);\n                    showToast({\n                                  type: 'warning',\n                                  text: 'Workspace is already open.',\n                              });\n                    return;\n                }\n                ok = maybeSaveCurrentWorkspace(dispatch, getState,\n                                               'Open Workspace',\n                                               'Would you like to save the current workspace before opening the new one?',\n                                               'Press \"Cancel\" to cancel opening a new workspace.'\n                );\n            }\n            if (ok) {\n                dispatch(openWorkspace(workspacePath));\n            }\n        }\n    }\n    dispatch(showSingleFileOpenDialog({\n                                          title: 'Open Workspace - Select Directory',\n                                          buttonLabel: 'Open',\n                                          properties: ['openDirectory'],\n                                      }, handleClose) as any);\n}\n\n/**\n * Let user select a workspace, then ask whether to save the existing workspace, then open new one.\n *\n * @returns a Redux thunk action\n */\nexport function openWorkspaceInteractive(): ThunkAction {\n\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (selectors.isLocalFSAccessAllowedSelector(getState())) {\n            openLocalWorkspace(dispatch, getState);\n        } else {\n            openRemoteWorkspace(dispatch, getState);\n        }\n    };\n}\n\n/**\n * Let user select a workspace, then ask whether to delete the selected workspace.\n *\n * @returns a Redux thunk action\n */\nexport function deleteWorkspaceInteractive(): ThunkAction {\n\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (!selectors.isLocalFSAccessAllowedSelector(getState())) {\n            deleteRemoteWorkspace(dispatch, getState);\n        }\n    };\n}\n\n/**\n * Ask user to whether to save workspace, then close it.\n *\n * @returns a Redux thunk action\n */\nexport function closeWorkspaceInteractive(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const ok = maybeSaveCurrentWorkspace(dispatch, getState,\n                                             'Close Workspace',\n                                             'Would you like to save the current workspace before closing it?',\n                                             'Press \"Cancel\" to cancel closing the workspace.'\n        );\n        if (ok) {\n            dispatch(closeWorkspace())\n        }\n    };\n}\n\n/**\n * Ask user whether to clean workspace, then clean it.\n *\n * @returns a Redux thunk action\n */\nexport function cleanWorkspaceInteractive(): ThunkAction {\n    return (dispatch: Dispatch) => {\n        dispatch(showMessageBox({\n                                    type: 'question',\n                                    title: 'Clean Workspace',\n                                    message: 'Do you really want to clean this workspace?',\n                                    detail: 'This will delete all resources and workflow steps.\\nYou will not be able to undo this operation.',\n                                    buttons: ['Yes', 'No'],\n                                    defaultId: 1,\n                                    cancelId: 1,\n                                }, (answer) => {\n            if (answer && answer.buttonIndex === 0) {\n                dispatch(cleanWorkspace());\n            }\n        }));\n    };\n}\n\n/**\n * Ask user whether to delete a resource/step, then delete it.\n *\n * @returns a Redux thunk action\n */\nexport function deleteResourceInteractive(resName: string): ThunkAction {\n    return (dispatch: Dispatch) => {\n        dispatch(showMessageBox({\n                                    type: 'question',\n                                    title: 'Remove Resource and Workflow Step',\n                                    message: `Do you really want to delete resource and step \"${resName}\"?`,\n                                    detail: 'This will also delete the workflow step that created it.\\n' +\n                                            'You will not be able to undo this operation.',\n                                    buttons: ['Yes', 'No'],\n                                    defaultId: 1,\n                                    cancelId: 1,\n                                }, answer => {\n            if (answer && answer.buttonIndex === 0) {\n                dispatch(deleteResource(resName));\n            }\n        }));\n    };\n}\n\n/**\n * If current workspace is scratch workspace, delegate to \"save as\" action otherwise save it.\n *\n * @returns a Redux thunk action\n */\nexport function saveWorkspaceInteractive(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const workspace = getState().data.workspace;\n        if (workspace.isScratch) {\n            dispatch(saveWorkspaceAsInteractive());\n        } else {\n            dispatch(saveWorkspace())\n        }\n    };\n}\n\n/**\n * Bring up the \"Save Workspace As\" dialog.\n *\n * @returns a Redux action\n */\nexport function saveWorkspaceAsInteractive() {\n    return showDialog('saveWorkspaceAsDialog');\n}\n\n/**\n * Save workspace after asking user whether to do so.\n *\n * @returns false, if action was cancelled, otherwise true\n */\nfunction maybeSaveCurrentWorkspace(dispatch, getState: GetState, title: string, message: string, detail?: string): boolean {\n    const workspace = getState().data.workspace;\n    if (workspace) {\n        const maySave = workspace.workflow.steps.length && (workspace.isModified || !workspace.isSaved);\n        if (maySave) {\n            dispatch(showMessageBox({\n                                        type: 'question',\n                                        title,\n                                        message,\n                                        detail,\n                                        buttons: ['Yes', 'No', 'Cancel'],\n                                        defaultId: 0,\n                                        cancelId: 2,\n                                    }, answer => {\n\n                if (answer) {\n                    if (answer.buttonIndex === 0) {\n                        if (workspace.isScratch) {\n                            dispatch(saveWorkspaceAsInteractive());\n                        } else {\n                            dispatch(saveWorkspace());\n                        }\n                    } else if (answer.buttonIndex === 2) {\n                        return false;\n                    }\n                } else {\n                    return false;\n                }\n            }));\n        }\n    }\n    return true;\n}\n\nexport function setCurrentWorkspace(workspace: WorkspaceState): ThunkAction {\n    return (dispatch: Dispatch, getState) => {\n        dispatch(setCurrentWorkspaceImpl(workspace));\n        const lastWorkspacePath = workspace.baseDir;\n        if (getState().session.lastWorkspacePath !== lastWorkspacePath) {\n            if (workspace.isScratch) {\n                dispatch(updateSessionState({'lastWorkspacePath': null}));\n            } else {\n                dispatch(updateSessionState({lastWorkspacePath}));\n            }\n        }\n    }\n}\n\nfunction setCurrentWorkspaceImpl(workspace: WorkspaceState): Action {\n    return {type: SET_CURRENT_WORKSPACE, payload: {workspace}};\n}\n\nexport function setSelectedWorkspaceResourceName(selectedWorkspaceResourceName: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        dispatch(setSelectedWorkspaceResourceNameImpl(selectedWorkspaceResourceName));\n        if (selectedWorkspaceResourceName && getState().data.workspace) {\n            const resources: Array<ResourceState> = getState().data.workspace.resources;\n            if (resources) {\n                const resource = resources.find(res => res.name === selectedWorkspaceResourceName);\n                if (resource && resource.variables && resource.variables.length) {\n                    const variable = resource.variables.find(variable => !!variable.isDefault);\n                    dispatch(setSelectedVariable(resource,\n                                                 variable || resource.variables[0],\n                                                 selectors.savedLayersSelector(getState())));\n                }\n            }\n        }\n    }\n}\n\nfunction setSelectedWorkspaceResourceNameImpl(selectedWorkspaceResourceName: string): Action {\n    return updateControlState({selectedWorkspaceResourceName});\n}\n\nexport function setSelectedWorkflowStepId(selectedWorkflowStepId: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (selectedWorkflowStepId) {\n            const resourceMap = selectors.resourceMapSelector(getState());\n            const resource = resourceMap[selectedWorkflowStepId];\n            if (resource) {\n                dispatch(setSelectedWorkspaceResourceName(resource.name));\n            }\n        }\n        dispatch(setSelectedWorkflowStepIdImpl(selectedWorkflowStepId));\n    };\n}\n\nfunction setSelectedWorkflowStepIdImpl(selectedWorkflowStepId: string): Action {\n    return updateControlState({selectedWorkflowStepId});\n}\n\n\nexport function dropWorkspaceResource(opName: string,\n                                      file: File,\n                                      opArgs: OperationKWArgs,\n                                      resName: string | null,\n                                      overwrite: boolean,\n                                      title: string,\n                                      postAction?: Action | ThunkAction): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const state = getState();\n        const dialogState = selectors.dialogStateSelector(FILE_UPLOAD_DIALOG_ID)(state);\n        const webAPIServiceURL = state.communication.webAPIServiceURL;\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n\n        // Do not fire action when the FileUploadDialog is open as the dialog also uses a drop like event.\n        if (!dialogState.isOpen) {\n            selectors.fileAPISelector(state).uploadFiles(baseDir, file, webAPIServiceURL)\n                     .then((res) => {\n                         showToast({type: res.status, text: 'Upload finished: ' + res.message});\n                         dispatch(setWorkspaceResource(opName, opArgs, resName, overwrite, title, postAction));\n                     })\n                     .catch((error) => {\n                         showToast({type: 'error', text: error.toString()});\n                         console.error(error);\n                     });\n        }\n    }\n}\n\nexport function setWorkspaceResource(opName: string,\n                                     opArgs: OperationKWArgs,\n                                     resName: string | null,\n                                     overwrite: boolean,\n                                     title: string,\n                                     postAction?: Action | ThunkAction): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call(onProgress) {\n            return selectors.workspaceAPISelector(getState()).setWorkspaceResource(baseDir,\n                                                                                   opName,\n                                                                                   opArgs,\n                                                                                   resName,\n                                                                                   overwrite,\n                                                                                   onProgress);\n        }\n\n        function action(result: [WorkspaceState, string]) {\n            const workspace = result[0];\n            const resName = result[1];\n            dispatch(setCurrentWorkspace(workspace));\n\n            const resource = findResourceByName(selectors.resourcesSelector(getState()), resName);\n            const isFigure = isFigureResource(resource);\n            const isAnimation = isAnimationResource(resource);\n            if (!isFigure && !isAnimation) {\n                dispatch(setSelectedWorkspaceResourceName(resName));\n            }\n            if ((isFigure || isAnimation) && getState().session.autoShowNewFigures) {\n                if (isFigure) {\n                    dispatch(showFigureView(resource, selectors.activeViewIdSelector(getState())))\n                } else if (isAnimation) {\n                    dispatch(showAnimationView(resource, selectors.activeViewIdSelector(getState())))\n                }\n            }\n            if (postAction) {\n                dispatch(postAction);\n            }\n        }\n\n        callAPI({dispatch, title, call, action, requireDoneNotification: true});\n    }\n}\n\nexport function setWorkspaceResourcePersistence(resName: string, persistent: boolean): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).setWorkspaceResourcePersistence(baseDir, resName, persistent);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n        }\n\n        callAPI({title: 'Change resource persistence', dispatch, call, action});\n    }\n}\n\nexport function renameWorkspaceResource(resName: string, newResName: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call() {\n            return selectors.workspaceAPISelector(getState()).renameWorkspaceResource(baseDir, resName, newResName);\n        }\n\n        function action(workspace: WorkspaceState) {\n            dispatch(setCurrentWorkspace(workspace));\n            dispatch(renameWorkspaceResourceImpl(resName, newResName));\n        }\n\n        callAPI({title: 'Rename resource', dispatch, call, action});\n    };\n}\n\nexport function renameWorkspaceResourceImpl(resName: string, newResName: string): Action {\n    return {type: RENAME_RESOURCE, payload: {resName, newResName}};\n}\n\nexport function getWorkspaceVariableStatistics(resName: string,\n                                               varName: string,\n                                               varIndex: number[],\n                                               action: (statistics: ImageStatisticsState) => any): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        assert.ok(baseDir);\n\n        function call(onProgress) {\n            return selectors.workspaceAPISelector(getState()).getWorkspaceVariableStatistics(baseDir,\n                                                                                             resName,\n                                                                                             varName,\n                                                                                             varIndex,\n                                                                                             onProgress);\n        }\n\n        function action2(statistics: ImageStatisticsState) {\n            dispatch(action(statistics));\n        }\n\n        const title = `Computing statistics for variable \"${varName}\"`;\n        const requestLock = getLockForGetWorkspaceVariableStatistics(resName, varName, varIndex);\n        callAPI({title, dispatch, call, action: action2, requestLock});\n    }\n}\n\nexport function showTableView(resName: string, varName: string | null, placeAfterViewId: string | null): Action {\n    return {type: SHOW_TABLE_VIEW, payload: {resName, varName, placeAfterViewId}};\n}\n\nexport function showFigureView(resource: ResourceState, placeAfterViewId: string | null): Action {\n    return {type: SHOW_FIGURE_VIEW, payload: {resource, placeAfterViewId}};\n}\n\nexport function showAnimationView(resource: ResourceState, placeAfterViewId: string | null): Action {\n    return {type: SHOW_ANIMATION_VIEW, payload: {resource, placeAfterViewId}};\n}\n\n// noinspection JSUnusedLocalSymbols\nexport function saveFigureImageAs(imageUrl: string, figureId: number): ThunkAction {\n    return () => {\n        if (!electron) {\n            return;\n        }\n        // console.log(\"saveFigureImageAs: \", imageUrl, figureId);\n        electron.shell.openExternal(imageUrl + '/png');\n\n        // showFileSaveDialog({\n        //     title: \"Save Figure As\",\n        //     filters: [\n        //         {name: 'Images', extensions: [\"png\", \"jpeg\", \"tif\"]},\n        //         {name: 'Other', extensions: [\"eps\", \"pdf\", \"ps\", \"raw\", \"svg\"]},\n        //     ]\n        // }, (filePath: string) => {\n        //     console.log(\"saveFigureImageAs:\", filePath);\n        // });\n    };\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Variable actions\n\nexport const SET_SHOW_SELECTED_VARIABLE_LAYER = 'SET_SHOW_SELECTED_VARIABLE_LAYER';\nexport const SET_SELECTED_VARIABLE = 'SET_SELECTED_VARIABLE';\n\nexport function setShowSelectedVariableLayer(showSelectedVariableLayer: boolean): Action {\n    return {type: SET_SHOW_SELECTED_VARIABLE_LAYER, payload: {showSelectedVariableLayer}};\n}\n\nexport function setSelectedVariable(resource: ResourceState,\n                                    selectedVariable: VariableState | null,\n                                    savedLayers?: SavedLayers): Action {\n    return {type: SET_SELECTED_VARIABLE, payload: {resource, selectedVariable, savedLayers}};\n}\n\nexport function addVariableLayer(viewId: string,\n                                 resource: ResourceState,\n                                 variable: VariableState,\n                                 selectLayer: boolean,\n                                 savedLayers?: { [name: string]: LayerState }) {\n    let layer = newVariableLayer(resource, variable, savedLayers);\n    return addLayer(viewId, layer, selectLayer);\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// AppMainPage actions\n\nexport function setLeftPanelContainerLayout(leftPanelContainerLayout: PanelContainerLayout) {\n    return updateSessionState({leftPanelContainerLayout});\n}\n\nexport function setRightPanelContainerLayout(rightPanelContainerLayout: PanelContainerLayout) {\n    return updateSessionState({rightPanelContainerLayout});\n}\n\nexport function setSelectedLeftTopPanelId(selectedLeftTopPanelId: string | null) {\n    return updateSessionState({selectedLeftTopPanelId});\n}\n\nexport function setSelectedLeftBottomPanelId(selectedLeftBottomPanelId: string | null) {\n    return updateSessionState({selectedLeftBottomPanelId});\n}\n\nexport function setSelectedRightTopPanelId(selectedRightTopPanelId: string | null) {\n    return updateSessionState({selectedRightTopPanelId});\n}\n\nexport function setSelectedRightBottomPanelId(selectedRightBottomPanelId: string | null) {\n    return updateSessionState({selectedRightBottomPanelId});\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// ViewManager actions\n\nexport const ADD_WORLD_VIEW = 'ADD_WORLD_VIEW';\nexport const ADD_TABLE_VIEW = 'ADD_TABLE_VIEW';\nexport const SELECT_VIEW = 'SELECT_VIEW';\nexport const CLOSE_VIEW = 'CLOSE_VIEW';\nexport const CLOSE_ALL_VIEWS = 'CLOSE_ALL_VIEWS';\nexport const SPLIT_VIEW_PANEL = 'SPLIT_VIEW_PANEL';\nexport const CHANGE_VIEW_SPLIT_POS = 'CHANGE_VIEW_SPLIT_POS';\nexport const MOVE_VIEW = 'MOVE_VIEW';\n\n\nexport function addWorldView(placeAfterViewId: string | null, baseMapId: string): Action {\n    return {type: ADD_WORLD_VIEW, payload: {placeAfterViewId, baseMapId}};\n}\n\nexport function selectView(viewPath: ViewPath, viewId: string): Action {\n    return {type: SELECT_VIEW, payload: {viewPath, viewId}};\n}\n\nexport function closeView(viewPath: ViewPath, viewId: string): Action {\n    return {type: CLOSE_VIEW, payload: {viewPath, viewId}};\n}\n\nexport function closeAllViews(viewPath: ViewPath): Action {\n    return {type: CLOSE_ALL_VIEWS, payload: {viewPath}};\n}\n\nexport function splitViewPanel(viewPath: ViewPath, dir: SplitDir, pos: number): Action {\n    return {type: SPLIT_VIEW_PANEL, payload: {viewPath, dir, pos}};\n}\n\nexport function changeViewSplitPos(viewPath: ViewPath, delta: number): Action {\n    return {type: CHANGE_VIEW_SPLIT_POS, payload: {viewPath, delta}};\n}\n\nexport function moveView(sourceViewId: string, placement: 'before' | 'after', targetViewId: string): Action {\n    return {type: MOVE_VIEW, payload: {sourceViewId, placement, targetViewId}};\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// World view actions\n\nexport const SET_VIEW_MODE = 'SET_VIEW_MODE';\nexport const SET_PROJECTION_CODE = 'SET_PROJECTION_CODE';\nexport const SET_LAYER_SPLIT_MODE = 'SET_LAYER_SPLIT_MODE';\nexport const SET_LAYER_SPLIT_POSITION = 'SET_LAYER_SPLIT_POSITION';\nexport const SET_SELECTED_ENTITY_ID = 'SET_SELECTED_ENTITY_ID';\nexport const INC_ENTITY_UPDATE_COUNT = 'INC_ENTITY_UPDATE_COUNT';\nexport const UPDATE_ENTITY_STYLE = 'UPDATE_ENTITY_STYLE';\nexport const UPDATE_MOUSE_IDLE_STATE = 'UPDATE_MOUSE_IDLE_STATE';\n\nexport function setViewMode(viewId: string, viewMode: WorldViewMode): Action {\n    return {type: SET_VIEW_MODE, payload: {viewId, viewMode}};\n}\n\nexport function setLayerSplitMode(viewId: string, layerId: string, splitMode: SplitMode): Action {\n    return {type: SET_LAYER_SPLIT_MODE, payload: {viewId, layerId, splitMode}};\n}\n\nexport function setLayerSplitPosition(viewId: string, layerSplitPosition: number): Action {\n    return {type: SET_LAYER_SPLIT_POSITION, payload: {viewId, layerSplitPosition}};\n}\n\nexport function notifySelectedEntityChange(viewId: string, layer: LayerState | null, selectedEntity: Cesium.Entity | null): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n\n        const selectedEntityId = selectedEntity && selectedEntity.id;\n        dispatch(setSelectedEntityId(viewId, isDefined(selectedEntityId) ? selectedEntityId : null));\n\n        if (selectedEntity\n            && isNumber(selectedEntity['_simp'])\n            && isNumber(selectedEntity['_resId'])\n            && isNumber(selectedEntity['_idx'])) {\n            const isGeometrySimplified = (selectedEntity['_simp'] & 0x01) !== 0;\n            if (isGeometrySimplified) {\n                const workspace = selectors.workspaceSelector(getState());\n                if (workspace) {\n                    const resId = selectedEntity['_resId'];\n                    const featureIndex = +selectedEntity['_idx'];\n                    const baseUrl = selectors.webAPIRestUrlSelector(getState());\n                    const baseDir = workspace.baseDir;\n                    const featureUrl = getFeatureUrl(baseUrl, baseDir, {resId}, featureIndex);\n                    reloadEntityWithOriginalGeometry(selectedEntity, featureUrl, (layer as any).style);\n                }\n            }\n        }\n    }\n}\n\nfunction setSelectedEntityId(viewId: string, selectedEntityId: string | null): Action {\n    return {type: SET_SELECTED_ENTITY_ID, payload: {viewId, selectedEntityId}};\n}\n\nexport function updateEntityStyle(view: ViewState<any>, entity: Cesium.Entity, style: SimpleStyle) {\n    return (dispatch: Dispatch) => {\n        const layer = getWorldViewVectorLayerForEntity(view, entity);\n        // We cannot dispatch an action with an entity payload, because action logging will no longer work\n        // (probably because Cesium Entities are not plain objects and contain numerous references\n        // to other complex Cesium objects).\n        // This is why we pass the entity ID as payload.\n        // However, entity IDs are only unique within a Cesium Entity DataSource / Cate Vector Layer,\n        // therefore must pass the layer ID and the entity ID to identify the entity.\n        if (layer) {\n            // We will only dispatch actions for entities belong to our own layers.\n            if (layer.id === MY_PLACES_LAYER_ID) {\n                // If this is the placemarks layer, we store the style change in the placemarks (= feature's)\n                // properties: state.session.placemarkCollection.features[entityId].properties = ...style\n                dispatch(updatePlacemarkStyle(entity.id, style));\n            } else {\n                // For all other layer we update the layer's entity styles:\n                // properties: state.control.views[viewId].data.layers[layerId].entityStyles[entityId] = style\n                dispatch(updateEntityStyleImpl(view.id, layer.id, entity.id, style));\n            }\n        }\n        dispatch(incEntityUpdateCount());\n    };\n}\n\nfunction updateEntityStyleImpl(viewId: string, layerId: string, entityId: string, style: SimpleStyle): Action {\n    return {type: UPDATE_ENTITY_STYLE, payload: {viewId, layerId, entityId, style}};\n}\n\nfunction incEntityUpdateCount(): Action {\n    return {type: INC_ENTITY_UPDATE_COUNT};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Table view actions\n\nexport const UPDATE_TABLE_VIEW_DATA = 'UPDATE_TABLE_VIEW_DATA';\n\nexport function updateTableViewData(viewId: string,\n                                    resName: string | null,\n                                    varName: string | null,\n                                    dataRows?: any[] | null,\n                                    error?: any,\n                                    isLoading?: boolean): Action {\n    dataRows = dataRows || null;\n    error = error || null;\n    isLoading = isLoading || false;\n    return {type: UPDATE_TABLE_VIEW_DATA, payload: {viewId, resName, varName, dataRows, error, isLoading}};\n}\n\nexport function loadTableViewData(viewId: string, resName: string, varName: string | null): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const restUrl = selectors.webAPIRestUrlSelector(getState());\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        const resource = selectors.resourcesSelector(getState()).find(res => res.name === resName);\n        if (resource) {\n            const csvUrl = getCsvUrl(restUrl, baseDir, {resId: resource.id}, varName);\n            dispatch(updateTableViewData(viewId, resName, varName, null, null, true));\n            d3.csv(csvUrl)\n              .then((dataRows: any[]) => {\n                  dispatch(updateTableViewData(viewId, resName, varName, dataRows, null, false));\n              })\n              .catch((error: any) => {\n                  dispatch(updateTableViewData(viewId, resName, varName, null, error, false));\n              });\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Animation view actions\n\nexport const UPDATE_ANIMATION_VIEW_DATA = 'UPDATE_ANIMATION_VIEW_DATA';\n\nexport function loadAnimationViewData(viewId: string, resId: number): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const restUrl = selectors.webAPIRestUrlSelector(getState());\n        const baseDir = selectors.workspaceBaseDirSelector(getState());\n        const htmlUrl = getHtmlUrl(restUrl, baseDir, resId);\n\n        const xmlHttp = new XMLHttpRequest();\n        xmlHttp.onreadystatechange = () => {\n            if (xmlHttp.readyState === 4) {\n                dispatch(setAnimationResult(viewId, xmlHttp.responseText, xmlHttp.status));\n            }\n        };\n        xmlHttp.open('GET', htmlUrl, true); // true for asynchronous\n        xmlHttp.send(null);\n    }\n}\n\nfunction setAnimationResult(viewId: string, innerHTML: string, status: number) {\n    return {type: UPDATE_ANIMATION_VIEW_DATA, payload: {viewId, innerHTML, status}}\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Layer actions\n\nexport const SET_SELECTED_LAYER_ID = 'SET_SELECTED_LAYER_ID';\nexport const ADD_LAYER = 'ADD_LAYER';\nexport const REMOVE_LAYER = 'REMOVE_LAYER';\nexport const UPDATE_LAYER = 'UPDATE_LAYER';\nexport const UPDATE_LAYER_STYLE = 'UPDATE_LAYER_STYLE';\nexport const MOVE_LAYER_UP = 'MOVE_LAYER_UP';\nexport const MOVE_LAYER_DOWN = 'MOVE_LAYER_DOWN';\nexport const SAVE_LAYER = 'SAVE_LAYER';\nexport const SET_BASE_MAP_ID = 'SET_BASE_MAP_ID';\n\nexport function setSelectedLayerId(viewId: string, selectedLayerId: string | null): Action {\n    return {type: SET_SELECTED_LAYER_ID, payload: {viewId, selectedLayerId}};\n}\n\nexport function addLayer(viewId: string, layer: LayerState, selectLayer: boolean): Action {\n    return {type: ADD_LAYER, payload: {viewId, layer, selectLayer}};\n}\n\nexport function removeLayer(viewId: string, id: string): Action {\n    return {type: REMOVE_LAYER, payload: {viewId, id}};\n}\n\nexport function moveLayerUp(viewId: string, id: string): Action {\n    return {type: MOVE_LAYER_UP, payload: {viewId, id}};\n}\n\nexport function moveLayerDown(viewId: string, id: string): Action {\n    return {type: MOVE_LAYER_DOWN, payload: {viewId, id}};\n}\n\nexport function updateLayer(viewId: string, layer: LayerState, ...layerProperties): ThunkAction {\n    return (dispatch: Dispatch) => {\n        if (layerProperties.length) {\n            // layer = {...layer, ...layerProperties};\n            layer = updateObject({}, layer, ...layerProperties);\n        }\n        dispatch(updateLayerImpl(viewId, layer));\n        if (layer.id === AUTO_LAYER_ID) {\n            const varName = (layer as VariableLayerBase).varName;\n            if (varName) {\n                dispatch(saveLayer(varName, layer));\n            }\n        }\n    };\n}\n\nfunction updateLayerImpl(viewId: string, layer: LayerState): Action {\n    return {type: UPDATE_LAYER, payload: {viewId, layer}};\n}\n\nexport function updateLayerStyle(viewId: string, layerId: string, style: SimpleStyle): Action {\n    return {type: UPDATE_LAYER_STYLE, payload: {viewId, layerId, style}};\n}\n\n/**\n * Save layer (in state.session), so it can later be restored.\n *\n * @param key a key\n * @param layer layer data\n * @returns {{type: string, payload: {key: string, layer: LayerState}}}\n */\nexport function saveLayer(key: string, layer: LayerState): Action {\n    return {type: SAVE_LAYER, payload: {key, layer}};\n}\n\nexport function setStyleContext(styleContext: StyleContext) {\n    return updateSessionState({styleContext});\n}\n\nexport function setBaseMap(viewId: string, baseMapId: string): Action {\n    return {type: SET_BASE_MAP_ID, payload: {viewId, baseMapId}};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// ColorMap actions\n\nexport const UPDATE_COLOR_MAPS = 'UPDATE_COLOR_MAPS';\n\n/**\n * Asynchronously load the initial workspace.\n * Called only a single time on app initialisation.\n *\n * @returns a Redux thunk action\n */\nexport function loadColorMaps(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call() {\n            return selectors.colorMapsAPISelector(getState()).getColorMaps();\n        }\n\n        function action(colorMaps: Array<ColorMapCategoryState>) {\n            dispatch(updateColorMaps(colorMaps));\n        }\n\n        callAPI({title: 'Load color maps', dispatch, call, action});\n    }\n}\n\nfunction updateColorMaps(colorMaps: Array<ColorMapCategoryState>): Action {\n    return {type: UPDATE_COLOR_MAPS, payload: {colorMaps}};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// (User) Preferences actions\n\nexport function showPreferencesDialog() {\n    return showDialog('preferencesDialog');\n}\n\nexport function hidePreferencesDialog() {\n    return hideDialog('preferencesDialog');\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Desktop-PWA installation support actions\n\nexport const SHOW_PWA_INSTALL_PROMOTION = 'SHOW_PWA_INSTALL_PROMOTION';\nexport const HIDE_PWA_INSTALL_PROMOTION = 'HIDE_PWA_INSTALL_PROMOTION';\nexport const UPDATE_PWA_DISPLAY_MODE = 'UPDATE_PWA_DISPLAY_MODE';\n\nlet _deferredPwaInstallPrompt: any = null;\n\nexport function showPwaInstallPromotion(deferredPrompt: any): Action {\n    // Prevent the mini info bar from appearing on mobile\n    _deferredPwaInstallPrompt = deferredPrompt;\n    _deferredPwaInstallPrompt.preventDefault();\n    return {type: SHOW_PWA_INSTALL_PROMOTION};\n}\n\nfunction hidePwaInstallPromotion(): Action {\n    return {type: HIDE_PWA_INSTALL_PROMOTION};\n}\n\nexport const showPwaInstallPrompt = (): ThunkAction => (dispatch) => {\n    // Hide the app provided install promotion\n    dispatch(hidePwaInstallPromotion());\n    // Show the install prompt\n    _deferredPwaInstallPrompt.prompt();\n    // Wait for the user to respond to the prompt\n    _deferredPwaInstallPrompt.userChoice.then((choiceResult: any) => {\n        if (choiceResult.outcome === 'accepted') {\n            console.debug('User accepted the install prompt');\n        } else {\n            console.debug('User dismissed the install prompt');\n        }\n    });\n}\n\n/////////////////////////////////////////////////////////////////////////////////////\n// EU GDPR actions\n\nexport const OBTAIN_COOKIE_CONSENT = 'OBTAIN_COOKIE_CONSENT';\n\nexport function obtainCookieConsent(trackingConsentObtained: boolean): Action {\n    return {type: OBTAIN_COOKIE_CONSENT, payload: {trackingConsentObtained}};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// File choosers and message boxes\n\nexport const OPEN_DIRECTORY_SELECT_DIALOG = 'OPEN_DIRECTORY_SELECT_DIALOG';\nexport const CLOSE_DIRECTORY_SELECT_DIALOG = 'CLOSE_DIRECTORY_SELECT_DIALOG';\n\nfunction openDirectorySelectDialog(options: OpenDialogOptions,\n                                   onClose: (result: OpenDialogResult) => any): Action {\n    return {type: OPEN_DIRECTORY_SELECT_DIALOG, payload: {options, onClose}};\n}\n\nfunction closeDirectorySelectDialog(result: OpenDialogResult): Action {\n    return {type: CLOSE_DIRECTORY_SELECT_DIALOG, payload: {result}};\n}\n\n/**\n * Shows a single-directory select dialog.\n * Similar to \"showFileOpenDialog\" but will always return a single directory path or null.\n *\n * @param openDialogOptions the file-open dialog options, see https://github.com/electron/electron/blob/master/docs/api/dialog.md\n * @param onClose a function which is called with the selected directory path or null if the dialog was canceled\n * @returns a thunk action\n */\nexport function showDirectorySelectDialog(openDialogOptions: OpenDialogOptions,\n                                          onClose: (dirPath: string | null) => void): ThunkAction {\n    const propsSet = new Set(openDialogOptions.properties);\n    propsSet.delete('openFile');\n    propsSet.delete('multiSelections');\n    propsSet.add('openDirectory');\n    openDialogOptions = {\n        ...openDialogOptions,\n        title: openDialogOptions.title || 'Select Directory',\n        buttonLabel: openDialogOptions.buttonLabel || 'Select',\n        properties: Array.from(propsSet)\n    };\n    return (dispatch: Dispatch) => {\n        const handleClose = (result: OpenDialogResult) => {\n            dispatch(closeDirectorySelectDialog(result));\n            onClose(!result.canceled && result.filePaths && result.filePaths.length > 0 ? result.filePaths[0] : null);\n        };\n        dispatch(openDirectorySelectDialog(openDialogOptions, handleClose));\n        desktopActions.showFileOpenDialog(openDialogOptions, handleClose);\n    };\n}\n\nexport const OPEN_FILE_OPEN_DIALOG = 'OPEN_FILE_OPEN_DIALOG';\nexport const CLOSE_FILE_OPEN_DIALOG = 'CLOSE_FILE_OPEN_DIALOG';\n\nfunction openFileOpenDialog(options: OpenDialogOptions,\n                            onClose: (result: OpenDialogResult) => any): Action {\n    return {type: OPEN_FILE_OPEN_DIALOG, payload: {options, onClose}};\n}\n\nfunction closeFileOpenDialog(result: OpenDialogResult): Action {\n    return {type: CLOSE_FILE_OPEN_DIALOG, payload: {result}};\n}\n\n\n/**\n * Shows a file open dialog.\n *\n * @param openDialogOptions the file-save dialog options, see https://github.com/electron/electron/blob/master/docs/api/dialog.md\n * @param onClose a function which is called with the open dialog result\n * @returns a thunk action\n */\nexport function showFileOpenDialog(openDialogOptions: OpenDialogOptions,\n                                   onClose: (result: OpenDialogResult) => void): ThunkAction {\n    return (dispatch: Dispatch) => {\n        const handleClose = (result: OpenDialogResult) => {\n            dispatch(closeFileOpenDialog(result));\n            onClose(result);\n        };\n        dispatch(openFileOpenDialog(openDialogOptions, handleClose));\n        desktopActions.showFileOpenDialog(openDialogOptions, handleClose);\n    };\n}\n\n/**\n * Shows a single-file open dialog.\n * Similar to \"showFileOpenDialog\" but will always return a single path or null.\n *\n * @param openDialogOptions the file-open dialog options, see https://github.com/electron/electron/blob/master/docs/api/dialog.md\n * @param onClose a function which is called with the selected file path or null if the dialog was canceled\n * @returns a thunk action\n */\nexport function showSingleFileOpenDialog(openDialogOptions: OpenDialogOptions,\n                                         onClose: (filePath: string | null) => void): ThunkAction {\n    const propsSet = new Set(openDialogOptions.properties);\n    propsSet.delete('multiSelections')\n    openDialogOptions = {...openDialogOptions, properties: Array.from(propsSet)};\n    return showFileOpenDialog(openDialogOptions,\n                              (result => {\n                                  onClose(!result.canceled && result.filePaths.length > 0 ? result.filePaths[0] : null);\n                              }));\n}\n\n/**\n * Shows a multi-file open dialog.\n * Similar to \"showFileOpenDialog\" but will always return a single path or null.\n *\n * @param openDialogOptions the file-open dialog options, see https://github.com/electron/electron/blob/master/docs/api/dialog.md\n * @param onClose a function which is called with the selected file paths\n * @returns a thunk action\n */\nexport function showMultiFileOpenDialog(openDialogOptions: OpenDialogOptions,\n                                        onClose: (filePaths: string[]) => any): ThunkAction {\n    const propsSet = new Set(openDialogOptions.properties);\n    propsSet.add('multiSelections')\n    openDialogOptions = {...openDialogOptions, properties: Array.from(propsSet)};\n    return showFileOpenDialog(openDialogOptions,\n                              (result => {\n                                  onClose(!result.canceled ? result.filePaths : []);\n                              }));\n}\n\nexport const OPEN_FILE_SAVE_DIALOG = 'OPEN_FILE_SAVE_DIALOG';\nexport const CLOSE_FILE_SAVE_DIALOG = 'CLOSE_FILE_SAVE_DIALOG';\n\nfunction openFileSaveDialog(options: SaveDialogOptions,\n                            onClose: (result: SaveDialogResult) => any): Action {\n    return {type: OPEN_FILE_SAVE_DIALOG, payload: {options, onClose}};\n}\n\nfunction closeFileSaveDialog(result: SaveDialogResult): Action {\n    return {type: CLOSE_FILE_SAVE_DIALOG, payload: {result}};\n}\n\n/**\n * Shows a file save dialog.\n *\n * @param saveDialogOptions the file-save dialog options, see https://github.com/electron/electron/blob/master/docs/api/dialog.md\n * @param onClose a function which is called with the selected file path\n * @returns a thunk action\n */\nexport function showFileSaveDialog(saveDialogOptions: SaveDialogOptions,\n                                   onClose: (result: SaveDialogResult) => any): ThunkAction {\n    return (dispatch: Dispatch) => {\n        const handleClose = (result: SaveDialogResult) => {\n            dispatch(closeFileSaveDialog(result));\n            onClose(result);\n        };\n        dispatch(openFileSaveDialog(saveDialogOptions, handleClose));\n        desktopActions.showFileSaveDialog(saveDialogOptions, handleClose);\n    };\n}\n\nexport const OPEN_MESSAGE_BOX = 'OPEN_MESSAGE_BOX';\nexport const CLOSE_MESSAGE_BOX = 'CLOSE_MESSAGE_BOX';\n\n\nfunction openMessageBox(options: MessageBoxOptions,\n                        onClose: (result: MessageBoxResult | null) => void): Action {\n    return {type: OPEN_MESSAGE_BOX, payload: {options, onClose}};\n}\n\nfunction closeMessageBox(result: MessageBoxResult | null): Action {\n    return {type: CLOSE_MESSAGE_BOX, payload: {result}};\n}\n\nexport function showMessageBox(messageBoxOptions: MessageBoxOptions,\n                               onClose?: (result: MessageBoxResult | null) => void): ThunkAction {\n    return (dispatch: Dispatch) => {\n        const handleClose = (result: MessageBoxResult | null) => {\n            dispatch(closeMessageBox(result));\n            if (onClose) {\n                onClose(result);\n            }\n        };\n        dispatch(openMessageBox(messageBoxOptions, handleClose));\n        desktopActions.showMessageBox(messageBoxOptions, handleClose);\n    };\n}\n\nexport const OPEN_FILE_BROWSE_DIALOG = 'OPEN_FILE_BROWSE_DIALOG';\nexport const CLOSE_FILE_BROWSE_DIALOG = 'CLOSE_FILE_BROWSE_DIALOG';\n\nfunction openFileBrowseDialog(filePath: string,\n                              onClose: () => any): Action {\n    return {type: OPEN_FILE_BROWSE_DIALOG, payload: {options: {defaultPath: filePath}, onClose}};\n}\n\nfunction closeFileBrowseDialog(): Action {\n    return {type: CLOSE_FILE_BROWSE_DIALOG};\n}\n\n/**\n * Show the given file in a file manager. If possible, select the file.\n * @param fullPath\n */\nexport function showItemInFolder(fullPath: string): ThunkAction {\n    return (dispatch: Dispatch) => {\n        const handleClose = () => {\n            dispatch(closeFileBrowseDialog());\n        };\n        dispatch(openFileBrowseDialog(fullPath, handleClose));\n        desktopActions.showItemInFolder(fullPath);\n    };\n}\n\n/**\n * Open the given URL in the desktop's default manner.\n *\n * @param url The URL.\n * @returns {boolean}\n */\nexport function openExternal(url: string): boolean {\n    if (hasElectron('openExternal')) {\n        return electron.shell.openExternal(url);\n    }\n    return false;\n}\n\n\n/**\n * Copies given text to clipboard.\n * @param text The text to be copied.\n */\nexport function copyTextToClipboard(text: string) {\n    if (hasElectron('copyTextToClipboard')) {\n        // noinspection JSIgnoredPromiseFromCall\n        electron.clipboard.writeText(text);\n    } else {\n        copyToClipboard(text);\n    }\n}\n\n/////////////////////////////////////////////////////////////////////////////////////\n// File upload/download\n\nexport function fileUploadInteractive() {\n    return showDialog('fileUploadDialog');\n}\n\nexport function fileDownloadInteractive() {\n    return showDialog('fileDownloadDialog');\n}\n\nexport function uploadFiles(dir: string, file: File): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const state = getState();\n        const webAPIServiceURL = state.communication.webAPIServiceURL;\n\n        selectors.fileAPISelector(state).uploadFiles(dir, file, webAPIServiceURL)\n                 .then((res) => {\n                     dispatch(updateFileNode(dir + '/' + file.name, true));\n                     showToast({type: res.status, text: 'Upload finished: ' + res.message});\n                 })\n                 .catch((error) => {\n                     showToast({type: 'error', text: error.toString()});\n                     console.error(error);\n                 });\n    }\n}\n\nexport function monitorProcess(processId: string): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        function call(onProgress) {\n            return selectors.fileAPISelector(getState()).monitorProcess(processId, onProgress);\n        }\n\n        function action() {\n            console.info('testing');\n        }\n\n        callAPI({title: 'Monitoring Progress', dispatch, call, action});\n    }\n}\n\nexport function downloadFiles(filePaths: string[]): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        const state = getState();\n        const webAPIServiceURL = state.communication.webAPIServiceURL;\n        const api = selectors.fileAPISelector(state);\n\n        api.downloadFiles(filePaths, 'ignore', webAPIServiceURL)\n           .then(() => {\n               showToast({type: 'success', text: 'Zip ready for download.'});\n           })\n           .catch((error) => {\n               showToast({type: 'error', text: error.toString()});\n               console.error(error);\n           });\n\n    }\n}\n\nfunction hasElectron(functionName: string): boolean {\n    if (!electron) {\n        console.warn(`${functionName}() cannot be executed, module electron not available`);\n        return false;\n    } else if (!electron.ipcRenderer) {\n        console.warn(`${functionName}() cannot be executed, module electron.ipcRenderer not available`);\n        return false;\n    }\n    return true;\n}\n\nexport function handleFetchError(error: any, message: string) {\n    console.info('fetch error: ', message, error);\n    let suffix = '';\n    if (error instanceof HttpError) {\n        if (error.statusText) {\n            suffix = ` (HTTP status ${error.status}: ${error.statusText})`;\n        } else {\n            suffix = ` (HTTP status ${error.status})`;\n        }\n    } else if (error instanceof TypeError) {\n        suffix = ' (wrong URL or no internet)';\n    } else if (error instanceof Error && error.message) {\n        suffix = ` (${error.message})`;\n    }\n    showToast({type: 'error', text: message + suffix});\n}\n\n\nlet _handlersInstalled: boolean = false;\n\nexport function installGlobalHandlers(): ThunkAction {\n    return (dispatch: Dispatch, getState: GetState) => {\n        if (_handlersInstalled) {\n            return;\n        }\n\n        if (electron && electron.ipcRenderer) {\n            const ipcRenderer = electron.ipcRenderer;\n\n            ipcRenderer.on('update-initial-state', (event, initialState) => {\n                dispatch(updateInitialState(initialState));\n            });\n\n            ipcRenderer.on('new-workspace', () => {\n                dispatch(newWorkspaceInteractive() as any);\n            });\n\n            ipcRenderer.on('open-workspace', () => {\n                dispatch(openWorkspaceInteractive() as any);\n            });\n\n            ipcRenderer.on('close-workspace', () => {\n                dispatch(closeWorkspaceInteractive() as any);\n            });\n\n            ipcRenderer.on('save-workspace', () => {\n                dispatch(saveWorkspaceInteractive() as any);\n            });\n\n            ipcRenderer.on('save-workspace-as', () => {\n                dispatch(saveWorkspaceAsInteractive());\n            });\n\n            ipcRenderer.on('delete-workspace', () => {\n                dispatch(deleteWorkspaceInteractive() as any);\n            });\n\n            ipcRenderer.on('show-preferences-dialog', () => {\n                dispatch(showPreferencesDialog());\n            });\n\n            ipcRenderer.on('logout', () => {\n                // dispatch(logout() as any);\n            });\n        }\n\n        document.addEventListener('drop', function (event: any) {\n            event.preventDefault();\n            event.stopPropagation();\n            for (let file of event.dataTransfer.files) {\n                readDroppedFile(file, dispatch);\n            }\n        });\n\n        document.addEventListener('dragover', function (event: any) {\n            event.preventDefault();\n            event.stopPropagation();\n        });\n\n        window.addEventListener('beforeunload', (event: any) => {\n            event.preventDefault();\n            const state = getState();\n            if (state.communication.webAPIClient) {\n                dispatch(savePreferences() as any);\n            }\n            return null;\n        });\n\n        _handlersInstalled = true;\n    }\n}\n\nfunction readDroppedFile(file: File, dispatch: Dispatch) {\n    let opName, opArgs;\n    if (file.name.endsWith('.nc')) {\n        opName = 'read_netcdf';\n        // opArgs = {file: {value: file.path}, normalize: {value: false}}\n    } else if (file.name.endsWith('.txt')) {\n        opName = 'read_text';\n    } else if (file.name.endsWith('.json')) {\n        opName = 'read_json';\n    } else if (file.name.endsWith('.csv')) {\n        opName = 'read_csv';\n    } else if (file.name.endsWith('.geojson') || file.name.endsWith('.shp') || file.name.endsWith('.gml')) {\n        opName = 'read_geo_data_frame';\n    }\n    if (!opArgs) {\n        opArgs = {file: {value: file.name}};\n    }\n    if (opName) {\n        dispatch(dropWorkspaceResource(opName,\n                                       file,\n                                       opArgs,\n                                       null,\n                                       false,\n                                       `Reading dropped file ${file.name}`) as any);\n    } else {\n        console.warn('Dropped file of unrecognized type: ', file.name);\n    }\n}\n","// Requires preload.js in cate-desktop:\r\n//\r\n//  import * as electron from 'electron';\r\n//  (window as any).electron = electron;\r\n//\r\nconst electron = (window as any).electron || null;\r\n\r\nexport default electron;","import copyToClipboard from 'copy-to-clipboard';\r\nimport {\r\n    DesktopActions,\r\n    MessageBoxOptions,\r\n    MessageBoxResult,\r\n    OpenDialogOptions,\r\n    OpenDialogResult,\r\n    SaveDialogOptions, SaveDialogResult\r\n} from './types';\r\nimport electron from './electron';\r\n\r\nconst newDesktopActions = (): DesktopActions => {\r\n\r\n    if (electron) {\r\n        return {\r\n            isNativeUI: true,\r\n\r\n            showFileOpenDialog: (openDialogOptions: OpenDialogOptions, onClose: (result: OpenDialogResult) => any): void => {\r\n                const actionName = 'show-open-dialog';\r\n                electron.ipcRenderer.send(actionName, openDialogOptions, false);\r\n                electron.ipcRenderer.once(actionName + '-reply', (event, result: OpenDialogResult) => {\r\n                    onClose(result);\r\n                });\r\n            },\r\n\r\n            showFileSaveDialog: (saveDialogOptions: SaveDialogOptions, onClose: (result: SaveDialogResult) => any): void => {\r\n                const actionName = 'show-save-dialog';\r\n                electron.ipcRenderer.send(actionName, saveDialogOptions, false);\r\n                electron.ipcRenderer.once(actionName + '-reply', (event, result: SaveDialogResult) => {\r\n                    onClose(result);\r\n                });\r\n            },\r\n\r\n            showMessageBox: (messageBoxOptions: MessageBoxOptions, onClose: (result: MessageBoxResult | null) => any): void => {\r\n                const actionName = 'show-message-box';\r\n                if (!messageBoxOptions.buttons) {\r\n                    messageBoxOptions = {...messageBoxOptions, buttons: ['OK']};\r\n                }\r\n                electron.ipcRenderer.send(actionName, messageBoxOptions, false);\r\n                electron.ipcRenderer.once(actionName + '-reply', (event, buttonIndex: number, checkboxChecked: boolean) => {\r\n                    onClose({buttonIndex, checkboxChecked});\r\n                });\r\n            },\r\n\r\n            showItemInFolder: (fullPath: string): Promise<boolean> => {\r\n                return Promise.resolve(electron.shell.showItemInFolder(fullPath));\r\n            },\r\n\r\n            openItem: (fullPath: string): Promise<boolean> => {\r\n                return Promise.resolve(electron.shell.openItem(fullPath));\r\n            },\r\n\r\n            openExternal: (url: string): Promise<boolean> => {\r\n                return Promise.resolve(electron.shell.openExternal(url));\r\n            },\r\n\r\n            copyTextToClipboard: (text: string): Promise<boolean> => {\r\n                return electron.clipboard.writeText(text);\r\n            },\r\n        }\r\n    } else {\r\n        // noinspection JSUnusedLocalSymbols\r\n        return {\r\n            isNativeUI: false,\r\n\r\n            showFileOpenDialog: (openDialogOptions: OpenDialogOptions, onClose: (result: OpenDialogResult) => any): void => {\r\n                // UI generated by React component MessageBox\r\n            },\r\n\r\n\r\n            showFileSaveDialog: (saveDialogOptions: SaveDialogOptions, onClose: (result: SaveDialogResult) => any): void => {\r\n                // UI generated by React\r\n            },\r\n\r\n            showMessageBox: (messageBoxOptions: MessageBoxOptions, onClose: (result: MessageBoxResult | null) => any): void => {\r\n                // UI generated by React\r\n            },\r\n\r\n            showItemInFolder: (fullPath: string): Promise<boolean> => {\r\n                // UI generated by React\r\n                return Promise.resolve(true);\r\n            },\r\n\r\n            copyTextToClipboard: (text: string): Promise<boolean> => {\r\n                return new Promise((callback: (result: boolean) => any) => {\r\n                    copyToClipboard(text, {onCopy: () => callback(true)});\r\n                });\r\n            },\r\n        }\r\n    }\r\n};\r\n\r\nexport default newDesktopActions();","/**\r\n * Job-related interfaces and type definitions.\r\n *\r\n * @author Norman Fomferra\r\n */\r\n\r\n/**\r\n * A job represents the execution of a remote method.\r\n */\r\nexport interface Job {\r\n    getRequest(): JobRequest;\r\n\r\n    getStatus(): JobStatus;\r\n\r\n    isCancelled(): boolean;\r\n\r\n    cancel(): void;\r\n}\r\n\r\n/**\r\n * A promise representing a remote method call.\r\n */\r\nexport interface JobPromise<JobResponse> extends Promise<JobResponse> {\r\n    getJob(): Job;\r\n\r\n    getJobId(): number;\r\n}\r\n\r\n/**\r\n * All the possible job statuses.\r\n */\r\nexport type JobStatus = 'NEW' | 'SUBMITTED' | 'IN_PROGRESS' | 'FAILED' | 'CANCELLED' | 'DONE';\r\n\r\nexport class JobStatusEnum {\r\n    static readonly NEW = 'NEW';\r\n    static readonly SUBMITTED = 'SUBMITTED';\r\n    static readonly IN_PROGRESS = 'IN_PROGRESS';\r\n    static readonly DONE = 'DONE';\r\n    static readonly FAILED = 'FAILED';\r\n    static readonly CANCELLED = 'CANCELLED';\r\n}\r\n\r\n/**\r\n * Represents a job request using the JSON-RCP 2.0 style.\r\n */\r\nexport interface JobRequest {\r\n    /** The JSON-RCP message identifier. */\r\n    readonly id: number;\r\n    readonly method: string;\r\n    readonly params: Array<any> | Object;\r\n}\r\n\r\n/**\r\n * Job progress information, this is a Cate-specific extension to JSON-RCP 2.0.\r\n */\r\nexport interface JobProgress {\r\n    /** The JSON-RCP message identifier. */\r\n    readonly id: number;\r\n    readonly label?: string;\r\n    readonly message?: string;\r\n    readonly total?: number;\r\n    readonly worked?: number;\r\n}\r\n\r\n/**\r\n * Represents a job failure using the JSON-RCP 2.0 style.\r\n */\r\nexport interface JobFailure {\r\n\r\n    /** A Number that indicates the error type that occurred. */\r\n    readonly code: number;\r\n\r\n    /** A the error message. */\r\n    readonly message: string;\r\n\r\n    /**\r\n     * A Primitive or Structured value that contains additional information about the error.\r\n     * This may be omitted.\r\n     * The value of this member is defined by the Server (e.g. detailed error information, nested errors etc.).\r\n     */\r\n    readonly data?: JobFailureInfo;\r\n}\r\n\r\n/**\r\n * Detailed error information.\r\n */\r\nexport interface JobFailureInfo {\r\n    /** The name of the method which was called while the error occurred. */\r\n    readonly method: string;\r\n\r\n    /** The name of the exception type, e.g. \"OSError\", \"ValidationError\". */\r\n    readonly exception: string;\r\n\r\n    /** Stack trace */\r\n    readonly traceback: string;\r\n}\r\n\r\n/**\r\n * A callback listening for job progress messages.\r\n */\r\nexport type JobProgressHandler = (progress: JobProgress) => void;\r\n\r\n/**\r\n * A callback listening for job responses.\r\n */\r\nexport type JobResponseHandler<JobResponse> = (response: JobResponse) => void;\r\n\r\n/**\r\n * A callback listening for job failures.\r\n */\r\nexport type JobFailureHandler = (failure: JobFailure) => void;\r\n\r\n"],"sourceRoot":""}